<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:magic_proto_property&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:magic_proto_property&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:magic_proto_property&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:magic_proto_property&amp;do=export_html.html#standardizing_the_magic_proto_property" class="toc">Standardizing The Magic __proto__ Property</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:magic_proto_property&amp;do=export_html.html#draft_specification" class="toc">Draft Specification</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:magic_proto_property&amp;do=export_html.html#background" class="toc">Background</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:magic_proto_property&amp;do=export_html.html#normative-optional_proposal_currently_in_es5_spec_language" class="toc">Normative-Optional Proposal (currently in ES5 spec language)</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:magic_proto_property&amp;do=export_html.html#open_issues" class="toc">Open Issues</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="standardizing_the_magic_proto_property"></a><h1>Standardizing The Magic __proto__ Property</h1>
<div class="level1">

</div>
<!-- SECTION [1-59] -->
<a name="draft_specification"></a><h2>Draft Specification</h2>
<div class="level2">

<p>
 The draft of the specification for this feature for incorporation into the ES6 working draft is here: <a href="lib/exe/fetch.php%3Fid=strawman%253Amagic_proto_property&amp;cache=cache&amp;media=harmony:draft_proto_spec_rev2.pdf" class="urlextern" title="harmony:draft_proto_spec_rev2.pdf" style="background-image: url(lib/images/fileicons/pdf.png)" onclick="return svchk()" onkeypress="return svchk()">draft_proto_spec_rev2.pdf</a>
</p>

</div>
<!-- SECTION [60-233] -->
<a name="background"></a><h2>Background</h2>
<div class="level2">

<p>
 See <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-December/019025.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2011-December/019025.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Why we need to clean up __proto__</a> for the motivation.
</p>

<p>
Proposed Requirements:
</p>
<ol>
<li class="level1"><div class="li"> That __proto__ be specified as &ldquo;Normative-Optional&rdquo;, which will in general be the new status of the Appendix B items. Normative-Optional means that there is no requirement or encouragement that the feature be implemented. <acronym title="Internet Explorer">IE</acronym>&lsquo;s current behavior of omitting it would still be standards conformant. However, if a feature of this name is provided, then it must act as specified. This allows name-based feature testing code to be correct. (This is in practice how Appendix B has been treated. This change in spec language would make it official.)</div>
</li>
<li class="level1"><div class="li"> If present, __proto__ is present <em>only</em> on Object.prototype as an accessor property, approximately as it is on FF today.</div>
</li>
<li class="level1"><div class="li"> Object.prototype.__proto__ have attributes {get: ..., set: ..., enumerable: false, configurable: true}. Currently FF reports this as being a non-configurable data property, and it is in fact non-deletable. With this change, conforming platforms would be honest about __proto__&lsquo;s accessor nature, and would allow it to be deleted. If deleted, then it is no longer there to be inherited by any other objects in that context (frame).</div>
</li>
<li class="level1"><div class="li"> Object.create(null), creating an object that does not inherit from Object.prototype, also creates an object that does not inherit it&rsquo;s __proto__, even if that property has not been deleted. With this change, objects-as-stringmaps for objects created by Object.create(null) would avoid the __proto__ hazard, even in contexts where Object.prototype.__proto__ has not been deleted. (FF already acts this way, so my previous message was wrong in claiming that Object.create(null) fails to avoid this platform on all non-<acronym title="Internet Explorer">IE</acronym> browsers.)</div>
</li>
<li class="level1"><div class="li"> If Object.prototype.__proto__ is present, then its setter is the only means of altering the [[Prototype]] property of objects, and works only for objects from that context (frame). If Object.prototype.__proto__ is absent or deleted, that there by no remaining way to alter the [[Prototype]] property of objects from that context.</div>
</li>
<li class="level1"><div class="li"> The previous item presents a problem for proxies. With __proto__&lsquo;s setter being normative optional, should proxies also have a normative optional trap for attempts to set their [[Prototype]]? If so, then presumably there should also be such an operation in that context&rsquo;s @reflect module. In that case, it no longer clear what to do to lock down a context so that the [[Prototype]] of its objects can no longer be mutated.</div>
</li>
</ol>

</div>
<!-- SECTION [234-2876] -->
<a name="normative-optional_proposal_currently_in_es5_spec_language"></a><h2>Normative-Optional Proposal (currently in ES5 spec language)</h2>
<div class="level2">

<p>
 <em>The following proposal is my elaboration of a suggestion made verbally by Dave Herman at the 11/2011 EcmaScript committee meeting. &ndash;MarkM</em>
</p>

<p>
<strong>B.?? Object.prototype.__proto__</strong>
</p>

<p>
The Object.prototype.__proto__ property, if present, has attributes  { [[Get]]: [[ProtoGetter]], [[Set]]: [[ProtoSetter]], [[Enumerable]]: false, [[Configurable]]: true }.
</p>

<p>
<strong>B.?? [[ProtoGetter]]()</strong>
</p>
<ol>
<li class="level1"><div class="li"> Let O be the result of calling ToObject passing <strong>this</strong> as the argument.</div>
</li>
<li class="level1"><div class="li"> Return the value of the [[Prototype]] property of O.</div>
</li>
</ol>

<p>
 <strong>B.?? [[ProtoSetter]](Parent)</strong>
</p>
<ol>
<li class="level1"><div class="li"> Let O be the result of calling ToObject passing <strong>this</strong> as the argument.</div>
</li>
<li class="level1"><div class="li"> If O is not an object from this context, throw a <strong>TypeError</strong> exception.</div>
</li>
<li class="level1"><div class="li"> If O is non-extensible, throw a <strong>TypeError</strong> exception.</div>
</li>
<li class="level1"><div class="li"> If Parent is null, let P be null. Else let P be the result of calling ToObject passing Parent as the argument.</div>
</li>
<li class="level1"><div class="li"> Set the [[Prototype]] property of O to P.</div>
</li>
</ol>

<p>
 [[ProtoSetter]] shall be the exclusive means for mutating the [[Prototype]] property of objects in this context. <em>(See note above about possible conflict with Proxy goals.)</em>
</p>

</div>
<!-- SECTION [2877-4113] -->
<a name="open_issues"></a><h2>Open Issues</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> As noted in the newsgroup, I contend we are making unnecessary work (the &ldquo;frame check&rdquo;) and borrowing trouble (unknown, speculative based on experience extending semantics without long-duration field trials) by reflecting <code>__proto__</code> as an accessor with a usable setter. Either we should reflect as a data property, or supply a poisoned setter as Andreas R. suggested.  &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2012/02/18 20:23</em></div>
</li>
</ul>

</div>
<!-- SECTION [4114-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/4/456590d64fa03021cf91383c73674e31.xhtml used -->
</body>
</html>
