<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:classes_with_trait_composition [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:classes_with_trait_composition&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:classes_with_trait_composition&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:classes_with_trait_composition&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2011-05-22T21:17:32+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:classes_with_trait_composition&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:classes_with_trait_composition</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:classes_with_trait_composition" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:classes_with_trait_composition" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:generators.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:generators">generators</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:modules.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:modules">modules</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:allen_wirfs-brock_s_comments_on_ephemeron_table_proposal.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:allen_wirfs-brock_s_comments_on_ephemeron_table_proposal">allen_wirfs-brock_s_comments_on_ephemeron_table_proposal</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:names.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:names">names</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:classes_with_trait_composition">classes_with_trait_composition</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#classes_with_trait_composition" class="toc">Classes with Trait Composition</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#motivation" class="toc">Motivation</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#the_proposal_in_a_nutshell" class="toc">The Proposal in a Nutshell</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#class_body" class="toc">Class Body</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#member_modifiers" class="toc">Member Modifiers</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#the_proposal_in_full" class="toc">The Proposal In Full</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#class_declarations_and_expressions" class="toc">Class Declarations and Expressions</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#grammar" class="toc">Grammar</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#class_adjective" class="toc">Class Adjective</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#const" class="toc">const</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#grammar" class="toc">Grammar</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#class_members" class="toc">Class Members</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#grammar" class="toc">Grammar</a></span></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#refinements" class="toc">Refinements</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#inheritance" class="toc">Inheritance</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#grammar" class="toc">Grammar</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#constructor_chaining" class="toc">Constructor Chaining</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#grammar" class="toc">Grammar</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#member_delegation" class="toc">Member Delegation</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#grammar" class="toc">Grammar</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#private_instance_members" class="toc">Private Instance Members</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#grammar" class="toc">Grammar</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#alternate_syntax" class="toc">Alternate Syntax</a></span></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#proposal_history" class="toc">Proposal History</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#open_issues" class="toc">Open Issues</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#see" class="toc">See</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="classes_with_trait_composition"></a><h1>Classes with Trait Composition</h1>
<div class="level1">

</div>

<a name="motivation"></a><h2>Motivation</h2>
<div class="level2">

<p>
 ECMAScript already has excellent features for defining abstractions for kinds of things. The trinity of constructor functions, prototypes, and instances are more than adequate for solving the problems that classes solve in other languages. The intent this strawman is not to change those semantics. Instead, it’s to provide a <em>terse</em> and <em>declarative</em> surface for those semantics so that <em>programmer intent</em> is shown instead of the <em>underlying imperative machinery</em>.
</p>

<p>
For example, here is code from <a href="https://github.com/mrdoob/three.js/blob/master/src/objects/SkinnedMesh.js" class="urlextern" target="_blank" title="https://github.com/mrdoob/three.js/blob/master/src/objects/SkinnedMesh.js" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">three.js</a> (simplified and modified slightly), with comments for the intent behind each line.
</p>
<pre class="code javascript"><span class="co1">// define a new type SkinnedMesh and a constructor for it</span>
<span class="kw2">function</span> SkinnedMesh<span class="br0">&#40;</span>geometry, materials<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="co1">// call the superclass constructor</span>
  THREE.<span class="me1">Mesh</span>.<span class="me1">call</span><span class="br0">&#40;</span><span class="kw1">this</span>, geometry, materials<span class="br0">&#41;</span>;
&nbsp;
  <span class="co1">// initialize instance fields</span>
  <span class="kw1">this</span>.<span class="me1">identityMatrix</span> = <span class="kw2">new</span> THREE.<span class="me1">Matrix4</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;
  <span class="kw1">this</span>.<span class="me1">bones</span> = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
  <span class="kw1">this</span>.<span class="me1">boneMatrices</span> = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
  ...
<span class="br0">&#125;</span>;
&nbsp;
<span class="co1">// inherit behavior from Mesh</span>
SkinnedMesh.<span class="me1">prototype</span> = Object.<span class="me1">create</span><span class="br0">&#40;</span>THREE.<span class="me1">Mesh</span>.<span class="me1">prototype</span><span class="br0">&#41;</span>;
SkinnedMesh.<span class="me1">prototype</span>.<span class="me1">constructor</span> = SkinnedMesh;
&nbsp;
<span class="co1">// define an overridden update() method</span>
SkinnedMesh.<span class="me1">prototype</span>.<span class="me1">update</span> = <span class="kw2">function</span><span class="br0">&#40;</span>camera<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  ...
  <span class="co1">// call base version of same method</span>
  THREE.<span class="me1">Mesh</span>.<span class="me1">prototype</span>.<span class="me1">update</span>.<span class="me1">call</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span>;</pre>
<p>
With class syntax, this becomes:
</p>
<pre class="code javascript"><span class="kw2">class</span> SkinnedMesh <span class="kw2">extends</span> THREE.<span class="me1">Mesh</span> <span class="br0">&#123;</span>
  constructor<span class="br0">&#40;</span>geometry, materials<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">super</span><span class="br0">&#40;</span>geometry, materials<span class="br0">&#41;</span>;
&nbsp;
    <span class="kw1">this</span>.<span class="me1">identityMatrix</span> = <span class="kw2">new</span> THREE.<span class="me1">Matrix4</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;
    <span class="kw1">this</span>.<span class="me1">bones</span> = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
    <span class="kw1">this</span>.<span class="me1">boneMatrices</span> = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
    ...
  <span class="br0">&#125;</span>
&nbsp;
  update<span class="br0">&#40;</span>camera<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    ...
    <span class="kw2">super</span>.<span class="me1">update</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<a name="the_proposal_in_a_nutshell"></a><h2>The Proposal in a Nutshell</h2>
<div class="level2">

<p>
 Before we lay out the detailed grammar and semantics, we&rsquo;ll show the core concepts by example. If there are places where this section disagrees with later parts of the proposal, those parts take precedence.
</p>

</div>

<a name="class_body"></a><h3>Class Body</h3>
<div class="level3">

<p>
 A class defines four objects and their properties: a constructor function, a prototype, a new instance, and a private record bound to the new instance. The body of a class is a collection of member definitions. This example shows each of the kinds of members that can be defined:
</p>
<pre class="code javascript"><span class="kw2">class</span> Monster <span class="br0">&#123;</span>
  <span class="co1">// The contextual keyword &quot;constructor&quot; followed by an argument</span>
  <span class="co1">// list and a body defines the body of the class’s constructor</span>
  <span class="co1">// function.</span>
  constructor<span class="br0">&#40;</span><span class="kw3">name</span>, health<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">this</span>.<span class="kw3">name</span> = <span class="kw3">name</span>;
    <span class="kw2">private</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span>.<span class="me1">health</span> = health;
  <span class="br0">&#125;</span>
&nbsp;
  <span class="co1">// An identifier followed by an argument list and body defines a</span>
  <span class="co1">// method. A “method” here is simply a function property on some</span>
  <span class="co1">// object.</span>
  attack<span class="br0">&#40;</span>target<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    log<span class="br0">&#40;</span><span class="st0">'The monster attacks '</span> + target<span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>
&nbsp;
  <span class="co1">// The contextual keyword &quot;get&quot; followed by an identifier and</span>
  <span class="co1">// a curly body defines a getter in the same way that &quot;get&quot;</span>
  <span class="co1">// defines one in an object literal.</span>
  get isAlive<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw1">this</span>.<span class="me1">health</span> &gt; <span class="nu0">0</span>;
  <span class="br0">&#125;</span>
&nbsp;
  <span class="co1">// Likewise, &quot;set&quot; can be used to define setters.</span>
  set health<span class="br0">&#40;</span>value<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>value &lt; <span class="nu0">0</span><span class="br0">&#41;</span> <span class="kw1">throw</span> <span class="kw2">new</span> Error<span class="br0">&#40;</span><span class="st0">'Health must be non-negative.'</span><span class="br0">&#41;</span>
    <span class="kw2">private</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span>.<span class="me1">health</span> = value
  <span class="br0">&#125;</span>
&nbsp;
  <span class="co1">// An identifier optionally followed by &quot;=&quot; and an expression</span>
  <span class="co1">// declares a field and initializes it to the value of that</span>
  <span class="co1">// expression.</span>
  numAttacks = <span class="nu0">0</span>;
&nbsp;
  <span class="co1">// The keyword &quot;const&quot; followed by an identifier and an</span>
  <span class="co1">// initializer declares a constant field.</span>
  <span class="kw2">const</span> attackMessage = <span class="st0">'The monster hits you!'</span>;
<span class="br0">&#125;</span></pre>
</div>

<a name="member_modifiers"></a><h3>Member Modifiers</h3>
<div class="level3">

<p>
 Since a class body defines properties on <em>four</em> objects, syntax is needed to indicate which object the member becomes a property on. Keyword prefixes are used:
</p>
<pre class="code javascript"><span class="kw2">class</span> Monster <span class="br0">&#123;</span>
  <span class="co1">// &quot;static&quot; places the property on the constructor.</span>
  static allMonsters = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
&nbsp;
  <span class="co1">// No keyword places it on the prototype.</span>
  numAttacks = <span class="nu0">0</span>;
&nbsp;
  <span class="co1">// &quot;public&quot; places it on the new instance.</span>
  <span class="kw2">public</span> <span class="kw3">name</span>;
&nbsp;
  <span class="co1">// &quot;private&quot; places it on the private record of the new instance.</span>
  <span class="kw2">private</span> health;
<span class="br0">&#125;</span></pre>
</div>

<a name="the_proposal_in_full"></a><h2>The Proposal In Full</h2>
<div class="level2">

</div>

<a name="class_declarations_and_expressions"></a><h3>Class Declarations and Expressions</h3>
<div class="level3">

<p>
 A class is both a blueprint for describing instances and a factory to create them. Like functions, a class can either be a <em>declaration</em> or an <em>expression</em>. Both define a constructor function to represent that class. We&rsquo;ll refer to that function as a &ldquo;class&rdquo;. We&rsquo;ll use &ldquo;class definition&rdquo; to refer to either a class declaration or expression when the distinction doesn&rsquo;t matter.
</p>

<p>
Like a function declaration, a class <em>declaration</em> defines a variable with the class&rsquo;s name whose declaration is hoisted to the beginning of the surrounding scope. This supports mutual recursion among function and class declarations. Like a function expression, a class <em>expression</em> defines an anonymous class if the identifier is omitted, or, if present, binds the class name only in the scope seen by the class being defined.
</p>

<p>
When a scope (Block, FunctionBody, Program, etc.) is entered, the variables declared by all immediately contained function and class declarations are bound to their respective functions and classes. Then all class bodies are executed in textual order. A class body defines and initializes class-wide properties once when the class definition is evaluated. This includes properties on the constructor function (the &ldquo;class&rdquo; itself) and on its prototype property. These initializations happen in textual order.
</p>

</div>

<a name="grammar"></a><h4>Grammar</h4>
<div class="level4">

<p>
 We extend the Declaration production from <a href="doku.php%3Fid=harmony:block_scoped_bindings.html" class="wikilink1" title="harmony:block_scoped_bindings" onclick="return svchk()" onkeypress="return svchk()">block scoped bindings</a> to accept a <em>ClassDeclaration</em>. We extend MemberExpression to accept a <em>ClassExpression</em>.
</p>
<pre class="code">
Declaration :
    ClassDeclaration
    ...
ClassDeclaration :
    class Identifier { ClassBody }

MemberExpression :
    ClassExpression
    ...
ClassExpression :
    class Identifier? { ClassBody }
ExpressionStatement :
    [lookahead not-in { &quot;{&quot;, &quot;function&quot;, &quot;class&quot; }] Expression ;

ClassBody :
    ClassElement*

// &quot;...&quot; means existing members defined elsewhere
</pre>

</div>

<a name="class_adjective"></a><h3>Class Adjective</h3>
<div class="level3">

<p>
 A class definition may be prefixed with an adjective to clarify its role. Currently, the only adjective proposed is <code>const</code>, but this set may expand.
</p>

</div>

<a name="const"></a><h4>const</h4>
<div class="level4">

<p>
 A <code>const</code> class provides high integrity. Both the constructor function and prototype object are frozen and the variable the class is bound to is <a href="doku.php%3Fid=harmony:const.html" class="wikilink1" title="harmony:const" onclick="return svchk()" onkeypress="return svchk()">const</a> (non-assignable). Instances of the class are sealed.
</p>

<p>
In other words, given this definition:
</p>
<pre class="code javascript"><span class="kw2">const</span> <span class="kw2">class</span> Empty <span class="br0">&#123;</span> <span class="br0">&#125;</span></pre>
<p>
The variable <code>Empty</code> is const, the constructor function it references is frozen, and <code>Empty.prototype</code> is frozen. Calling <code>new Empty()</code> returns a sealed object.
</p>

</div>

<a name="grammar"></a><h4>Grammar</h4>
<div class="level4">

<p>
 We revise the previous grammar to allow adjectives before <code>class</code>.
</p>
<pre class="code">
ClassDeclaration :
    ClassAdjective* class Identifier { ClassBody }
ClassExpression :
    ClassAdjective* class Identifier? { ClassBody }

ClassAdjective :
    const
ExpressionStatement :
    [lookahead not-in { &quot;{&quot;, &quot;function&quot;, &quot;class&quot;, ...ClassAdjective }]  Expression ;
</pre>

</div>

<a name="class_members"></a><h3>Class Members</h3>
<div class="level3">

<p>
 The body of a class definition is a collection of members each of which becomes a property on one of the objects associated with the class. By default, data field members define enumerable properties while method members define non-enumerable properties. Members of non-const classes default to writable and configurable. Member adjectives, if present, override the default attributes of the property being defined.
</p>

<p>
A class body may contain one constructor, whose body is the code run to initialize instances of the class. This constructor code is also the behavior of the class&rsquo;s internal <code>[[Call]]</code> and <code>[[Construct]]</code> methods.
</p>

</div>

<a name="grammar"></a><h4>Grammar</h4>
<div class="level4">
<pre class="code">
ClassElement :
    Constructor
    PrototypePropertyDefinition
    ClassPropertyDefinition
    InstancePropertyDeclaration

Constructor :
    constructor ( FormalParameterList? ) { ConstructorBody }
ConstructorBody :
    ConstructorElement*
ConstructorElement :
    Statement
    Declaration

PrototypePropertyDefinition :
    ExportableDefinition
ClassPropertyDefinition :
    static ExportableDefinition
InstancePropertyDeclaration :
    public ForwardDeclaration

ExportableDefinition :
    Declaration
    Identifier = Expression ;                            // data field
    Identifier ( FormalParameterList? ) { FunctionBody } // method
    get Identifier ( ) { FuntionBody }                   // getter
    set Identifier ( FormalParameter ) { FunctionBody }  // setter
    MemberAdjective ExportableDefinition
ForwardDeclaration :
    IdentifierList ;                      // data field
    Identifier ( FormalParameterList? ) ; // method
    MemberAdjective ForwardDeclaration
    ...

IdentifierList :
    Identifier
    IdentifierList , Identifier
MemberAdjective :
    // attribute control
</pre>

</div>

<a name="refinements"></a><h2>Refinements</h2>
<div class="level2">

<p>
 Starting from the above syntactic kernel, we refine it with additional features until we reach a complete, usable class proposal.
</p>

</div>

<a name="inheritance"></a><h3>Inheritance</h3>
<div class="level3">

<p>
 We extend this class syntax to allow users to <em>declaratively</em> specify the prototypal inheritance they can already express <em>imperatively</em>. There are two forms: <code>extends</code> and <code>prototype</code>, each followed by an expression. When this class&rsquo;s <code>prototype</code> object is created, either of those clauses will be used to determine which object it inherits from. The expression following <code>extends</code> or <code>prototype</code> is evaluated. Then, if <code>extends</code> is used, the <code>prototype</code> property of that object will be used. If <code>prototype</code> is used, the object itself will be. If neither clause is given, the class&rsquo;s <code>prototype</code> will inherit from <code>Object.prototype</code>.
</p>

<p>
By example:
</p>
<pre class="code javascript"><span class="kw2">class</span> Base <span class="br0">&#123;</span><span class="br0">&#125;</span>
<span class="kw2">class</span> Derived <span class="kw2">extends</span> Base <span class="br0">&#123;</span><span class="br0">&#125;</span></pre>
<p>
Here, <code>Derived.prototype</code> will inherit from <code>Base.prototype</code>.
</p>
<pre class="code javascript">let parent = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
<span class="kw2">class</span> Derived prototype parent <span class="br0">&#123;</span><span class="br0">&#125;</span></pre>
<p>
Here, <code>Derived.prototype</code> will inherit directly from <code>parent</code>.
</p>

</div>

<a name="grammar"></a><h4>Grammar</h4>
<div class="level4">

<p>
 We revise the previous grammar to allow these inheritance clauses.
</p>
<pre class="code">
ClassDeclaration :
    ClassAdjective* class Identifier Proto? { ClassBody }

ClassExpression :
    ClassAdjective* class Identifier? Proto? { ClassBody }

Proto :
    extends MemberExpression
    prototype MemberExpression
</pre>

</div>

<a name="constructor_chaining"></a><h3>Constructor Chaining</h3>
<div class="level3">

<p>
 Building on inheritance, we provide a cleaner syntax for invoking the parent constructor in classes defined with an <code>extends</code> clause. Within the body of the constructor, an expression <code>super(x, y)</code> calls the superclass&rsquo;s <code>[[Call]]</code> method with <code>thisArg</code> bound to this constructor&rsquo;s <code>this</code> and the arguments <code>x</code> and <code>y</code>. In other words, <code>super(x, y)</code> acts like <code>Superclass.call(this, x, y)</code>, as if using the original binding of <code>Function.prototype.call</code>. A call like this may appear anywhere within the constructor body, excluding nested functions and classes.
</p>

<p>
These semantics for constructor chaining preclude defining classes that inherit from various distinguished built-in constructors, such as Date, Array, RegExp, Function, Error, etc, whose <code>[[Construct]]</code> ignores the normal object passed in as the this-binding and instead creates a fresh specialized object. Similar problems occur for <acronym title="Document Object Model">DOM</acronym> constructors such as HTMLElement. This strawman can be extended to handle such cases, but probably at the cost of making classes something more than syntactic sugar for functions. We leave that to other strawmen to explore.
</p>

</div>

<a name="grammar"></a><h4>Grammar</h4>
<div class="level4">

<p>
 To enable this, we add a production to CallExpression.
</p>
<pre class="code">
CallExpression :
    ProtoChaining
    ...
ProtoChaining :
    super Arguments;
</pre>

<p>
with a post-parsing early error if this production occurs outside a ConstructorBody.
</p>

</div>

<a name="member_delegation"></a><h3>Member Delegation</h3>
<div class="level3">

<p>
 Similar to constructor chaining, we extend <code>super</code> to allow delegating to any inherited member when called from within the body of a class. Within the class <code>Derived</code>, the expression <code>super.member</code> evaluates to a Reference with <em>base</em> <code>this</code> and <em>referenced name</em> <code>member</code>, but whose <code>[[GetValue]]</code> will look up <code>Derived.prototype.[[Prototype]].member</code>. In other words, <code>super.member(x, y)</code> acts like <code>Derived.prototype.[[Prototype]].member.call(this, x, y)</code>, as if using the original binding of <code>Function.prototype.call</code>. The <code>super.member</code> expression may not be used as a LeftHandSideExpression.
</p>

</div>

<a name="grammar"></a><h4>Grammar</h4>
<div class="level4">

<p>
 To enable this, we add a new production to MemberExpression.
</p>
<pre class="code">
MemberExpression :
    super . IdentifierName
    ...
</pre>

<p>
with a post-parsing early error if this occurs outside a class.
</p>

</div>

<a name="private_instance_members"></a><h3>Private Instance Members</h3>
<div class="level3">

<p>
 A requirement of this proposal is the ability to define private per-object state that meets the following requirements: 
</p>
<ul>
<li class="level1"><div class="li"> A usable syntax for defining and accessing private instance state from within methods of the class.</div>
</li>
<li class="level1"><div class="li"> Information hiding to encourage decoupling for software engineering concerns.</div>
</li>
<li class="level1"><div class="li"> Strong encapsulation in order to support defensiveness and security.</div>
</li>
<li class="level1"><div class="li"> An efficient implementation. The private state should be allocated with the instance as part of a single allocation, and with no undue burden on the garbage collector.</div>
</li>
<li class="level1"><div class="li"> The ability to have private mutable state on publicly frozen objects.</div>
</li>
</ul>

<p>
 We can refine this proposal to support just that. Alternatively, if something like <a href="doku.php%3Fid=strawman:private_names.html" class="wikilink1" title="strawman:private_names" onclick="return svchk()" onkeypress="return svchk()">private_names</a> or <a href="doku.php%3Fid=strawman:unique_string_values.html" class="wikilink1" title="strawman:unique_string_values" onclick="return svchk()" onkeypress="return svchk()">unique_string_values</a> gets accepted, such that a pattern composing private names with classes satisfies the above requirements, then there is no need for this extension.
</p>

<p>
Within a member of a class, a <code>private(argument)</code> expression can be used anywhere an expression can appear. The nearest class definition enclosing the usage is called the <em>containing class</em>. To evaluate it, we first evaluate <code>argument</code>. If it evaluates to an instance of the containing class, or an instance of a class that inherits from the containing class, then the <code>private(argument)</code> expression evaluates to an object containing private instance variables associated with this instance by the containing class. Otherwise, the expression evaluates to <code>undefined</code>.
</p>
<pre class="code javascript"><span class="kw2">class</span> Key <span class="br0">&#123;</span>
  constructor<span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">private</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span>.<span class="kw3">name</span> = <span class="kw3">name</span>;
  <span class="br0">&#125;</span>
&nbsp;
  sameAs<span class="br0">&#40;</span>key<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw2">private</span><span class="br0">&#40;</span>key<span class="br0">&#41;</span> === undefined<span class="br0">&#41;</span> <span class="kw1">return</span> <span class="kw2">false</span>;
    <span class="kw1">return</span> <span class="kw2">private</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span>.<span class="kw3">name</span> == <span class="kw2">private</span><span class="br0">&#40;</span>key<span class="br0">&#41;</span>.<span class="kw3">name</span>;
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
<p>
This defines a <code>Key</code> class that encapsulates a hidden name. Given an instance of <code>Key</code>, there is no way to access its name from outside of the class. However, two keys can be compared using <code>sameAs</code>. Note that <code>sameAs</code> <em>can</em> access the private record of its argument, as long as that argument is also a Key.
</p>

<p>
In addition to <em>initializing</em> private state in the constructor, it can also be <em>declared</em> in the class body like other members.
</p>
<pre class="code javascript"><span class="kw2">class</span> Key <span class="br0">&#123;</span>
  <span class="kw2">private</span> <span class="kw3">name</span>;
  <span class="co1">// ...</span>
<span class="br0">&#125;</span></pre>
<p>
Doing so isn&rsquo;t a requirement (just like for public instance members) but provides a natural place for documentation comments or <a href="doku.php%3Fid=strawman:guards.html" class="wikilink1" title="strawman:guards" onclick="return svchk()" onkeypress="return svchk()">guards</a>. We are not proposing any built-in consistency check between these declarations and the initialization in the constructor, but linters or other static analysis tools may well perform such checks.
</p>

</div>

<a name="grammar"></a><h4>Grammar</h4>
<div class="level4">

<p>
 To work with private state within the body of a class member, we extend CallExpression like so:
</p>
<pre class="code">
CallExpression :
    private ( AssignmentExpression )
    ...
</pre>

<p>
with a post-parse early error if this occurs outside a class member.
</p>

<p>
To declare in the class body, we extend ClassElement:
</p>
<pre class="code">
ClassElement :
    PrivateVariableDeclaration
    ...
PrivateVariableDeclaration :
    private ForwardDeclaration
</pre>

</div>

<a name="alternate_syntax"></a><h4>Alternate Syntax</h4>
<div class="level4">

<p>
 Instead of <code>private(...)</code>&lsquo;, we could adopt the syntactic conventions of <a href="doku.php%3Fid=strawman:instance_variables.html" class="wikilink1" title="strawman:instance_variables" onclick="return svchk()" onkeypress="return svchk()">instance_variables</a>. With that, <code>object@member</code> is equivalent to <code>private(object).member</code> and <code>@member</code> is equivalent to <code>private(this).member</code>.
</p>
<pre class="code">
MemberExpression :
    MemberExpression @ Identifier
    ...
UnaryExpression :
    @ Identifier
    ...
</pre>

</div>

<a name="proposal_history"></a><h2>Proposal History</h2>
<div class="level2">

<p>
 This is a major revision of the <a href="doku.php%3Fid=strawman:classes_with_trait_composition&amp;rev=1299750065.html" class="urlextern" target="_blank" title="http://wiki.ecmascript.org/doku.php?id=strawman:classes_with_trait_composition&amp;rev=1299750065" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">earlier classes and traits strawman</a> in order to reconcile <a href="doku.php%3Fid=strawman:object_initialiser_extensions.html" class="wikilink1" title="strawman:object_initialiser_extensions" onclick="return svchk()" onkeypress="return svchk()">object_initialiser_extensions</a>, especially <a href="doku.php%3Fid=strawman:obj_initialiser_class_abstraction.html" class="wikilink1" title="strawman:obj_initialiser_class_abstraction" onclick="return svchk()" onkeypress="return svchk()">obj_initialiser_class_abstraction</a> and <a href="doku.php%3Fid=strawman:instance_variables.html" class="wikilink1" title="strawman:instance_variables" onclick="return svchk()" onkeypress="return svchk()">instance_variables</a>. A prototype implementation of an earlier version of this reconciled strawman is described at <a href="http://code.google.com/p/traceur-compiler/wiki/LanguageFeatures#Classes" class="urlextern" target="_blank" title="http://code.google.com/p/traceur-compiler/wiki/LanguageFeatures#Classes" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Traceur Classes and Traits</a>.
</p>

<p>
The strawman as presented on this page no longer supports general trait composition, abstract classes, required members, or multiple inheritance, as we felt that was premature to propose at the May 2011 meeting, and therefore premature to propose for inclusion in the EcmaScript to follow ES5. Instead, we have extracted those elements into <a href="doku.php%3Fid=strawman:trait_composition_for_classes.html" class="wikilink1" title="strawman:trait_composition_for_classes" onclick="return svchk()" onkeypress="return svchk()">trait_composition_for_classes</a>, whose existence demonstrates that the single inheritance shown here does straightforwardly generalize to support these extensions.
</p>

</div>

<a name="open_issues"></a><h2>Open Issues</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> What are the semantics of a <code>return</code> within a constructor body?</div>
</li>
</ul>

</div>

<a name="see"></a><h2>See</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="doku.php%3Fid=strawman:object_initialiser_extensions.html" class="wikilink1" title="strawman:object_initialiser_extensions" onclick="return svchk()" onkeypress="return svchk()">object_initialiser_extensions</a>, especially <a href="doku.php%3Fid=strawman:obj_initialiser_class_abstraction.html" class="wikilink1" title="strawman:obj_initialiser_class_abstraction" onclick="return svchk()" onkeypress="return svchk()">obj_initialiser_class_abstraction</a> and <a href="doku.php%3Fid=strawman:instance_variables.html" class="wikilink1" title="strawman:instance_variables" onclick="return svchk()" onkeypress="return svchk()">instance_variables</a></div>
</li>
<li class="level1"><div class="li"> <a href="doku.php%3Fid=strawman:classes_as_sugar.html" class="wikilink1" title="strawman:classes_as_sugar" onclick="return svchk()" onkeypress="return svchk()">classes as sugar</a></div>
</li>
<li class="level1"><div class="li"> <a href="doku.php%3Fid=strawman:classes_as_inheritance_sugar.html" class="wikilink1" title="strawman:classes_as_inheritance_sugar" onclick="return svchk()" onkeypress="return svchk()">classes as inheritance sugar</a> (not yet ready)</div>
</li>
<li class="level1"><div class="li"> <a href="doku.php%3Fid=strawman:trait_composition_for_classes.html" class="wikilink1" title="strawman:trait_composition_for_classes" onclick="return svchk()" onkeypress="return svchk()">trait_composition_for_classes</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://code.google.com/p/traceur-compiler/wiki/LanguageFeatures#Classes" class="urlextern" target="_blank" title="http://code.google.com/p/traceur-compiler/wiki/LanguageFeatures#Classes" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Traceur Classes and Traits</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.17.1949" class="urlextern" target="_blank" title="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.17.1949" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow"> Encapsulation and Inheritance in Object-Oriented Programming Languages</a>: classic 1986 paper by Alan Snyder.</div>
</li>
<li class="level1"><div class="li"> <a href="https://mail.mozilla.org/pipermail/es-discuss/2009-March/009115.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2009-March/009115.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Classes as Sugar thread</a> which starts with pointers to earlier threads.</div>
</li>
<li class="level1"><div class="li"> <a href="https://docs.google.com/document/d/1gOFRSBOKtB8VjXC5LRhhNiGi1n1QQ6z1O6LyxjrOB3g/edit?hl=en_US" class="urlextern" target="_blank" title="https://docs.google.com/document/d/1gOFRSBOKtB8VjXC5LRhhNiGi1n1QQ6z1O6LyxjrOB3g/edit?hl=en_US" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Harmonious Classes</a>: write-up of discussion to unify this and <a href="doku.php%3Fid=strawman:obj_initialiser_class_abstraction.html" class="wikilink1" title="strawman:obj_initialiser_class_abstraction" onclick="return svchk()" onkeypress="return svchk()">obj_initialiser_class_abstraction</a> proposals.</div>
</li>
</ul>

</div>

<!-- no cachefile used, but created -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/classes_with_trait_composition.txt &middot; Last modified: 2011/05/22 21:17 by markm      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:classes_with_trait_composition" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:classes_with_trait_composition" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:classes_with_trait_composition" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:classes_with_trait_composition" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:classes_with_trait_composition.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Aclasses_with_trait_composition&amp;1454275721" width="1" height="1" alt=""  /></body>
</html>
