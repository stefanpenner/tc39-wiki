<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:traits_semantics [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:traits_semantics&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:traits_semantics&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:traits_semantics&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2010-12-05T04:44:39+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:traits_semantics&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:traits_semantics</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:traits_semantics" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:traits_semantics" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:proxies_names.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:proxies_names">proxies_names</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:proxy_symbol_decoupled.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:proxy_symbol_decoupled">proxy_symbol_decoupled</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:revokable_proxies.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:revokable_proxies">revokable_proxies</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:scoped_object_extensions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:scoped_object_extensions">scoped_object_extensions</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:traits_semantics.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:traits_semantics">traits_semantics</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="clear"><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:traits_semantics.html#trait_semantics" class="toc">Trait Semantics</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:traits_semantics.html#traitliteral" class="toc">TraitLiteral</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:traits_semantics.html#tcompose" class="toc">TCompose</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:traits_semantics.html#toverride" class="toc">TOverride</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:traits_semantics.html#tresolve" class="toc">TResolve</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:traits_semantics.html#tcreate" class="toc">TCreate</a></span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<a name="trait_semantics"></a><h2>Trait Semantics</h2>
<div class="level2">

<p>
 This page describes the semantics of trait composition for the <a href="doku.php%3Fid=strawman:syntax_for_efficient_traits.html" class="wikilink1" title="strawman:syntax_for_efficient_traits" onclick="return svchk()" onkeypress="return svchk()">syntax for efficient traits</a> strawman.
</p>

<p>
A trait is a &ldquo;property descriptor map&rdquo;, represented as a set of properties. Only a property descriptor map object&rsquo;s own properties are treated as members of this set. The prototype of the property descriptor map is ignored. Properties are represented as <code>name:pd</code> tuples where name is the property name (a string) and pd is a property descriptor object (this corresponds to the &ldquo;Property Identifier&rdquo; type in ES-262 5th ed, section 8.10). Property descriptors are either plain ES5 data or accessor property descriptors, or one of the following traits-specific property descriptors: a &ldquo;required&rdquo; property (identifying an &ldquo;abstract&rdquo; property that should be present in the final trait), a &ldquo;conflicting&rdquo; property (identifying a name conflict during composition) or a &ldquo;method&rdquo; property, which identifies a data property whose function value should be treated as a &ldquo;method&rdquo; (with bound-<code>this</code> semantics).
</p>
<pre class="code">
PDMap ::= { PropertyIdentifier* }
PropertyIdentifier ::= String:PropDesc
PropDesc ::= { value: v, writable: b }
           | { get: fg, set: fs }
           | { required: true }
           | { conflict: true }
           | { value: f, writable: false, method: true }
</pre>

<p>
The functions below are specified using a Haskell-like syntax. Property descriptor maps are represented using the syntax <code>{ n1:p1, ..., nk:pk }</code>. These property descriptor maps are treated as sets, so the ordering of the properties <code>n1:p1</code> up to <code>nk:pk</code> is irrelevant. Property descriptors on this page are assumed to have default attributes <code>enumerable:true</code> and <code>configurable:true</code>.
</p>

<p>
Metasyntactic variables used: <code>v</code> for any value, <code>b</code> for booleans, <code>f</code> for functions, <code>fg</code> for getter functions, <code>fs</code> for setter functions, <code>n</code> for property names, <code>p</code> for property descriptors, <code>pdm</code> for property descriptor maps.
</p>

</div>

<a name="traitliteral"></a><h3>TraitLiteral</h3>
<div class="level3">

<p>
 The function <code>TraitLiteral</code> describes how a <code>TraitPartList</code> consisting of a series of property declarations is converted into a property descriptor map.
</p>
<pre class="code">
TraitLiteral :: TraitPartList -&gt; PDMap
TraitLiteral [] = {}
TraitLiteral (part:parts) =
  add_prop (TraitLiteral parts) (to_property part)

to_property :: TraitPart -&gt; PropertyIdentifier
to_property 'n : expr'                = n:{ value: expr, writable: true }
to_property 'get n() { body }'        = n:{ get: const() { body }, set: undefined }
to_property 'set n(arg) { body }'     = n:{ get: undefined, set: const(arg) { body } }
to_property 'method n(args) { body }' = n:{ value: const(args) { body }, writable: false, method: true }
to_property 'require n'               = n:{ required: true }
</pre>

<p>
Notes:
</p>
<ul>
<li class="level1"><div class="li"> we implicitly assume that all created property descriptors have additional attributes <code>{ enumerable: true, configurable: true }</code>.</div>
</li>
<li class="level1"><div class="li"> See below for the definition of <code>add_prop</code>.</div>
</li>
</ul>

</div>

<a name="tcompose"></a><h3>TCompose</h3>
<div class="level3">

<p>
 <code>TCompose</code> takes an arbitrary number of property descriptor maps and returns a property descriptor map that combines all own properties of its arguments. Name clashes lead to the generation of special <code>conflict</code> properties in the resulting trait. <code>TCompose</code> is commutative: its result is independent of the ordering of its arguments.
</p>
<pre class="code">
TCompose :: [ PDMap ] -&gt; PDMap
TCompose [] = {}
TCompose (pdm:pdms) =
  compose_pdmap pdm (TCompose pdms)

compose_pdmap :: PDMap -&gt; PDMap -&gt; PDMap
compose_pdmap pdm { } = pdm
compose_pdmap pdm { n1:p1, … , nk:pk } =
  compose_pdmap (add_prop pdm n1:p1) { n2:p2, …, nk:pk }

add_prop :: PDMap -&gt; PropertyIdentifier -&gt; PDMap
add_prop { n1:p1, …, nk:pk } ni:pi =
  { n1:p1, …, nk:pk, ni:pi } if not member ni { n1, …, nk }
add_prop { n1:p1, … , n:pi1, … nk:pk } n:pi2 =
  { n1:p1, …, n:(compose_pd pi1 pi2), … , nk:pk }

compose_pd :: PropDesc -&gt; PropDesc -&gt; PropDesc
compose_pd { value: v1, writable: bw1, method: b1 } { value: v2, writable bw2, method: b2 } =
  { value: v1, writable: bw1, method: b1 } if (identical v1 v2) and bw1 === bw2 and b1 === b2
compose_pd { value: v1, writable: bw1, method: b1 } { value: v2, writable bw2, method: b2 } =
  { conflict: true } if not (identical v1 v2) or bw1 !== bw2 or b1 !== b2
compose_pd { get: fg1, set: fs1 } { get: fg2, set: fs2 } = { get: fg1, set: fs1 } if (identical fg1 fg2) and (identical fs1 fs2)
compose_pd { get: fg1, set: fs1 } { get: fg2, set: fs2 } = { conflict: true } if not (identical fg1 fg2) or not (identical fs1 fs2)
compose_pd { get: fg, set: undefined } { get: undefined, set: fs } = { get: fg, set: fs }
compose_pd { get: undefined, set: fs } { get: fg, set: undefined } = { get: fg, set: fs }
compose_pd { value: v, writable: bw, method: b } { get: fg, set: fs } = { conflict: true }
compose_pd { get: fg, set: fs } { value: v, writable: bw, method: b } = { conflict: true }
compose_pd { required: true } p = p
compose_pd p { required: true } = p
compose_pd { conflict: true } p = { conflict: true }
compose_pd p { conflict: true } = { conflict: true }
</pre>

<p>
Notes:
</p>
<ul>
<li class="level1"><div class="li"> <code>{ value: v, writable: b, method: false }</code> is considered equivalent to the plain data property descriptor <code>{ value: v, writable: b }</code>.</div>
</li>
<li class="level1"><div class="li"> We implicitly assume that the <code>enumerable</code> and <code>configurable</code> attributes of the above property descriptors are equal. This is the case for property descriptors created using <code>TraitLiteral</code>. If these attributes are not equal for a pair of property descriptors, they are treated as non-equal and would generate <code>{ conflict: true }</code> if composed.</div>
</li>
<li class="level1"><div class="li"> <code>identical(a,b)</code> has the semantics of <a href="doku.php%3Fid=harmony:egal.html" class="wikilink1" title="harmony:egal" onclick="return svchk()" onkeypress="return svchk()">egal</a>.</div>
</li>
</ul>

</div>

<a name="toverride"></a><h3>TOverride</h3>
<div class="level3">

<p>
 <code>TOverride</code> takes an arbitrary number of property descriptor maps and combines them into a single property descriptor map. It automatically resolves name clashes by having the left-hand trait&rsquo;s property value take precedence over the right-hand trait&rsquo;s property value. Hence, <code>TOverride</code> is not commutative: the ordering of arguments is significant and precedence is from left to right.
</p>
<pre class="code">
TOverride :: [ PDMap ] -&gt; PDMap
TOverride [] = {}
TOverride (pdm:pdms) =
  override_pdmap pdm (TOverride pdms)

override_pdmap :: PDMap -&gt; PDMap -&gt; PDMap
override_pdmap pdm {} = pdm
override_pdmap pdm { n1:p1, … , nk:pk } =
  override_pdmap (override_prop pdm n1:p1) { n2:p2, …, nk:pk }

override_prop :: PDMap -&gt; PropertyIdentifier -&gt; PDMap
override_prop { n1:p1, …, nk:pk } ni:pi = { n1:p1, …, nk:pk, ni:pi } if not member ni { n1, …, nk }
override_prop { n1:p1, … , n:pi1, … nk:pk } n:pi2 = { n1:p1, …, n:pi1, … , nk:pk }
</pre>

</div>

<a name="tresolve"></a><h3>TResolve</h3>
<div class="level3">

<p>
 <code>TResolve</code> renames and excludes property names of a single argument property descriptor map.
</p>

<p>
Let Renames be a map from String to String and Exclusions be a set of Strings:
</p>
<pre class="code">
Renames    ::= [ String -&gt; String ]
Exclusions ::= [ String ]

TResolve :: Renames -&gt; Exclusions -&gt; PDMap -&gt; PDMap
TResolve r e pdm = 
  rename r (exclude e pdm)

exclude :: Exclusions -&gt; PDMap -&gt; PDMap
exclude e {} = {}
exclude e { n1:p1, …, nk:pk } =
  add_prop (exclude e { n2:p2, …, nk:pk }) n1:{ required: true } if member n1 e
exclude e { n1:p1, … , nk:pk } =
  add_prop (exclude e { n2:p2, …, nk:pk }) n1:p1 if not member n1 e

rename :: Renames -&gt;  PDMap -&gt; PDMap
rename map {} = {}
rename map { n1:p1, …, nk:pk } =
  add_prop (rename map { n2:p2, …, nk:pk }) m:p1 if member (n1 -&gt; m) map
rename map { n1:p1, …, nk:pk } =
  add_prop (rename map { n2:p2, …, nk:pk }) n1:p1 if not member (n1 -&gt; m) map
</pre>

</div>

<a name="tcreate"></a><h3>TCreate</h3>
<div class="level3">

<p>
 <code>TCreate</code> takes a prototype object and a property descriptor map and returns an &ldquo;instance&rdquo; of the property descriptor map. <code>TCreate</code> validates the property descriptor map to see if it contains unsatisfied <code>required</code> arguments and unresolved <code>conflict</code> properties. If so, it fails. <code>TCreate</code> also binds and freezes all properties marked as <code>method</code>s.
</p>
<pre class="code">
TCreate :: Object -&gt; PDMap -&gt; Object
TCreate proto pdm =
  do {
   -- pardon the awkward mixture of Haskell and Javascript syntax
   obj &lt;- Object.create(proto);
   Object.defineProperties(obj, validate obj pdm);
   return Object.freeze(obj);
  }

validate :: Object -&gt; PDMap -&gt; PDMap
validate obj {} = {}
validate obj { n1:p1, …, nk:pk } =
  add_prop (validate obj { n2:p2, …, nk:pk }) n1:(validate_prop obj n1:p1)

validate_prop :: Object -&gt; PropertyIdentifier -&gt; PropDesc
validate_prop self n:{ value: v, writable: b, method: false } = { value: v, writable: b }
validate_prop self n:{ value: v, writable: b, method: true } = { value: freezeAndBind(v,self), writable: b  }
validate_prop self n:{ get: fg, set: fs } = { get: freezeAndBind(fg,self), set: freezeAndBind(fs,self) }
validate_prop self n:{ required: true } = &lt;error: required property: n&gt; if not (n in self)
validate_prop self n:{ required: true } = {} if (n in self)
validate_prop self n:{ conflict: true } = &lt;error: conficting property: n&gt;

freezeAndBind :: Function -&gt; Object -&gt; Function
freezeAndBind fun obj = 
  Object.freeze(Function.prototype.bind.call(fun, obj))
</pre>

</div>

<!-- no cachefile used, but created -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/traits_semantics.txt &middot; Last modified: 2010/12/05 04:44 by markm      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:traits_semantics" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:traits_semantics" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:traits_semantics" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:traits_semantics" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:traits_semantics.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Atraits_semantics&amp;1454275646" width="1" height="1" alt=""  /></body>
</html>
