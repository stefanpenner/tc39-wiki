<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=harmony:completion_reform&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=harmony" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=harmony:completion_reform&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=harmony:completion_reform&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>

<a name="completion_value"></a><h2>Completion value</h2>
<div class="level2">

<p>
 The existing specs describe a completion value that every statement can produce, but some statements do not <em>necessarily</em> produce a completion value. This means that it&rsquo;s not always statically predictable which sub-statement of a compound statement will produce the completion. For example:
</p>
<pre class="code javascript"><span class="br0">&#123;</span>
    <span class="nu0">41</span>;          <span class="co1">// completion is 41</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>...<span class="br0">&#41;</span> <span class="nu0">42</span>; <span class="co1">// either no completion or 42</span>
<span class="br0">&#125;</span>                <span class="co1">// block's completion is either 41 or 42</span></pre><pre class="code javascript"><span class="br0">&#123;</span>
    <span class="nu0">41</span>;             <span class="co1">// completion is 41</span>
    <span class="kw1">while</span> <span class="br0">&#40;</span>...<span class="br0">&#41;</span> <span class="nu0">42</span>; <span class="co1">// either no completion (if 0 iterations) or 42</span>
<span class="br0">&#125;</span>                   <span class="co1">// block's completion is either 41 or 42</span></pre>
<p>
For <a href="doku.php%3Fid=harmony:proper_tail_calls.html" class="wikilink1" title="harmony:proper_tail_calls" onclick="return svchk()" onkeypress="return svchk()">proper tail calls</a>, the completion position should coincide with tail position. This would be important for e.g. <a href="doku.php%3Fid=strawman:block_lambda_revival.html" class="wikilink1" title="strawman:block_lambda_revival" onclick="return svchk()" onkeypress="return svchk()">block lambda revival</a>.
</p>

</div>
<!-- SECTION [1-849] -->
<a name="completion_for_conditionally_executed_statements"></a><h2>Completion for conditionally executed statements</h2>
<div class="level2">

<p>
 This strawman proposes breaking compatibility of the definition of completion values, such that completion position becomes statically predictable. The basic idea is that these conditional cases would produce the undefined value as their completion, rather than no completion.
</p>
<pre class="code javascript"><span class="br0">&#123;</span>
    <span class="nu0">41</span>;          <span class="co1">// completion is 41</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>...<span class="br0">&#41;</span> <span class="nu0">42</span>; <span class="co1">// either undefined or 42</span>
<span class="br0">&#125;</span>                <span class="co1">// block's completion is either undefined or 42</span></pre><pre class="code javascript"><span class="br0">&#123;</span>
    <span class="nu0">41</span>;             <span class="co1">// completion is 41</span>
    <span class="kw1">while</span> <span class="br0">&#40;</span>...<span class="br0">&#41;</span> <span class="nu0">42</span>; <span class="co1">// either undefined (if 0 iterations) or 42</span>
<span class="br0">&#125;</span>                   <span class="co1">// block's completion is either undefined or 42</span></pre>
</div>
<!-- SECTION [850-1566] -->
<a name="backwards_compatibility"></a><h2>Backwards compatibility</h2>
<div class="level2">

<p>
 While this is backwards-incompatible, the completion value only showed up in ES5 and earlier as the result of <code>eval</code>. The hope is that this is an obscure enough corner case of completion values, that it wouldn&rsquo;t be likely to break many programs. 
</p>
<hr noshade="noshade" size="1" />

<p>
 I like it. The strange &ldquo;nothing means previous statement&rsquo;s completion value&rdquo; semantics were a just-so story from JS1.0 that we codified in ES1.
</p>

<p>
Can we get away with this kind of migration-tax (remember, only five fingers of fate to use up)? We probably can <acronym title="In my humble opinion">IMHO</acronym>, and anyway we should test and scan the web harder to check before making a hard decision.
</p>

<p>
At the least, I&rsquo;d rather we have this completion-value semantics for sharp-functions and other new syntactic forms than the bad old completion semantics.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2011/03/01 00:24</em>
</p>

</div>
<!-- SECTION [1567-2434] -->
<a name="additional_changes"></a><h2>Additional changes</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> should make the completion of a <code>try</code>-<code>finally</code> be the result of the <code>try</code> block &ndash; see <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-November/018289.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2011-November/018289.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Mike Samuel's message</a> on es-discuss</div>
<ul>
<li class="level3"><div class="li"> It already is, except in the case the finally has an abrupt completion.  &mdash; <em><a href="mailto:%26%23x41%3B%26%23x6c%3B%26%23x6c%3B%26%23x65%3B%26%23x6e%3B%26%23x40%3B%26%23x57%3B%26%23x69%3B%26%23x72%3B%26%23x66%3B%26%23x73%3B%26%23x2d%3B%26%23x42%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x41;&#x6c;&#x6c;&#x65;&#x6e;&#x40;&#x57;&#x69;&#x72;&#x66;&#x73;&#x2d;&#x42;&#x72;&#x6f;&#x63;&#x6b;&#x2e;&#x63;&#x6f;&#x6d;">Allen Wirfs-Brock</a> 2012/03/02 00:46</em></div>
</li>
</ul>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> also needs to fix do-while and for/for-in statements</div>
</li>
</ul>

</div>
<!-- SECTION [2435-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/7/79e298e2c2c6417fafe113a313e2b8b0.xhtml used -->
</body>
</html>
