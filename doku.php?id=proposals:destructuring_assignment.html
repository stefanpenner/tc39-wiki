<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>proposals:destructuring_assignment [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=proposals:destructuring_assignment&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=proposals" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=proposals:destructuring_assignment&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=proposals:destructuring_assignment&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2008-07-14T18:38:05+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=proposals:destructuring_assignment&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">proposals:destructuring_assignment</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:destructuring_assignment" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:destructuring_assignment" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:program_units.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:program_units">program_units</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:generic_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:generic_functions">generic_functions</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:getters_and_setters.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:getters_and_setters">getters_and_setters</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:catchalls.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:catchalls">catchalls</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=proposals:destructuring_assignment.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:destructuring_assignment">destructuring_assignment</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#destructuring_assignment_and_binding_forms" class="toc">Destructuring assignment and binding forms</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#summary" class="toc">Summary</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#rationale" class="toc">Rationale</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#syntax" class="toc">Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#type_annotations" class="toc">Type annotations</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#semantics" class="toc">Semantics</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#assignments" class="toc">Assignments</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#variable_definitions" class="toc">Variable definitions</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#let_statements_and_let_expressions" class="toc">''let'' statements and ''let'' expressions</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#for_statements" class="toc">For statements</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#plain_for_statement" class="toc">Plain ''for'' statement</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#for-in_statements" class="toc">For-in statements</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#for-each_statements" class="toc">For-each statements</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#formal_parameter_lists" class="toc">Formal parameter lists</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#notes" class="toc">Notes</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#catch_clauses" class="toc">Catch clauses</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#typecase_clauses" class="toc">Typecase clauses</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#examples" class="toc">Examples</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:destructuring_assignment.html#prior_art" class="toc">Prior art</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="destructuring_assignment_and_binding_forms"></a><h1>Destructuring assignment and binding forms</h1>
<div class="level1">

<p>
 (Also see the <a href="doku.php%3Fid=discussion:destructuring_assignment.html" class="wikilink1" title="discussion:destructuring_assignment" onclick="return svchk()" onkeypress="return svchk()">discussion page</a> for this proposal)
</p>

</div>

<a name="summary"></a><h2>Summary</h2>
<div class="level2">

<p>
 Allow for destructuring of array and object data using a syntax that mirrors the construction of array and object literals.  The destructuring can appear in assignment statements but also in various initialization and binding forms.
</p>

</div>

<a name="rationale"></a><h2>Rationale</h2>
<div class="level2">

<p>
 The object and array literal expressions provide convenient means of creating ad-hoc packages of data, returning them from functions, etc.  A common idiom for multiple return values is <code>return [a,b]</code>.
</p>

<p>
The present proposal provides a convenient syntax for picking apart structured data in various contexts.  Such a syntax is a benefit not just for &ldquo;scripting&rdquo; type programs that construct objects using the object and array literal expressions, but also for statically typed programs that need to read a few fields from class instances into other variables.
</p>

<p>
The syntax is initially introduced as an assignment form.  This assignment form is then extended to the <code>let</code> and <code>var</code> binding forms, and then to all binding forms, including formal parameters, catch clauses, and type-switch clauses.
</p>

</div>

<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">
<pre class="code">
   pattern ::= lhs (&quot;:&quot; type)
   lhs     ::= &quot;{&quot; (field (&quot;,&quot; field)*)* &quot;}&quot;  
             | &quot;[&quot; ((lhs | lvalue)? &quot;,&quot;)* &quot;]&quot;
   field   ::= ident &quot;:&quot; (lhs | lvalue)
   lvalue  ::= &lt;any lvalue expression allowed in a normal assignment expression&gt; 
   type    ::= &lt;structural type expression&gt;
</pre>

<p>
A <em>pattern</em> can only appear on the left-hand-side of &ldquo;=&rdquo; in the following contexts: 
</p>
<ul>
<li class="level1"><div class="li"> in a plain assignment expression</div>
</li>
<li class="level1"><div class="li"> in a variable initializer in a <code>var</code>, <code>let</code> or <code>const</code> definition</div>
</li>
<li class="level1"><div class="li"> in a variable initializer in a <code>let</code> expression or <code>let</code> statement</div>
</li>
<li class="level1"><div class="li"> in a variable initializer in a <code>for</code> statement</div>
</li>
</ul>

<p>
 If preceded by a <code>var</code>, <code>let</code>, or <code>const</code> the <em>pattern</em> must contain <em>lvalue</em>s that are all identifiers.  If not, the compiler must throw a SyntaxError for the phrase.
</p>

<p>
Note that object literals cannot appear in statement positions, so a plain object destructuring assignment statement <code>{ x } = y</code> must be parenthesized either as <code>({ x } = y)</code> or <code>({ x }) = y</code>.
</p>

<p>
 &mdash;
</p>

<p>
We should allow empty object patterns, just as we allow empty array patterns. Here is some rationale from an email thread between Lars and Jeff: 
</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
 [J] One more question. What is the point of using an empty array  pattern? It seems to be allowed by the syntax.</blockquote>

<p>
 [L] I guess it never occured to me to disallow it.  It has a straightforward meaning, I guess the same meaning as the &ldquo;void&rdquo; operator except in a  more limited context. Any reason why we should not allow it?  Is the syntax useful for  something else?
</p>
</blockquote>

<p>
 [J] I can&rsquo;t think of a reason to not allow it, except for symmetry with  the object pattern. Should we allow ({} = o) too?
</p>
</blockquote>

<p>
 [L] Or indeed the even uglier ({}) = o?  <img src="lib/images/smileys/icon_smile.gif" align="middle" alt=":-)" /> No reason not to allow these things, I think.  After all [a,b,c] = E is the same as { 0:a, 1:b, 2:c } = E, so then [] = E ought to be the same as {} = E.
</p>
</blockquote>

<p>
  &mdash; <em><a href="mailto:%26%23x6a%3B%26%23x6f%3B%26%23x64%3B%26%23x79%3B%26%23x65%3B%26%23x72%3B%26%23x40%3B%26%23x61%3B%26%23x64%3B%26%23x6f%3B%26%23x62%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6a;&#x6f;&#x64;&#x79;&#x65;&#x72;&#x40;&#x61;&#x64;&#x6f;&#x62;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Jeff Dyer</a> 2006/11/14 12:22</em>
</p>

<p>
We talked about this at the Mozilla face-to-face, because I had implemented destructuring for Firefox 2 without supporting empty patterns (I fixed the implementation before final release to support empty patterns). Dave pointed out that code generators won&rsquo;t want to have to special-case for n=0, and I heard Lars concur. Just wanted to point this rationale out.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2006/11/14 13:36</em>
</p>

<p>
Then we are agreed! Cool.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6a%3B%26%23x6f%3B%26%23x64%3B%26%23x79%3B%26%23x65%3B%26%23x72%3B%26%23x40%3B%26%23x61%3B%26%23x64%3B%26%23x6f%3B%26%23x62%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6a;&#x6f;&#x64;&#x79;&#x65;&#x72;&#x40;&#x61;&#x64;&#x6f;&#x62;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Jeff Dyer</a> 2006/11/14 14:25</em>
</p>

</div>

<a name="type_annotations"></a><h2>Type annotations</h2>
<div class="level2">

<p>
 If a <em>type</em> annotation is provided in a <em>pattern</em>, then the structure of the <em>type</em> must match the structure of the <em>lhs</em> it annotates (recursively):
</p>
<ol>
<li class="level1"><div class="li"> if <em>lhs</em> is an object pattern, then <em>type</em> must be an object type</div>
</li>
<li class="level1"><div class="li"> if <em>lhs</em> is an array pattern, then <em>type</em> must be an array type</div>
</li>
<li class="level1"><div class="li"> if <em>lhs</em> is an identifier then <em>type</em> can be anything</div>
</li>
<li class="level1"><div class="li"> if <em>lhs</em> contains a property <code>p</code> with value <code>v</code> and <em>type</em> contains a property <code>p</code> with a type annotation <code>t</code>, then <code>t</code> must match the structure of <code>v</code>.  (For array patterns the name <code>p</code> is the index, and it&rsquo;s given implicitly by position in the pattern.)</div>
</li>
<li class="level1"><div class="li"> if a <em>type</em> contains a property <code>p</code> then the corresponding <em>lhs</em> must also contain an <code>p</code></div>
</li>
</ol>

</div>

<a name="semantics"></a><h2>Semantics</h2>
<div class="level2">

<p>
 The meaning is given separately for the four contexts in which destructuring may appear.
</p>

</div>

<a name="assignments"></a><h3>Assignments</h3>
<div class="level3">

<p>
 The meaning of the assignment expression P &ldquo;=&rdquo; E where P is a <em>pattern</em> and E is an <em>expression</em> is: 
</p>
<ol>
<li class="level1"><div class="li"> Evaluate E yielding a value V</div>
</li>
<li class="level1"><div class="li"> Assign V to a fresh temporary T</div>
</li>
<li class="level1"><div class="li"> If P is an array pattern then </div>
<ol>
<li class="level3"><div class="li"> Taking each lhs L at the top level of P in order, with the ordinal position I of L in P</div>
<ol>
<li class="level5"><div class="li"> If L is an lvalue N then</div>
<ol>
<li class="level7"><div class="li"> Perform N = T[I]</div>
</li>
</ol>
</li>
<li class="level5"><div class="li"> Else L is a pattern P&rsquo;</div>
<ol>
<li class="level7"><div class="li"> Destructure P&rsquo; and T[I] according to this algorithm (from step 2)</div>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li class="level1"><div class="li"> If P is an object pattern then</div>
<ol>
<li class="level3"><div class="li"> Taking each field F with name Q at the top level of P in order</div>
<ol>
<li class="level5"><div class="li"> If the right-hand-side of F is an lvalue N</div>
<ol>
<li class="level7"><div class="li"> Perform N = T.Q</div>
</li>
</ol>
</li>
<li class="level5"><div class="li"> Else the right-hand-side of F is a pattern P&rsquo;</div>
<ol>
<li class="level7"><div class="li"> Destructure P&rsquo; and T.Q according to this algorithm (from step 2)</div>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li class="level1"><div class="li"> Return T</div>
</li>
</ol>

<p>
 As can be seen, the destructuring assignment is simple syntactic sugar.
</p>

<p>
<em>Note</em>: In contrast with normal assignment expressions, the locations updated by destructuring assignment are not computed before the value that is to be stored.  Destructuring assignment is simple syntactic sugar for a common compute-and-destructure pattern, and true to this pattern it computes the value prior to computing the locations.  (See discussion below for more detail.)
</p>

<p>
If a <em>type</em> is provided in the <em>pattern</em> then the concrete type of the value <code>V</code> must be a subtype of <em>type</em>.
</p>

</div>

<a name="variable_definitions"></a><h3>Variable definitions</h3>
<div class="level3">

<p>
 The meaning of 
</p>
<pre class="code">
   &lt;defining-keyword&gt; &lt;pattern&gt; = &lt;expr&gt;;
</pre>

<p>
where the <em>defining-keyword</em> can be <code>var</code>, <code>let</code>, or <code>const</code> and all <em>lvalue</em>s in <em>pattern</em> are simple identifiers, the set of which is i1, i2, ..., is
</p>
<pre class="code">
   &lt;defining-keyword&gt; i1, i2, ...;
   &lt;pattern&gt; = &lt;expr&gt;
</pre>

<p>
If a <em>type</em> is provided in the <em>pattern</em> then the <em>type</em> provides type annotations to i1, i2, ...
</p>

</div>

<a name="let_statements_and_let_expressions"></a><h3>''let'' statements and ''let'' expressions</h3>
<div class="level3">

<p>
 The meaning of 
</p>
<pre class="code">
   let (&lt;b0&gt; ..., &lt;pattern&gt; = &lt;expr&gt;, &lt;b1&gt; ...) { ... }
</pre>

<p>
where all <em>lvalue</em>s in <em>pattern</em> are simple identifiers <code>i1</code>, <code>i2</code>, ..., is
</p>
<pre class="code">
   let (&lt;b0&gt; ..., tmp = &lt;expr&gt;, i1, i2, ..., &lt;b1&gt; ...) { 
      &lt;pattern&gt; = tmp;
      ... 
   }
</pre>

<p>
where <code>tmp</code> is a fresh temporary variable.  
</p>

<p>
Similarly, the meaning of 
</p>
<pre class="code">
   let (&lt;b0&gt; ..., &lt;pattern&gt; = &lt;expr0&gt;, &lt;b1&gt; ...) &lt;expr1&gt;
</pre>

<p>
where all <em>lvalue</em>s in <em>pattern</em> are simple identifiers <code>i1</code>, <code>i2</code>, ..., is
</p>
<pre class="code">
   let (b0 ..., tmp = &lt;expr0&gt;, i1, i2, ..., &lt;b1&gt; ...) ( &lt;pattern&gt; = tmp, &lt;expr1&gt; )
</pre>

<p>
where <code>tmp</code> is a fresh temporary variable.  
</p>

<p>
If a <em>type</em> is provided in the <em>pattern</em> then the <em>type</em> provides type annotations to <code>i1</code>, <code>i2</code>, ...
</p>

</div>

<a name="for_statements"></a><h3>For statements</h3>
<div class="level3">

<p>
 Below a <em>var-keyword</em> is <code>var</code> or <code>let</code>.
</p>

<p>
If a <em>var-keyword</em> is present in the <code>for</code> loops, then all the <em>lvalue</em>s in the <em>pattern</em> must be simple identifiers.
</p>

<p>
If a <em>type</em> is provided in the <em>pattern</em> then the <em>type</em> provides type annotations to names defined by the <em>pattern</em>.
</p>

</div>

<a name="plain_for_statement"></a><h4>Plain ''for'' statement</h4>
<div class="level4">

<p>
 The meaning of 
</p>
<pre class="code">
   for ( &lt;var-keyword&gt;? &lt;b0&gt; ..., &lt;pattern&gt; = &lt;expr0&gt;, &lt;b1&gt; ... ; &lt;expr1&gt; ; &lt;expr2&gt; ) &lt;stmt&gt;
</pre>

<p>
is that the <em>b0</em> ... are evaluated, then <em>expr0</em> is evaluated and destructured into the <em>lvalue</em>s of <em>lhs</em>, then the <em>b1</em> ... are evaluated, and then the loop proceeds by normal rules.
</p>

</div>

<a name="for-in_statements"></a><h4>For-in statements</h4>
<div class="level4">

<p>
 The meaning of 
</p>
<pre class="code">
   for ( &lt;var-keyword&gt; &lt;pattern&gt; = &lt;expr0&gt; in &lt;expr1&gt; ) &lt;stmt&gt;
   for ( &lt;var-keyword&gt; &lt;pattern&gt; in &lt;expr1&gt; ) &lt;stmt&gt;
   for ( &lt;pattern&gt; in &lt;expr1&gt; ) &lt;stmt&gt;
</pre>

<p>
where <em>pattern</em> has the form <code>[ i1 , i2 ]</code> where both <code>i1</code> and <code>i2</code> may be omitted, is that <em>expr0</em> (if present) is evaluated and destructured into <code>i1</code> and <code>i2</code> before the loop begins; then before each loop iteration <code>i1</code> receives the property name and <code>i2</code> receives the property value extracted from the object expression <em>expr1</em>.
</p>

<p>
Neither <code>i1</code> nor <code>i2</code> are restricted to being identifiers; they can themselves be destructuring patterns.  If <em>var-keyword</em> is present then those patterns must have lvalues that are identifiers, however.
</p>

<p>
If <em>pattern</em> has any other form then the compiler must throw a SyntaxError. 
</p>
<hr noshade="noshade" size="1" />

<p>
 If <code>i1</code> and <code>i2</code> are both omitted, the form is <code>[, ]</code>, which has length 1.  In the latest TG1 meeting I believe the requirement was that the length of the destructuring pattern be 2.  If so, the above needs to require a second comma if <code>i2</code> or both <code>i1</code> and <code>i2</code> are omitted.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2006/09/22 20:42</em>
</p>

<p>
Problem: if the object to the right of <code>in</code> is an <a href="doku.php%3Fid=proposals:iterators_and_generators.html" class="wikilink1" title="proposals:iterators_and_generators" onclick="return svchk()" onkeypress="return svchk()">iterator</a>, then the loop iterates over arbitrary values; it does not <em>enumerate</em> properties. So there should be no restriction on the destructuring pattern, and <code>SyntaxError</code> is the wrong exception. Commenting here rather than discussion to get attention, but we can move there if a quick fix here is difficult to find.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/01/13 18:21</em>
</p>

<p>
Let&rsquo;s consider keeping to the original, albeit quirky, meaning of <code>for-in</code> and require the iterator/generator on the right of <code>in</code> to return a string, and for the pattern in the left of &lsquo;in&rsquo; to be compatible with a string value. <code>for-each-in</code> can of course still return an object that is destructed by a compatible pattern, but there will be no way to get at the property name and the property value in the same <code>for</code> head. This also alleviates potential confusion over the new meaning of <code>for-in</code> in the presence of a pattern on the left side of <code>in</code>.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6a%3B%26%23x6f%3B%26%23x64%3B%26%23x79%3B%26%23x65%3B%26%23x72%3B%26%23x40%3B%26%23x61%3B%26%23x64%3B%26%23x6f%3B%26%23x62%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6a;&#x6f;&#x64;&#x79;&#x65;&#x72;&#x40;&#x61;&#x64;&#x6f;&#x62;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Jeff Dyer</a> 2007/01/14 16:12</em>
</p>

<p>
That would be a proposal for <a href="doku.php%3Fid=proposals:iterators_and_generators.html" class="wikilink1" title="proposals:iterators_and_generators" onclick="return svchk()" onkeypress="return svchk()">iterators and generators</a>, but I&rsquo;m against it because it&rsquo;s (a) needlessly verbose; (b) not Pythonic.  The <code>each</code> contextual keyword is deadwood if there&rsquo;s an iterator on the right of <code>in</code>.  Iterators can return any value, and the values have nothing to do with property identifiers, shadowing along the prototype chain, or delete/for-in coherence.  The quirky tail of enumeration should not wag this dog.
</p>

<p>
Consider Python: 
</p>
<pre class="code python">&gt;&gt;&gt; d = <span class="br0">&#123;</span><span class="st0">"a"</span>:<span class="nu0">1</span>, <span class="st0">"b"</span>:<span class="nu0">2</span><span class="br0">&#125;</span>
&gt;&gt;&gt; s = <span class="br0">&#91;</span>v <span class="kw1">for</span> k, v <span class="kw1">in</span> d.<span class="me1">items</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
&gt;&gt;&gt; s
<span class="br0">&#91;</span><span class="nu0">1</span>, <span class="nu0">2</span><span class="br0">&#93;</span>
&gt;&gt;&gt; t = <span class="br0">&#91;</span>k <span class="kw1">for</span> k <span class="kw1">in</span> d<span class="br0">&#93;</span>
&gt;&gt;&gt; t
<span class="br0">&#91;</span><span class="st0">'a'</span>, <span class="st0">'b'</span><span class="br0">&#93;</span>
&gt;&gt;&gt; u = <span class="br0">&#91;</span>v <span class="kw1">for</span> k, v <span class="kw1">in</span> d<span class="br0">&#93;</span>  <span class="co1"># oops!</span>
<span class="kw3">Traceback</span> <span class="br0">&#40;</span>most recent call last<span class="br0">&#41;</span>:
  <span class="kw2">File</span> <span class="st0">"&lt;stdin&gt;"</span>, line <span class="nu0">1</span>, <span class="kw1">in</span> &lt;module&gt;
<span class="kw2">ValueError</span>: need more than <span class="nu0">1</span> value to unpack</pre>
<p>
It really is a <code>ValueError</code> (missing from ECMA&rsquo;s overloaded exception taxonomy, <code>TypeError</code> is used instead) to destructure (&rdquo;unpack&rdquo;) using an array pattern that does not match.
</p>

<p>
In JS1.7 (real, live session): 
</p>
<pre class="code javascript">js&gt; d = <span class="br0">&#123;</span>a:<span class="nu0">1</span>, b:<span class="nu0">2</span><span class="br0">&#125;</span>
<span class="br0">&#91;</span>object Object<span class="br0">&#93;</span>
js&gt; s = <span class="br0">&#91;</span>v <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#91;</span>k, v<span class="br0">&#93;</span> <span class="kw1">in</span> d<span class="br0">&#41;</span><span class="br0">&#93;</span>
<span class="nu0">1</span>,<span class="nu0">2</span>
js&gt; <span class="kw2">function</span> keys<span class="br0">&#40;</span>d<span class="br0">&#41;</span><span class="br0">&#123;</span><span class="kw1">for</span> <span class="br0">&#40;</span>let k <span class="kw1">in</span> d<span class="br0">&#41;</span> yield k<span class="br0">&#125;</span>
js&gt; t = <span class="br0">&#91;</span>k <span class="kw1">for</span> <span class="br0">&#40;</span>k <span class="kw1">in</span> d<span class="br0">&#41;</span><span class="br0">&#93;</span>
a,b
js&gt; u = <span class="br0">&#91;</span>v <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#91;</span>k, v<span class="br0">&#93;</span> <span class="kw1">in</span> d<span class="br0">&#41;</span><span class="br0">&#93;</span>
<span class="nu0">1</span>,<span class="nu0">2</span>
js&gt; <span class="kw2">function</span> items<span class="br0">&#40;</span>d<span class="br0">&#41;</span><span class="br0">&#123;</span><span class="kw1">for</span> <span class="br0">&#40;</span>let k <span class="kw1">in</span> d<span class="br0">&#41;</span> yield <span class="br0">&#91;</span>k, d<span class="br0">&#91;</span>k<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="br0">&#125;</span>
js&gt; u = <span class="br0">&#91;</span>v <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#91;</span>k, v<span class="br0">&#93;</span> <span class="kw1">in</span> items<span class="br0">&#40;</span>d<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
<span class="nu0">1</span>,<span class="nu0">2</span>
js&gt; <span class="kw2">function</span> values<span class="br0">&#40;</span>d<span class="br0">&#41;</span><span class="br0">&#123;</span><span class="kw1">for</span> each <span class="br0">&#40;</span>let v <span class="kw1">in</span> d<span class="br0">&#41;</span> yield v<span class="br0">&#125;</span>
js&gt; u = <span class="br0">&#91;</span>v <span class="kw1">for</span> <span class="br0">&#40;</span><span class="br0">&#91;</span>k, v<span class="br0">&#93;</span> <span class="kw1">in</span> values<span class="br0">&#40;</span>d<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#93;</span>
,</pre>
<p>
What&rsquo;s different? Ignoring mandatory extra parentheses, we have a special case: <code>for ([k, v] in d)</code> just works, destructuring key and value given non-iterator <code>d</code>. So we don&rsquo;t need <code>items(d)</code>.
</p>

<p>
But look what happens when <code>values(d)</code> is used: <code>[k, v]</code> unpacks <code>undefined</code> twice at indexes <code>0</code> and <code>1</code> from each (numeric in this example) value in <code>d</code>. This suggests that the problem to fix is not elevating the quirky (enumeration) case above the clean (iteration) case &ndash; it is that destructuring should throw something like <code>ValueError</code> when there is no such property. Or perhaps when the structural type given by the pattern (array of length 2) does not match the right-hand side.
</p>

<p>
On the other hand, destructuring is proposed as sugar for assignments from properties of the right-hand-side object, and you can easily mistake a number for some indexed object and get <code>undefined</code> by mistake from <code>n[0]</code>. But two wrongs don&rsquo;t make a right!
</p>

<p>
Lars, what do you say?
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/01/14 21:49</em>
</p>

<p>
Tentative comments:
</p>

<p>
I think that the fundamental bug here is that iterators change the meaning of for-in, especially given that we have for-each-in.  I understand the desirability for succinctness, but I think for-in should not be &ldquo;fixed&rdquo; in this way.  (Ideologically, I also do not consider it important that concepts carry over directly from Python any more than from Java or C++, say, so I sort of think of that as a non-argument <img src="lib/images/smileys/icon_smile.gif" align="middle" alt=":-)" /> )
</p>

<p>
I agree that destructuring in general is weak in the sense that errors go unnoticed, but destructuring was never intended to be more than syntactic sugar.  What makes it particularly brittle in this case is my proposal about allowing fancy destructuring in the for-in head coupled with the correct-but-sometimes-surprising behavior of trailing commas in array literals.
</p>

<p>
I think I&rsquo;ve argued myself into agreeing with Jeff (but I make no claims about actually understanding the iterators proposal fully yet).
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x61%3B%26%23x63%3B%26%23x6d%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x61;&#x63;&#x6d;&#x2e;&#x6f;&#x72;&#x67;">Lars T Hansen</a> 2007/01/16 07:47</em>
</p>

<p>
First, let me say that I hold no ideological or other <em>a priori</em> brief for Python. The costs of being influenced by it are language impedance mismatches and outright mistakes copied from it. The benefits are familiarity and reduced brain-print for programmers who know Python and use <acronym title="JavaScript">JS</acronym>/AS/ES (non-trivial population given the popularity of Python on the server, and the <acronym title="JavaScript">JS</acronym> monopoly on the client), and re-use of genuinely good ideas and design elements. The community-joining benefit in particular is important in my view (call this ideology if you like <img src="lib/images/smileys/icon_razz.gif" align="middle" alt=":-P" />).
</p>

<p>
Second, <code>for each (v in o)</code> is a late addition from ECMA-357 (E4X), not supported by browsers other than Firefox, verbose yet without connotation of value rather than key enumeration, and still cursed with <code>DontEnum</code>, shadowing along the prototype chain, and delete coherence. Arguing that we can make it work for iteration because it enumerates values in objects misses the point: iterators return arbitrary values, not values of their properties; and their prototype&rsquo;s properties, unless shadowed or deleted by the time the loop reaches them; and provided the property lacks <code>DontEnum</code>.
</p>

<p>
Count the semicolons in that last sentence. The problem here is not hijacking <code>for-in</code>, solvable by a lesser incompatible change (which is still hijacking if the first case is truly hijacking) to <code>for-each-in</code>. The problem is the complexity and confusion inherent in <strong>enumeration</strong>.
</p>

<p>
This is my fault, of course; it goes back to the dawn of JS1. I&rsquo;m proposing that we fix it directly and compatibly, by allowing the right operand of <code>in</code> to be an object that has an <code>iterator::get</code> method. Existing objects defined by ES3 and E4X have no such method. New objects may; user-defined objects, especially collections, will. And new objects matching a structural <code>IteratorType</code> by definition have an <code>iterator::get</code> method that returns its <code>this</code> object.
</p>

<p>
If the objection is that <code>for ([key, value] in obj)</code> vs. <code>for ([subject, verb, object] in tripledb)</code> can&rsquo;t be checked at compile time, the same objection exists for destructuring in general &ndash; and this proposal does not specify even runtime errors for pattern mismatch. That seems inconsistent, to say the least.
</p>

<p>
If the objection is that old syntax should not be retasked for new semantics, I would like to point out the retasking of <code>function</code> and <code>var</code> within classes and <code>function</code> within interfaces, and (particularly relevant here) the retasking of object and array initialiser syntax for destructuring left-hand side patterns, and (with necessary changes) for structural types. We are retasking old syntax all over the place, and I would argue for good reasons.
</p>

<p>
Iteration should be easy to say, as easy as enumeration. If there is a compelling argument for brand-new iteration syntax, I&rsquo;d like to hear it. It would be better to have new syntax than to retask <code>for-each-in</code> instead of <code>for-in</code>, just because of the red herring of value vs. key enumeration. Iteration is not enumeration. The choice is either to use the obvious (and Pythonic, for a bonus community benefit) syntax of <code>for-in</code>, or to invent something new (and gratuitous, <acronym title="In my humble opinion">IMHO</acronym>).
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/01/16 10:08</em>
</p>

<p>
See <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=366941" class="urlextern" target="_blank" title="https://bugzilla.mozilla.org/show_bug.cgi?id=366941" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Mozilla bug 366941</a> for a complaint from the field about this restriction on destructuring <code>for-in</code>.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/01/24 10:10</em>
</p>

<p>
See <a href="doku.php%3Fid=proposals:iterators_and_generators.html#itemization" class="wikilink1" title="proposals:iterators_and_generators" onclick="return svchk()" onkeypress="return svchk()">itemization</a> for a protocol that supports <code>for ([k,v] in o)</code> loops universally.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/02/22 16:41</em>
</p>

<p>
I recall Lars withdrawing the <code>for ([key, value] in obj)</code> special form at a Mozilla meeting late last year. The <a href="doku.php%3Fid=proposals:iterators_and_generators.html#itemization" class="wikilink1" title="proposals:iterators_and_generators" onclick="return svchk()" onkeypress="return svchk()">itemization</a> spec has been revised accordingly, but it also specifies that general destructuring on the left of <code>in</code> in <code>for-in</code> loop heads is allowed. If everyone agrees, then this whole section should be rewritten to state that any pattern is allowed in both <code>for-in</code> and <code>for-each-in</code> loops and comprehensions, and that the pattern destructures each iterated result in turn.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/03/11 04:21</em>
</p>

</div>

<a name="for-each_statements"></a><h4>For-each statements</h4>
<div class="level4">

<p>
 The meaning of 
</p>
<pre class="code">
   for each ( &lt;var-keyword&gt; &lt;pattern&gt; = &lt;expr0&gt; in &lt;expr1&gt; ) &lt;stmt&gt;
   for each ( &lt;var-keyword&gt; &lt;pattern&gt; in &lt;expr1&gt; ) &lt;stmt&gt;
   for each ( &lt;pattern&gt; in &lt;expr1&gt; ) &lt;stmt&gt;
</pre>

<p>
where <em>lvalue</em>s in <em>pattern</em> are identifiers <code>i1</code>, <code>i2</code>, ... is that <em>expr0</em> (if present) is evaluated and destructured into <code>i1</code>, <code>i2</code>, ... before the loop begins.  Then before at each iteration the value extracted from the object <em>expr1</em> is destructured into the variables <code>i1</code>, <code>i2</code> ....
</p>

</div>

<a name="formal_parameter_lists"></a><h3>Formal parameter lists</h3>
<div class="level3">

<p>
 The fragment
</p>
<pre class="code">
    function f({ &quot;name&quot;: name, &quot;address&quot;: address} : Person) { 
        ... 
    }
</pre>

<p>
can be transformed into a more primitive form:
</p>
<pre class="code">
    function f(tmp : Person) { 
       var { &quot;name&quot;: name, &quot;address&quot;: address} : Person = tmp;
       ... 
    }
</pre>

<p>
where <em>tmp</em> is a fresh unforgeable name.  If there are several destructurings, then they are processed in left-to-right order.  All the lvalues must be simple identifiers.
</p>

<p>
Rest parameters can also be destructured.  The fragment
</p>
<pre class="code">
    function f(...[ x, y ] : T) { 
        ... 
    }
</pre>

<p>
can be transformed into a more primitive form:
</p>
<pre class="code">
    function f(...tmp) { 
       var [x, y] : T = tmp;
       ... 
    }
</pre>

<p>
where <em>tmp</em> is a fresh unforgeable name.  There is no particular reason the pattern needs to be restricted to an array pattern, and in fact the following captures the two first arguments as well as the number of arguments passed:
</p>
<pre class="code">
    function f(...{ 0: x, 1: y, &quot;length&quot;: len }) { 
        ... 
    }
</pre>

</div>

<a name="notes"></a><h4>Notes</h4>
<div class="level4">

<p>
 As is the case for non-destructuring formal parameters, parameter names may be duplicated, and from the rewriting rules it follows that last binding wins, as is also the case for non-destructuring formal parameters.
</p>

<p>
It is necessary to use <code>var</code> rather than <code>let</code> in the rewritten fragments to make formal parameter names bound by destructurings to be equivalent to formal parameter names not so bound.  Consider:
</p>
<pre class="code javascript">    <span class="kw2">function</span> f<span class="br0">&#40;</span>a<span class="br0">&#41;</span> <span class="br0">&#123;</span> let a = <span class="nu0">42</span>; <span class="kw1">return</span> arguments<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> <span class="br0">&#125;</span>
    f<span class="br0">&#40;</span><span class="nu0">7</span><span class="br0">&#41;</span> =&gt; <span class="nu0">7</span></pre>
<p>
compared to:
</p>
<pre class="code javascript">    <span class="kw2">function</span> f<span class="br0">&#40;</span><span class="br0">&#91;</span>a, b<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> let a = <span class="nu0">42</span>, b = <span class="nu0">43</span>; <span class="kw1">return</span> arguments<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> <span class="br0">&#125;</span>
    f<span class="br0">&#40;</span><span class="br0">&#91;</span><span class="nu0">7</span>, <span class="nu0">8</span><span class="br0">&#93;</span><span class="br0">&#41;</span> =&gt; <span class="br0">&#91;</span><span class="nu0">7</span>, <span class="nu0">8</span><span class="br0">&#93;</span></pre>
<p>
as well as
</p>
<pre class="code javascript">    <span class="kw2">function</span> f<span class="br0">&#40;</span>a, b<span class="br0">&#41;</span>   <span class="br0">&#123;</span> <span class="kw2">function</span> a<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span><span class="br0">&#125;</span>; <span class="kw3">print</span><span class="br0">&#40;</span>a, b<span class="br0">&#41;</span> <span class="br0">&#125;</span>
    <span class="kw2">function</span> g<span class="br0">&#40;</span><span class="br0">&#91;</span>a, b<span class="br0">&#93;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw2">function</span> a<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span><span class="br0">&#125;</span>; <span class="kw3">print</span><span class="br0">&#40;</span>a, b<span class="br0">&#41;</span> <span class="br0">&#125;</span>
    f<span class="br0">&#40;</span><span class="nu0">1</span>, <span class="nu0">2</span><span class="br0">&#41;</span>   =&gt; <span class="st0">"function a() {} 2"</span>
    g<span class="br0">&#40;</span><span class="br0">&#91;</span><span class="nu0">3</span>, <span class="nu0">4</span><span class="br0">&#93;</span><span class="br0">&#41;</span> =&gt; <span class="st0">"3 4"</span></pre>
<p>
where the inner function <code>a</code> must be bound on entering the execution context for g(3, 4), then replaced by the destructured binding of <code>3</code> to <code>a</code>.
</p>

</div>

<a name="catch_clauses"></a><h3>Catch clauses</h3>
<div class="level3">

<p>
 The fragment
</p>
<pre class="code">
    try { 
        ... 
    }
    catch ( {&quot;message&quot;: m } : TypeError ) { 
        ... 
    }
</pre>

<p>
means
</p>
<pre class="code">
    try { 
        ... 
    }
    catch ( tmp : TypeError} ) { 
       let {&quot;message&quot;: m} : TypeError = tmp;
       ... 
    }
</pre>

<p>
where <em>tmp</em> is a fresh unforgeable name and <em>m</em> must be an identifier, obviously.
</p>

</div>

<a name="typecase_clauses"></a><h3>Typecase clauses</h3>
<div class="level3">

<p>
 The fragment
</p>
<pre class="code">
    switch type (x:U) {
        case ( { &quot;fnord&quot;: f } : X ) { 
            ... 
        }
    }
</pre>

<p>
means
</p>
<pre class="code">
    switch type (x:U) {
        case ( tmp : X ) { 
            let { &quot;fnord&quot;: f } : X = tmp;
            ... 
        }
    }
</pre>

<p>
where <em>tmp</em> is a fresh unforgeable name and <em>f</em> must be an identifier, obviously.
</p>

</div>

<a name="examples"></a><h2>Examples</h2>
<div class="level2">

<p>
 Swap:
</p>
<pre class="code">
    [a,b] = [b,a]
</pre>

<p>
Multiple-value returns:
</p>
<pre class="code javascript">    <span class="kw2">function</span> f<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="br0">&#91;</span><span class="nu0">1</span>,<span class="nu0">2</span><span class="br0">&#93;</span> <span class="br0">&#125;</span>
    <span class="kw2">var</span> a, b;
    <span class="br0">&#91;</span>a,b<span class="br0">&#93;</span> = f<span class="br0">&#40;</span><span class="br0">&#41;</span>;</pre>
<p>
Multiple-value returns, some values are not interesting:
</p>
<pre class="code javascript">    <span class="kw2">function</span> f<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="br0">&#91;</span><span class="nu0">1</span>,<span class="nu0">2</span>,<span class="nu0">3</span><span class="br0">&#93;</span> <span class="br0">&#125;</span>
    <span class="kw2">var</span> <span class="br0">&#91;</span>a,,b<span class="br0">&#93;</span> = f<span class="br0">&#40;</span><span class="br0">&#41;</span>;</pre>
<p>
Going deeper into the array:
</p>
<pre class="code javascript">    <span class="br0">&#91;</span>a,,<span class="br0">&#91;</span>b,,<span class="br0">&#91;</span>c<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="br0">&#93;</span> = f<span class="br0">&#40;</span><span class="br0">&#41;</span>;</pre>
<p>
Object destructuring:
</p>
<pre class="code javascript">    <span class="kw2">var</span> <span class="br0">&#123;</span> op: a, lhs: b, rhs: c <span class="br0">&#125;</span> = getASTNode<span class="br0">&#40;</span><span class="br0">&#41;</span></pre>
<p>
Digging deeper into an object:
</p>
<pre class="code javascript">    <span class="kw2">var</span> <span class="br0">&#123;</span> op: a, lhs: <span class="br0">&#123;</span> op: b <span class="br0">&#125;</span>, rhs: c <span class="br0">&#125;</span> = getASTNode<span class="br0">&#40;</span><span class="br0">&#41;</span></pre>
<p>
Looping across an object:
</p>
<pre class="code javascript">    <span class="kw1">for</span> <span class="br0">&#40;</span> let <span class="br0">&#91;</span><span class="kw3">name</span>, value<span class="br0">&#93;</span> <span class="kw1">in</span> obj <span class="br0">&#41;</span>
        <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">"Name: "</span> + <span class="kw3">name</span> + <span class="st0">", Value: "</span> + value<span class="br0">&#41;</span>;</pre>
<p>
Looping across values in an object:
</p>
<pre class="code javascript">    <span class="kw1">for</span> each <span class="br0">&#40;</span> let <span class="br0">&#123;</span> <span class="kw3">name</span>: n, family: <span class="br0">&#123;</span> father: f <span class="br0">&#125;</span> <span class="br0">&#125;</span> <span class="kw1">in</span> obj <span class="br0">&#41;</span>
       <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">"Name: "</span> + n + <span class="st0">", Father: "</span> + f<span class="br0">&#41;</span>;</pre>
<p>
Summing the salary fields of all records whose record key begins with <code>N</code> (silly, and depends on the proposed string-indexing syntax):
</p>
<pre class="code javascript">    <span class="kw1">for</span> <span class="br0">&#40;</span> let <span class="br0">&#91;</span><span class="br0">&#91;</span>k<span class="br0">&#93;</span>, <span class="br0">&#123;</span> <span class="st0">"salary"</span>: s <span class="br0">&#125;</span><span class="br0">&#93;</span> <span class="kw1">in</span> database <span class="br0">&#41;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>k == <span class="st0">"N"</span><span class="br0">&#41;</span>
            sum += s;</pre>
<p>
   Function that destructures its first argument and accepts some optional object arguments:
</p>
<pre class="code">
    function f( { &quot;name&quot;: n } : Person, ...[ a, b, c ] : [ Object ] )
    {
    }
</pre>

<p>
(Not sure about the type of the rest parameter here.)
</p>

</div>

<a name="prior_art"></a><h2>Prior art</h2>
<div class="level2">

<p>
 Array destructuring is implemented in the Opera browser starting with Opera 8. 
</p>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/6/64996bb9d3fa8d0a9533455ee2d1bc8a.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        proposals/destructuring_assignment.txt &middot; Last modified: 2008/07/14 18:38 by jodyer      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:destructuring_assignment" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:destructuring_assignment" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="proposals:destructuring_assignment" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="proposals:destructuring_assignment" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=proposals:destructuring_assignment.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=proposals%253Adestructuring_assignment&amp;1454275571" width="1" height="1" alt=""  /></body>
</html>
