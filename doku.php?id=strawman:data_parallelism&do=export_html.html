<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:data_parallelism&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#parallel_ecmascript_river_trail_api" class="toc">Parallel EcmaScript (River Trail) API</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#introduction" class="toc">Introduction</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#goals" class="toc">Goals</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#proposal" class="toc">Proposal</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#design_approach" class="toc">Design approach</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#approach" class="toc">Approach</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arrays_and_typed_objects" class="toc">Arrays and Typed Objects</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#elemental_functions" class="toc">Elemental Functions</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#temporal_immutability" class="toc">Temporal Immutability</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#prototype_methods" class="toc">Prototype Methods</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#example" class="toc">Example</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#terminology" class="toc">Terminology</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#api" class="toc">API</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#mappar" class="toc">mapPar</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#elemental_function" class="toc">Elemental Function</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#examplean_identity_function" class="toc">Example: an identity function</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#frompar" class="toc">fromPar</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#elemental_function" class="toc">Elemental Function</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#exampleconvert_1_2_3_to_a_int32array" class="toc">Example: Convert [1,2,3] to a Int32Array</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#reducepar" class="toc">reducePar</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#elemental_function" class="toc">Elemental Function</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#scanpar" class="toc">scanPar</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#elemental_function" class="toc">Elemental Function</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#exampleprefix_sum" class="toc">Example: Prefix Sum</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#scatterpar" class="toc">scatterPar</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#examplean_identity_function" class="toc">Example: an identity function</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#handling_conflicts_with_the_conflict_function" class="toc">Handling conflicts with the Conflict Function</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#exampleresolve_conflict_with_the_larger_value" class="toc">Example: Resolve conflict with the larger value</a></span></li>
</ul>
</li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#filterpar" class="toc">filterPar</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#elemental_function" class="toc">Elemental Function</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#examples" class="toc">Examples</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#identity_function" class="toc">identity function</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#filter_out_every_other_element" class="toc">filter out every other element</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#buildpar" class="toc">buildPar</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#elemental_function" class="toc">Elemental Function</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#flatten" class="toc">flatten</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#example" class="toc">Example</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#partition" class="toc">partition</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#example" class="toc">Example</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#get" class="toc">get</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#arguments" class="toc">Arguments</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#throws" class="toc">Throws</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#example" class="toc">Example</a></span></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#api_additions" class="toc">API additions</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#type" class="toc">type</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#synopsis" class="toc">Synopsis</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#array" class="toc">Array</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#typed_object" class="toc">Typed Object</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#returns" class="toc">Returns</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#example" class="toc">Example</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=strawman:data_parallelism&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<a name="parallel_ecmascript_river_trail_api"></a><h1>Parallel EcmaScript (River Trail) API</h1>
<div class="level1">

</div>
<!-- SECTION [1-52] -->
<a name="introduction"></a><h1>Introduction</h1>
<div class="level1">

<p>
This proposal describes a gentle extension to EcmaScript that will enable access to the parallelism found in modern processors. 
</p>

</div>
<!-- SECTION [53-207] -->
<a name="goals"></a><h1>Goals</h1>
<div class="level1">

<p>
The goal of this proposal is to enable data-parallelism in web applications. Browser applications and in particular EcmaScript often need to leverage all available computing resources to provide the best possible user experience. Today web applications do not take full advantage of ever increasing parallel client hardware due to the lack of appropriate programming models. This proposal puts the parallel computing power of client&rsquo;s hardware into the hands of the web developer while staying within the safe and secure boundaries of the familiar EcmaScript programming paradigm. It gently extends EcmaScript with simple deterministic data-parallel constructs that enable runtime translation to a low-level hardware abstraction layer. By leveraging multiple CPU cores and vector instructions, Parallel EcmaScript achieves significant speedup over sequential EcmaScript.
</p>

</div>
<!-- SECTION [208-1097] -->
<a name="proposal"></a><h1>Proposal</h1>
<div class="level1">

</div>
<!-- SECTION [1098-1119] -->
<a name="design_approach"></a><h2>Design approach</h2>
<div class="level2">

</div>
<!-- SECTION [1120-1146] -->
<a name="approach"></a><h3>Approach</h3>
<div class="level3">

<p>
The design of Parallel EcmaScript (aka RiverTrail) adds methods with parallel semantics to Array and Typed Object, see  <a href="doku.php%3Fid=harmony:typed_objects.html" class="wikilink1" title="harmony:typed_objects" onclick="return svchk()" onkeypress="return svchk()">typed objects</a>, prototypes. These methods take as an argument an elemental function which typically returns a single data element. The methods are designed to enable concurrent execution of the elemental function.
</p>

<p>
We have chosen a set of parallel constructs that we feel is minimal and upon which other data parallel constructs can be built. For example sum would be implemented using the <em>reducePar</em> construct while prefix sum would be implemented using the <em>scanPar</em> construct. We anticipate useful libraries and infrastructure being built upon these constructs. This approach enables a &ldquo;do few things well&rdquo; implementation strategy while ensuring the composability needed to build other abstractions.
</p>

</div>
<!-- SECTION [1147-2006] -->
<a name="arrays_and_typed_objects"></a><h3>Arrays and Typed Objects</h3>
<div class="level3">

<p>
Array types are extended instead of introducing a new data type as we did in previous proposals. The Array types will be used for one dimensional objects. Some interfaces, in particular WebGL and canvas, require the use of specific Typed Object formats like single precision float (float32), unsigned 8 bit Integer values (uint8) or structs. Treating collection of data as multi-dimension data structures is also useful. To support these use we have added the same functionality to the Typed Object types adapting the interfaces to reflect the increased robustness of Typed Object. 
</p>

</div>
<!-- SECTION [2007-2624] -->
<a name="elemental_functions"></a><h3>Elemental Functions</h3>
<div class="level3">

<p>
Similar in spirit to the use of kernel functions and callback functions our approach makes use of elemental functions written in EcmaScript.  Any EcmaScript function can be used as long as it has an appropriate signature and is temporally immutable, i.e., the function is side effect free and does not mutate global state. The system will determine if the elemental function can be optimized to take advantage of data parallel hardware. If the system can prove that the function is not temporally immutable it will throw an error.   If the optimization is semantically possible but the system is unable to do the optimization it is free to execute it sequentially.  Providing an elemental function that can be optimized is the responsibility of the developer though there are a few hints that will serve the programmer well.  Recursion is an example of a typical EcmaScript construct that is likely to defeat optimization.  Sequences of arithmetic operations on Arrays or Typed Objects that hold dense homogeneous data, e.g. Array objects that contain only floating point numbers, are good candidates for optimization. 
</p>

</div>
<!-- SECTION [2625-3773] -->
<a name="temporal_immutability"></a><h3>Temporal Immutability</h3>
<div class="level3">

<p>
Temporal immutability means that whenever it is possible for two or more computations to run concurrently all objects visible to both computations are immutable until the computations complete. Since the main thread is dormant during parallel execution it is free to mutate objects without regard to temporal immutability. Since all current EcmaScript programs are single threaded they are temporally immutable and unaffected by this extension. Temporal immutability is weaker than declaring an object immutable since the object can be mutated by the main thread or if the object is local to a parallel thread. 
</p>

</div>
<!-- SECTION [3774-4418] -->
<a name="prototype_methods"></a><h3>Prototype Methods</h3>
<div class="level3">

<p>
Array and Typed Object come with the following four data parallel methods that map Arrays to Arrays and Typed Object to Typed Object: <code>mapPar</code>, <code>scanPar</code>, <code>filterPar</code>, and <code>scatterPar</code>. When combined with elemental functions each of these methods create a freshly minted object. In addition to these we provide the method <code>buildPar</code> which uses an elemental function to create freshly minted Arrays and Typed Object.   Array and Typed Object also includes a sixth data parallel method, <code>reducePar</code>, which typically produces a single value. We believe that with these few methods one can create a very robust and complete data parallel library that covers a large number of applications. 
</p>

</div>
<!-- SECTION [4419-5151] -->
<a name="example"></a><h3>Example</h3>
<div class="level3">

<p>
This simple example creates a three element Array <code>myPA</code>.  It then uses the prototype method <code>mapPar</code> and the elemental function <code>val &rArr; val + 1</code> to create a freshly minted Array <code>myPlusPA</code> with each element in <code>myPA</code> incremented by 1. 
</p>
<pre class="code">
myPA = [1, 2, 3];                                               // [1, 2, 3]
myPlusPA = myPA.mapPar(val =&gt; val + 1);  // [2, 3, 4]
</pre>

</div>
<!-- SECTION [5152-5560] -->
<a name="terminology"></a><h3>Terminology</h3>
<div class="level3">

<p>
<code>Frame</code> indicates the iteration space. <code>Depth</code> indicates how many dimensions to iterate over. As such it is how many dimensions are to be used in the <code>frame</code>.  <code>Grain</code> indicates the value at each iterations, it is what is returned by an elemental function. An <code>element</code> is the grain found when the depth and the number of dimensions are the same. For example if one has a 4 dimensional structure and maps at the depth of 4 then the <code>grain</code> is the same as the <code>element</code> and the <code>frame</code> has 4 dimensions. If I map at the depth of 3 then the <code>grain</code> is a 1 dimensional vector of <code>elements</code> and the <code>frame</code> has 3 dimensions. Since Arrays are always one dimensional one can only iterate at the depth of 1, the <code>frame</code> has 1 dimension and the <code>grain</code> is the same as the <code>elements</code>. The terms <code>grainType</code> and <code>elementType</code> indicate corresponding types of a <code>grain</code> or an <code>element</code>.
</p>

</div>
<!-- SECTION [5561-6492] -->
<a name="api"></a><h2>API</h2>
<div class="level2">

</div>
<!-- SECTION [6493-6507] -->
<a name="mappar"></a><h3>mapPar</h3>
<div class="level3">

</div>
<!-- SECTION [6508-6522] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [6523-6538] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">
<pre class="code">myArray.mapPar(elementalFunction, thisArg = undefined)</pre>

</div>
<!-- SECTION [6539-6621] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myTO.mapPar(depth = 1, elementalFunction, thisArg = undefined)</pre>

</div>
<!-- SECTION [6622-6719] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li">  <code>depth</code> (optional) the number of dimensions to iterate over (as before), default is 1, the outermost dimension.</div>
</li>
<li class="level1"><div class="li">  <code>elementalFunction</code> described below</div>
</li>
<li class="level1"><div class="li">  <code>thisArg</code> If a thisArg parameter is provided, it will be used as the this value for each invocation of elementalFunction. If it is not provided, undefined is used instead.</div>
</li>
</ul>

</div>
<!-- SECTION [6720-7080] -->
<a name="elemental_function"></a><h4>Elemental Function</h4>
<div class="level4">
<pre class="code">function (element, index, source, outCursor) </pre>
<ul>
<li class="level1"><div class="li">  <code>element</code> The element from the source.</div>
</li>
<li class="level1"><div class="li">  <code>index</code> The index in source where element is located as well as where the result will be placed.</div>
</li>
<li class="level1"><div class="li">  <code>source</code> The source holding the elements.</div>
</li>
<li class="level1"><div class="li">  <code>outCursor</code> Output cursor where results can be placed. If a non-undefined value is returned outCursor will be overwritten by the returned value. </div>
</li>
</ul>

<p>
If outCursor is not specified the result of the function will be placed in mapPar&rsquo;s result at index.
</p>

</div>
<!-- SECTION [7081-7622] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
A freshly minted Array or Typed Object. Elements are the results of applying the elemental function to the elements in the original Array or Typed Object block coerced to the type grain of the source.
</p>

</div>
<!-- SECTION [7623-7839] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>elementalFunction</code> is not a function. </div>
</li>
<li class="level1"><div class="li"> <em>Error</em> when required by Typed Object conversion semantics.</div>
</li>
</ul>

</div>
<!-- SECTION [7840-7984] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
One functionally correct implementation of <em>mapPar</em> using Array would be to use the sequential map. 
</p>

</div>
<!-- SECTION [7985-8106] -->
<a name="examplean_identity_function"></a><h4>Example: an identity function</h4>
<div class="level4">
<pre class="code">
result = pa.mapPar(function(val){return val;});
</pre>

</div>
<!-- SECTION [8107-8206] -->
<a name="frompar"></a><h3>fromPar</h3>
<div class="level3">

</div>
<!-- SECTION [8207-8222] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [8223-8237] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">
<pre class="code">Array.fromPar(source, elementalFunction=undefined, thisArg=undefined)</pre>

</div>
<!-- SECTION [8238-8330] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">TypedObject.fromPar(source, elementalFunction=undefined, thisArg=undefined)</pre>

</div>
<!-- SECTION [8331-8437] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li">  <code>source</code> The source values  </div>
</li>
<li class="level1"><div class="li">  <code>elementalFunction</code> if defined is called as described below, if undefined the source values are simple converted to Array or TypedObject elements.</div>
</li>
<li class="level1"><div class="li">  <code>thisArg</code>  If defined it is used as the <code>this</code> inside the <code>elementalFunction</code></div>
</li>
</ul>

</div>
<!-- SECTION [8438-8732] -->
<a name="elemental_function"></a><h4>Elemental Function</h4>
<div class="level4">
<pre class="code">function (element, index, source, outCursor) </pre>
<ul>
<li class="level1"><div class="li">  <code>element</code> The element from the source.</div>
</li>
<li class="level1"><div class="li">  <code>index</code> The index in source where element is located as well as where the result will be placed.</div>
</li>
<li class="level1"><div class="li">  <code>source</code> The source holding the elements.</div>
</li>
<li class="level1"><div class="li">  <code>outCursor</code> Output cursor where results can be placed. If a non-undefined value is returned outCursor will be overwritten by the returned value.</div>
</li>
</ul>

<p>
  If outCursor is not specified the result of the function will be placed in fromPar&rsquo;s result at index. 
</p>

</div>
<!-- SECTION [8733-9271] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
A freshly minted Array or Type Object. Elements are the results of applying the elemental function to the elements in the source and converting them according to the Array or Typed Object. If the elemental function is not provided the source values are converted into the appropriate destination type.
</p>

</div>
<!-- SECTION [9272-9588] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>elementalFunction</code> is not a function or undefined. </div>
</li>
<li class="level1"><div class="li"> <em>Error</em> when required by Typed Object conversion semantics.</div>
</li>
</ul>

</div>
<!-- SECTION [9589-9746] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
Unlike the sequential version of from the elemental function takes an index, the source, and an outcursor. 
</p>

</div>
<!-- SECTION [9747-9870] -->
<a name="exampleconvert_1_2_3_to_a_int32array"></a><h4>Example: Convert [1,2,3] to a Int32Array</h4>
<div class="level4">
<pre class="code">
result = Int32Array.fromPar([1,2,3]);
result = Int32Array.fromPar([1,2,3], function(val){return val;});
</pre>

</div>
<!-- SECTION [9871-10037] -->
<a name="reducepar"></a><h3>reducePar</h3>
<div class="level3">

</div>
<!-- SECTION [10038-10055] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [10056-10070] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">
<pre class="code">myArray.reducePar(elementalFunction)</pre>

</div>
<!-- SECTION [10071-10132] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myArray.reducePar(elementalFunction)</pre>

</div>
<!-- SECTION [10133-10200] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">

<p>
<code>elementalFunction</code> described below 
</p>

</div>
<!-- SECTION [10201-10254] -->
<a name="elemental_function"></a><h4>Elemental Function</h4>
<div class="level4">
<pre class="code">function (a, b)</pre>
<ul>
<li class="level1"><div class="li">  <code>a, b</code> Arguments to be reduced and returned</div>
</li>
</ul>

</div>
<!-- SECTION [10255-10360] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
The final value, if the source Array or Typed Object has only 1 element then that element is returned.
</p>

</div>
<!-- SECTION [10361-10478] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>elementalFunction</code> is not a function.</div>
</li>
<li class="level1"><div class="li"> <em>RangeError</em> if the source Array or Typed Object is empty. </div>
</li>
</ul>

</div>
<!-- SECTION [10479-10623] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
reducePar is free to group calls to the elemental function and reorder the calls. For an elemental function that is associative the final result will be the same as reducing from left to right. Modular addition of integers is an example of an associative function and in this case the sum of an Array will always be the same regardless of the order that <code>reducePar</code> calls the addition operator. On the other hand, averaging is an example of a non-associative function. The expression Average(Average(2, 3), 9) produces the value 5 2/3 while the expression Average(2, Average(3, 9)) produces the value 4. <code>reducePar</code> is permitted to choose whichever call ordering it finds convenient.
</p>

<p>
<code>reducePar</code> is only required to return a result consistent with some call ordering and is not required to choose the same call ordering on subsequent calls. Furthermore, <code>reducePar</code> does not magically resolve problems related to overflow and the well documented fact that some floating point numbers are not represented exactly in EcmaScript and the underlying hardware so floating point addition and multiplication are not truly associative.
</p>

<p>
Typically the programmer will only call <code>reducePar</code> with associative functions but there is nothing preventing them doing otherwise. Calling <code>reducePar</code> with a non-associative function will lead to a result that is guaranteed only to be consistent with some ordering of applying the elemental function on some ordering of the arguments.
</p>

<p>
<code>reducePar</code> always works on the top level dimensions. 
</p>

</div>
<!-- SECTION [10624-12177] -->
<a name="scanpar"></a><h3>scanPar</h3>
<div class="level3">

</div>
<!-- SECTION [12178-12193] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [12194-12208] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">
<pre class="code">myArray.scanPar(elementalFunction)</pre>

</div>
<!-- SECTION [12209-12268] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myTO.scanPar(elementalFunction)</pre>

</div>
<!-- SECTION [12269-12332] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <code>elementalFunction</code> described below</div>
</li>
</ul>

</div>
<!-- SECTION [12333-12393] -->
<a name="elemental_function"></a><h4>Elemental Function</h4>
<div class="level4">
<pre class="code">function (a, b) </pre>
<ul>
<li class="level1"><div class="li">  <code>a, b</code> - arguments to be reduced and result returned</div>
</li>
</ul>

<p>
The arguments will have the same grainType as the source elements. The returned result is converted immediately to the grainType of source elements.  
</p>

</div>
<!-- SECTION [12394-12660] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
<code>scanPar</code> returns a freshly minted Array or Typed Object whose i-th element is the result of using the elemental function to reduce the source elements between 0 and i, inclusively. Elements returned from elemental functions are converted to the type of the elements in the spec before being stored in the result. 
</p>

</div>
<!-- SECTION [12661-12993] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>elementalFunction</code> is not a function.</div>
</li>
<li class="level1"><div class="li"> <em>Error</em> when required by Typed Object conversion semantics.</div>
</li>
</ul>

</div>
<!-- SECTION [12994-13137] -->
<a name="exampleprefix_sum"></a><h4>Example: Prefix Sum</h4>
<div class="level4">
<pre class="code">pa.scanPar(function(a, b){return a+b;})</pre>

</div>
<!-- SECTION [13138-13218] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
The construct implements what is known as an inclusive scan which means that the value of the i-th result is the same as what would be produced by  <code>[0..i].reducePar(elementalFunction)</code>. Notice that the first element of the result is the same as the first element in the original Array. An exclusive scan can be implemented by shifting right by one the results of an inclusive scan dropping the rightmost value, and inserting the identity at location 0. Similar to reducePar, scanPar can reorder the calls to the elemental functions. Ignoring overflow and floating point anomalies, this cannot be detected if the elemental function is associative and commutative; in which case using an elemental function such as addition to create a partial sum will produce the same result regardless of the order in which the elemental function is called. However using a non-associative or non-commutative function can produce different results due to the ordering that <code>scanPar</code> calls the elemental function. While <code>scanPar</code> will produce a result consistent with a legal ordering the ordering and the result may differ for each call to scanPar.
</p>

<p>
Typically the programmer will only call <code>scanPar</code> with associative and commutative functions but there is nothing preventing them doing otherwise. Calling <code>scanPar</code> with a non-associative and/or non-commutative function will lead to a result that is guaranteed only to be consistent with some ordering of applying the elemental function. One issue that has come up is when the coercion to grainType is done. The elementalFunction might see arguments from the source mixed up with intermediate results from previous invocation of the elementalFunction if the intermediate values are not converted immediately upon return from the elementalFunction. To avoid this the returned values are converted immediately to the grainType of the source element. 
</p>

</div>
<!-- SECTION [13219-15131] -->
<a name="scatterpar"></a><h3>scatterPar</h3>
<div class="level3">

</div>
<!-- SECTION [15132-15150] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [15151-15165] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">
<pre class="code">myArray.scatterPar(indices, defaultValue, conflictFunction, length)</pre>

</div>
<!-- SECTION [15166-15258] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myTO.scatterPar(indices, defaultValue, conflictFunction, length)</pre>

</div>
<!-- SECTION [15259-15355] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li">  <code>indices</code> array of indices in the resulting array<br/>
</div>
</li>
<li class="level1"><div class="li">  <code>defaultValue</code> optional argument indicating the value of elements not set by scatter. When not present, the default value is <code>undefined</code></div>
</li>
<li class="level1"><div class="li">  <code>conflictFunction</code> optional function to resolve conflicts, details below.</div>
</li>
<li class="level1"><div class="li">  <code>length</code> optional argument indicating the length of the resulting array. If absent, the length is the same as the length of the source.</div>
</li>
</ul>

</div>
<!-- SECTION [15356-15802] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
A freshly minted Array <code>A</code> where each element <code>A[i]</code> is defined as
</p>
<ol>
<li class="level1"><div class="li">  <code>A[indices[i]] = myArray[i]</code>, when <code>indices[i]</code> appears only once in <code>indices</code></div>
</li>
<li class="level1"><div class="li">  <code>A[indices[i]] = grainType(conflictFunction(valA, valB ) </code> when multiple elements are scattered to the same location. The return value is immediately converted to grainType.</div>
</li>
</ol>

</div>
<!-- SECTION [15803-16161] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>RangeError</em> when the length of <code>indices</code> does not match the <code>length</code> argument or, if <code>length</code> is not given, the length of the source Array or Typed Object.</div>
</li>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>conflictFunction</code> is neither <code>undefined</code> nor a function.</div>
</li>
<li class="level1"><div class="li"> <em>RangeError</em> when a conflict occurs but no conflict function has been supplied by the programmer.</div>
</li>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>indices</code> contains a value that cannot be interpreted as a number, e.g., +-Infinity and NaN.</div>
</li>
<li class="level1"><div class="li"> <em>RangeError</em> when <code>indices</code> contains an index smaller 0 or greater than the result array&rsquo;s length.</div>
</li>
<li class="level1"><div class="li"> <em>Error</em> when required by Typed Object conversion semantics. Note that omitting a default value while using a type specification may lead to coercion errors if the default cannot be coerced to the specified type.</div>
</li>
</ul>

</div>
<!-- SECTION [16162-16977] -->
<a name="examplean_identity_function"></a><h4>Example: an identity function</h4>
<div class="level4">

<p>
<code>result = pa.scatterPar(indices);</code> where <code>indices</code> is a Array in which element === index
</p>

</div>
<!-- SECTION [16978-17107] -->
<a name="handling_conflicts_with_the_conflict_function"></a><h4>Handling conflicts with the Conflict Function</h4>
<div class="level4">

<p>
A conflict occurs when multiple elements are scattered to the same location. It results in a call to <code>conflictFunction</code>, which is an optional third argument to “scatterPar”. If <code>conflictFunction</code> is undefined, <code>scatterPar</code> throws an exception when a conflict occurs. Note that the order in which conflicts are resolved is left unspecified. Therefore, to ensure deterministic behavior, the conflict functions needs to be deterministic and associative.
</p>

</div>
<!-- SECTION [17108-17621] -->
<a name="discussion"></a><h5>Discussion</h5>
<div class="level5">

<p>
It is important to note here that for <em>scatterPar</em>, the arguments to the conflict resolution function are the already coerced values. The rationale is two-fold:
</p>
<ul>
<li class="level1"><div class="li"> <em>Conceptually</em>, the conflict resolution function resolves conflicting stores to the result object. As only coerced values are stored, these are also the parties in the conflict.</div>
</li>
<li class="level1"><div class="li"> <em>Practically</em>, this semantics enables a simpler and more efficient implementation, where results may be written to the final result buffer even though a conflict may still arise.  </div>
</li>
</ul>

<p>
The value returned is converted to the grainType found in the source. The created “block” object uses a data storage format that complies with the type description <code>ArrayType(typeSpec, length)</code> where <code>length</code> is the value of the <em>length</em> argument or, if that is omitted, the value of the <em>length</em> property of the source array <code>myArray</code>.
</p>
<pre class="code">conflictFunction(valA, valB)</pre>

</div>
<!-- SECTION [17622-18568] -->
<a name="arguments"></a><h5>Arguments</h5>
<div class="level5">
<ul>
<li class="level1"><div class="li">  <code>valA, valB</code> the two values that conflict</div>
</li>
</ul>

</div>
<!-- SECTION [18569-18632] -->
<a name="returns"></a><h5>Returns</h5>
<div class="level5">

<p>
Value to place in <code>result[indices[index]] </code>. This value will be converted according to grain type found in the source.
</p>

</div>
<!-- SECTION [18633-18766] -->
<a name="exampleresolve_conflict_with_the_larger_value"></a><h5>Example: Resolve conflict with the larger value</h5>
<div class="level5">
<pre class="code">
function chooseMax(valA, valB){
      return (valA&gt;valB)?valA:valB;
 }
pa = [0,1,2,3,4,5];
result  = pa.scatterPar([0,3,1,4,2,5]);  		   // &lt;0,2,4,1,3,5&gt;
result2 = pa.scatterPar([0,0,1,1,2,2], 42, chooseMax);     // &lt;1,3,5,42,42,42&gt;
result3 = pa.scatterPar([0,0,1,1,2,2], 42, chooseMax, 3);  // &lt;1,3,4&gt;
</pre>

</div>
<!-- SECTION [18767-19139] -->
<a name="filterpar"></a><h3>filterPar</h3>
<div class="level3">

</div>
<!-- SECTION [19140-19158] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [19159-19173] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">
<pre class="code">myArray.filterPar(elementalFunction)</pre>

</div>
<!-- SECTION [19174-19235] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myTO.filterPar(elementalFunction)</pre>

</div>
<!-- SECTION [19236-19301] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>elementalFunction</em> described below.</div>
</li>
</ul>

</div>
<!-- SECTION [19302-19362] -->
<a name="elemental_function"></a><h4>Elemental Function</h4>
<div class="level4">
<pre class="code">function (element, index, source) </pre>
<ul>
<li class="level1"><div class="li">  <code>element</code> The element from the source Array or Typed Object.</div>
</li>
<li class="level1"><div class="li">  <code>index</code> The index in source where element is located.</div>
</li>
<li class="level1"><div class="li">  <code>source</code> The source Array or Typed Object holding the elements.</div>
</li>
</ul>

<p>
If the result of the function is truthy then the corresponding element will be placed in <code>filterPar</code>&lsquo;s result. Elements in the result will be in the same order as in the <code>source</code>.
</p>

</div>
<!-- SECTION [19363-19820] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
A freshly minted Array holding the source elements located at <em>myArray[i]</em> for which <em>elementalFunction</em> returns a truthy value. The order of the elements in the result is the same as the order of the elements in the source.
</p>

</div>
<!-- SECTION [19821-20065] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>elementalFunction</code> is not a function. </div>
</li>
<li class="level1"><div class="li"> <em>Error</em> If required by the Typed Object conversion semantics. </div>
</li>
</ul>

</div>
<!-- SECTION [20066-20213] -->
<a name="examples"></a><h4>Examples</h4>
<div class="level4">

</div>
<!-- SECTION [20214-20228] -->
<a name="identity_function"></a><h5>identity function</h5>
<div class="level5">
<pre class="code">
var pa = [1,2,3,4,5,6,7]; 
var result = pa.filterPar(function(ignore){return true;});
</pre>

</div>
<!-- SECTION [20229-20354] -->
<a name="filter_out_every_other_element"></a><h5>filter out every other element</h5>
<div class="level5">
<pre class="code">
var pa = [1,2,3,4,5,6,7]; 
var result = pa.filterPar(function(element, index) { return index%2?false:true;} );
</pre>

</div>
<!-- SECTION [20355-20520] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
The values are converted to the grain type of the source. The result uses a data storage format that complies with the grain type of the source.
</p>

</div>
<!-- SECTION [20521-20686] -->
<a name="buildpar"></a><h3>buildPar</h3>
<div class="level3">

</div>
<!-- SECTION [20687-20708] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

<p>
buildPar is a method of ArrayType, see <a href="doku.php%3Fid=harmony:typed_objects.html" class="wikilink1" title="harmony:typed_objects" onclick="return svchk()" onkeypress="return svchk()">typed objects</a>. It is intended to be used to create new Arrays and Typed Objects in parallel.
</p>

</div>
<!-- SECTION [20709-20868] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">
<pre class="code">ArrayType.buildPar(iterationSpace, elementalFunction)</pre>

</div>
<!-- SECTION [20869-20948] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code"> ArrayType.buildPar(iterationSpace, elementalFunction) </pre>

</div>
<!-- SECTION [20949-21039] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li">  <code>iterationSpace</code> the shape, if a scalar the length of a 1 dimensional array, otherwise an array of scalars specifying the shape of the result. </div>
</li>
<li class="level1"><div class="li">  <code>elementalFunction</code> described below</div>
</li>
</ul>

</div>
<!-- SECTION [21040-21252] -->
<a name="elemental_function"></a><h4>Elemental Function</h4>
<div class="level4">
<pre class="code">function (index, outCursor)  </pre>
<pre class="code">function (index, [outCursor1, outCursor2, …, outCursorN]) </pre>
<ul>
<li class="level1"><div class="li"> <code>index</code> The index in source where element is located as well as where the result will be placed.</div>
</li>
<li class="level1"><div class="li"> <code>outCursor</code> (optional) <code>outCursor</code> specifies a cursor where results can be placed. If a non-undefined value is returned outCursor will be overwritten by the returned value. </div>
</li>
<li class="level1"><div class="li"> <code>[outCursor1, outCursor2, … outCursorN]</code> (optional) An array of output cursors where results can be placed. If a non-undefined value is returned outCursor1 will be overwritten by the returned value. If a non-undefined value is returned outCursor1 will be set to the returned value. </div>
</li>
</ul>

</div>
<!-- SECTION [21253-21975] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
If zero or one outCursor is specified: A freshly minted Array or Typed Object.
</p>

<p>
Otherwise: an array holding the arrays associated with the outCursors.
</p>

</div>
<!-- SECTION [21976-22142] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>TypeError</em> when <code>elementalFunction</code> is not a function. </div>
</li>
<li class="level1"><div class="li"> <em>Error</em> when required by Typed Object conversion semantics.</div>
</li>
</ul>

</div>
<!-- SECTION [22143-22289] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
 Typed Objects work by moving the shape and grain type specification into the type. For example
</p>
<pre class="code">
var T = new ArrayType([20,40], uint32); 

var result = T.buildPar((i, j)=&gt;i+j);
</pre>

</div>
<!-- SECTION [22290-22503] -->
<a name="flatten"></a><h3>flatten</h3>
<div class="level3">

</div>
<!-- SECTION [22504-22520] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [22521-22535] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">

<p>
Not available.
</p>

</div>
<!-- SECTION [22536-22561] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myTO.flatten()</pre>

</div>
<!-- SECTION [22562-22607] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">

<p>
none 
</p>

</div>
<!-- SECTION [22608-22628] -->
<a name="throws"></a><h4>throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>RangeError</em> when <code>myArray</code> is one dimensional.</div>
</li>
</ul>

</div>
<!-- SECTION [22629-22699] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
Typed Object whose outermost two dimensions have been collapsed into one and where the outermost two <code>ArrayType</code> constructors of the descriptor for the underlying storage format have been combined. 
</p>

</div>
<!-- SECTION [22700-22915] -->
<a name="example"></a><h4>Example</h4>
<div class="level4">
<pre class="code">
T = new ArrayType(new ArrayType(uint8, 2), 2);
pa = new T ([[1,2], [3,4]])                  // &lt;&lt;1,2&gt;,&lt;3,4&gt;&gt;
flatPA = pa.flatten()                           // &lt;1,2,3,4&gt;
flatPA.elementType === ArrayType(uint8,4)
T3D = new ArrayType(T, 3);
pa3D = new T3D ( [[[1,2][3,4]], [[11,12][13,14]], [[11,22][23,24]]] );
		             // &lt;&lt;&lt;1,2&gt;,&lt;3,4&gt;&gt;, &lt;&lt;11,12&gt;,&lt;13,14&gt;&gt;, &lt;&lt;11,22&gt;,&lt;23,24&gt;&gt;&gt;
pa2D = pa3D.flatten(); // &lt;&lt;1,2&gt;,&lt;3,4&gt;,&lt;11,12&gt;,&lt;13,14&gt;,&lt;11,22&gt;,&lt;23,24&gt;&gt;
pa1D = pa2D.flatten(); // &lt;1,2,3,4,11,12,13,14,11,22,23,24&gt;
</pre>

</div>
<!-- SECTION [22916-23458] -->
<a name="partition"></a><h3>partition</h3>
<div class="level3">

</div>
<!-- SECTION [23459-23478] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [23479-23493] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">

<p>
Not available
</p>

</div>
<!-- SECTION [23494-23518] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myTO.partition(size)</pre>

</div>
<!-- SECTION [23519-23571] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">

<p>
<code>size</code> the size of each element of the newly created dimension; the outermost dimension of <code>myArray</code> needs to be divisible by <code>size</code>. 
</p>

</div>
<!-- SECTION [23572-23727] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
A freshly minted block where the outermost dimension has been partitioned into elements of size <code>size</code>. 
</p>

</div>
<!-- SECTION [23728-23847] -->
<a name="example"></a><h4>Example</h4>
<div class="level4">
<pre class="code">
T = new ArrayType(uint8, 4);
pa = new T([1,2,3,4])  // &lt;1,2,3,4&gt;
pa2D = pa.partition(2)                    // &lt;&lt;1,2&gt;,&lt;3,4&gt;&gt;
</pre>

</div>
<!-- SECTION [23848-24001] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
While one could implement both <code>flatten</code> and <code>partition</code> using the other constructs we call them out here to make it easy for the compiler to recognize <code>flatten</code> or <code>partition</code> and make optimizations easier. 
</p>

</div>
<!-- SECTION [24002-24234] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>RangeError</em>, when outermost dimension is not divisible by <code>size</code>.</div>
</li>
</ul>

</div>
<!-- SECTION [24235-24324] -->
<a name="get"></a><h3>get</h3>
<div class="level3">

</div>
<!-- SECTION [24325-24336] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">
<pre class="code">myArray.get(indices);</pre>

</div>
<!-- SECTION [24337-24386] -->
<a name="arguments"></a><h4>Arguments</h4>
<div class="level4">

<p>
<code>indices</code>: an array of number values that represent valid indices into <code>myArray</code>. The first index references the outer most dimension, the second index references the next dimension and so forth.   The same lookup rules as for <code>[]</code> apply.
</p>

</div>
<!-- SECTION [24387-24648] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
The value found at the indices or <code>undefined</code> if no such value exists.
</p>

</div>
<!-- SECTION [24649-24736] -->
<a name="throws"></a><h4>Throws</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <em>TypeError</em> if <code>indices</code> is not an array like object.</div>
</li>
<li class="level1"><div class="li"> <em>RangeError</em> if the length of <code>indices</code> is larger than the number of dimensions in the source array.</div>
</li>
</ul>

</div>
<!-- SECTION [24737-24921] -->
<a name="example"></a><h4>Example</h4>
<div class="level4">
<pre class="code">
pa = [[0,1,2,3,4], [10,11,12,13,14], [20,21,22,23,24]]

pa.get([1,1]);                    // 11 same as pa[1][1].
pa.get([1]);                      // &lt;10,11,12,13,14&gt;, same as pa[1].
</pre>

</div>
<!-- SECTION [24922-25139] -->
<a name="api_additions"></a><h2>API additions</h2>
<div class="level2">

</div>
<!-- SECTION [25140-25166] -->
<a name="type"></a><h3>type</h3>
<div class="level3">

</div>
<!-- SECTION [25167-25182] -->
<a name="synopsis"></a><h4>Synopsis</h4>
<div class="level4">

</div>
<!-- SECTION [25183-25199] -->
<a name="array"></a><h5>Array</h5>
<div class="level5">

<p>
Not available
</p>

</div>
<!-- SECTION [25200-25224] -->
<a name="typed_object"></a><h5>Typed Object</h5>
<div class="level5">
<pre class="code">myTO.type</pre>

</div>
<!-- SECTION [25225-25266] -->
<a name="returns"></a><h4>Returns</h4>
<div class="level4">

<p>
 The type descriptor of used for a Typed Object.
</p>

</div>
<!-- SECTION [25267-25332] -->
<a name="example"></a><h4>Example</h4>
<div class="level4">
<pre class="code">
T = new ArrayType(new ArrayType(uint8, 2), 2);
pa = new T ([[1,2], [3,4]])   // &lt;&lt;1,2&gt;,&lt;3,4&gt;&gt;

pa.type // yields T
pa[1].type // yields ArrayType(uint8, 2)
pa[1][1] // yields uint8
</pre>

</div>
<!-- SECTION [25333-25545] -->
<a name="discussion"></a><h4>Discussion</h4>
<div class="level4">

<p>
Surely we can do this without introducing a new method.  
</p>

</div>
<!-- SECTION [25546-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/4/4dc702eb23e05a01214c23cce72d4718.xhtml used -->
</body>
</html>
