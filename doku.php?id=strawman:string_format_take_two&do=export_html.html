<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:string_format_take_two&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_html.html#ecmascript_string_format_method" class="toc">EcmaScript String Format Method</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_html.html#introduction" class="toc">Introduction</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_html.html#goal" class="toc">Goal</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_html.html#design" class="toc">Design</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_html.html#string.prototype.format" class="toc">String.prototype.format()</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:string_format_take_two&amp;do=export_html.html#references" class="toc">References</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="ecmascript_string_format_method"></a><h1>EcmaScript String Format Method</h1>
<div class="level1">

</div>
<!-- SECTION [1-48] -->
<a name="introduction"></a><h2>Introduction</h2>
<div class="level2">

<p>
 EcmaScript lacks a method to format strings in a flexible and controllable manner. Most EcmaScript strings are constructed by concatenating a series of substrings. Such practice really hurts code readability. Especially for localization, it is almost impossible to translate the string when it is split into multiple pieces. This problem has been identified long before. Brendan Eich proposed something in 2006 for ECMA 3 (<a href="doku.php%3Fid=discussion:string_formatting.html" class="wikilink1" title="discussion:string_formatting" onclick="return svchk()" onkeypress="return svchk()">discussion</a>). Mike Samuel&rsquo;s <a href="doku.php%3Fid=strawman:quasis.html" class="wikilink1" title="strawman:quasis" onclick="return svchk()" onkeypress="return svchk()">quasis</a> and Douglas Crockford&rsquo;s <a href="doku.php%3Fid=strawman:string_format.html" class="wikilink1" title="strawman:string_format" onclick="return svchk()" onkeypress="return svchk()">string_format</a> each proposed a solution as well. This proposal references those proposals, and borrows many ideas introduced by Python (<a href="http://www.python.org/dev/peps/pep-3101/" class="urlextern" target="_blank" title="http://www.python.org/dev/peps/pep-3101/" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://www.python.org/dev/peps/pep-3101/</a>). This proposal also applies lessons learned in Localization (l10n) and Internationalization (i18n) practice, both in Javascript and other languages.
</p>

</div>
<!-- SECTION [49-941] -->
<a name="goal"></a><h2>Goal</h2>
<div class="level2">

<p>
 The goal of this proposal is to provide a convenient and flexible string generation method to the EcmaScript Language, to empower developers to have more control on what is produced, and enforce good i18n and l10n practices.
</p>

<p>
For practical purposes, the proposal will avoid introducing any new language syntax. It can be implemented through a library before it is implemented in browser. 
</p>

</div>
<!-- SECTION [942-1349] -->
<a name="design"></a><h2>Design</h2>
<div class="level2">

<p>
 The main contribution of this proposal is to add a “format” method to the String prototype.  This method will greatly improve the language’s expressiveness, and probably improve its performance in string construction. String.format method will not have any locale dependent behavior.
</p>

</div>
<!-- SECTION [1350-1662] -->
<a name="string.prototype.format"></a><h3>String.prototype.format()</h3>
<div class="level3">

<p>
 <strong>1. The basic idea is to use placeholder to argument a string. &ldquo;{&rdquo; and &ldquo;}&rdquo; are used to mark placeholders; literal &ldquo;{&rdquo; and &ldquo;}&rdquo; will be escaped as &quot;{{&quot; and &quot;}}&quot;.</strong>
</p>

<p>
<strong>2. Placeholder can reference argument by position.</strong> 
</p>
<pre class="code javascript"><span class="kw2">var</span> msg = <span class="st0">"{0}'s father has two sons, {0} and {1}"</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="st0">"tom"</span>, <span class="st0">"jerry"</span><span class="br0">&#41;</span>;
msg == <span class="st0">"tom's father has two sons, tom and jerry."</span></pre>
<p>
<strong>3. Placeholder can reference argument by key. In such case, the argument will be provided as an Object.</strong> 
</p>
<pre class="code javascript"><span class="kw2">var</span> msg = <span class="st0">"The car is made by {brand} in year {make}."</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>brand: <span class="st0">"Nissan"</span>, make: <span class="nu0">2009</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;
msg == <span class="st0">"The car is made by Nissan in year 2009."</span></pre>
<p>
<strong>4. Placeholder can reference a field of an object argument.</strong> 
</p>
<pre class="code javascript"><span class="kw2">var</span> car = <span class="br0">&#123;</span>brand: <span class="st0">"Nissan"</span>, make: <span class="nu0">2012</span><span class="br0">&#125;</span>;
<span class="kw2">var</span> msg1 = <span class="st0">"The car is made by {0.brand} in year {0.make}."</span>.<span class="me1">format</span><span class="br0">&#40;</span>car<span class="br0">&#41;</span>;
<span class="kw2">var</span> msg2 = <span class="st0">"The car is made by {0[brand]} in year {0[make]}."</span>.<span class="me1">format</span><span class="br0">&#40;</span>car<span class="br0">&#41;</span>;
msg1 == <span class="st0">"The car is made by Nissan in year 2012."</span>
msg2 == <span class="st0">"The car is made by Nissan in year 2012."</span></pre>
<p>
Item 3 can be considered as a simple form of this one. This form allow object to be specified in any argument, not just the first one. It also allow multiple objects to be specified.
</p>

<p>
<strong>5. Placeholder can reference an item of an argument that is an array. </strong>As array is really associated map in Javascript, this item can also be treated as a special case of item 4. 
</p>
<pre class="code javascript"><span class="kw2">var</span> msg = <span class="st0">"This year’s top two Japanese brands are {0[0]} and {0[1]}."</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="st0">"Honda"</span>, <span class="st0">"Toyota"</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
msg == <span class="st0">"This year’s top two Japanese brands are Honda or Toyota."</span></pre>
<p>
<strong>6. Each placeholder can specify an optional set of format specifiers, which is used to further define how certain argument should be formatted. The specifiers are separated from argument identification part by an ‘:’.</strong> 
</p>
<pre class="code javascript"><span class="kw2">var</span> msg = <span class="st0">"Number {0} can be presented as decimal {0:d}, octex {0:o}, hex {0:x}"</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="nu0">56</span><span class="br0">&#41;</span>;
msg == <span class="st0">"Number 056 can be presented as decimal 56, octex 70, hex 38"</span></pre>
<p>
<strong>7. The formatting is taken care of by each argument&rsquo;s object type through method &lt;object&gt;.prototype.toFormat.</strong> Format specifiers are passed to &lt;object type&gt;.prototype.toFormat().
</p>

<p>
<strong>8. Object.prototype.toFormat() will return toString() if format specifiers is not given, otherwise it will raise an exception.</strong> In other words, if format specifier(s) presents, it(they) must be taken care of. That will be the default implementation for all object type that does not define toFormat for its own. 
</p>

<p>
 <strong>9. The set of format specifiers supported by ES&rsquo;s implementation of toFormat is mostly compatible with other languages’ common printf implementation, like C++ , Java and Python. Modifications are made to make it fit with EcmaScript language.</strong>
</p>

<p>
 <strong>10. The format specifiers supported by Number.prototype.toNumber is described as below.</strong>
</p>

<p>
The syntax of format specifiers is <em>&ldquo;[flags][width][.precision]type&rdquo;</em>.
</p>
<ul>
<li class="level1"><div class="li"> <strong>Flags</strong> can be zero or more (in any order) of:</div>
</li>
</ul>
<table class="inline">
	<tr>
		<td class="centeralign">  +  </td><td> Causes the sign &lsquo;+&rsquo; or &lsquo;-&rsquo; of a number to be always used (the default is to omit the sign for positive numbers). Only applicable to numeric types. </td>
	</tr>
	<tr>
		<td class="centeralign">  -  </td><td> Causes the output of this placeholder to be left-aligned (the default is to right-align the output). </td>
	</tr>
	<tr>
		<td class="centeralign">  #  </td><td> Alternate form. For &lsquo;g&rsquo; and &lsquo;G&rsquo;, trailing zeros are not removed. For &lsquo;f&rsquo;, &lsquo;F&rsquo;, &lsquo;e&rsquo;, &lsquo;E&rsquo;, &lsquo;g&rsquo;, &lsquo;G&rsquo;, the output always contains a decimal point. For &lsquo;o&rsquo;, &lsquo;x&rsquo;, and &lsquo;X&rsquo;, a 0, 0x, and 0X, respectively, is prepended to non-zero numbers. </td>
	</tr>
	<tr>
		<td class="centeralign">  0  </td><td> Causes 0 to be used instead of spaces to left-fill a fixed-length field. For example, &ldquo;%2d&rdquo;.format(3) results in &quot; 3&rdquo;, while &ldquo;%02d&rdquo;.format(3) results in &ldquo;03&rdquo;. </td>
	</tr>
</table>
<br />
<ul>
<li class="level1"><div class="li"> <strong>Width</strong> can be omitted or be a number. Output of this placeholder will be padded with spaces until it is at least number of characters wide. </div>
</li>
<li class="level1"><div class="li"> <strong>Precision</strong> can be omitted or a number. For non-integral numeric types, causes the decimal portion of the output to be expressed in at least number digits. For the string type, causes the output to be truncated at number characters. If the precision is zero, nothing is printed for the corresponding argument.</div>
</li>
<li class="level1"><div class="li"> <strong>Type</strong> can be any of:</div>
</li>
</ul>
<table class="inline">
	<tr>
		<td class="centeralign">  d  </td><td>Print a number as a signed decimal number. The number is converted to integer by apply math.round(n - 0.5) to it.</td>
	</tr>
	<tr>
		<td class="centeralign">  f,F  </td><td> Print a number as float in normal (fixed-point) notation. &lsquo;f&rsquo; and &lsquo;F&rsquo; only differs in how the strings for an infinite number or NaN are printed (&rsquo;inf&rsquo;, &lsquo;infinity&rsquo; and &lsquo;nan&rsquo; for &lsquo;f&rsquo;, &lsquo;INF&rsquo;, &lsquo;INFINITY&rsquo; and &lsquo;NAN&rsquo; for &lsquo;F&rsquo;).</td>
	</tr>
	<tr>
		<td class="centeralign">  e,E  </td><td>	Print a number in standard form ([-]d.ddd e[+/-]ddd). An E conversion uses the letter E (rather than e) to introduce the exponent. The exponent always 			contains at least two digits; if the value is zero, the exponent is 00.</td>
	</tr>
	<tr>
		<td class="centeralign">  g,G  </td><td>	Print a number in either normal or exponential notation, whichever is more appropriate for its magnitude. &lsquo;g&rsquo; uses lower-case letters, &lsquo;G&rsquo; uses upper-case 			letters. This type differs slightly from fixed-point notation in that insignificant zeroes to the right of the decimal point are not included. Also, the decimal point is not included on whole numbers.</td>
	</tr>
	<tr>
		<td class="centeralign">  x,X  </td><td> Print a number in hexadecimal form. &lsquo;x&rsquo; uses lower-case letters and &lsquo;X&rsquo; uses upper-case. The number is converted to integer by apply math.round(n - 0.5) to it. </td>
	</tr>
	<tr>
		<td class="centeralign">  o  </td><td> Print a number in octal form.  The number is converted to integer by apply math.round(n) to it.</td>
	</tr>
	<tr>
		<td class="centeralign">  b  </td><td> Print a number in binary form.  The number is converted to integer by apply math.round(n) to it.</td>
	</tr>
	<tr>
		<td class="centeralign">  s  </td><td> Print a string. If the given argument is not string, it will be converted to string through toString() automatically.</td>
	</tr>
</table>
<br />

<p>
<strong>11. Format specifiers can also be provided through an embedded placeholder inside the placeholder. </strong>Example like, 
</p>
<pre class="code javascript"><span class="kw2">var</span> msg = <span class="st0">"Number formatter: {0} formatted string: {1:{0}}"</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="st0">"02d"</span>, <span class="nu0">56</span><span class="br0">&#41;</span>;
msg == <span class="st0">"Number formatter: 02d formatted string: 56"</span></pre>
<p>
 Placeholder used in format specifier part can not have format specifier. This prevent the replacement from embedding more than one level.
</p>

<p>
<strong>12. String.prototype.format method will not have any locale specific behavior by itself.</strong> Locale specific behavior will be provided through LocaleInfo in future once it lands in ECMAScript. We intentionally avoid using anything related with the default locale as provided by now-a-day&rsquo;s browser, due to its unexpected and inconsistent behavior. This proposal should lay a good foundation for future locale specific behavior implementation, most likely happen in another namespace.
</p>

</div>
<!-- SECTION [1663-8225] -->
<a name="references"></a><h2>References</h2>
<div class="level2">

<p>
 Brendan Eich, <a href="doku.php%3Fid=discussion:string_formatting.html" class="wikilink1" title="discussion:string_formatting" onclick="return svchk()" onkeypress="return svchk()">string formatting discussion</a>
</p>

<p>
Mike Samuel, <a href="doku.php%3Fid=strawman:quasis.html" class="wikilink1" title="strawman:quasis" onclick="return svchk()" onkeypress="return svchk()">quasis</a>
</p>

<p>
Douglas Crockford, <a href="doku.php%3Fid=strawman:string_format.html" class="wikilink1" title="strawman:string_format" onclick="return svchk()" onkeypress="return svchk()">String format</a>
</p>

<p>
Python string format design (<a href="http://www.python.org/dev/peps/pep-3101/" class="urlextern" target="_blank" title="http://www.python.org/dev/peps/pep-3101/" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://www.python.org/dev/peps/pep-3101/</a>) 
</p>

</div>
<!-- SECTION [8226-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/9/9abdf183ace04ec5e8a91d750150a11f.xhtml used -->
</body>
</html>
