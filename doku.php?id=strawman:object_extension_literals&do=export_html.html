<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:object_extension_literals&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html#object_extension_literals" class="toc">Object Extension Literals</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html#adding_properties_to_an_existing_object" class="toc">Adding Properties to an Existing Object</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html#modify_property_values_on_an_existing_object" class="toc">Modify Property Values on an Existing Object</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html#nested_object_extensions" class="toc">Nested Object Extensions</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html#grammar_extensions" class="toc">Grammar Extensions</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html#semantic_details" class="toc">Semantic Details</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:object_extension_literals&amp;do=export_html.html#history" class="toc">History</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="object_extension_literals"></a><h1>Object Extension Literals</h1>
<div class="level1">

<p>
 An Object Extension Literal uses <em>ObjectLiteral</em>-like syntax to define or modify a set of properties of a preexisting object.  The <em>ObjectLiteral</em>-like syntax is treated as an Object Extension Literal when it appears immediately to the right of the <strong><code>.</code></strong> in a <em>MemberExpression</em> or a <em>CallExpression</em>. While an Object Extension Literal is syntactically similar to an <em>ObjectLiteral</em> its semantics are somewhat different and there are some differences between the syntactic features that are available.  
</p>

</div>
<!-- SECTION [1-562] -->
<a name="adding_properties_to_an_existing_object"></a><h2>Adding Properties to an Existing Object</h2>
<div class="level2">

<p>
 When an <em>PropertyDefintion</em> occurs in a Object Extension Literal its semantics are largely the same as in an <em>ObjectLiteral</em> except that the property is defined on the already existing object rather than on a newly created object.
</p>

<p>
For example:
</p>
<pre class="code javascript">obj.<span class="br0">&#123;</span>
   a: <span class="nu0">1</span>,
   b: <span class="nu0">2</span>,
   c: <span class="nu0">3</span>
<span class="br0">&#125;</span>;</pre>
<p>
This is, for the most part, semantically equivalent to: 
</p>
<pre class="code javascript">Object.<span class="me1">defineProperties</span><span class="br0">&#40;</span>obj, <span class="br0">&#123;</span>
   a: <span class="br0">&#123;</span>value: <span class="nu0">1</span>, enumerable: <span class="kw2">true</span>, writable: <span class="kw2">true</span>, configurable: <span class="kw2">true</span><span class="br0">&#125;</span>,
   b: <span class="br0">&#123;</span>value: <span class="nu0">2</span>, enumerable: <span class="kw2">true</span>, writable: <span class="kw2">true</span>, configurable: <span class="kw2">true</span><span class="br0">&#125;</span>,
   c: <span class="br0">&#123;</span>value: <span class="nu0">3</span>, enumerable: <span class="kw2">true</span>, writable: <span class="kw2">true</span>, configurable: <span class="kw2">true</span><span class="br0">&#125;</span>
<span class="br0">&#125;</span>;</pre>
<p>
All object literal property forms are valid in an Object Extension Literal including get/set properties, concise methods, and <a href="doku.php%3Fid=harmony:object_initialiser_shorthand.html" class="wikilink1" title="harmony:object_initialiser_shorthand" onclick="return svchk()" onkeypress="return svchk()">Implicit property values</a>. 
</p>
<pre class="code javascript">&nbsp;
<span class="co1">//initializing instance state from constructor parameters</span>
<span class="kw2">function</span> Point<span class="br0">&#40;</span>x,y<span class="br0">&#41;</span> <span class="br0">&#123;</span>
   <span class="kw1">this</span>.<span class="br0">&#123;</span>x,y<span class="br0">&#125;</span>;
<span class="br0">&#125;</span>;
&nbsp;
<span class="co1">//defining methods on a prototype object</span>
Point.<span class="me1">prototype</span>.<span class="br0">&#123;</span>
   plus<span class="br0">&#40;</span>aPoint<span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="kw1">return</span> <span class="kw2">new</span> Point<span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">x</span>+aPoint.<span class="me1">x</span>,<span class="kw1">this</span>.<span class="me1">y</span>+aPoint.<span class="me1">y</span><span class="br0">&#125;</span>,
   get rho<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="kw1">return</span> Math.<span class="me1">sqrt</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">x</span>*<span class="kw1">this</span>.<span class="me1">x</span>+<span class="kw1">this</span>.<span class="me1">y</span>*<span class="kw1">this</span>.<span class="me1">y</span><span class="br0">&#125;</span>
<span class="br0">&#125;</span>;</pre>
</div>
<!-- SECTION [563-1775] -->
<a name="modify_property_values_on_an_existing_object"></a><h2>Modify Property Values on an Existing Object</h2>
<div class="level2">

<p>
 One capability of Object Extension Literals that <em>ObjectLiterals</em> lack is the ability to assign property values (semantically a [[Put]] operation) rather than defining/redefining a own property (semantically a [[DefineOwnProerty]] operation). This can be signified in an Object Extension Literal by using a <strong>=</strong> in place of the <strong>:</strong> in a Property Definition.  For example:
</p>
<pre class="code javascript">obj.<span class="br0">&#123;</span>
   a = <span class="nu0">1</span>,
   b = <span class="nu0">2</span>,
   c = <span class="nu0">3</span>
<span class="br0">&#125;</span>;</pre>
<p>
 The above example is semantically equivalent to: 
</p>
<pre class="code javascript"><span class="br0">&#123;</span>
 let temp = obj;
 temp.<span class="me1">a</span> = <span class="nu0">1</span>;
 temp.<span class="me1">b</span> = <span class="nu0">2</span>;
 temp.<span class="me1">c</span> = <span class="nu0">3</span>;
<span class="br0">&#125;</span>;</pre>
<p>
Such assignment properties enables the use of Object Extension Literals as a concise way to assign multiple values to objects that extensively use accessor properties (eg, <acronym title="Document Object Model">DOM</acronym> objects) or to &ldquo;sealed&rdquo; objects that permit property assignment but not property creation.
</p>
<pre class="code javascript">someDomElement.<span class="me1">style</span>.<span class="br0">&#123;</span>
   color = <span class="st0">'red'</span>,
   backgroundColor = <span class="st0">'pink'</span>
<span class="br0">&#125;</span>;</pre>
</div>
<!-- SECTION [1776-2789] -->
<a name="nested_object_extensions"></a><h2>Nested Object Extensions</h2>
<div class="level2">

<p>
 Another form of Property Definition that only occurs in Object Extension Literals is a nested Object Extension.  A nested Object Extension is a PropertyName immediately followed by an Object Extension Literal. For example:
</p>
<pre class="code javascript">someDomElement.<span class="br0">&#123;</span>
  textContent = <span class="st0">'Hello world'</span>,
  style.<span class="br0">&#123;</span>
    color = <span class="st0">'red'</span>,
    backgroundColor = <span class="st0">'pink'</span>
  <span class="br0">&#125;</span>,
  onclick = <span class="kw3">alert</span>
<span class="br0">&#125;</span>;</pre>
</div>
<!-- SECTION [2790-3210] -->
<a name="grammar_extensions"></a><h2>Grammar Extensions</h2>
<div class="level2">
<pre class="code ebnf">CallExpression :
    CallExpression ObjectExtension
    ...

MemberExpression :
    MemberExpression ObjectExtension
    ...

ObjectExtension :
    . { }
    . { PropertyExtensionList }
    . { PropertyExtensionList , }

PropertyExtensionList :
    PropertyExtension
    PropertyExtensionList , PropertyExtension

PropertyExtension :
    PropertyDefinition
    PropertyAssignment
    PropertyName ObjectExtension

PropertyAssignment :
    PropertyName = AssignmentExpression

</pre>
</div>
<!-- SECTION [3211-3740] -->
<a name="semantic_details"></a><h2>Semantic Details</h2>
<div class="level2">

<p>
 The value of an <em>MemberExpression</em> or <em>CallExpression</em> with an <em>ObjectExtension</em> element is the value of the nested <em>MemberExpression</em> or <em>CallExpression</em> that is to the left of the <em>ObjectExtension</em>. This is the object that is being extended. The ToObject abstract operation is applied to the nested <em>MemberExpression</em> or <em>CallExpression</em> before applying the <em>ObjectExtension</em> to it.  This will throw a TypeError if the expression evaluated to <strong>null</strong> or <strong>undefined</strong>.  For a nested <em>ObjectExtension</em> the object that is the value of the <em>PropertyName</em> property of the object being extended is itself extended.  If the named property does not exist or if its ECMAScript Type is not Object a TypeError is thrown.
</p>

<p>
[[DefineOwnProperty]] is used to install a <em>PropertyExtension</em> that is a <em>PropertyDefinition</em>.  [[Put]] is used for a <em>PropertyExtension</em> that is a <em>PropertyAssignment</em>. If the object being extended already has an property with the same name as a property defined in a <em>PropertyDefinition</em> or <em>PropertyAssignment</em>, the existing property is replaced or modified according to the rules of [[DefineOwnProperty]] or [[Put]]. The static semantic rules for duplicate <em>PropertyName</em> values within an <em>ObjectExtension</em> are the same as are used within an <em>ObjectLiteral</em> (appropiate extended to include <em>PropertyAssignment</em> and nested <em>ObjectExtension</em> productions).  However those rules only apply to the actual syntactic elements of the <em>ObjectExtension</em>.  The dynamic semantics for already existing properties of the object are those of [[DefineOwnProperty]] and [[Put]].
</p>

<p>
Note for a <em>ObjectExtension</em> the apparent object literal on the right of the <strong><code>.</code></strong> is not actually instantiated as a distinct object.  Instead each <em>PropertyExtension</em> in the object literal is directly created on (or assigned to in the case of <strong>=</strong>)  the object being extented.  This is important if the property  is a method or accessor function containing <strong><code>super</code></strong> references because it means that the <strong><code>super</code></strong> binding is made to the [[Prototype]] of the LHS object rather than to <code>Object.prototype</code> which is the [[Prototype]] of normally instantiated object literals.  It also means that any private named properties can be directly created on the LHS object without  requiring private named properties to be exposed to reflection operations that would otherwise be need to copy them from the extension object to the existing object.
</p>

</div>
<!-- SECTION [3741-6289] -->
<a name="history"></a><h2>History</h2>
<div class="level2">

<p>
This proposal combines elements of Allen Wirfs-Brock&rsquo;s earlier object extension literal proposals <a href="doku.php%3Fid=harmony:object_literals.html#object_extension_literal" class="wikilink1" title="harmony:object_literals" onclick="return svchk()" onkeypress="return svchk()">object extension literal</a> proposal and Dave Herman&rsquo;s <a href="doku.php%3Fid=strawman:batch_assignment_operator.html" class="wikilink1" title="strawman:batch_assignment_operator" onclick="return svchk()" onkeypress="return svchk()">batch assignment operator</a> proposal.  Douglas Crockford first suggested using the <strong>.{ }</strong> syntax for literal object extensions.  Some people have informally used the terms &ldquo;mustache&rdquo; or &ldquo;monocle&rdquo; operator to refer to this syntax.
</p>

</div>
<!-- SECTION [6290-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/2/24d9690aeabf33135d9085a63eb0cb4d.xhtml used -->
</body>
</html>
