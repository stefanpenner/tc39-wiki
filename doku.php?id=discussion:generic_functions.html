<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>discussion:generic_functions [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=discussion:generic_functions&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=discussion" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=discussion:generic_functions&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=discussion:generic_functions&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2007-08-18T10:02:51+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=discussion:generic_functions&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">discussion:generic_functions</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="discussion:generic_functions" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="discussion:generic_functions" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=discussion:destructuring_assignment.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="discussion:destructuring_assignment">destructuring_assignment</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=discussion:dictionary.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="discussion:dictionary">dictionary</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=discussion:enumerability.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="discussion:enumerability">enumerability</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=discussion:extend_regexps.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="discussion:extend_regexps">extend_regexps</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=discussion:generic_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="discussion:generic_functions">generic_functions</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:generic_functions.html#rationale_etc_for_aspects_of_the_proposals" class="toc">Rationale etc for aspects of the proposals</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:generic_functions.html#arguments_in_favor_of_generic_functions" class="toc">Arguments in favor of generic functions</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:generic_functions.html#arguments_against_generic_functions" class="toc">Arguments against generic functions</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:generic_functions.html#no_parameterized_generic_function_types" class="toc">No parameterized generic function types</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:generic_functions.html#null" class="toc">Null</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:generic_functions.html#conversions" class="toc">Conversions</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<p>
This is the discussion page for <a href="doku.php%3Fid=proposals:generic_functions.html" class="wikilink1" title="proposals:generic_functions" onclick="return svchk()" onkeypress="return svchk()">the generic functions proposal</a>.
</p>

<a name="rationale_etc_for_aspects_of_the_proposals"></a><h1>Rationale etc for aspects of the proposals</h1>
<div class="level1">

</div>

<a name="arguments_in_favor_of_generic_functions"></a><h2>Arguments in favor of generic functions</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> powerful operator overloading</div>
</li>
<li class="level1"><div class="li"> powerful ad-hoc overloading &ndash; more powerful than C++ style, since a generic function is an object that can be passed around like any other function</div>
</li>
<li class="level1"><div class="li"> automates common dispatch idioms in a general way (see [Clifton 2006] for more)</div>
</li>
<li class="level1"><div class="li"> continues a tradition of offering multiple choices</div>
</li>
<li class="level1"><div class="li"> fills the type dispatch gap in ES4</div>
</li>
<li class="level1"><div class="li"> very well studied technology; most general issues are known</div>
</li>
<li class="level1"><div class="li"> way cool</div>
</li>
</ul>

</div>

<a name="arguments_against_generic_functions"></a><h2>Arguments against generic functions</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> we don&rsquo;t (yet) have a MOP, so the utility is reduced relative to other languages, but there&rsquo;s always ES5...</div>
</li>
<li class="level1"><div class="li"> a lot of things are now done with regular methods and functions; adding generic functions is a little redundant</div>
</li>
<li class="level1"><div class="li"> very late in the ES4 game &ndash; don&rsquo;t know how well they&rsquo;ll fit</div>
</li>
<li class="level1"><div class="li"> performance and complexity issues</div>
</li>
<li class="level1"><div class="li"> hard to do &ldquo;just a little&rdquo;?</div>
</li>
<li class="level1"><div class="li"> &ldquo;generic&rdquo; is an overloaded term now, and &ldquo;multimethods&rdquo; is sort of obscure and relates in a sense to objects, which our generic functions are not (yet) about</div>
</li>
</ul>

</div>

<a name="no_parameterized_generic_function_types"></a><h2>No parameterized generic function types</h2>
<div class="level2">

<p>
 The problem here is to figure out what it would mean to add a new method to a generic function that has live instantiations.  Does this update all the instantiations (and if so, what does it mean if the new method makes some subset of the instantiations obviously incorrect, eg by redefining a method) or just the parameterized generic function?
</p>

</div>

<a name="null"></a><h2>Null</h2>
<div class="level2">

<p>
 The problem with <code>null</code> is that it is a member of any nullable class type.  Naively speaking, if <code>C</code> and <code>D</code> are nullable classes, the following code is illegal:
</p>
<pre class="code">
  generic function f(x);

  generic function f(x:C) { ... }
  generic function f(x:D) { ... }
</pre>

<p>
The reason is that the first method defines cases for <code>C!</code> and <code>null</code>, and the second case for <code>D!</code> and <code>null</code>, thus redefining the behavior for <code>null</code>, which is illegal.
</p>

<p>
I see the following possibilities.
</p>

<p>
(1) This solution strips <code>null</code> from any union type or nullable class type, so these are the same:
</p>
<pre class="code">
  generic function f(x: C) { ... }
  generic function f(x: C!) { ... }
</pre>

<p>
It then requires any specialization on <code>null</code> to use that specializer by itself.  This is harsh; it requires duplication of code, and that is not nice:
</p>
<pre class="code">
  generic function f(x: C) { ... }
  generic function f(x: null) { ... }
</pre>

<p>
But we can milden the harshness by requiring <code>null</code> to be mentioned explicitly in a union:
</p>
<pre class="code">
  generic function f(x: (C,null)) { ... }
</pre>

<p>
The distinction is syntactic: the specializer must be an explicit union with null in the parameter list, it can&rsquo;t be hidden in a type definition, say.
</p>

<p>
(2) We can milden the previous proposal even further by allowing the specializer to be the name of a defined type that is a union with null:
</p>
<pre class="code">
  type t = (C, null)
  generic function f(x: t) { ... }
</pre>

<p>
In other words, the type of a nullable class may well be the same as a union of its nonnullable equivalent with null in ES4, but unions defined with type definitions are different from nullable class definitions.
</p>

<p>
I don&rsquo;t care for this; it&rsquo;s too subtle.
</p>

<p>
(3) If the ES4 type system equates <code>C?</code> completely with <code>(C,null)</code> then the most reasonable avenue is to require the programmer explicitly to strip <code>null</code> when defining generic methods, eg the programmer must write
</p>
<pre class="code">
  generic function f(x:C!) { ... }
  generic function f(x:D!) { ... }
</pre>

<p>
It would be error-prone for the generic function system to strip <code>null</code> from union types, not knowing how those union types originated.
</p>

<p>
On the other hand, writing just plain <code>C</code> defines a method for <code>null</code> as well.
</p>

<p>
(4) If the ES4 type system does not equate <code>C?</code> with <code>(C,null)</code> then it is most reasonable for the generic function system to interpret any nullable class by itself or in a union type as <code>C!</code>.  This is like solutions (1) and (2) above, but assumes an even clearer distinction between a nullable class and a union with null.
</p>

<p>
(5) MultiJava interprets a null value as being of the same type as the static constraint on the generic function in the parameter position, ie, if the generic function is defined as
</p>
<pre class="code">
  generic function f(x: Object);
</pre>

<p>
then a null value passed as the first parameter will be assumed to be of type <code>Object</code> during method resolution.  This is not an excellent fit with ECMAScript since we have union types, for one thing. 
</p>
<hr noshade="noshade" size="1" />

<p>
I vote for (3) above, the explicit <code>C!</code> requirement. We allow <code>class Complex! {...}</code> so this is not onerous, and indeed usually desirable for classes with operator multimethods. Dave just confirmed that we do (still) equate <code>C?</code> and <code>(C!, null)</code>, and while order matters when converting to union type, <code>null</code> is not a conversion target so it can occur anywhere &ndash; a compiler is free to move <code>null</code> to the end of a union type, collapse all <code>null</code> type occurrences in a union, etc.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/08/17 23:13</em>
</p>

<p>
Noted.
</p>

<p>
This is conjecture of course, but <acronym title="In my opinion">IMO</acronym>: (a) people are not going to define non-nullable classes to any great extent and so (b) they will be required to write <code>C!</code> all over the place, which is actually onerous.
</p>

<p>
Do we still need ordered unions?  I sure hope not &ndash; they&rsquo;re a major wart.  I thought we only needed them for the implicit conversion, but we got rid of that.  (Maybe they are still required for wrappers?  Ouch.)
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x61%3B%26%23x63%3B%26%23x6d%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x61;&#x63;&#x6d;&#x2e;&#x6f;&#x72;&#x67;">Lars T Hansen</a> 2007/08/18 09:58</em>
</p>

</div>

<a name="conversions"></a><h2>Conversions</h2>
<div class="level2">

<p>
 Suppose a call to a generic function finds that there are no applicable methods at all.  Then it might be interesting to look for one or more methods that would be applicable if some of the argument values were converted to primitive values.  Here is one proposal for an algorithm that does that.
</p>

<p>
Assume we have some set of candidate methods:
</p>
<pre class="code">
  m1(T, ...)
  m2(S, ...)
  m3(R, ...)
</pre>

<p>
and a signature for the call (a tuple of manifest types) that is <code>(t, ...)</code>.  
</p>

<p>
Since there are no applicable methods there will be some set of values i s.t. t(i) is not a subtype of R(i), and ditto for the S and the T.  If all of those R(i) are a primitive type to which arbitrary types can be converted (numbers, strings, boolean) then the method m3 continues to be a candidate; otherwise not.  Ditto for the S and T.
</p>

<p>
Now sort the remaining candidate types, assuming type <code>*</code> where conversions are necessary for each individual method.  This yields an unambiguous most specific method or not.  In the latter case, fail.  In the former case, convert the values  to primitives for the most specific method, then select from among the current candidate set all applicable methods, sort them to get a set of totally ordered methods, and then apply them in order.  (Some optimizations may be possible, this is just a sketch.)
</p>

</div>

<!-- no cachefile used, but created -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        discussion/generic_functions.txt &middot; Last modified: 2007/08/18 10:02 by lars      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="discussion:generic_functions" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="discussion:generic_functions" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="discussion:generic_functions" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="discussion:generic_functions" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=discussion:generic_functions.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=discussion%253Ageneric_functions&amp;1454275583" width="1" height="1" alt=""  /></body>
</html>
