<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=discussion:is_as_to&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=discussion" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=discussion:is_as_to&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#concerns_about_this_proposal" class="toc">Concerns about this proposal</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#syntax_discussion" class="toc">Syntax discussion</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#existing_situation" class="toc">Existing situation</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#older_discussion" class="toc">Older discussion</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#interaction_with_null_type_and_unsafe_downcasts" class="toc">Interaction with Null type and unsafe downcasts</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#a_more_popular_proposal" class="toc">A more popular proposal</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#notation_for_type_nullability" class="toc">Notation for type nullability</a></span></li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#casts" class="toc">Casts</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#proposed_amendments_retired_from_main_page_20070313" class="toc">Proposed amendments (retired from main page 2007/03/13)</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#function_coercion" class="toc">Function coercion</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#more_retired_proposal_text" class="toc">More retired proposal text</a></span></li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#primary_to" class="toc">Primary 'to'</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=discussion:is_as_to&amp;do=export_html.html#binary_cast" class="toc">Binary 'cast'</a></span></li>
</ul>
</div>
</div>

<p>
This is the discussion page for <a href="doku.php%3Fid=proposals:is_as_to.html" class="wikilink1" title="proposals:is_as_to" onclick="return svchk()" onkeypress="return svchk()">is_as_to</a>.
</p>

<a name="concerns_about_this_proposal"></a><h1>Concerns about this proposal</h1>
<div class="level1">

<p>
 I am a little uncertain on whether this proposal is &ldquo;ready&rdquo;. 
</p>
<ul>
<li class="level1"><div class="li"> Some of the issues addressed tie in with the <a href="doku.php%3Fid=clarification:type_system.html" class="wikilink1" title="clarification:type_system" onclick="return svchk()" onkeypress="return svchk()">type system</a>, <a href="doku.php%3Fid=proposals:strict_and_standard_modes.html" class="wikilink1" title="proposals:strict_and_standard_modes" onclick="return svchk()" onkeypress="return svchk()">strict and standard modes</a>, and strict-vs-standard, but the type system is not well defined yet, the static-vs-dynamic proposal has no meat on the bones, and the draft spec is incomplete on strict-vs-dynamic (I think our discussions have progressed beyond what is written up)</div>
</li>
<li class="level1"><div class="li"> I find it disconcerting that annotations are simply dropped in the standard language, ie, the implication is that there is no typechecking in the standard language and that <code>var x : T = y</code> is not the same as <code>var x : T; x = y</code>.  This is in apparent conflict with section 3.5.2 of the January 26 draft.</div>
</li>
</ul>

<p>
 I suspect this proposal should be put on hold until there is more good information available on the distinction between the strict and standard languages. 
</p>
<hr noshade="noshade" size="1" />

<p>
What did you mean by &ldquo;<code>var x : T = y</code> is not the same as <code>var x : T; x = y</code>&ldquo;? My understanding is that they are the same.
</p>

<p>
Also, if this proposal defines the meaning of the <code>is</code>, <code>as</code>, <code>to</code>, and <code>cast</code> operators, then it has done its job. We can leave the definition of <code>:</code> to <a href="doku.php%3Fid=clarification:type_system.html" class="wikilink1" title="clarification:type_system" onclick="return svchk()" onkeypress="return svchk()">type system</a>.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6a%3B%26%23x6f%3B%26%23x64%3B%26%23x79%3B%26%23x65%3B%26%23x72%3B%26%23x40%3B%26%23x61%3B%26%23x64%3B%26%23x6f%3B%26%23x62%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6a;&#x6f;&#x64;&#x79;&#x65;&#x72;&#x40;&#x61;&#x64;&#x6f;&#x62;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Jeff Dyer</a> 2006/05/19 09:07</em>
</p>

<p>
I am quoting the proposal: &ldquo;Annotation var v : T = x which means var v = x to T.&rdquo;.  Note how the annotation on v is lost, thus implying in effect &ldquo;var v : * = x to T&rdquo;.  At least that&rsquo;s how I read it.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/05/19 10:31</em>
</p>

</div>
<!-- SECTION [59-1649] -->
<a name="syntax_discussion"></a><h1>Syntax discussion</h1>
<div class="level1">

<p>
 [<em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/05/20 07:00</em>  &mdash; Moved from the proposal page because it is really a discussion and because I generally agree with Jeff&rsquo;s point; the current proposal stands.] 
</p>
<ul>
<li class="level1"><div class="li"> syntax proposal 1: <code>cast.&lt;T&gt;(x)</code> is unambiguous, mirrors the type parameterization syntax, and mirrors C++</div>
<ul>
<li class="level3"><div class="li"> the idea with <code>cast T(x)</code> is that it reforms <code>T(x)</code>, the E3 poor man&rsquo;s cast/conversion. I still like <code>cast T(x)</code> better because it has two (maybe three) fewer characters and doesn&rsquo;t look like a parameterised type, which it isn&rsquo;t.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> syntax proposal 2: <code>x as T</code> is even better, <acronym title="In my opinion">IMO</acronym></div>
<ul>
<li class="level3"><div class="li"> this has two problems: it means something different in AS3; and it doesn&rsquo;t allow <code>T</code> to be a full <em>TypeExpression</em> because of syntactic ambiguity with other kinds of expressions that might occur there.</div>
<ul>
<li class="level4"><div class="li"> AS3 issue noted.  But the syntactic ambiguity does not exist with the <a href="doku.php%3Fid=proposals:syntax_for_type_expressions.html" class="wikilink1" title="proposals:syntax_for_type_expressions" onclick="return svchk()" onkeypress="return svchk()">syntax for type expressions</a> clarification, does it?  What is the nature of the ambiguity?</div>
<ul>
<li class="level5"><div class="li"> the rhs of <code>as</code> is an expression that can be a <em>PrimaryExpression</em> which can be a <em>ParenExpression</em>, <em>ObjectLiteral</em>, etc. I suppose we should fix that so that the rhs of <code>as</code>, <code>to</code> and <code>is</code> must be a <em>TypeExpression</em>. That certainly makes more sense that what is currently allowed.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr noshade="noshade" size="1" />

<p>
 I have a personal preference for <code>cast.&lt;T&gt;(x)</code>, which is simply that <code>as</code> is a less-common word in the literature and history. The word <code>cast</code> has a longer and more widely-known history in programming languages. New users are less likely to wonder what it means.  
</p>

<p>
&mdash; <em><a href="mailto:%26%23x67%3B%26%23x72%3B%26%23x61%3B%26%23x79%3B%26%23x64%3B%26%23x6f%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x67;&#x72;&#x61;&#x79;&#x64;&#x6f;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">graydon</a> 2006/05/20 23:35</em>
</p>

</div>
<!-- SECTION [1650-3342] -->
<a name="existing_situation"></a><h1>Existing situation</h1>
<div class="level1">

<p>
 At the Jan 19 meeting there was some consensus that the proposed spec contains too many type annotations and too many type operators. Currently the spec contains: 
</p>
<ul>
<li class="level1"><div class="li"> operator <code>to</code> which calls a user-provided conversion operator (or one of several builtins).  </div>
</li>
<li class="level1"><div class="li"> operator <code>as</code> which downcasts or returns null if the downcast fails</div>
</li>
<li class="level1"><div class="li"> operator <code>is</code> which is a boolean predicate</div>
</li>
<li class="level1"><div class="li"> annotation <code>var v to T = x</code> which means <code>var v = x to T</code></div>
</li>
<li class="level1"><div class="li"> annotation <code>var v as T = x</code> which means <code>var v = x as T</code></div>
</li>
<li class="level1"><div class="li"> annotation <code>var v is T = x</code> which means <code>var v; if( x is T ) v = x; else throw new TypeError</code></div>
</li>
<li class="level1"><div class="li"> annotation <code>var v : T</code> which means <code>var v to T</code></div>
</li>
</ul>

</div>
<!-- SECTION [3343-4054] -->
<a name="older_discussion"></a><h1>Older discussion</h1>
<div class="level1">

</div>
<!-- SECTION [4055-4086] -->
<a name="interaction_with_null_type_and_unsafe_downcasts"></a><h2>Interaction with Null type and unsafe downcasts</h2>
<div class="level2">

<p>
 Some users might wish to &ldquo;look inside&rdquo; unsafe downcasts to ensure that they are being safe: checking for <code>null</code> before casting to non-<code>null</code>, or in general checking that a value <code>v</code> of type <code>T</code> is also of a subtype <code>U</code> before casting to <code>U</code>.
</p>

<p>
One possible technique follows: 
</p>
<ul>
<li class="level1"><div class="li"> Make the type-cast exception statically checked (like a checked exception in java) in strict mode.</div>
</li>
<li class="level1"><div class="li"> For any casts <code>cast T(x:U)</code> where <code>U &lt;: T</code> (a widening cast), eliminate the possibility of an exception being thrown.</div>
</li>
</ul>

<p>
 Under this technique, only those casts guaranteed to succeed would pass the typechecker unadorned. Those cases guaranteed to fail would be hard errors, and those of unknown success (downcasts) would require that they be enclosed in an exception-catching block which handled the case of a failed downcast.
</p>

</div>
<!-- SECTION [4087-4971] -->
<a name="a_more_popular_proposal"></a><h2>A more popular proposal</h2>
<div class="level2">

<p>
 ... has been moved to <a href="doku.php%3Fid=discussion:switch_class.html" class="wikilink1" title="discussion:switch_class" onclick="return svchk()" onkeypress="return svchk()">switch class</a>.
</p>

</div>
<!-- SECTION [4972-5049] -->
<a name="notation_for_type_nullability"></a><h2>Notation for type nullability</h2>
<div class="level2">

<p>
 ... has been moved to <a href="doku.php%3Fid=discussion:nullability.html" class="wikilink1" title="discussion:nullability" onclick="return svchk()" onkeypress="return svchk()">nullability</a>.
</p>

</div>
<!-- SECTION [5050-5132] -->
<a name="casts"></a><h1>Casts</h1>
<div class="level1">

<p>
 Are both <code>cast</code> and <code>to</code> necessary?
</p>

<p>
The <code>is</code> operator essentially gives us the ability to check the type of a value (using the subtyping algorithm) &ndash; and this is important. The other operation we need is casting. The <code>to</code> method gives programmers the ability to write their own custom casts (similarly to C++ cast overloading), which is a nice feature. But for actually performing casts, is there any need to have these two separate operators, <code>cast</code> and <code>to</code>? Why not combine these to one operator? If there&rsquo;s an ambiguity, let the custom <code>to</code> method win.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x64%3B%26%23x68%3B%26%23x65%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x63%3B%26%23x63%3B%26%23x73%3B%26%23x2e%3B%26%23x6e%3B%26%23x65%3B%26%23x75%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x64;&#x68;&#x65;&#x72;&#x6d;&#x61;&#x6e;&#x40;&#x63;&#x63;&#x73;&#x2e;&#x6e;&#x65;&#x75;&#x2e;&#x65;&#x64;&#x75;">Dave Herman</a> 2006/08/11 17:25</em>
</p>

</div>
<!-- SECTION [5133-5791] -->
<a name="proposed_amendments_retired_from_main_page_20070313"></a><h1>Proposed amendments (retired from main page 2007/03/13)</h1>
<div class="level1">

</div>
<!-- SECTION [5792-5864] -->
<a name="function_coercion"></a><h2>Function coercion</h2>
<div class="level2">

<p>
 At the May f2f Cormac noted that there is a generalized &ldquo;function coercion&rdquo; idea lurking here.  Here is a proposal that attempts to capture that.
</p>

<p>
Consider a function f taking a function parameter fp: 
</p>
<pre class="code">  function f( fp: function ( int ) : int ) { ... }</pre>

<p>
 Calling this with a function that matches the signature is straightforward: 
</p>
<pre class="code">  f( function ( x : int ) : int { return x+37; } )</pre>

<p>
 Now the situation is that there are conversions from double to int and int to double, yet the following is not allowed: 
</p>
<pre class="code">  f( function ( x : double ) : double { return x+37.0; } )</pre>

<p>
 We can introduce a notion of function coercion with the following rules.  Suppose a function argument <em>fp</em> to a function <em>f</em> takes arguments of types <em>fp_a_1</em>, ..., <em>fp_a_n</em> and returns a type <em>fp_r</em>.  We wish to call <em>f</em> with an actual argument <em>g</em> with argument types <em>g_a_1</em>, ..., <em>g_a_n</em>.  If the type of <em>g</em> is a subtype of <em>fp</em> we&rsquo;re done.  Otherwise, if there exists a one-step conversion (maybe the identity conversion) from <em>fp_a_i</em> to <em>g_a_i</em> and a one-step conversion from <em>g_r</em> to <em>fp_r</em>, then <em>f</em> can be called with <em>g</em> wrapped in a function that converts arguments and return values, that is:
</p>
<pre class="code">
    function g ( x : double ) : double { return x+37.0; };

    f( function ( x : int ) : int { return g(x); } )
</pre>

<p>
I propose that such wrapping should happen automatically.
</p>

<p>
This would be expressed as part of the semantics of <code>to</code>, where a function value f can be conversed to a function type T if the above rules hold: <code>g to (function (int) : int)</code>.
</p>

<p>
It would not be hard to provide for this.  It might benefit scripting-type applications in the presence of strongly typed library code.  The alternatives are:
</p>
<ul>
<li class="level1"><div class="li"> use &lsquo;Object&rsquo; or &lsquo;*&rsquo; types;</div>
</li>
<li class="level1"><div class="li"> push a union type into the function being passed, but even that does not generalize, because unions are not extensible: an existing library does not allow its interface types to be extended; or</div>
</li>
<li class="level1"><div class="li"> use parameterized functions.  (In the above case, <em>f</em> would be parameterized on its argument and return type(s).  This does not feel entirely natural; it requires the library writer to anticipate uses, rather than leaving that to the library user.)</div>
</li>
</ul>

<p>
  &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/05/29 19:31</em>
</p>

</div>
<!-- SECTION [5865-8180] -->
<a name="more_retired_proposal_text"></a><h2>More retired proposal text</h2>
<div class="level2">

</div>
<!-- SECTION [8181-8221] -->
<a name="primary_to"></a><h1>Primary 'to'</h1>
<div class="level1">

<p>
 As with <code>cast</code> it would be useful to be able to use a <code>to</code> operation as the base of a reference as in,
</p>
<pre class="code">
to T(x).foo()
</pre>

<p>
Therefore we propose to add a primary (cast-like) <code>to</code> operator that takes a <em>TypeExpression</em> as the first operand and a <em>ParenListExpression</em> whose value is to be converted as the second operand.
</p>

</div>
<!-- SECTION [8222-8591] -->
<a name="binary_cast"></a><h1>Binary 'cast'</h1>
<div class="level1">

<p>
 As with the binary <code>to</code> operator it would be useful to be able to use a <code>cast</code> operation when the destination type is not known at compile time as in,
</p>
<pre class="code">
x cast foo()
</pre>

<p>
Therefore we propose to add a binary <code>cast</code> operator that takes a <em>RelationalExpression</em> representing the value to be checked as the left operand and a <em>ShiftExpression</em> representing the destination type as the right operand.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6a%3B%26%23x6f%3B%26%23x64%3B%26%23x79%3B%26%23x65%3B%26%23x72%3B%26%23x40%3B%26%23x61%3B%26%23x64%3B%26%23x6f%3B%26%23x62%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6a;&#x6f;&#x64;&#x79;&#x65;&#x72;&#x40;&#x61;&#x64;&#x6f;&#x62;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Jeff Dyer</a> 2007/03/13 14:01</em>
</p>

</div>
<!-- SECTION [8592-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/6/69719471668e50b3d34c2e1e1b3c4a17.xhtml used -->
</body>
</html>
