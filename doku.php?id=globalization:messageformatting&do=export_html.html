<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=globalization:messageformatting&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=globalization" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=globalization:messageformatting&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#message_formatting" class="toc">Message Formatting</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#introduction" class="toc">Introduction</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#internationalization" class="toc">Internationalization</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#proposed_solution" class="toc">Proposed solution</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#locale" class="toc">Locale</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#pattern" class="toc">Pattern</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#string_pattern" class="toc">String pattern</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#array_pattern" class="toc">Array pattern</a></span></li>
</ul>
</li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#field_formatters" class="toc">Field Formatters</a></span><ul class="toc">
<li class="level5"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#build-in_formatters" class="toc">Build-in formatters</a></span></li>
<li class="level5"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#user_defined_formatters" class="toc">User defined formatters</a></span></li>
</ul>
</li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#icu_plural_handling" class="toc">ICU plural handling</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#modified_icu_approach" class="toc">Modified ICU approach</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#alternative_proposals" class="toc">Alternative Proposals</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#alternative_to_user_defined_formatters" class="toc">Alternative to user defined formatters</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#simplified_nested_pluralsgenders" class="toc">Simplified nested plurals/genders</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=globalization:messageformatting&amp;do=export_html.html#mozilla_s_approach" class="toc">Mozilla's approach</a></span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<a name="message_formatting"></a><h1>Message Formatting</h1>
<div class="level1">

</div>
<!-- SECTION [1-35] -->
<a name="introduction"></a><h2>Introduction</h2>
<div class="level2">

<p>
The only standard way to build/format a string in JavaScript is to concatenate parts of the string. This approach is not readable and it introduces possible localization errors, thus most of JavaScript libraries (jQuery, Dojo, YUI, Closure) implement some form of string formatting support.
</p>

<p>
The libraries provide similar solutions which should be easy to unify and standardize. Some of the existing proposals already describe such unification, see <a href="doku.php%3Fid=strawman:string_format_take_two.html" class="urlextern" target="_blank" title="http://wiki.ecmascript.org/doku.php?id=strawman:string_format_take_two" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Shanjian's proposal</a> for an example.
</p>

<p>
We could probably stop there for locale independent string formatting. It offers most of C++ printf or Python print function functionality (%d, %i, %s, positional parameters,...).
</p>

<p>
This type of strings is easy to extract and localize, vs. template string proposal.
</p>

<p>
We&rsquo;ll call this approach Simple String Format (SSF).
</p>

<p>
<a href="http://dojotoolkit.org/reference-guide/1.8/dojo/string.html#substitute" class="urlextern" target="_blank" title="http://dojotoolkit.org/reference-guide/1.8/dojo/string.html#substitute" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Dojo .substitute()</a> <a href="http://code.google.com/p/jquery-utils/wiki/StringFormat#Formatting" class="urlextern" target="_blank" title="http://code.google.com/p/jquery-utils/wiki/StringFormat#Formatting" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">jQuery .format()</a> <a href="http://www.python.org/dev/peps/pep-3101/" class="urlextern" target="_blank" title="http://www.python.org/dev/peps/pep-3101/" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Python 3.0 format, which is base for jQuery implementation</a>
</p>

</div>
<!-- SECTION [36-1229] -->
<a name="internationalization"></a><h2>Internationalization</h2>
<div class="level2">

<p>
A second group of problems with string formatting comes from locale specific rules for number, date, plural and gender formatting. We could insert appropriate forms of dates and numbers using SSF, but that&rsquo;s not good enough for plural and gender case.
</p>

</div>
<!-- SECTION [1230-1517] -->
<a name="proposed_solution"></a><h3>Proposed solution</h3>
<div class="level3">

<p>
We could combine SSF and modified ICU solution (see below) like this:
</p>
<pre class="code javascript"><span class="coMULTI">/**
 * Creates MessageFormat object from a pattern, locale and field formatters.
 * locale {LocaleList|String} Locale for string formatting
 * pattern {Array|String} Array or string that serves as formatting pattern.
 *     Use array for plural and select messages, otherwise use string form.
 * optFieldFormatters {Object} Holds user defined formatters for each field (Dojo like).
 * @constructor
 */</span>
Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span>locale, pattern, optFieldFormatters<span class="br0">&#41;</span>;
&nbsp;
<span class="coMULTI">/**
 * Formats pattern with supplied parameters.
 * Dates, times and numbers are formatted in locale sensitive way.
 * params {Array|Object}
 * @returns {String}
 */</span>
Intl.<span class="me1">MessageFormat</span>.<span class="me1">prototype</span>.<span class="me1">format</span><span class="br0">&#40;</span>params<span class="br0">&#41;</span>;
&nbsp;
<span class="coMULTI">/**
 * Returns resolved options, in this case supported locale.
 * @returns {Object}
 */</span>
Intl.<span class="me1">MessageFormat</span>.<span class="me1">prototype</span>.<span class="me1">resolvedOptions</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;</pre>
</div>
<!-- SECTION [1518-2452] -->
<a name="locale"></a><h4>Locale</h4>
<div class="level4">

<p>
Locale parameter is either a simple String containing BCP47 valid locale or a locale list containing valid BCP47 locales.
</p>

<p>
Locale information is used to format dates, numbers and to get locale appropriate data for plural formatting.
</p>

</div>
<!-- SECTION [2453-2701] -->
<a name="pattern"></a><h4>Pattern</h4>
<div class="level4">

<p>
Formatting pattern can either be a String or an Array.
</p>

</div>
<!-- SECTION [2702-2773] -->
<a name="string_pattern"></a><h5>String pattern</h5>
<div class="level5">

<p>
String pattern is used for named and positional parameter substitution.
</p>

</div>
<!-- SECTION [2774-2867] -->
<a name="array_pattern"></a><h5>Array pattern</h5>
<div class="level5">

<p>
Array pattern is used for named, positional, plural and select substitution.
</p>

</div>
<!-- SECTION [2868-2965] -->
<a name="field_formatters"></a><h4>Field Formatters</h4>
<div class="level4">

<p>
Field formatters define how each placeholder value is formatted. There are built-in and user defined formatters.
</p>

</div>
<!-- SECTION [2966-3105] -->
<a name="build-in_formatters"></a><h5>Build-in formatters</h5>
<div class="level5">

<p>
Built in formatters support the usual options, like integers, floating point numbers, strings...
</p>

<p>
We could reserve range from 1 - 3 characters for these.
</p>
<pre class="code javascript"><span class="kw2">var</span> message = Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span>undefined, <span class="st0">'I am ${height:d}cm high.'</span><span class="br0">&#41;</span>;
&nbsp;
<span class="co1">// Returns 'I am 193cm high.'</span>
message.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>height: <span class="nu0">193</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;</pre>
</div>
<!-- SECTION [3106-3449] -->
<a name="user_defined_formatters"></a><h5>User defined formatters</h5>
<div class="level5">

<p>
User can specify a name of the function to format the field. We first try to look up the name in the optFormatters object. If the object is undefined or optFormatters[name] is undefined we try the global namespace.
</p>
<pre class="code javascript"><span class="coMULTI">/**
 * User defined formatter for a given value.
 * Function name is user defined.
 * locale {String} Resolved locale from MessageFormat object.
 * value {Any} Value passed for specific placeholder.
 * @returns {String} formatted value.
 */</span>
<span class="kw2">function</span> fieldFormat<span class="br0">&#40;</span>locale, value<span class="br0">&#41;</span>;</pre>
<p>
Example: 
</p>
<pre class="code javascript"><span class="kw2">var</span> formatters = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
&nbsp;
<span class="co1">// First parameter is always resolved locale.</span>
<span class="co1">// Second parameter is the placeholder value.</span>
formatters<span class="br0">&#91;</span><span class="st0">'toEuros'</span><span class="br0">&#93;</span> = <span class="kw2">function</span> <span class="br0">&#40;</span>locale, number<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw2">var</span> nf = Intl.<span class="me1">NumberFormat</span><span class="br0">&#40;</span>locale, <span class="br0">&#123;</span>style:<span class="st0">'currency'</span>, currency:<span class="st0">'EUR'</span>, currencyDisplay: <span class="st0">'code'</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;
  <span class="kw1">return</span> nf.<span class="me1">format</span><span class="br0">&#40;</span>number<span class="br0">&#41;</span>;
<span class="br0">&#125;</span>;
&nbsp;
<span class="kw2">var</span> message = Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">'sr'</span>, <span class="st0">'My salary is ${salary:toEuros}.'</span>, formatters<span class="br0">&#41;</span>;
&nbsp;
<span class="co1">// Returns 'My salary is 1.234.567.890,00 евра'.</span>
message.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>salary: <span class="nu0">1234567890</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;</pre>
</div>
<!-- SECTION [3450-4514] -->
<a name="icu_plural_handling"></a><h3>ICU plural handling</h3>
<div class="level3">

<p>
ICU library, and Google Closure, encode plural and gender format into a message string and select appropriate message at a runtime. This approach applies well to SSF, but has a couple of pain points. Plural and gender syntax is hard to get right and there are escaping issues with quotes and {}.
</p>
<pre class="code javascript"><span class="kw2">var</span> message = <span class="kw2">new</span> Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">'sr'</span>, <span class="st0">'Some text before {|numPeople, plural, offset: 1, '</span> +
    <span class="st0">'one {|Some message {|ph|} with {|#|} value|}'</span> +
    <span class="st0">'few {|Some other message|}'</span> +
    <span class="st0">'=1  {|Optional prefix text {|GENDER, select, '</span> +
    <span class="st0">'male {|Text for male option with '</span><span class="st0">' single quotes|}'</span> +
    <span class="st0">'female {|Text for female option with '</span><span class="br0">&#123;</span>||<span class="br0">&#125;</span><span class="st0">''</span> +
    <span class="st0">'other {|Text for default}} optional postfix text'</span> +
    <span class="st0">'} and text after.'</span><span class="br0">&#41;</span>;
&nbsp;
message.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>numPeople:<span class="nu0">4</span>, ph:<span class="st0">'whatever'</span>, GENDER:<span class="st0">'male'</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;</pre>
</div>
<!-- SECTION [4515-5366] -->
<a name="modified_icu_approach"></a><h3>Modified ICU approach</h3>
<div class="level3">

<p>
Using the same ICU syntax, but encoded as a JavaScript object or JSON object, we could make writing of complex messages easier: 
</p>
<ul>
<li class="level1"><div class="li"> Editor matches {} and indents values automatically</div>
</li>
<li class="level1"><div class="li"> Cleaner syntax</div>
</li>
<li class="level1"><div class="li"> No escaping problems</div>
</li>
<li class="level1"><div class="li"> Adding comments to each section would be easier, which helps documentation and possibly translation process</div>
</li>
</ul>

<p>
 Cons:
</p>
<ul>
<li class="level1"><div class="li"> Messages would be harder to extract as strings (we could add parse/serialize methods to help deal with the extraction), or they could be kept as JSON objects in the message bundles</div>
</li>
<li class="level1"><div class="li"> More verbose than the ICU approach</div>
</li>
</ul>
<pre class="code javascript"><span class="kw2">var</span> message = <span class="kw2">new</span> Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">'sr'</span>, <span class="br0">&#91;</span><span class="st0">'Some text before'</span>, <span class="br0">&#123;</span>
    type: <span class="st0">'plural'</span>,  <span class="co1">// can be plural or gender/select</span>
    valueName: <span class="st0">'numPeople'</span>,  <span class="co1">// placeholder for switch value</span>
    offset: <span class="nu0">1</span>,  <span class="co1">// optional for plural, invalid for select</span>
    one: <span class="st0">'Some message ${ph} with ${#} value'</span>, <span class="co1">// no gender specific msg necessary</span>
    few: <span class="br0">&#91;</span> <span class="st0">'Optional prefix text for |few|'</span>, <span class="br0">&#123;</span>
       type: <span class="st0">'select'</span>,
       valueName: <span class="st0">'gender'</span>,
       male: <span class="st0">'Text for male option with <span class="es0">\'</span> single quotes'</span>,
       female: <span class="st0">'Text for female option with {}'</span>,  <span class="co1">// {} produces {} in the output.</span>
       other: <span class="st0">'Text for default'</span>
    <span class="br0">&#125;</span>, <span class="st0">'optional postfix text'</span><span class="br0">&#93;</span><span class="br0">&#93;</span>,
    other: <span class="st0">'Some messages for the default'</span>, <span class="co1">// no gender specific msg necessary</span>
    <span class="st0">'1'</span>: <span class="br0">&#91;</span> <span class="st0">'Optional prefix text'</span>, <span class="br0">&#123;</span>
       type: <span class="st0">'select'</span>
       valueName: <span class="st0">'gender'</span>,
       male: <span class="st0">'Text for male option with <span class="es0">\'</span> single quotes'</span>,
       female: <span class="st0">'Text for female option with {}'</span>,  <span class="co1">// {} produces {} in the output.</span>
       other: <span class="st0">'Text for default'</span>
    <span class="br0">&#125;</span>, <span class="st0">'optional postfix text'</span><span class="br0">&#93;</span><span class="br0">&#93;</span>,
<span class="br0">&#125;</span>, <span class="st0">'and text after'</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
&nbsp;
message.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>numPeople:<span class="nu0">4</span>, ph:<span class="st0">'whatever'</span>, gender:<span class="st0">'male'</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;</pre>
</div>
<!-- SECTION [5367-7095] -->
<a name="alternative_proposals"></a><h2>Alternative Proposals</h2>
<div class="level2">

</div>
<!-- SECTION [7096-7130] -->
<a name="alternative_to_user_defined_formatters"></a><h3>Alternative to user defined formatters</h3>
<div class="level3">

<p>
 <em>Norbert Lindenberg 2013-04-19</em>
</p>

<p>
The user defined formatters got me thinking:
</p>
<ul>
<li class="level1"><div class="li"> good: options for subformats are not in message format pattern (they usually shouldn&rsquo;t be changed in localization).</div>
</li>
<li class="level1"><div class="li"> not so good: function is a lot of extra text.</div>
</li>
<li class="level1"><div class="li"> bad: definitely should not access global namespace.</div>
</li>
</ul>

<p>
 Proposal:
</p>
<ul>
<li class="level1"><div class="li"> MessageFormat takes <code>options</code> argument, which may provide options for subformats.</div>
</li>
<li class="level1"><div class="li"> For any parameter name v, <code>MessageFormat(pattern, locales, options).format(args)</code> gets the value to insert from the expression <code>args[v].toLocaleString(locales, options ? options[v] : undefined)</code></div>
</li>
<li class="level1"><div class="li"> Integrates with existing ES internationalization infrastructure.</div>
</li>
</ul>

<p>
 Example 1 - no options: 
</p>
<pre class="code javascript">    Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">"I am {height}cm tall."</span>, <span class="st0">"en"</span><span class="br0">&#41;</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>height: <span class="nu0">193</span><span class="br0">&#125;</span><span class="br0">&#41;</span>
    <span class="co1">// → &quot;I am &quot; + (193).toLocaleString(&quot;en&quot;, undefined) + &quot;cm tall.&quot;</span>
    <span class="co1">// → &quot;I am 193cm tall.&quot;</span></pre>
<p>
Example 2 - options for NumberFormat: 
</p>
<pre class="code javascript">   let options = <span class="br0">&#123;</span>salary: <span class="br0">&#123;</span>style: <span class="st0">"currency"</span>, currency: <span class="st0">"EUR"</span>, currencyDisplay: <span class="st0">"name"</span><span class="br0">&#125;</span><span class="br0">&#125;</span>;
   Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">"My salary is {salary}."</span>, <span class="st0">"sr"</span>, options<span class="br0">&#41;</span>.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>salary: <span class="nu0">1234567890</span><span class="br0">&#125;</span><span class="br0">&#125;</span>
   <span class="co1">// → &quot;My salary is &quot; + (1234567890).toLocaleString(&quot;sr&quot;, options) + &quot;.&quot;</span>
   <span class="co1">// → &quot;My salary is 1.234.567.890,00 евра.&quot;</span></pre>
</div>
<!-- SECTION [7131-8469] -->
<a name="simplified_nested_pluralsgenders"></a><h3>Simplified nested plurals/genders</h3>
<div class="level3">

<p>
 <em>Mihai Nita 2013-10-21</em>
</p>

<p>
Current plural form is hard to follow for nested messages (even for two levels). We aim to make structure easier to enumerate and glance over all cases.
</p>
<pre class="code javascript"><span class="kw2">var</span> message = <span class="kw2">new</span> Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">'sr'</span>, <span class="br0">&#123;</span>
    <span class="st0">'rules'</span>: <span class="br0">&#91;</span><span class="br0">&#91;</span><span class="st0">'plural'</span>, <span class="st0">'numPeople'</span>, <span class="nu0">1</span><span class="br0">&#93;</span>, <span class="br0">&#91;</span><span class="st0">'select'</span>, <span class="st0">'gender'</span><span class="br0">&#93;</span><span class="br0">&#93;</span>,
    <span class="st0">'one other'</span>:  <span class="st0">'Some message {ph} with {#} value'</span>, <span class="co1">// no gender specific msg necessary</span>
    <span class="st0">'few male'</span>:   <span class="st0">'Text for male option with <span class="es0">\'</span> single quotes'</span>,
    <span class="st0">'few female'</span>: <span class="st0">'Text for female option with {}'</span>,  <span class="co1">// {} produces {} in the output.</span>
    <span class="st0">'few other'</span>:  <span class="st0">'Text for default'</span>,
    <span class="st0">'1 male'</span>:     <span class="st0">'Text for male option with <span class="es0">\'</span> single quotes'</span>,
    <span class="st0">'1 female'</span>:   <span class="st0">'Text for female option with {}'</span>,  <span class="co1">// {} produces {} in the output.</span>
    <span class="st0">'1 other'</span>:    <span class="st0">'Text for default'</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span>;
&nbsp;
message.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>numPeople:<span class="nu0">4</span>, ph:<span class="st0">'whatever'</span>, gender:<span class="st0">'male'</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;</pre>
<p>
or with array syntax (may be harder to localize?)
</p>
<pre class="code javascript"><span class="kw2">var</span> message = <span class="kw2">new</span> Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">'sr'</span>, <span class="br0">&#91;</span>
    <span class="br0">&#91;</span><span class="br0">&#91;</span><span class="st0">'plural'</span>, <span class="st0">'numPeople'</span>, <span class="nu0">1</span><span class="br0">&#93;</span>, <span class="br0">&#91;</span><span class="st0">'select'</span>, <span class="st0">'gender'</span><span class="br0">&#93;</span><span class="br0">&#93;</span>,
    <span class="br0">&#91;</span><span class="st0">'one'</span>, <span class="st0">'other'</span>,  <span class="st0">'Some message {ph} with {#} value'</span><span class="br0">&#93;</span>, <span class="co1">// no gender specific msg necessary</span>
    <span class="br0">&#91;</span><span class="st0">'few'</span>, <span class="st0">'male'</span>,   <span class="st0">'Text for male option with <span class="es0">\'</span> single quotes'</span><span class="br0">&#93;</span>,
    <span class="br0">&#91;</span><span class="st0">'few'</span>, <span class="st0">'female'</span>, <span class="st0">'Text for female option with {}'</span><span class="br0">&#93;</span>,  <span class="co1">// {} produces {} in the output.</span>
    <span class="br0">&#91;</span><span class="st0">'few'</span>, <span class="st0">'other'</span>,  <span class="st0">'Text for default'</span><span class="br0">&#93;</span>,
    <span class="br0">&#91;</span><span class="nu0">1</span>, <span class="st0">'male'</span>,       <span class="st0">'Text for male option with <span class="es0">\'</span> single quotes'</span><span class="br0">&#93;</span>,
    <span class="br0">&#91;</span><span class="nu0">1</span>, <span class="st0">'female'</span>,     <span class="st0">'Text for female option with {}'</span><span class="br0">&#93;</span>,  <span class="co1">// {} produces {} in the output.</span>
    <span class="br0">&#91;</span><span class="nu0">1</span>, <span class="st0">'other'</span>,      <span class="st0">'Text for default'</span><span class="br0">&#93;</span>
<span class="br0">&#93;</span><span class="br0">&#41;</span>;
&nbsp;
message.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#123;</span>numPeople:<span class="nu0">4</span>, ph:<span class="st0">'whatever'</span>, gender:<span class="st0">'male'</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;</pre>
<p>
Note: Gender doesn&rsquo;t have # syntax, produces # in the output. Fix example.
</p>

<p>
Note: Offset belongs to the innermost plural. Have to come up with better reference to which one in this syntax.
</p>

</div>
<!-- SECTION [8470-10299] -->
<a name="mozilla_s_approach"></a><h3>Mozilla's approach</h3>
<div class="level3">

<p>
 <em>Zibi Braniecki, Stas Malolepszy 2014-01-01</em>
</p>

<p>
The proposals on this page explore important aspects of formatting translations without resorting to simple concatenation.  In the following proposal, we put more emphasis on future-compatibility, drawing from our experience with L20n.  
</p>

<p>
We like Mihai&rsquo;s &ldquo;Simplified nested plurals/genders&rdquo; proposal, and we build on top of it:
</p>

<p>
## good 
</p>
<ul>
<li class="level1"><div class="li"> multi-value translations (branching),</div>
</li>
<li class="level1"><div class="li"> allowing more than one selection rule,</div>
</li>
<li class="level1"><div class="li"> formatters are not hard-coded into Intl.</div>
</li>
</ul>

<p>
 ## not so good:
</p>
<ul>
<li class="level1"><div class="li"> complex messages with multiple nested branches are still hard to follow, because the syntax doesn&rsquo;t reflect the nesting,</div>
</li>
<li class="level1"><div class="li"> messages have no identifiers, which forces the extraction of translations into other languages to be based on the serialization of the entire body of the message. Furthermore it makes it impossible in the future to extend the spec with message interpolation (something we found useful at Mozilla),</div>
</li>
<li class="level1"><div class="li"> we suggest the locale code be the second argument to Intl.MessageFormat.  In the future, we envision using MessageBundle or a similar concept to store the current locale.</div>
</li>
</ul>

<p>
   # bad
</p>
<ul>
<li class="level1"><div class="li"> string branching is only one level, which does not represent nested cases (gender and plural)</div>
</li>
<li class="level1"><div class="li"> string selection description is an awkward three-element array that does not extend</div>
</li>
<li class="level1"><div class="li"> the proposal is a mixture of AST object and semantic string</div>
</li>
<li class="level1"><div class="li"> messages are stripped of unique identifiers which makes it hard to maintain localizations, and in the future interpolate messages</div>
</li>
<li class="level1"><div class="li"> the variable interpolation identifier is not future compatible with message interpolation identifiers</div>
</li>
</ul>

<p>
 The key paradigm of L20n that we would also see in Intl.MessageFormat is the  separation of concerns of developers vs. concerns of localizers.  We try to move as much of the text formatting task as possible into the hands of translators, thus making the <acronym title="Application Programming Interface">API</acronym> simpler for developers to use and giving more control to translators over the content.
</p>

<p>
One of the ways to achieve this is to make the variables passed to .format() be available in the larger scope for all messages to use.  This allows localizers to make their own decisions about which variables to use in which message.  Think grammatically-correct past tense which depends on the gender of the subject.  If gender is available in a larger scope, any message can use string selection to display the correct translation.
</p>

<p>
(In fact, L20n distinguishes between three different kinds of things that are available in the scope:  variables like gender or numPeople, other messages (very useful for brand names), and contextual data (e.g. current screen width).  In  order to avoid name conflicts, to help debugging and to increase security, L20n uses different syntax for the data types mentioned  above: {{ brandName }} for referencing other messages, {{ $gender }} for developer-provided variables and {{ @screen }} for contextual data.)
</p>

<p>
In this proposal for Intl.MessageFormat, we only posit to use developer-provided variables like $gender or $numPeople.  (Other data types can be added later in separate proposals.)  The dolar sign helps localizers understand that they should not translate the variable name.
</p>

<p>
Lastly, the proposal uses string literals to define messages, with L20n-compatible syntax.  It&rsquo;s more compact and based on JSON for defining translation values.  It conveniently solves the problem of string selection rules being limited to being defined as functions which take only one argument.
</p>

<p>
# Proposal 
</p>
<pre class="code javascript">  <span class="kw2">var</span> ctxdata = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
  ctxdata<span class="br0">&#91;</span><span class="st0">'plural'</span><span class="br0">&#93;</span> = <span class="kw2">function</span><span class="br0">&#40;</span>n<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">return</span> n == <span class="nu0">1</span> ? <span class="st0">'one'</span> : <span class="st0">'other'</span>;
  <span class="br0">&#125;</span>;
  ctxdata<span class="br0">&#91;</span><span class="st0">'numPeople'</span><span class="br0">&#93;</span> = <span class="nu0">3</span>;
  ctxdata<span class="br0">&#91;</span><span class="st0">'gender'</span><span class="br0">&#93;</span> = <span class="st0">'female'</span>;
  <span class="kw2">var</span> hello = Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span><span class="st0">"&lt;hello 'Hello, world!'&gt;"</span>, <span class="st0">'en-US'</span><span class="br0">&#41;</span>;
  
  <span class="kw2">var</span> complex = Intl.<span class="me1">MessageFormat</span><span class="br0">&#40;</span>
    <span class="st0">"&lt;complex[$plural($numPeople), $gender] {
      one: 'Some message {{$ph}} with value',
      other: {
        male: 'Text for male option with <span class="es0">\'</span> single quotes',
        female: 'Text for female option with {}',
        other: 'Text for default'
      }
    }&gt;"</span>, <span class="st0">'en-US'</span><span class="br0">&#41;</span>;
  <span class="kw3">alert</span><span class="br0">&#40;</span>hello.<span class="me1">format</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
  <span class="kw3">alert</span><span class="br0">&#40;</span>complex.<span class="me1">format</span><span class="br0">&#40;</span>ctxdata<span class="br0">&#41;</span><span class="br0">&#41;</span>;</pre>
</div>
<!-- SECTION [10300-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/e/e84c41b6ab7210a927303e147741a529.xhtml used -->
</body>
</html>
