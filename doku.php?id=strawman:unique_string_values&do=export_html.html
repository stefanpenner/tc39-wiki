<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:unique_string_values&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#unique_string_valuesgensym_for_javascript" class="toc">Unique String Values: Gensym for JavaScript</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#changes_to_the_ecmascript_string_data_type" class="toc">Changes to the ECMAScript String Data Type</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#changes_to_ecmascript_operations_on_string_values" class="toc">Changes to  ECMAScript Operations on String Values</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#changes_to_property_access_abstract_operations" class="toc">Changes to Property Access Abstract Operations</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#8.12.1_getownproperty" class="toc">8.12.1 [[GetOwnProperty]]</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#8.12.7_delete" class="toc">8.12.7 [[Delete]]</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#8.12.9_defineownproperty" class="toc">8.12.9 [[DefineOwnProperty]]</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#changes_to_type_conversion_and_testing" class="toc">Changes to Type Conversion and Testing</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#9.12_the_samevalue_algorithm" class="toc">9.12 The SameValue Algorithm</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#11.9.6_the_strict_equality_algorithm" class="toc">11.9.6 The Strict Equality Algorithm</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#creating_unique_string_values" class="toc">Creating Unique String Values</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#15.5.3.3_string.unique_value" class="toc">15.5.3.3 String.unique(value)</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#15.5.3.4_string.secret_value" class="toc">15.5.3.4 String.secret(value)</a></span></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#using_unique_string_values_as_property_names" class="toc">Using Unique String Values as Property Names</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#special_handling_of_unique_strings_where_secret_is_true" class="toc">Special Handling of Unique Strings Where [[Secret]] is true</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#secrecy_wrappers" class="toc">Secrecy Wrappers</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#secrecy_wrapper_.samesecret_obj" class="toc">&lt;secrecy wrapper&gt;.sameSecret(obj)</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#secrecy_wrapper_.isit_value" class="toc">&lt;secrecy wrapper&gt;.isIt(value)</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#producing_secrecy_wrappers" class="toc">Producing Secrecy Wrappers</a></span></li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:unique_string_values&amp;do=export_html.html#unique_strings_and_weakmaps" class="toc">Unique Strings and WeakMaps</a></span></li>
</ul>
</div>
</div>

<a name="unique_string_valuesgensym_for_javascript"></a><h1>Unique String Values: Gensym for JavaScript</h1>
<div class="level1">

<p>
 Proposal by Allen Wirfs-Brock <br/>
 An alternative to the revised <a href="doku.php%3Fid=strawman:private_names.html" class="wikilink1" title="strawman:private_names" onclick="return svchk()" onkeypress="return svchk()">private_names</a> proposal by Allen Wirfs-Brock<br/>
 and the original <a href="doku.php%3Fid=strawman:names.html" class="wikilink1" title="strawman:names" onclick="return svchk()" onkeypress="return svchk()">names</a> proposal by Dave Herman and Sam Tobin-Hochstadt .
</p>

<p>
In existing ECMAScript, string values are distinguished solely based upon their specific ordered sequence of characters.  Two strings that have the same sequence of characters are considered to be the same value, even though they originate at different points in a program or exist as distinct implementation level entities. Unique strings extends the ECMAScript string type to also include the concept of distinct strings values that may have identical character sequences.
</p>

<p>
These values are similar, in concept, to the unique symbols generated by the gensym function in Lisp and other similar languages. They are useful for creating unique property names that are guaranteed to be different from any other property name that has or in the future may be created. 
</p>

</div>
<!-- SECTION [1-1035] -->
<a name="changes_to_the_ecmascript_string_data_type"></a><h1>Changes to the ECMAScript String Data Type</h1>
<div class="level1">

<p>
 Section 8.4 of the ECMAScript specification defines a string to be finite ordered sequence of 16-bit unsigned integer character values.  That definition is extended as follows:
</p>

<p>
Each string value contains a immutable Boolean value named <code>[[Secret]]</code>  and an immutable integer value named <code>[[UniqueId]]</code>. Just like a string&rsquo;s character sequence, the values of <code>[[Secret]]</code> and <code>[[UniqueId]]</code> are set during the creation of a string value and may not be subsequently modified.  Unless other specified, each string value is created with <strong>false</strong> as its <code>[[Secret]]</code> and 0 as its <code>[[UniqueId]]</code>. In particular, the SV of string literals (7.8.4) have the default values for  <code>[[Secret]]</code> and <code>[[UniqueId]]</code>.  In the rest of the specification the term <em>Unique String</em> is used to mean a string values whose <code>[[UniqueId]]</code> value is non-zero. The term <em>Private String</em> is used to mean a string values whose <code>[[UniqueId]]</code> value is non-zero and whose &lsquo;[[Secret]]<code> value is <strong>true</strong>. String values are never created with both a </code>[[UniqueId]]<code> value of zero and a &lsquo;[[Secret]]</code> value that is <strong>true</strong>.
</p>

<p>
<em><strong>Note</strong> <code>[[Secret]]</code> and <code>[[UniqueId]]</code> are specification devices.  They need not literally exist within an implementation as long as the observable behavior of the implementation matches the observable characteristics of this specification. </em>
</p>

</div>
<!-- SECTION [1036-2585] -->
<a name="changes_to_ecmascript_operations_on_string_values"></a><h1>Changes to  ECMAScript Operations on String Values</h1>
<div class="level1">

<p>
 This extension does not change the semantics of any ECMAScript operations upon string values other than those explicitly identified in this specification. The values of <code>[[Secret]]</code> and  <code>[[UniqueId]]</code> have no effect upon such string operations unless explicitly identified by this specification as having an effect.
</p>

</div>
<!-- SECTION [2586-2989] -->
<a name="changes_to_property_access_abstract_operations"></a><h2>Changes to Property Access Abstract Operations</h2>
<div class="level2">

<p>
 In some cases the current ECMAScript specification is imprecise concerning how a string value is used as a name for accessing or creating an object property.  The following clarification are made as part of this proposal:
</p>

</div>
<!-- SECTION [2990-3272] -->
<a name="8.12.1_getownproperty"></a><h3>8.12.1 [[GetOwnProperty]]</h3>
<div class="level3">

<p>
Replace:<br/>
 1. If <em>O</em> doesn&rsquo;t have an own property with name <em>P</em>, return <strong>undefined</strong>.<br/>
 with:<br/>
 1. If <em>O</em> dosn&rsquo;t have an own property whose name is the SameValue as <em>P</em>, return <strong>undefined</strong>.
</p>

<p>
Replace:<br/>
 3. Let <em>X</em> be <em>O</em>&lsquo;s own property  named  <em>P</em>.<br/>
 with:<br/>
 3. Let <em>X</em> be <em>O</em>&lsquo;s own property whose name is the SameValue as  <em>P</em>.
</p>

</div>
<!-- SECTION [3273-3660] -->
<a name="8.12.7_delete"></a><h3>8.12.7 [[Delete]]</h3>
<div class="level3">

<p>
Replace:<br/>
 3.a. Remove the own property with name <em>P</em> from <em>O</em>.<br/>
 with:<br/>
 3.a. Remove the own property whose name is the SameValue as <em>P</em> from <em>O</em>.
</p>

</div>
<!-- SECTION [3661-3845] -->
<a name="8.12.9_defineownproperty"></a><h3>8.12.9 [[DefineOwnProperty]]</h3>
<div class="level3">

<p>
Replace:<br/>
 12. For each attribute field of <em>Desc</em> that is present, set the corresponding named attribute of the property  named <em>P</em> of object <em>O</em> to the value of the field.<br/>
 with:<br/>
 12. For each attribute field of <em>Desc</em> that is present, set the corresponding named attribute of the property of object <em>O</em> whose name is the SameValue as  <em>P</em>  to the value of the field.
</p>

</div>
<!-- SECTION [3846-4268] -->
<a name="changes_to_type_conversion_and_testing"></a><h2>Changes to Type Conversion and Testing</h2>
<div class="level2">

<p>
Note that this proposal does not modify the Abstract Relational Comparison Algorithm or the Abstract Equality Comparison Algorithm.
</p>

</div>
<!-- SECTION [4269-4452] -->
<a name="9.12_the_samevalue_algorithm"></a><h3>9.12 The SameValue Algorithm</h3>
<div class="level3">

<p>
Replace:<br/>
 5. If Type(<em>x</em>) is String, then return <strong>true</strong> if <em>x</em> and <em>y</em> are exactly the same sequence of characters (same length and same characters in corresponding positions); otherwise return <strong>false</strong>.<br/>
 with:<br/>
 5. If Type(<em>x</em>) is String, then return <strong>true</strong> if <em>x</em> and <em>y</em> have the same <code>[[UniqueId]]</code> value and have exactly the same sequence of characters (same length and same characters in corresponding positions); otherwise return <strong>false</strong>.
</p>

<p>
Note that if the proposed <a href="doku.php%3Fid=harmony:egal.html" class="wikilink1" title="harmony:egal" onclick="return svchk()" onkeypress="return svchk()">egal</a> operator should use this modified specification of the SameValue Algorithm. 
</p>

</div>
<!-- SECTION [4453-5088] -->
<a name="11.9.6_the_strict_equality_algorithm"></a><h3>11.9.6 The Strict Equality Algorithm</h3>
<div class="level3">

<p>
Replace:<br/>
 5. If Type(<em>x</em>) is String, then return <strong>true</strong> if <em>x</em> and <em>y</em> are exactly the same sequence of characters (same length and same characters in corresponding positions); otherwise return <strong>false</strong>.<br/>
 with:<br/>
 5. If Type(<em>x</em>) is String, then return <strong>true</strong> if <em>x</em> and <em>y</em> have the same <code>[[UniqueId]]</code> value and have exactly the same sequence of characters (same length and same characters in corresponding positions); otherwise return <strong>false</strong>. 
</p>

</div>
<!-- SECTION [5089-5612] -->
<a name="creating_unique_string_values"></a><h2>Creating Unique String Values</h2>
<div class="level2">

<p>
 String values with non-zero <code>[[UniqueId]]</code> values and possibly a <strong>true</strong> <code>[[Secret]]</code> are created using the following new built-in property of the String Constructor. These are the only way that new Unique String values can be created.  It is impossible to synthesis an already existing Unique String value using a String literal or in any other manner.
</p>

</div>
<!-- SECTION [5613-6031] -->
<a name="15.5.3.3_string.unique_value"></a><h3>15.5.3.3 String.unique(value)</h3>
<div class="level3">

<p>
If <em>value</em> is not present let <em>value</em> be the empty string. If the type of <em>value</em> is not String  let <em>value</em> be the result of ToString(<em>value</em>). Returns a String value containing the same sequence of characters as <em>value</em>. The value of <code>[[UniqueId]]</code> for the returned string is set to an integer that is 1 greater than any previous value that has been assigned to any string&rsquo;s <code>[[UniqueId]]</code>.  The value of <code>[[Secret]]</code> for the returned string is set to <strong>false</strong>.
</p>

<p>
This function most closely corresponds to the Lisp gensym function.  The <em>value</em> is provided primarily for debugging purposes and can be omitted. 
</p>

</div>
<!-- SECTION [6032-6729] -->
<a name="15.5.3.4_string.secret_value"></a><h3>15.5.3.4 String.secret(value)</h3>
<div class="level3">

<p>
If <em>value</em> is not present let <em>value</em> be the empty string. If the type of <em>value</em> is not String  let <em>value</em> be the result of ToString(<em>value</em>). Returns a String value containing the same sequence of characters as <em>value</em>. The value of <code>[[UniqueId]]</code> for the returned string is set to an integer that is 1 greater than any previous value that has been assigned to any string&rsquo;s <code>[[UniqueId]]</code>.  The value of <code>[[Secret]]</code> for the returned string is set to <strong>true</strong>.
</p>

<p>
<code>String.secret</code> operates exactly like <code>String.unique</code> except that the <code>[[Secret]]</code> internal property of returned string is set to <strong>true</strong>.  The  <code>[[Secret]]</code> internal property is used by reflective operations that expose property names to limit the exposure of such names.  Code can only directly gain access via reflection to a secret string valued property name if it already has access to that secret string value. 
</p>

</div>
<!-- SECTION [6730-7721] -->
<a name="using_unique_string_values_as_property_names"></a><h1>Using Unique String Values as Property Names</h1>
<div class="level1">

<p>
 Because unique string values are real string values, they may be used in any context where a string is required including as property names. However, such properties can only be created and accessed using bracket notation or reflection operations. For example, a property with a unique string name might be added to an object as follows:
</p>
<pre class="code javascript"><span class="kw2">var</span> x = String.<span class="me1">unique</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;  <span class="co1">//create a new Unique Name value.</span>
<span class="kw2">var</span> obj = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
obj<span class="br0">&#91;</span>x<span class="br0">&#93;</span> = <span class="nu0">1</span>;
<span class="kw3">print</span><span class="br0">&#40;</span>obj<span class="br0">&#91;</span>x<span class="br0">&#93;</span><span class="br0">&#41;</span>;  <span class="co1">//prints 1</span></pre>
<p>
Because the SameValue algorithm is used for property lookup distinct unique string values designate separate properties even when the unique strings have the same character sequences: 
</p>
<pre class="code javascript"><span class="kw2">var</span> x = String.<span class="me1">unique</span><span class="br0">&#40;</span><span class="st0">"x"</span><span class="br0">&#41;</span>;  <span class="co1">//create a new Unique String value.</span>
<span class="kw2">var</span> x2 = String.<span class="me1">unique</span><span class="br0">&#40;</span><span class="st0">"x"</span><span class="br0">&#41;</span>; <span class="co1">//create another  Unique String value.</span>
<span class="kw2">var</span> obj = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
obj<span class="br0">&#91;</span>x<span class="br0">&#93;</span> = <span class="nu0">1</span>;
obj<span class="br0">&#91;</span>x2<span class="br0">&#93;</span> = <span class="nu0">2</span>
<span class="kw3">print</span><span class="br0">&#40;</span>obj<span class="br0">&#91;</span>x<span class="br0">&#93;</span>+obj<span class="br0">&#91;</span>x2<span class="br0">&#93;</span><span class="br0">&#41;</span>;  <span class="co1">//prints 3</span></pre>
<p>
 Property named using unique strings are also distinct from properties accessed using normal strings or dot notation: 
</p>
<pre class="code javascript"><span class="kw2">var</span> x = String.<span class="me1">unique</span><span class="br0">&#40;</span><span class="st0">"x"</span><span class="br0">&#41;</span>;  <span class="co1">//create a new Unique Name value.</span>
<span class="kw2">var</span> obj = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
obj<span class="br0">&#91;</span>x<span class="br0">&#93;</span> = <span class="nu0">1</span>;
<span class="kw3">print</span><span class="br0">&#40;</span>obj<span class="br0">&#91;</span><span class="st0">"x"</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;  <span class="co1">//prints undefined</span>
<span class="kw3">print</span><span class="br0">&#40;</span>obj.<span class="me1">x</span><span class="br0">&#41;</span>;     <span class="co1">//prints undefined</span></pre>
<p>
The use of an unique string (even those with a <strong>true</strong> value for <code>[[Secret]]</code>) has no direct effect on the enumerablity of properties. If it is desired that a unique name not be exposed via for-in enumeration then its property must be explicitly made non-enumerable: 
</p>
<pre class="code javascript"><span class="kw2">var</span> y = String.<span class="me1">secret</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;  <span class="co1">//create a new Unique strng value.</span>
<span class="kw2">var</span> obj = <span class="br0">&#123;</span>a:<span class="nu0">1</span><span class="br0">&#125;</span>;
Object.<span class="me1">defineProperty</span><span class="br0">&#40;</span>obj,y,<span class="br0">&#123;</span>value: <span class="nu0">2</span>, enumerable: <span class="kw2">false</span><span class="br0">&#125;</span><span class="br0">&#125;</span>
<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw2">var</span> p <span class="kw1">in</span> obj<span class="br0">&#41;</span> <span class="kw3">print</span><span class="br0">&#40;</span>p<span class="br0">&#41;</span>;  <span class="co1">//prints &quot;a&quot;</span></pre>
</div>
<!-- SECTION [7722-9471] -->
<a name="special_handling_of_unique_strings_where_secret_is_true"></a><h1>Special Handling of Unique Strings Where [[Secret]] is true</h1>
<div class="level1">

<p>
Setting <code>[[Secret]]</code> to <strong>true</strong> for a unique string prevents that string from being directly exposed using certain reflective operations. Instead, in those situations, a special secrecy wrapper object is used instead of a unique string value.
</p>

</div>
<!-- SECTION [9472-9801] -->
<a name="secrecy_wrappers"></a><h2>Secrecy Wrappers</h2>
<div class="level2">

<p>
A Secrecy Wrapper is an object with an <code>[[Hidden]]</code> internal property and the following two methods.  Secret Wrapper objects are always created as frozen objects. 
</p>

</div>
<!-- SECTION [9802-10003] -->
<a name="secrecy_wrapper_.samesecret_obj"></a><h3>&lt;secrecy wrapper&gt;.sameSecret(obj)</h3>
<div class="level3">

<p>
If either the this object or the value of <em>obj</em> does not have a <code>[[Hidden]]</code> internal property return <strong>false</strong>. Otherwise, return the result of applying the SameValue algorithm to the values of the <code>[[Hidden]]</code> internal property of the this object and <em>obj</em>.
</p>

</div>
<!-- SECTION [10004-10332] -->
<a name="secrecy_wrapper_.isit_value"></a><h3>&lt;secrecy wrapper&gt;.isIt(value)</h3>
<div class="level3">

<p>
If  the this object does not have a <code>[[Hidden]]</code> internal property throw TypeError exception. Otherwise, return the result of applying the SameValue algorithm to the value of the <code>[[Hidden]]</code> internal properties of the this object and the value of <em>obj</em>.
</p>

</div>
<!-- SECTION [10333-10651] -->
<a name="producing_secrecy_wrappers"></a><h2>Producing Secrecy Wrappers</h2>
<div class="level2">

<p>
Secrecy wrapper are used instead of string values in the following situations:
</p>
<ul>
<li class="level1"><div class="li"> In place of any string value whose <code>[[Secret]]</code> value is <strong>true</strong> that would be contained in the array returned by <code>Object.getOwnPropertyNames</code>.</div>
</li>
<li class="level1"><div class="li"> Any name argument passed to a Proxy trap handler where the name is a string value whose <code>[[Secret]]</code> value is <strong>true</strong>.</div>
</li>
</ul>

</div>
<!-- SECTION [10652-11065] -->
<a name="unique_strings_and_weakmaps"></a><h1>Unique Strings and WeakMaps</h1>
<div class="level1">

<p>
Unique Strings are explicitly created and existing or previously existing Unique Strings can not be re-synthesized. Unlike other string values they are subject to garbage collection.  Because of this, it is useful to use them as keys of WeakMaps. The <a href="doku.php%3Fid=harmony:weak_maps.html" class="wikilink1" title="harmony:weak_maps" onclick="return svchk()" onkeypress="return svchk()">weak maps</a> proposal is extended to allow Unique Strings to be used as WeakMap keys. 
</p>

</div>
<!-- SECTION [11066-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/c/c7667e6098814afae2555fa954dfc57a.xhtml used -->
</body>
</html>
