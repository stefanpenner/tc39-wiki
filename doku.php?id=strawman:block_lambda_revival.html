<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:block_lambda_revival [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:block_lambda_revival&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:block_lambda_revival&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:block_lambda_revival&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2012-01-15T02:39:04+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:block_lambda_revival&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:block_lambda_revival</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:block_lambda_revival" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:block_lambda_revival" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:name_property_of_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:name_property_of_functions">name_property_of_functions</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:parameters_property_of_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:parameters_property_of_functions">parameters_property_of_functions</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:function_to_string.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:function_to_string">function_to_string</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:const_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:const_functions">const_functions</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:block_lambda_revival.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:block_lambda_revival">block_lambda_revival</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="clear"><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:block_lambda_revival.html#prologue" class="toc">Prologue</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:block_lambda_revival.html#proposal" class="toc">Proposal</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:block_lambda_revival.html#syntax" class="toc">Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:block_lambda_revival.html#semantics" class="toc">Semantics</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:block_lambda_revival.html#see_also" class="toc">See Also</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="prologue"></a><h2>Prologue</h2>
<div class="level2">

<p>
 As a mutually exclusive alternative to <a href="doku.php%3Fid=strawman:arrow_function_syntax.html" class="wikilink1" title="strawman:arrow_function_syntax" onclick="return svchk()" onkeypress="return svchk()">arrow function syntax</a>, inspired by the long <a href="https://mail.mozilla.org/listinfo/es-discuss" class="urlextern" target="_blank" title="https://mail.mozilla.org/listinfo/es-discuss" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">es-discuss</a> thread <a href="https://mail.mozilla.org/pipermail/es-discuss/2008-November/008216.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2008-November/008216.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Allen's lambda syntax proposal</a> and echoes and followups since, here is a proposal for Tennent Correspondence Principle, AKA &ldquo;Principle of Abstraction&rdquo; full-strength blocks as better functions, both syntactically and semantically.
</p>

<p>
An essential part of this proposal is a paren-free call syntax, but only for calls bearing block arguments. A more general <a href="doku.php%3Fid=strawman:paren_free.html" class="wikilink1" title="strawman:paren_free" onclick="return svchk()" onkeypress="return svchk()">paren_free</a> call syntax could perhaps be separated and considered on its own, but I&rsquo;m specializing and combining proposals here to work through details holistically, and to emphasize that usability demands this syntax, based on Smalltalk, Ruby, and E expert witness testimony.
</p>

<p>
Also, general paren-free call syntax poses parsing and compatibility challenges that add (I believe) much more complexity than the paren-free block-argument-bearing call syntax proposed here.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2011/05/20 21:52</em>
</p>

</div>

<a name="proposal"></a><h2>Proposal</h2>
<div class="level2">
<pre class="code javascript">let empty = <span class="br0">&#123;</span>||<span class="br0">&#125;</span>;                           <span class="co1">// empty block-lambda (note || not | |)</span>
&nbsp;
assert<span class="br0">&#40;</span>empty<span class="br0">&#40;</span><span class="br0">&#41;</span> === undefined<span class="br0">&#41;</span>;
assert<span class="br0">&#40;</span><span class="kw1">typeof</span> empty === <span class="st0">"function"</span><span class="br0">&#41;</span>;        <span class="co1">// native and does implement [[Call]]</span>
assert<span class="br0">&#40;</span>empty.<span class="me1">length</span> === <span class="nu0">0</span><span class="br0">&#41;</span>;
&nbsp;
let identity = <span class="br0">&#123;</span>|x| x<span class="br0">&#125;</span>;                     <span class="co1">// reformed completion is return value</span>
&nbsp;
assert<span class="br0">&#40;</span>identity<span class="br0">&#40;</span><span class="nu0">42</span><span class="br0">&#41;</span> === <span class="nu0">42</span><span class="br0">&#41;</span>;
assert<span class="br0">&#40;</span>identity.<span class="me1">length</span> === <span class="nu0">1</span><span class="br0">&#41;</span>;
&nbsp;
let a = <span class="br0">&#91;</span><span class="nu0">1</span>, <span class="nu0">2</span>, <span class="nu0">3</span>, <span class="nu0">4</span><span class="br0">&#93;</span>;
let b = a.<span class="me1">map</span> <span class="br0">&#123;</span>|e| e * e<span class="br0">&#125;</span>                   <span class="co1">// paren-free call with block is</span>
                                            <span class="co1">// idiomatic control structure so</span>
                                            <span class="co1">// no semicolon at end</span>
&nbsp;
<span class="kw3">print</span><span class="br0">&#40;</span>b<span class="br0">&#41;</span>;                                   <span class="co1">// [1, 4, 9, 16]</span>
&nbsp;
b = a.<span class="me1">map</span> <span class="br0">&#123;</span>|e|                              <span class="co1">// newline in block ok</span>
           e * e * e<span class="br0">&#125;</span>                       <span class="co1">// newline after ends call</span>
&nbsp;
<span class="kw2">function</span> find_first_odd<span class="br0">&#40;</span>a<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  a.<span class="me1">forEach</span> <span class="br0">&#123;</span> |e, i|
              <span class="kw1">if</span> <span class="br0">&#40;</span>e &amp; <span class="nu0">1</span><span class="br0">&#41;</span> <span class="kw1">return</span> i; <span class="br0">&#125;</span>        <span class="co1">// return from find_first_odd</span>
  <span class="kw1">return</span> -<span class="nu0">1</span>;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">function</span> escape_return<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">return</span> <span class="br0">&#123;</span>|e| <span class="kw1">return</span> e<span class="br0">&#125;</span>;
<span class="br0">&#125;</span>
b = escape_return<span class="br0">&#40;</span><span class="br0">&#41;</span>;
<span class="kw1">try</span> <span class="br0">&#123;</span> b<span class="br0">&#40;</span><span class="nu0">42</span><span class="br0">&#41;</span>; <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>e<span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>                 <span class="co1">// error, return from inactive function</span>
&nbsp;
<span class="kw2">function</span> find_odds_in_arrays<span class="br0">&#40;</span>list,          <span class="co1">// array of arrays</span>
                             skip<span class="br0">&#41;</span>          <span class="co1">// if found, skip rest of current array</span>
<span class="br0">&#123;</span>
  let a = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
  <span class="kw1">for</span> <span class="br0">&#40;</span>let i = <span class="nu0">0</span>; i &lt; list.<span class="me1">length</span>; i++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    list<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">forEach</span> <span class="br0">&#123;</span>
      |e|
      <span class="kw1">if</span> <span class="br0">&#40;</span>e === skip<span class="br0">&#41;</span> <span class="kw1">continue</span>;             <span class="co1">// continue the for loop</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>e &amp; <span class="nu0">1</span><span class="br0">&#41;</span> a.<span class="me1">push</span><span class="br0">&#40;</span>e<span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">return</span> a;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">function</span> find_more_odds<span class="br0">&#40;</span>list, <span class="kw3">stop</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  let a = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
  <span class="kw1">for</span> <span class="br0">&#40;</span>let i = <span class="nu0">0</span>; i &lt; list.<span class="me1">length</span>; i++<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    list<span class="br0">&#91;</span>i<span class="br0">&#93;</span>.<span class="me1">forEach</span> <span class="br0">&#123;</span>
      |e|
      <span class="kw1">if</span> <span class="br0">&#40;</span>e === <span class="kw3">stop</span><span class="br0">&#41;</span> <span class="kw1">break</span>;                <span class="co1">// break from the for loop</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>e &amp; <span class="nu0">1</span><span class="br0">&#41;</span> a.<span class="me1">push</span><span class="br0">&#40;</span>e<span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">return</span> a;
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">function</span> arguments_in_block<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">return</span> <span class="br0">&#123;</span>|| arguments<span class="br0">&#125;</span>;
<span class="br0">&#125;</span>
b = arguments_in_block<span class="br0">&#40;</span><span class="st0">"hi"</span>, <span class="st0">"there"</span><span class="br0">&#41;</span>;
a = b<span class="br0">&#40;</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw3">print</span><span class="br0">&#40;</span>Array.<span class="me1">prototype</span>.<span class="me1">join</span>.<span class="me1">call</span><span class="br0">&#40;</span>a<span class="br0">&#41;</span><span class="br0">&#41;</span>;        <span class="co1">// &quot;hi&quot;,&quot;there&quot;</span>
&nbsp;
<span class="kw2">function</span> this_in_block<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">return</span> <span class="br0">&#123;</span>|| <span class="kw1">this</span><span class="br0">&#125;</span>;
<span class="br0">&#125;</span>
let o = <span class="br0">&#123;</span>m: this_in_block<span class="br0">&#125;</span>;
let b = o.<span class="me1">m</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;
let t = b<span class="br0">&#40;</span><span class="br0">&#41;</span>;
&nbsp;
assert<span class="br0">&#40;</span>t === o<span class="br0">&#41;</span>;
&nbsp;
let p = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
let u = b.<span class="me1">call</span><span class="br0">&#40;</span>p<span class="br0">&#41;</span>;
&nbsp;
assert<span class="br0">&#40;</span>u === o<span class="br0">&#41;</span>;
&nbsp;
<span class="coMULTI">/* Another block-lambdas example, courtesy Claus Reinke. */</span>
&nbsp;
<span class="kw2">function</span> A<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  let ret = <span class="br0">&#123;</span>|x| <span class="kw1">return</span> x; <span class="br0">&#125;</span>;               <span class="co1">// Tennent &quot;sequel&quot;</span>
  let inc = <span class="br0">&#123;</span>|x| x+<span class="nu0">1</span> <span class="br0">&#125;</span>;
  let j = <span class="nu0">0</span>;
  <span class="kw1">while</span> <span class="br0">&#40;</span><span class="kw2">true</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>j &gt; <span class="nu0">3</span><span class="br0">&#41;</span>
      ret<span class="br0">&#40;</span>j<span class="br0">&#41;</span>;                               <span class="co1">// leave function A</span>
    j = inc<span class="br0">&#40;</span>j<span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="coMULTI">/* A Smalltalk ifTrue:ifFalse: homage requested by Peter Michaux. */</span>
&nbsp;
Object.<span class="me1">defineProperty</span><span class="br0">&#40;</span>
  Boolean.<span class="me1">prototype</span>,
  <span class="st0">'ifElse'</span>,
  <span class="br0">&#123;</span>
    value: <span class="kw2">function</span> <span class="br0">&#40;</span>ifTrue, ifFalse<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">return</span> <span class="kw1">this</span> ? ifTrue<span class="br0">&#40;</span><span class="br0">&#41;</span> : ifFalse<span class="br0">&#40;</span><span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#41;</span>;
&nbsp;
<span class="kw3">print</span><span class="br0">&#40;</span><span class="kw2">false</span>.<span class="me1">ifElse</span> <span class="br0">&#123;</span>|| <span class="st0">"true"</span><span class="br0">&#125;</span> <span class="br0">&#123;</span>|| <span class="st0">"false"</span><span class="br0">&#125;</span><span class="br0">&#41;</span>; <span class="co1">// &quot;false&quot;</span>
<span class="kw3">print</span><span class="br0">&#40;</span><span class="kw2">true</span>.<span class="me1">ifElse</span> <span class="br0">&#123;</span>|| <span class="st0">"true"</span><span class="br0">&#125;</span> <span class="br0">&#123;</span>|| <span class="st0">"false"</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;  <span class="co1">// &quot;true&quot;</span>
&nbsp;</pre>
</div>

<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">

<p>
 Change all uses of <em>AssignmentExpression</em> outside of the <em>Expression</em> sub-grammar to <em>InitialValue</em>:
</p>
<pre class="code ebnf">ElementList :                               // See 11.1.4
    Elision_opt InitialValue
    ElementList , Elision_opt InitialValue

PropertyAssignment :                        // See 11.1.5
    PropertyName : InitialValue

ArgumentList :                              // See 11.2
    InitialValue
    ArgumentList , InitialValue

Initialiser :                               // See 12.2
    = InitialValue

InitialiserNoIn :                           // See 12.2
    = InitialValueNoIn

InitialValue :
    AssignmentExpression
    CallWithBlockArguments

Statement :
    ...
    CallWithBlockArguments
    LeftHandSideExpression = CallWithBlockArguments
    LeftHandSideExpression AssignmentOperator CallWithBlockArguments

MemberExpression :
    ...
    BlockLambda

PrimaryExpression :
    ...
    ( CallWithBlockArguments )

CallWithBlockArguments :
    LeftHandSideExpression [no LineTerminator here] BlockArguments

BlockArguments :
    BlockLambda
    BlockArguments [no LineTerminator here] BlockLambda

BlockLambda :
    { || StatementList_opt }
    { | BlockParameterList_opt | StatementList_opt }

BlockParameterList :
    BlockParameter
    BlockParameterList , BlockParameter

BlockParameter :
    Identifier BlockParameterInitialiser_opt
    Pattern BlockParameterInitialiser_opt

BlockParameterInitialiser :
    = BitwiseXorExpression
</pre>
<p>
Notes: 
</p>
<ul>
<li class="level1"><div class="li"> The grammar above confines paren-free calls with block-lambda initial arguments and comma-free horizontal spaces only between arguments to certain contexts:</div>
<ul>
<li class="level2"><div class="li"> Initial values, in object and array initialisers, argument lists, default parameter values, and variable declaration initialiser.</div>
</li>
<li class="level2"><div class="li"> Statements, either as the whole of an expression statement variant, or on the right of a left-hand side expression followed by <code>=</code> or an <em>AssignmentOperator</em>.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> The grammar changes show <em>Pattern</em> for <a href="doku.php%3Fid=harmony:destructuring.html" class="wikilink1" title="harmony:destructuring" onclick="return svchk()" onkeypress="return svchk()">destructuring</a>, but I left out <a href="doku.php%3Fid=harmony:rest_parameters.html" class="wikilink1" title="harmony:rest_parameters" onclick="return svchk()" onkeypress="return svchk()">rest_parameters</a> syntax for simplicity&rsquo;s sake.</div>
</li>
<li class="level1"><div class="li"> With GLR parsing for the spec grammar, we could consider, e.g. <code>(x) {x}</code> instead of <code>{|x| x}</code> with <em>LineTerminator</em> excluded between parameters and body.</div>
<ul>
<li class="level2"><div class="li"> But this syntax does not look like a block, and it may lead to missing newline errors between calls and blocks being parsed without error.</div>
</li>
<li class="level2"><div class="li"> So this is a cautionary tale: we do not want something that looks like a function expression more than a block, given TCP purity.</div>
</li>
</ul>
</li>
</ul>

</div>

<a name="semantics"></a><h2>Semantics</h2>
<div class="level2">

<p>
 <strong>8.6.2 Object Internal Properties and Methods</strong>
</p>

<p>
<strong>Table 9 &ndash; Internal Properties Only Defined for Some Objects</strong> 
</p>
<table class="inline">
	<tr>
		<th>Internal Property</th><th>Value Type Domain</th><th>Description</th>
	</tr>
	<tr>
		<td><code>[[Call]]</code></td><td>SpecOp(any, a List of any) → any or Reference or Completion</td><td>Executes code associated with the object. Invoked via a function call expression. The arguments to the SpecOp are this object and a list containing the arguments passed to the function call expression. Objects that implement this internal method are callable. Only callable objects that are host objects may return Reference values. Only block-lambda objects (11.1.7) may return Completion values (8.9)</td>
	</tr>
</table>
<br />

<p>
 <strong>11.1.7 Block Lambda</strong>
</p>

<p>
The production <em>BlockLambda</em><code> : { | </code><em>BlockParameterList</em><code><sub>opt</sub> | </code><em>StatementList</em><code><sub>opt</sub> }</code> is evaluated as follows: 
</p>
<ol>
<li class="level1"><div class="li"> Create a new native ECMAScript object and let <em>B</em> be that object.</div>
</li>
<li class="level1"><div class="li"> Set all the internal methods of <em>B</em> as described in 8.12.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[Class]]</code> internal property of <em>B</em> to &ldquo;Function&rdquo;.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[Prototype]]</code> internal property of <em>B</em> to the standard built-in Function prototype object as specified in 15.3.3.1.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[Call]]</code> internal property of <em>B</em> as described in 11.1.7.1.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[Scope]]</code> internal property of <em>B</em> to the LexicalEnvironment of the running execution context.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[Context]]</code> internal property of <em>B</em> to the running execution context.</div>
</li>
<li class="level1"><div class="li"> Let <em>names</em> be a List containing, in left to right textual order, the Strings corresponding to the identifiers of <em>BlockParameterList</em>. If no parameters are specified, let <em>names</em> be the empty list.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[FormalParameters]]</code> internal property of <em>B</em> to <em>names</em>.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[Code]]</code> internal property of <em>B</em> to <em>StatementList</em><code><sub>opt</sub></code>. If there is no <em>StatementList</em>, set <code>[[Code]]</code> to an <em>EmptyStatement</em>.</div>
</li>
<li class="level1"><div class="li"> Set the <code>[[Extensible]]</code> internal property of <em>B</em> to true.</div>
</li>
<li class="level1"><div class="li"> Let <em>len</em> be the number of formal parameters specified in <em>BlockParameterList</em>. If no parameters are specified, let <em>len</em> be 0.</div>
</li>
<li class="level1"><div class="li"> Call the <code>[[DefineOwnProperty]]</code> internal method of <em>B</em> with arguments <code><strong>&ldquo;length&rdquo;</strong></code>, Property Descriptor <code>{[[Value]]: </code><em>len</em><code>, [[Writable]]: <strong>false</strong>, [[Enumerable]]: <strong>false</strong>, [[Configurable]]: <strong>false</strong>}</code>, and <code><strong>false</strong></code>.</div>
</li>
<li class="level1"><div class="li"> Return the block-lambda object <em>B</em>.</div>
</li>
</ol>

<p>
 Block-lambda parameter lists should support everything in Harmony that one can do in function formal parameter lists: <a href="doku.php%3Fid=harmony:parameter_default_values.html" class="wikilink1" title="harmony:parameter_default_values" onclick="return svchk()" onkeypress="return svchk()">parameter default values</a>, <a href="doku.php%3Fid=harmony:rest_parameters.html" class="wikilink1" title="harmony:rest_parameters" onclick="return svchk()" onkeypress="return svchk()">rest parameters</a>, and <a href="doku.php%3Fid=harmony:destructuring.html" class="wikilink1" title="harmony:destructuring" onclick="return svchk()" onkeypress="return svchk()">destructuring</a>.
</p>

<p>
The <em>BlockParameterList</em>, <em>BlockParameter</em>, and <em>BlockParameterInitialiser</em> productions have straightforward semantics, elided here mainly because I don&rsquo;t want to duplicate all the existing <em>FormalParameterList</em>, etc. semantics.
</p>

<p>
<strong>11.1.7.1 <code>[[Call]]</code></strong>
</p>

<p>
When the <code>[[Call]]</code> internal method for a block-lambda object <em>B</em> is called with a list of arguments, the following steps are taken: 
</p>
<ol>
<li class="level1"><div class="li"> Let <em>funcCtx</em> be the result of establishing a new execution context for function code using the value of <em>B</em>&lsquo;s <code>[[FormalParameters]]</code> internal property, the passed arguments List <em>args</em>, and the <strong>this</strong> value given by the ThisBinding component of the execution context in <em>B</em>&lsquo;s <code>[[Context]]</code> internal property.</div>
</li>
<li class="level1"><div class="li"> Let <em>result</em> be the result of evaluating the <em>StatementList</em> or <em>EmptyStatement</em> that is the value of <em>B</em>&lsquo;s <code>[[Code]]</code> internal property.</div>
</li>
<li class="level1"><div class="li"> Exit the execution context <em>funcCtx</em>, restoring the previous execution context.</div>
</li>
<li class="level1"><div class="li"> If <em>result</em>.type is <strong>normal</strong> and <em>result</em>.value is <strong>empty</strong> then return (<strong>normal</strong>, <code><strong>undefined</strong></code>, <strong>empty</strong>).</div>
</li>
<li class="level1"><div class="li"> Else if <em>result</em>.type is <strong>break</strong>, <strong>continue</strong>, or <strong>return</strong> and the execution context in <em>B</em>&lsquo;s <code>[[Context]]</code> internal property has already exited, throw a <strong>TypeError</strong> exception.</div>
</li>
<li class="level1"><div class="li"> Else if <em>result</em>.type is <strong>break</strong> or <strong>continue</strong> and evaluation of the label-set <em>result</em>.target has already completed, throw a <strong>TypeError</strong> exception.</div>
</li>
<li class="level1"><div class="li"> Else return the Completion value <em>result</em>.</div>
</li>
</ol>

<p>
 TODO: forbid <code>var</code> in block-lambdas via early error (yeah!)
</p>

<p>
<strong>11.2.3 Function Calls</strong>
</p>

<p>
<em>...</em>
</p>

<p>
TODO: Process Completion return type
</p>

<p>
The production <em>CallWithBlockArguments</em><code> : </code><em>LeftHandSideExpression</em><code> [no </code><em>LineTerminator</em><code> here] </code><em>BlockArguments</em> is evaluated in exactly the same manner, except that <em>BlockArguments</em> is evaluated instead of <em>Arguments</em> in step 3.
</p>

<p>
(This paragraph goes just before the NOTE at the bottom of 11.2.3.)
</p>

<p>
<strong>11.2.4 Argument Lists</strong>
</p>

<p>
<em>...</em>
</p>

<p>
The production <em>BlockArguments</em><code> : </code><em>BlockLambda</em> is evaluated as follows: 
</p>
<ol>
<li class="level1"><div class="li"> Let <em>ref</em> be the result of evaluating <em>BlockLambda</em>.</div>
</li>
<li class="level1"><div class="li"> Let <em>arg</em> be GetValue(<em>ref</em>).</div>
</li>
<li class="level1"><div class="li"> Return a List whose sole item is <em>arg</em>.</div>
</li>
</ol>

<p>
 The production <em>BlockArguments</em><code> : </code><em>BlockArguments</em><code> [no </code><em>LineTerminator</em><code> here] </code><em>BlockLambda</em> is evaluated as follows: 
</p>
<ol>
<li class="level1"><div class="li"> Let <em>precedingArgs</em> be the result of evaluating <em>BlockArguments</em>.</div>
</li>
<li class="level1"><div class="li"> Let <em>ref</em> be the result of evaluating <em>BlockLambda</em>.</div>
</li>
<li class="level1"><div class="li"> Let <em>arg</em> be GetValue(<em>ref</em>).</div>
</li>
<li class="level1"><div class="li"> Return a List whose length is one greater than the length of <em>precedingArgs</em> and whose items are the items of <em>precedingArgs</em>, in order, followed at the end by <em>arg</em> which is the last item of the new list.</div>
</li>
</ol>

<p>
 <strong>12.7 The <code>continue</code> Statement</strong>
</p>

<p>
The verbiage about &ldquo;(but not crossing function boundaries)&rdquo; should be clarified to exclude block-lambda boundaries, which are treated like <em>Block</em> boundaries.
</p>

<p>
<strong>12.8 The <code>break</code> Statement</strong>
</p>

<p>
The verbiage about &ldquo;(but not crossing function boundaries)&rdquo; should be clarified to exclude block-lambda boundaries, which are treated like <em>Block</em> boundaries.
</p>

<p>
<strong>12.9 The <code>return</code> Statement</strong>
</p>

<p>
The verbiage about &ldquo;A return statement causes a function to cease execution and return a value to the caller&rdquo; should be clarified to include <code>return</code> in block-lambda attempting to exit the nearest enclosing <em>FunctionBody</em>.
</p>

<p>
Notes: 
</p>
<ul>
<li class="level1"><div class="li"> <a href="doku.php%3Fid=strawman:completion_reform.html" class="wikilink1" title="strawman:completion_reform" onclick="return svchk()" onkeypress="return svchk()">completion reform</a> should be considered since the completion value is the return value for block lambdas.</div>
</li>
<li class="level1"><div class="li"> Existing semantic early error checks on label use, <code>break</code> outside of <code>switch</code> and loop, etc. work as before, but cross the block-lambda boundary.</div>
</li>
<li class="level1"><div class="li"> The runtime semantics for block-lambda <code>[[Call]]</code> must handle <code>return</code> from an outer function activation that has already returned.</div>
</li>
</ul>

</div>

<a name="see_also"></a><h2>See Also</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="doku.php%3Fid=strawman:arrow_function_syntax.html" class="wikilink1" title="strawman:arrow_function_syntax" onclick="return svchk()" onkeypress="return svchk()">arrow function syntax</a>, an alternative considering only syntax, without new semantics</div>
</li>
<li class="level1"><div class="li"> <a href="http://lists.squeakfoundation.org/pipermail/squeak-dev/2001-April/008237.html" class="urlextern" target="_blank" title="http://lists.squeakfoundation.org/pipermail/squeak-dev/2001-April/008237.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Allen's &quot;Comments on Smalltalk block closure designs, part 1&quot;</a></div>
</li>
</ul>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/2/2a4a47c3633dc89352e5f5b761c42372.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/block_lambda_revival.txt &middot; Last modified: 2012/01/15 02:39 by brendan      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:block_lambda_revival" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:block_lambda_revival" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:block_lambda_revival" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:block_lambda_revival" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:block_lambda_revival.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Ablock_lambda_revival&amp;1454275634" width="1" height="1" alt=""  /></body>
</html>
