<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:dicts&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:dicts&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="clear"><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#dicts" class="toc">Dicts</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#type" class="toc">Type</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#keys" class="toc">Keys</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#enumeration" class="toc">Enumeration</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#attributes" class="toc">Attributes</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#syntax" class="toc">Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#alternative_syntaxen" class="toc">Alternative syntaxen</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:dicts&amp;do=export_html.html#comments" class="toc">Comments</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="dicts"></a><h2>Dicts</h2>
<div class="level2">

<p>
 ECMAScript&rsquo;s objects and functions have a number of special cases (both in the official spec and in unofficial extensions) that can become hazards in practical programming. For example, prototype inheritance as well as magic properties such as <code>__proto__</code> pollute object tables and can introduce bugs when people use objects as tables.
</p>

<p>
At the same time, the <a href="doku.php%3Fid=strawman:tuples.html" class="wikilink1" title="strawman:tuples" onclick="return svchk()" onkeypress="return svchk()">tuples</a>, <a href="doku.php%3Fid=strawman:records.html" class="wikilink1" title="strawman:records" onclick="return svchk()" onkeypress="return svchk()">records</a> and <a href="doku.php%3Fid=strawman:shorter_function_syntax.html" class="wikilink1" title="strawman:shorter_function_syntax" onclick="return svchk()" onkeypress="return svchk()">sharp functions</a> proposals define new core primitive types that could be used to define the core semantics of objects and functions. They also provide cleaner building blocks that are useful for programmers.
</p>

<p>
This strawman proposes a new primitive called <em>dicts</em>, which conceptually represent the own-property table of objects. An object can be conceptualized as an immutable <a href="doku.php%3Fid=strawman:records.html" class="wikilink1" title="strawman:records" onclick="return svchk()" onkeypress="return svchk()">record</a> of internal properties, including one property mapping to a dict containing the object&rsquo;s own-property descriptors, and another property pointing to a prototype object.
</p>

<p>
Dicts are mutable and can grown and shrink. But they do not contain a prototype or any of ECMAScript&rsquo;s traditional internal properties.
</p>
<pre class="code javascript"><span class="kw2">var</span> table = <span class="br0">&#91;</span>foo: <span class="st0">"howdy"</span>, <span class="nu0">42</span>: <span class="kw2">true</span>, <span class="st0">"hey, cool!"</span>: <span class="st0">"not bad, huh?"</span><span class="br0">&#93;</span>;
table<span class="br0">&#91;</span><span class="st0">"foo"</span><span class="br0">&#93;</span>; <span class="co1">// &quot;howdy&quot;</span>
<span class="kw1">delete</span> table.<span class="me1">foo</span>;
table.<span class="me1">foo</span>; <span class="co1">// undefined</span>
<span class="kw1">typeof</span> table; <span class="co1">// &quot;dict&quot;</span></pre>
</div>
<!-- SECTION [1-1365] -->
<a name="type"></a><h2>Type</h2>
<div class="level2">

<p>
 The <code>typeof</code> operator returns <code>&ldquo;dict&rdquo;</code> for dict values.
</p>

<p>
Dicts are not objects; the object operations (such as <code>Object.getPrototypeOf</code> or <code>Object.getOwnPropertyDescriptor</code>) do not work for dicts.
</p>

</div>
<!-- SECTION [1366-1588] -->
<a name="keys"></a><h2>Keys</h2>
<div class="level2">

<p>
 The allowable keys of a dict are exactly the same as the allowable keys of an object.
</p>

</div>
<!-- SECTION [1589-1693] -->
<a name="enumeration"></a><h2>Enumeration</h2>
<div class="level2">

<p>
 The enumeration order of a dict is exactly the same as the <a href="doku.php%3Fid=strawman:enumeration.html" class="wikilink1" title="strawman:enumeration" onclick="return svchk()" onkeypress="return svchk()">enumeration</a> order of an object, but of course without walking the prototype chain.
</p>

</div>
<!-- SECTION [1694-1874] -->
<a name="attributes"></a><h2>Attributes</h2>
<div class="level2">

<p>
 Dict properties do not have attributes. All properties of a dict are treated as writable and enumerable.
</p>

</div>
<!-- SECTION [1875-2004] -->
<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">

<p>
 The syntax of dict literals is analogous to that of object literals, but with square brackets and without the additional syntax for getters and setters.
</p>

<p>
(Parsers only need one token of lookahead when reading the first token after the left-bracket, to determine whether the next token is a colon.)
</p>

<p>
An empty dict is written <code>[| |]</code>.
</p>

</div>
<!-- SECTION [2005-2360] -->
<a name="alternative_syntaxen"></a><h2>Alternative syntaxen</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> optionally allow the <code>|</code> tokens for non-empty dicts, for consistency</div>
</li>
<li class="level1"><div class="li"> mandate the <code>|</code> regardless, for consistency</div>
</li>
<li class="level1"><div class="li"> switch to <code>{| ... |}</code> and make them mandatory, for consistency</div>
</li>
</ul>

</div>
<!-- SECTION [2361-2589] -->
<a name="comments"></a><h2>Comments</h2>
<div class="level2">

<p>
 +1 on this strawman. A few thoughts and issues beyond syntax: 
</p>
<ul>
<li class="level1"><div class="li"> Shared mutable value types may give some folks pause, but this is the big, obvious, &ldquo;dict-not-object&rdquo; use-case, and poorly served by object.</div>
</li>
<li class="level1"><div class="li"> We may want a method to wrap a dict into an object that can be optimized to adopt the dict if it is about to become garbage (has only one reference via the argument to this method), so the object can then be frozen, etc.</div>
</li>
<li class="level1"><div class="li"> Given the sharp syntax proposed for <a href="doku.php%3Fid=strawman:records.html" class="wikilink1" title="strawman:records" onclick="return svchk()" onkeypress="return svchk()">records</a>, <a href="doku.php%3Fid=strawman:tuples.html" class="wikilink1" title="strawman:tuples" onclick="return svchk()" onkeypress="return svchk()">tuples</a>, etc., <code>#[a: 1, b: 2, c: 3]</code> is an easy and complementary extension to this proposal that allows frozen-from-birth dicts and may relieve need for the last bullet&rsquo;s method.</div>
</li>
<li class="level1"><div class="li"> Without object clothing (in particular delegation to <code>Object.prototype</code>), what does the spec&rsquo;s internal <code>ToString</code> abstract operation do with a <code>dict</code>?</div>
</li>
</ul>

<p>
  &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2011/03/13 20:15</em> 
</p>

</div>
<!-- SECTION [2590-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/2/2ac3a4d63df8fb6b14c6d282c1743a5d.xhtml used -->
</body>
</html>
