<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=harmony:modules&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=harmony" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=harmony:modules&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=harmony:modules&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#this_page_is_no_longer_current" class="toc">THIS PAGE IS NO LONGER CURRENT</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#modules" class="toc">Modules</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#goals" class="toc">Goals</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#terminology" class="toc">Terminology</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#syntax" class="toc">Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#quick_examples" class="toc">Quick examples</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#module_declarations" class="toc">Module declarations</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#inline_module_declarations" class="toc">Inline module declarations</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#external_module_load" class="toc">External module load</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#import_declarations" class="toc">Import declarations</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#export_declarations" class="toc">Export declarations</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#compile-time_resolution_and_linking" class="toc">Compile-time resolution and linking</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#run-time_execution" class="toc">Run-time execution</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#first-class_module_references" class="toc">First-class module references</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#module_instance_objects" class="toc">Module instance objects</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#reflective_evaluation" class="toc">Reflective evaluation</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules&amp;do=export_html.html#this" class="toc">This</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="this_page_is_no_longer_current"></a><h1>THIS PAGE IS NO LONGER CURRENT</h1>
<div class="level1">

<p>
 <a href="lib/exe/detail.php%3Fid=harmony%253Amodules&amp;cache=cache&amp;media=harmony:warning.png.html" class="media" title="harmony:warning.png" onclick="return svchk()" onkeypress="return svchk()"><img src="lib/exe/fetch.php%3Fw=100&amp;h=&amp;cache=cache&amp;media=harmony:warning.png" class="media" alt="" width="100" /></a> <strong>WARNING:</strong> This page is <strong>out of date</strong>. Please see the ES6 <a href="doku.php%3Fid=harmony:specification_drafts.html" class="wikilink1" title="harmony:specification_drafts" onclick="return svchk()" onkeypress="return svchk()">specification drafts</a> for up-to-date information. This page is here only as an archive.
</p>

</div>
<!-- SECTION [1-230] -->
<a name="modules"></a><h2>Modules</h2>
<div class="level2">

<p>
 This proposal describes a module system for ECMAScript. It describes the semantics of the core module system. See the <a href="doku.php%3Fid=harmony:module_loaders.html" class="wikilink1" title="harmony:module_loaders" onclick="return svchk()" onkeypress="return svchk()">module loaders</a> spec for the companion proposal to provide a dynamic, reflective <acronym title="Application Programming Interface">API</acronym> for loading modules.
</p>

<p>
See the <a href="doku.php%3Fid=harmony:modules_examples.html" class="wikilink1" title="harmony:modules_examples" onclick="return svchk()" onkeypress="return svchk()">modules examples</a> page for highlights of the module system.
</p>

<p>
See the <a href="doku.php%3Fid=harmony:modules_rationale.html" class="wikilink1" title="harmony:modules_rationale" onclick="return svchk()" onkeypress="return svchk()">modules rationale</a> page for a description of the design rationale.
</p>

<p>
See the <a href="doku.php%3Fid=harmony:modules_semantics.html" class="wikilink1" title="harmony:modules_semantics" onclick="return svchk()" onkeypress="return svchk()">modules semantics</a> page for a more detailed description of the semantics.
</p>

<p>
See <a href="https://gist.github.com/wycats/51c96e3adcdb3a68cbc3" class="urlextern" target="_blank" title="https://gist.github.com/wycats/51c96e3adcdb3a68cbc3" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Yehuda Katz's essay</a> for a discussion of common use cases and interoperability with existing module systems.
</p>

</div>
<!-- SECTION [231-885] -->
<a name="goals"></a><h2>Goals</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Obviate need for globals</div>
</li>
<li class="level1"><div class="li"> Orthogonality from existing features</div>
</li>
<li class="level1"><div class="li"> Smooth refactoring from global code to modular code</div>
</li>
<li class="level1"><div class="li"> Smooth interoperability with existing <acronym title="JavaScript">JS</acronym> module systems like AMD, CommonJS, and Node.js</div>
</li>
<li class="level1"><div class="li"> Fast compilation</div>
</li>
<li class="level1"><div class="li"> Simplicity and usability</div>
</li>
<li class="level1"><div class="li"> Standardized protocol for sharing libraries</div>
</li>
<li class="level1"><div class="li"> Compatibility with browser and non-browser environments</div>
</li>
<li class="level1"><div class="li"> Easy asynchronous external loading</div>
</li>
</ul>

</div>
<!-- SECTION [886-1320] -->
<a name="terminology"></a><h2>Terminology</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <em>Module</em>: A unit of source contained within a module declaration or within an externally-loaded file.</div>
</li>
<li class="level1"><div class="li"> <em>Module instance</em>: An evaluated module, linked to other modules and containing lexically encapsulated data/state as well as exported bindings.</div>
</li>
<li class="level1"><div class="li"> <em>Module instance object</em>: A first-class object that reflects the exported bindings of a module instance.</div>
</li>
<li class="level1"><div class="li"> <em>Module binding</em>: A binding in a scope chain record that maps to a statically loaded module.</div>
</li>
</ul>

</div>
<!-- SECTION [1321-1816] -->
<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">

<p>
 The basic syntax of ES programs is extended as follows (the <code>Script</code> and <code>ScriptElement</code> non-terminals replace the ES5 <code>Program</code> and <code>ProgramElement</code>):
</p>
<pre class="code">
Script         ::= ScriptElement*                                                 // script

ScriptElement  ::= Statement                                                      // statement
                |  VariableDeclaration                                            // var/let/const declaration
                |  FunctionDeclaration                                            // function declaration
                |  ClassDeclaration                                               // class declaration
                |  ImportDeclaration                                              // import declaration
                |  ModuleDeclaration                                              // module declaration

ModuleDeclaration ::= &quot;module&quot; [NoNewline] StringLiteral &quot;{&quot; ModuleBody &quot;}&quot;       // module declaration
                   |  &quot;module&quot; Identifier &quot;from&quot; StringLiteral &quot;;&quot;                // local module binding

ModuleBody    ::= ModuleElement*                                                  // module body

ModuleElement ::= ScriptElement                                                   // statements, declarations
               |  ExportDeclaration                                               // export declarations

ExportDeclaration  ::=  &quot;export&quot; ExportSpecifierSet (&quot;from&quot; ModuleSpecifier)? &quot;;&quot; // named exports
                    |   &quot;export&quot; &quot;default&quot; AssignmentExpression &quot;;&quot;               // default export
                    |   &quot;export&quot; VariableDeclaration                              // exported var/let/const declaration
                    |   &quot;export&quot; FunctionDeclaration                              // exported function declaration
                    |   &quot;export&quot; ClassDeclaration                                 // exported class declaration

ExportSpecifierSet ::=  &quot;{&quot; (ExportSpecifier (&quot;,&quot; ExportSpecifier)* &quot;,&quot;?)? &quot;}&quot;    // named exports
                    |   &quot;*&quot;                                                       // batch export

ExportSpecifier    ::=  Identifier (&quot;as&quot; IdentifierName)?                         // exported name

ModuleSpecifier ::= StringLiteral                                                 // module name reference

ImportDeclaration ::= &quot;import&quot; ImportSpecifierSet &quot;from&quot; ModuleSpecifier &quot;;&quot;      // explicit import declaration
                   |  &quot;import&quot; ModuleSpecifier &quot;;&quot;                                // depend on the named module but don't import any bindings

ImportSpecifierSet ::=   Identifier                                               // default import
                    |    &quot;{&quot; (ImportSpecifier (&quot;,&quot; ImportSpecifier)* &quot;,&quot;?)? &quot;}&quot;   // named imports

ImportSpecifier    ::=   Identifier (&quot;as&quot; Identifier)?                            // named import
                    |    ReservedWord &quot;as&quot; Identifier                             // keyword-named import
</pre>

<p>
The two important entry points for the grammar are <code>Script</code> and <code>ModuleBody</code>. A top-level program, such as a <code>script</code> tag in <acronym title="HyperText Markup Language">HTML</acronym>, will contain a <code>Script</code>. An external module file, such as one imported with the <code>import</code> declaration, will contain a <code>ModuleBody</code>. That is, when writing a module in an individual file, the file contents are treated as if they were within an implicit <code>module</code> declaration.
</p>

</div>
<!-- SECTION [1817-5287] -->
<a name="quick_examples"></a><h2>Quick examples</h2>
<div class="level2">
<pre class="code javascript"><span class="kw2">import</span> $ from <span class="st0">"jquery"</span>;                    <span class="co1">// import the default export of a module</span>
module crypto from <span class="st0">"crypto"</span>;               <span class="co1">// binding an external module to a variable</span>
<span class="kw2">import</span> <span class="br0">&#123;</span> encrypt, decrypt <span class="br0">&#125;</span> from <span class="st0">"crypto"</span>; <span class="co1">// binding a module's exports to variables</span>
<span class="kw2">import</span> <span class="br0">&#123;</span> encrypt <span class="kw1">as</span> enc <span class="br0">&#125;</span> from <span class="st0">"crypto"</span>;   <span class="co1">// binding and renaming one of a module's exports</span>
<span class="kw2">export</span> * from <span class="st0">"crypto"</span>;                    <span class="co1">// re-exporting another module's exports</span>
<span class="kw2">export</span> <span class="br0">&#123;</span> foo, bar <span class="br0">&#125;</span> from <span class="st0">"crypto"</span>;         <span class="co1">// re-exporting specified exports from another module</span></pre>
</div>
<!-- SECTION [5288-5874] -->
<a name="module_declarations"></a><h2>Module declarations</h2>
<div class="level2">

<p>
 Module declarations can only appear at the top level of a program or module body. They are compiled and linked during the compilation of their containing program or module.
</p>

</div>
<!-- SECTION [5875-6081] -->
<a name="inline_module_declarations"></a><h2>Inline module declarations</h2>
<div class="level2">

<p>
 Modules can be declared inline: 
</p>
<pre class="code javascript">module <span class="st0">"foo"</span> <span class="br0">&#123;</span>
    <span class="kw2">export</span> let x = <span class="nu0">42</span>;
<span class="br0">&#125;</span></pre>
</div>
<!-- SECTION [6082-6221] -->
<a name="external_module_load"></a><h2>External module load</h2>
<div class="level2">

<p>
 Modules can be loaded from external resources:
</p>
<pre class="code javascript"><span class="kw2">import</span> <span class="br0">&#123;</span> y <span class="br0">&#125;</span> from <span class="st0">"foo"</span>;</pre>
<p>
The external module is fetched and compiled during the compilation of the loading module. (Depending on the current module loader, this may trigger user-defined compilation hooks. See <a href="doku.php%3Fid=harmony:module_loaders.html" class="wikilink1" title="harmony:module_loaders" onclick="return svchk()" onkeypress="return svchk()">module loaders</a> for more information.)
</p>

<p>
External modules do not name themselves; rather, their files simply contain the contents of the module. This prevents wasteful indentation and allows clients to determine the most appropriate local name for the third-party libraries they load.
</p>

<p>
An external module is compiled and executed in a fresh scope chain that extends only the global scope. This means that external modules have access to standard bindings, but their own bindings do not modify the global scope (i.e., their top-level variables are local to the module.)
</p>

<p>
Depending on the <a href="doku.php%3Fid=harmony:module_loaders.html" class="wikilink1" title="harmony:module_loaders" onclick="return svchk()" onkeypress="return svchk()">module loader</a>, multiple module <acronym title="Uniform Resource Locator">URL</acronym> references may resolve to a shared, single module instance. In this case, the first reference that is evaluated executes the module body, and subsequent references simply produce the same instance without re-executing the body.
</p>

<p>
A module can declare a dependency on another module without actually forcing the dependent module to be executed. In particular, this ensures that at runtime a synchronous to <code>System.get</code> will succeed.
</p>
<pre class="code javascript"><span class="kw2">import</span> <span class="st0">"foo"</span>;                <span class="co1">// fetches &quot;foo&quot; at compile time</span>
&nbsp;
let foo = System.<span class="me1">get</span><span class="br0">&#40;</span><span class="st0">"foo"</span><span class="br0">&#41;</span>; <span class="co1">// succeeds at runtime</span></pre>
</div>
<!-- SECTION [6222-7759] -->
<a name="import_declarations"></a><h2>Import declarations</h2>
<div class="level2">

<p>
 Import declarations bind another module&rsquo;s exports as local variables. Imported variables may be locally renamed to avoid conflicts.
</p>

<p>
If a module defines a default export:
</p>
<pre class="code javascript">module <span class="st0">"foo"</span> <span class="br0">&#123;</span>
    <span class="kw2">export</span> <span class="kw2">default</span> <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> console.<span class="me1">log</span><span class="br0">&#40;</span><span class="st0">"hello!"</span><span class="br0">&#41;</span> <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
<p>
then you can import that default export by omitting the curly braces:
</p>
<pre class="code javascript"><span class="kw2">import</span> foo from <span class="st0">"foo"</span>;
foo<span class="br0">&#40;</span><span class="br0">&#41;</span>; <span class="co1">// hello!</span></pre>
<p>
The static variable resolution and linking pass checks for conflicts in imported variable names. If there is a conflict between two imported names, or an imported name and another local binding, then it is a compile-time error.
</p>

</div>
<!-- SECTION [7760-8432] -->
<a name="export_declarations"></a><h2>Export declarations</h2>
<div class="level2">

<p>
 Export declarations declare that a top-level declaration in a module is visible externally to the module. The set of exports of a module is fixed at the module&rsquo;s compile-time. Other modules can read (get) the module exports but cannot modify (set) them. Exports can be renamed so that their external name is different from their local name.
</p>

</div>
<!-- SECTION [8433-8809] -->
<a name="compile-time_resolution_and_linking"></a><h2>Compile-time resolution and linking</h2>
<div class="level2">

<p>
 Compilation resolves and validates all variable definitions and references. Linking also happens at compile-time; linking resolves and validates all module imports and exports.
</p>

</div>
<!-- SECTION [8810-9036] -->
<a name="run-time_execution"></a><h2>Run-time execution</h2>
<div class="level2">

<p>
 At run-time, the program is evaluated top-down. Before the program body begins executing, all child modules are instantiated, which is a recursive operation that transitively instantiates all descendent modules. Module instantiation initializes all module top-level <code>function</code> bindings, and initializes all variable bindings to the undefined value. Each externally-required module is executed the first time a module binding requires it.
</p>

</div>
<!-- SECTION [9037-9509] -->
<a name="first-class_module_references"></a><h2>First-class module references</h2>
<div class="level2">

<p>
 Modules bound to variables with the <code>module</code> keyword are bound in the same scope chain as other bindings. At run-time, a reference to a module returns a module instance object, which is a run-time reflection of the module instance.
</p>

</div>
<!-- SECTION [9510-9787] -->
<a name="module_instance_objects"></a><h2>Module instance objects</h2>
<div class="level2">

<p>
 A module instance object is a prototype-less object that provides read-only access to the exports of the module. All of the exports are provided as getters without setters.
</p>

</div>
<!-- SECTION [9788-9999] -->
<a name="reflective_evaluation"></a><h2>Reflective evaluation</h2>
<div class="level2">

<p>
 Reflective evaluation, via <code>eval</code> or the <a href="doku.php%3Fid=harmony:module_loaders.html" class="wikilink1" title="harmony:module_loaders" onclick="return svchk()" onkeypress="return svchk()">module loading API</a> starts a new compilation and linking phase for the dynamically evaluated code. As in ES5, the direct <code>eval</code> operator inherits its caller&rsquo;s scope chain.
</p>

<p>
The <code>eval</code> operator is a blocking <acronym title="Application Programming Interface">API</acronym>, so a host environment is permitted to reject programs passed to <code>eval</code> which require fetching code from external resources (see the <a href="doku.php%3Fid=harmony:module_loaders.html" class="wikilink1" title="harmony:module_loaders" onclick="return svchk()" onkeypress="return svchk()">module loading API</a> for a definition of when code is fetched). This prevents the evaluated code from blocking on reads from external resources. (Host environments like node.js may instead choose to allow site-local <acronym title="Uniform Resource Locator">URL</acronym>&lsquo;s, but browsers would not.)
</p>

</div>
<!-- SECTION [10000-10712] -->
<a name="this"></a><h2>This</h2>
<div class="level2">

<p>
 The initial binding of <code>this</code> is the global object.
</p>

</div>
<!-- SECTION [10713-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/9/907eafba95ca43a68b15c189a4405db3.xhtml used -->
</body>
</html>
