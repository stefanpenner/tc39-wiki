<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:let_expressions&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:let_expressions&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:let_expressions&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="clear"><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:let_expressions&amp;do=export_html.html#rationale" class="toc">Rationale</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:let_expressions&amp;do=export_html.html#syntax" class="toc">Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:let_expressions&amp;do=export_html.html#scope" class="toc">Scope</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:let_expressions&amp;do=export_html.html#evaluation" class="toc">Evaluation</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:let_expressions&amp;do=export_html.html#options" class="toc">Options</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:let_expressions&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="rationale"></a><h2>Rationale</h2>
<div class="level2">

<p>
It&rsquo;s currently hard to create compound expressions that do anything non-trivial. And it would be useful to be able to bind local variables and execute statements in an unobtrusive way, without introducing refactoring hazards like capturing the meaning of <code>return</code>.
</p>

<p>
We had less success with <a href="doku.php%3Fid=strawman:lambdas.html" class="wikilink1" title="strawman:lambdas" onclick="return svchk()" onkeypress="return svchk()">lambdas</a>, but <code>let</code> is a less powerful and more orthogonal construct.
</p>

</div>
<!-- SECTION [1-394] -->
<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">
<pre class="code">
Expression     ::= ... | &quot;let&quot; LetHead &quot;{&quot; Statement* (&quot;=&gt;&quot; Expression)? &quot;}&quot;
LetHead        ::= &quot;(&quot; LetBindingList &quot;)&quot;
LetBindingList ::= LetBinding | LetBindingList &quot;,&quot; LetBinding
LetBinding     ::= Pattern (&quot;=&quot; AssignmentExpression)?
                |  Ident (&quot;=&quot; AssignmentExpression)?
</pre>

<p>
See <a href="doku.php%3Fid=harmony:destructuring.html" class="wikilink1" title="harmony:destructuring" onclick="return svchk()" onkeypress="return svchk()">destructuring</a> for the meaning of Pattern.
</p>

</div>
<!-- SECTION [395-779] -->
<a name="scope"></a><h2>Scope</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> all variable bindings in LetHead are in scope in the body</div>
</li>
<li class="level1"><div class="li"> each variable binding in scope in subsequent head expressions? (let*) or not? (let)</div>
</li>
</ul>

</div>
<!-- SECTION [780-950] -->
<a name="evaluation"></a><h2>Evaluation</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> evaluate the RHS expressions in left-to-right order</div>
</li>
<li class="level1"><div class="li"> extend scope chain &ndash; as you go? (let*) or after head? (let)</div>
</li>
<li class="level1"><div class="li"> variables with no RHS are bound to the <code>undefined</code> value</div>
</li>
<li class="level1"><div class="li"> evaluate body</div>
</li>
<li class="level1"><div class="li"> result value is value of the tail expression</div>
</li>
<li class="level1"><div class="li"> if no tail expression, result value is the <code>undefined</code> value</div>
</li>
</ul>

</div>
<!-- SECTION [951-1295] -->
<a name="options"></a><h2>Options</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <code>let</code> vs <code>let*</code></div>
</li>
</ul>

<p>
 In typical programming, <code>let*</code> tends to be more convenient; combats rightward-drift, and it&rsquo;s rare that you need something <em>not</em> to be in scope in ordinary programming.
</p>

<p>
But for code generation, including desugaring spec&rsquo;s, future-proofing for macros, and supporting <acronym title="JavaScript">JS</acronym>-as-x86, it&rsquo;s a little harder to achieve <code>let</code> from <code>let*</code> than vice versa. Probably possible e.g. with a destructuring LHS:
</p>
<pre class="code javascript">let <span class="br0">&#40;</span><span class="br0">&#123;</span> x, y, z <span class="br0">&#125;</span> = <span class="br0">&#123;</span> x: foo<span class="br0">&#40;</span><span class="br0">&#41;</span>, y: bar<span class="br0">&#40;</span><span class="br0">&#41;</span>, z: baz<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#125;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span></pre>
<p>
This won&rsquo;t get you any duplicate-variable checking, but it will ensure that none of the LHS&rsquo;s are in scope on the RHS&rsquo;s. Anyway it&rsquo;s uncommon for ES to enforce no-dups. Even function args can be dups.
</p>
<ul>
<li class="level1"><div class="li"> make <code>LetHead</code> optional &ndash; probably impossible</div>
</li>
</ul>

<p>
 Ambiguity with destructuring <code>let</code> declaration:
</p>
<pre class="code javascript">let <span class="br0">&#123;</span> x <span class="br0">&#125;</span>; <span class="co1">// variable expression statement or property-destructuring?</span>
let <span class="br0">&#123;</span> x: x <span class="br0">&#125;</span>; <span class="co1">// labelled variable expression statement or property-destructuring?</span></pre><ul>
<li class="level1"><div class="li"> Explicit completions</div>
</li>
</ul>

<p>
 With the completion value, statements are almost expressions anyway; why not introduce a syntax for making the completion more statically predictable? Then this spec just becomes:
</p>
<pre class="code">
Block ::= &quot;{&quot; Statement* (&quot;=&gt;&quot; Expression)? &quot;}&quot;
Expression ::= ... | &quot;let&quot; LetHead Block
</pre>
<ul>
<li class="level1"><div class="li"> default to completion value</div>
</li>
</ul>

<p>
 The result value of a <code>let</code> expression with no tail expression could be the completion value instead of <code>undefined</code>.
</p>

</div>
<!-- SECTION [1296-2790] -->
<a name="discussion"></a><h2>Discussion</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Still not clear whether this feature pays for itself. It introduces a different way of doing something that could be done about as easily using existing means.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> I&rsquo;m concerned typos like the following will be quite common:</div>
</li>
</ul>
<pre class="code javascript">let <span class="br0">&#40;</span>x = ...<span class="br0">&#41;</span> <span class="br0">&#123;</span> statement<span class="br0">&#40;</span><span class="br0">&#41;</span>
                &gt;= x <span class="br0">&#125;</span></pre>
<p>
 &mdash; <em><a href="mailto:%26%23x77%3B%26%23x61%3B%26%23x6c%3B%26%23x64%3B%26%23x65%3B%26%23x6d%3B%26%23x61%3B%26%23x72%3B%26%23x40%3B%26%23x67%3B%26%23x6f%3B%26%23x6f%3B%26%23x67%3B%26%23x6c%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x77;&#x61;&#x6c;&#x64;&#x65;&#x6d;&#x61;&#x72;&#x40;&#x67;&#x6f;&#x6f;&#x67;&#x6c;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Waldemar Horwat</a> 2010/05/22 00:49</em>
</p>

</div>
<!-- SECTION [2791-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/f/fa630818f53cbe044198076106ddabc7.xhtml used -->
</body>
</html>
