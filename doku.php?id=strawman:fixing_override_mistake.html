<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:fixing_override_mistake [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:fixing_override_mistake&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:fixing_override_mistake&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:fixing_override_mistake&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2012-01-09T20:52:12+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:fixing_override_mistake&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:fixing_override_mistake</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:fixing_override_mistake" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:fixing_override_mistake" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=es3.1:discussion.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="es3.1:discussion">discussion</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:concurrency.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:concurrency">concurrency</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:deferred_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:deferred_functions">deferred_functions</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:magic_proto_property.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:magic_proto_property">magic_proto_property</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:fixing_override_mistake">fixing_override_mistake</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html#fixing_the_read-only_override_prohibition_mistake" class="toc">Fixing the Read-only Override Prohibition Mistake</a></span><ul class="toc">
<li class="clear"><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html#why_it_s_bad_for_efficiency" class="toc">Why it's bad for efficiency</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html#why_it_s_inconvenient" class="toc">Why it's inconvenient</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html#why_it_s_bad_for_security" class="toc">Why it's bad for security</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html#how_bad_would_fixing_it_be_for_legacy_compatibility" class="toc">How bad would fixing it be for legacy compatibility?</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html#proposal_currently_in_es5_spec_language" class="toc">Proposal (currently in ES5 spec language)</a></span></li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:fixing_override_mistake.html#see" class="toc">See</a></span></li>
</ul>
</div>
</div>

<a name="fixing_the_read-only_override_prohibition_mistake"></a><h1>Fixing the Read-only Override Prohibition Mistake</h1>
<div class="level1">

<p>
 Currently, according to the ES5.1 spec, if object y inherits a non-writable data property &ldquo;foo&rdquo; from object x, then one cannot override &ldquo;foo&rdquo; on y simply by using assignment. In other words,  
</p>
<pre class="code javascript">  <span class="kw2">var</span> x = Object.<span class="me1">freeze</span><span class="br0">&#40;</span><span class="br0">&#123;</span>foo: <span class="nu0">88</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;
  <span class="kw2">var</span> y = Object.<span class="me1">create</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span>;
  y.<span class="me1">foo</span> = <span class="nu0">99</span>; <span class="co1">// Currently specified to fail</span></pre>
<p>
This is a problem for efficiency, convenience, and security. Although currently specified, it is not implemented correctly as of this writing by Chrome/v8 and Safari/JSC, and so legacy web content does not yet depend on this behavior. In retrospect, I believe that specifying it this way was a mistake due to lack of adequate attention to this issue and its implications. 
</p>
<hr noshade="noshade" size="1" />

<p>
 <strong>Not a Mistake</strong>  &mdash; <em><a href="mailto:%26%23x41%3B%26%23x6c%3B%26%23x6c%3B%26%23x65%3B%26%23x6e%3B%26%23x40%3B%26%23x57%3B%26%23x69%3B%26%23x72%3B%26%23x66%3B%26%23x73%3B%26%23x2d%3B%26%23x42%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x41;&#x6c;&#x6c;&#x65;&#x6e;&#x40;&#x57;&#x69;&#x72;&#x66;&#x73;&#x2d;&#x42;&#x72;&#x6f;&#x63;&#x6b;&#x2e;&#x63;&#x6f;&#x6d;">Allen Wirfs-Brock</a> 2012/01/09 20:45</em>
</p>

<p>
 This was not a mistake in ES5/5.1 and it is not a bug.  It is a semantics that goes all the way back to ES1.  It is also a behavior which makes complete sense from a prototypal inheritance perspective and can be found in the Self language. 
</p>

<p>
The basic idea is that the properties prototype object are shared parts of all of inheriting child object.  Modifying such a shared part by a child, introduces a local change that is visible to that child (and its children) so this requires creation of a &ldquo;own&rdquo; property on the child. However, read-only properties can not modified (by normal means, eg assignment) so there is no need to create a &ldquo;own&rdquo; copy.  Assigning to an inherited read-only property or a &ldquo;own&rdquo; read-only property should have the same affect (whether it is ignoring the assignment, throwing, etc.).  Allowing assignment to an inherited read-only property would break the invariant that that a prototype&rsquo;s readonly property is an immutable value that is  shared among all children of the prototype.
</p>

<p>
If there was a mistake in designing ES5, it was allowing Object.defineOwnProperty to create child properties that over-ride inherited read-only data properties.  This broke an invariant that previously existed in the language but this invariant  was already violated by some pre-ES5 clause 15 objects, (eg the writability of the prototype property of some children of Function.prototype).  However, I think the ES5 decision was probably the right one given the legacy clause 15 usages and the overall reflective nature of defineOwnProperty).
</p>

<p>
Finally, this issue was given plenty of attention in during the development of ES5.  In various drafts, the ES5 specification actually broke the legacy behavior causing it to behave similarly to what is suggested by this strawman.  Those specification bugs were corrected in order to ensure that the semantics specified by ES3 and earlier editions were not changed by ES5.
</p>
<hr noshade="noshade" size="1" />

</div>

<a name="why_it_s_bad_for_efficiency"></a><h3>Why it's bad for efficiency</h3>
<div class="level3">

<p>
 To be written
</p>

</div>

<a name="why_it_s_inconvenient"></a><h3>Why it's inconvenient</h3>
<div class="level3">

<p>
 To be written
</p>

</div>

<a name="why_it_s_bad_for_security"></a><h3>Why it's bad for security</h3>
<div class="level3">

<p>
 To be written
</p>

</div>

<a name="how_bad_would_fixing_it_be_for_legacy_compatibility"></a><h3>How bad would fixing it be for legacy compatibility?</h3>
<div class="level3">

<p>
 To be written
</p>

</div>

<a name="proposal_currently_in_es5_spec_language"></a><h2>Proposal (currently in ES5 spec language)</h2>
<div class="level2">

<p>
 Changes to <strong><a href="http://es5.github.com/#x8.12.4" class="urlextern" target="_blank" title="http://es5.github.com/#x8.12.4" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">8.12.4</a> [[CanPut]](P)</strong>
</p>
<pre class="code">...
8. Else inherited must be a DataDescriptor
  a. ...
  b. Else return true</pre>

<p>
 This change is independent of the &ldquo;mode&rdquo; of the code in which the assignment appears. As of ES-next, this change would affect non-strict, strict, and extended-mode assignment. The only difference in assignment behaviors would remain that non-strict assignment failures are silent. But all would fail for all the same cases, which would differ from the cases specified to fail in ES5.1.
</p>

</div>

<a name="see"></a><h1>See</h1>
<div class="level1">

<p>
 <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-November/017997.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2011-November/017997.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">ES-discuss thread</a> and <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-November/018774.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2011-November/018774.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">another</a>
</p>

<p>
<a href="http://code.google.com/p/v8/issues/detail?id=1169" class="urlextern" target="_blank" title="http://code.google.com/p/v8/issues/detail?id=1169" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Overriding inherited read-only proprties must fail / throw</a>
</p>

<p>
<a href="http://hg.ecmascript.org/tests/test262/file/c84161250e66/test/suite/chapter15/15.2/15.2.3/15.2.3.6/15.2.3.6-4-405.js" class="urlextern" target="_blank" title="http://hg.ecmascript.org/tests/test262/file/c84161250e66/test/suite/chapter15/15.2/15.2.3/15.2.3.6/15.2.3.6-4-405.js" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Test262 test case</a>
</p>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/0/0fce85a8cd20605374545f6f891df9e8.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/fixing_override_mistake.txt &middot; Last modified: 2012/01/09 20:52 by allen      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:fixing_override_mistake" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:fixing_override_mistake" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:fixing_override_mistake" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:fixing_override_mistake" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:fixing_override_mistake.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Afixing_override_mistake&amp;1454275629" width="1" height="1" alt=""  /></body>
</html>
