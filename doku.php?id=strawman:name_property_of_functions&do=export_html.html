<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:name_property_of_functions&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:name_property_of_functions&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:name_property_of_functions&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>

<p>
<strong>This proposal has progressed to the Draft ECMAScript 6 Specification, which is available for review here: <a href="doku.php%3Fid=harmony:specification_drafts.html" class="wikilink1" title="harmony:specification_drafts" onclick="return svchk()" onkeypress="return svchk()">specification_drafts</a>. Any new issues relating to them should be filed as bugs at <a href="http://bugs.ecmascript.org" class="urlextern" target="_blank" title="http://bugs.ecmascript.org" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://bugs.ecmascript.org</a>. The content on this page is for historic record only and may no longer reflect the current state of the feature described within.</strong>
</p>

<a name="precedent"></a><h2>Precedent</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <code>(new Function).name === &ldquo;anonymous&rdquo;</code> wanted by the Web, according to <a href="https://bugs.webkit.org/show_bug.cgi?id=7726" class="urlextern" target="_blank" title="https://bugs.webkit.org/show_bug.cgi?id=7726" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">this webkit bug</a></div>
</li>
<li class="level1"><div class="li"> <code>(function(){}).name === &ldquo;&ldquo;</code> may be wanted too, we suspect &ndash; we aren&rsquo;t sure, though, so this behavior of some browser-based implementations is not strong precedent</div>
</li>
<li class="level1"><div class="li"> <code>function f(){} assert(f.name === &ldquo;f&rdquo;)</code> is implemented by several browsers, with name not writable and not configurable</div>
</li>
<li class="level1"><div class="li"> Most browsers that implement <code>name</code> for functions use it in the result of <code>toString</code> as the function identifier (<a href="https://mail.mozilla.org/pipermail/es-discuss/2009-March/008916.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2009-March/008916.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">detailed results of testing by Allen</a>)</div>
</li>
<li class="level1"><div class="li"> <code>toString</code> according to ES3 is not well-defined for anonymous function expressions</div>
</li>
<li class="level1"><div class="li"> Writable <a href="http://trac.webkit.org/changeset/42478" class="urlextern" target="_blank" title="http://trac.webkit.org/changeset/42478" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">displayName</a> property used for console logging in webkit</div>
</li>
</ul>

</div>
<!-- SECTION [367-1262] -->
<a name="goals"></a><h2>Goals</h2>
<div class="level2">

<p>
 These conflict if achieved for all functions. 
</p>
<ul>
<li class="level1"><div class="li"> Support <em>de facto</em> standards per above precedent</div>
</li>
<li class="level1"><div class="li"> Avoid adding unnecessary properties</div>
</li>
<li class="level1"><div class="li"> Keep <code>name</code> and <code>toString</code> results consistent</div>
</li>
<li class="level1"><div class="li"> Automatically derive names for synthesized functions such as get, set, and bind functions</div>
<ul>
<li class="level2"><div class="li"> e.g., for <code>obj = {get prop() { return 42; }}</code> extracting the getter for <code>prop</code> would recover a function <code>g</code> such that <code>g.name === &ldquo;get prop&rdquo;</code> in one proposal</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Allow some functions to be given arbitrary names, e.g. by code generators (Objective-J)</div>
</li>
</ul>

</div>
<!-- SECTION [1263-1836] -->
<a name="proposals"></a><h2>Proposals</h2>
<div class="level2">

<p>
 These are not mutually exclusive. 
</p>
<ul>
<li class="level1"><div class="li"> For function declarations and named function expressions, create a non-writable, non-configurable <code>name</code> property whose value is the function&rsquo;s identifier as a string</div>
</li>
<li class="level1"><div class="li"> For anonymous function expressions, create no <code>name</code> property at all</div>
</li>
<li class="level1"><div class="li"> <code>Function.prototype</code> would have no <code>name</code> property (in some implementations it is a function created as if by evaluating an anonymous function expression taking no arguments and having an empty body)</div>
</li>
<li class="level1"><div class="li"> Add <code>Function.create(</code><em>name</em><code>, </code><em>params...</em><code>, </code><em>body</em><code>)</code> per <a href="https://mail.mozilla.org/pipermail/es-discuss/2009-March/008954.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2009-March/008954.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Maciej's suggestion</a></div>
</li>
<li class="level1"><div class="li"> Rather than adding a WebKit-inspired <code>displayName</code> <a href="http://www.alertdebugging.com/2009/04/29/building-a-better-javascript-profiler-with-webkit/" class="urlextern" target="_blank" title="http://www.alertdebugging.com/2009/04/29/building-a-better-javascript-profiler-with-webkit/" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">writable property</a>, specify <code>Function.displayName(f)</code> as follows:</div>
<ul>
<li class="level2"><div class="li"> If <code>f.name</code> exists, return <code>f.name</code>.</div>
</li>
<li class="level2"><div class="li"> Else if <code>f</code> was invoked via an expression evaluated from a Reference whose propertyName was <code>N</code>, return <code>N</code>.</div>
</li>
<li class="level2"><div class="li"> Else if <code>f</code> was assigned to a Reference whose propertyName was <code>M</code>, return <code>M</code>. There could be more than one such <code>M</code>. Implementations should pick the most recently used name.</div>
</li>
<li class="level2"><div class="li"> Else if <code>f</code> was the initial value in an object initializer or a property descriptor for a property named <code>P</code>, return <code>P</code>.</div>
</li>
<li class="level2"><div class="li"> Else returned <code>undefined</code>.</div>
</li>
</ul>
</li>
</ul>

</div>
<!-- SECTION [1837-3270] -->
<a name="discussion"></a><h2>Discussion</h2>
<div class="level2">

<p>
 I like the spirit of Maciej&rsquo;s proposal, but I don&rsquo;t like repeating the string-pasting, <code>eval</code>-like interface of the <code>Function</code> constructor. Here&rsquo;s a variation:
</p>
<pre class="code javascript"><span class="kw2">Function</span>.<span class="me1">create</span><span class="br0">&#40;</span><span class="kw3">name</span>, call<span class="br0">&#91;</span>, construct<span class="br0">&#91;</span>, proto<span class="br0">&#93;</span><span class="br0">&#93;</span><span class="br0">&#41;</span></pre>
<p>
Creates a function with the given display name, call behavior, optional construct behavior (which defaults to the usual call-with-fresh-object behavior), and optional prototype (which defaults to the original value of <code>Function.prototype</code>).
</p>
<pre class="code javascript"><span class="kw2">Function</span>.<span class="me1">getDisplayNameOf</span><span class="br0">&#40;</span>f<span class="br0">&#41;</span></pre>
<p>
Returns the display name of a function.
</p>

<p>
Some more detail: 
</p>
<ul>
<li class="level1"><div class="li"> Every function has an internal [[DisplayName]] property</div>
</li>
<li class="level1"><div class="li"> The semantics automatically infers this property for function literals in at least the following contexts:</div>
<ul>
<li class="level2"><div class="li"> function declarations: the declared name is the inferred display name</div>
</li>
<li class="level2"><div class="li"> named function expressions: the function name is the inferred display name</div>
</li>
<li class="level2"><div class="li"> <code>var</code>/<code>let</code>/<code>const</code> declarations that assign function literals: the variable name is the inferred display name</div>
</li>
<li class="level2"><div class="li"> object literals that assign function literals to property names: the property name is the inferred display name</div>
</li>
</ul>
</li>
</ul>

<p>
 Sample implementation:
</p>
<pre class="code javascript"><span class="br0">&#40;</span><span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">var</span> names = <span class="kw2">new</span> WeakMap<span class="br0">&#40;</span><span class="br0">&#41;</span>;
&nbsp;
    <span class="kw2">Function</span>.<span class="me1">create</span> = <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span>, call, construct, fproto<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>!fproto<span class="br0">&#41;</span>
            fproto = <span class="kw2">Function</span>.<span class="me1">prototype</span>;
        <span class="kw1">if</span> <span class="br0">&#40;</span>fproto !== <span class="kw2">Function</span>.<span class="me1">prototype</span> &amp;&amp; !<span class="br0">&#40;</span>fproto <span class="kw1">instanceof</span> <span class="kw2">Function</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
            <span class="kw1">throw</span> <span class="kw2">new</span> TypeError<span class="br0">&#40;</span><span class="st0">"expected instance of Function, got "</span> + fproto<span class="br0">&#41;</span>;
        <span class="kw2">var</span> f;
        <span class="kw1">if</span> <span class="br0">&#40;</span>!construct<span class="br0">&#41;</span> <span class="br0">&#123;</span>
            construct = <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
                <span class="kw2">var</span> oproto = f.<span class="me1">prototype</span>;
                <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">typeof</span> oproto !== <span class="st0">"object"</span><span class="br0">&#41;</span>
                    oproto = Object.<span class="me1">prototype</span>;
                <span class="kw2">var</span> newborn = Object.<span class="me1">create</span><span class="br0">&#40;</span>oproto, <span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;
                <span class="kw2">var</span> result = <span class="kw2">Function</span>.<span class="me1">prototype</span>.<span class="me1">apply</span>.<span class="me1">call</span><span class="br0">&#40;</span>call, arguments<span class="br0">&#41;</span>;
                <span class="kw1">return</span> <span class="kw1">typeof</span> result === <span class="st0">"object"</span> ? result : newborn;
            <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
        <span class="kw2">var</span> handler = Proxy.<span class="me1">Handler</span><span class="br0">&#40;</span>Object.<span class="me1">create</span><span class="br0">&#40;</span>fproto, <span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
        f = Proxy.<span class="me1">createFunction</span><span class="br0">&#40;</span>handler, call, construct, fproto<span class="br0">&#41;</span>;
        <span class="kw1">return</span> f;
    <span class="br0">&#125;</span>;
&nbsp;
    <span class="kw2">Function</span>.<span class="me1">getDisplayNameOf</span> = <span class="kw2">function</span><span class="br0">&#40;</span>f<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> names.<span class="me1">get</span><span class="br0">&#40;</span>f<span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>;
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;</pre>
<p>
 &mdash; <em><a href="mailto:%26%23x64%3B%26%23x68%3B%26%23x65%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x63%3B%26%23x63%3B%26%23x73%3B%26%23x2e%3B%26%23x6e%3B%26%23x65%3B%26%23x75%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x64;&#x68;&#x65;&#x72;&#x6d;&#x61;&#x6e;&#x40;&#x63;&#x63;&#x73;&#x2e;&#x6e;&#x65;&#x75;&#x2e;&#x65;&#x64;&#x75;">Dave Herman</a> 2011/02/24 06:00</em>
</p>

<p>
The major objection to losing the &ldquo;compile this string as the function body&rdquo; <code>Function</code> design on which Maciej built comes from the use-case: Objective J compilation and similar want to create a function per &ldquo;method&rdquo;, not two (one returned by this variation and its <code>call</code> function). Maciej&rsquo;s <code>Function.create</code> proposal was simply a <code>Function</code> variant that allowed the intrinsic name to be specified. This variation is more like a proxy-maker.
</p>

<p>
A minor objection:
</p>
<pre class="code javascript"><span class="kw2">Function</span>.<span class="me1">prototype</span> <span class="kw1">instanceof</span> <span class="kw2">Function</span>  <span class="co1">// =&gt; false</span></pre>
<p>
This means you cannot pass <code>otherWindow.Function.prototype</code> as the <code>proto</code> parameter.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2011/02/28 21:34</em>
</p>

<p>
Despite being one of the people responsible for displayName existing i kind of wish that it didn&rsquo;t.  I feel that a lot of what it provides needn&rsquo;t being exposed to content in general.  In hindsight i feel the better solution would have been to have the platform development tools provide APIs to associate names with some functions and so not have it be part of ES core.
</p>

<p>
If we were wanting to standardise some kind of developer tools <acronym title="Application Programming Interface">API</acronym> (essentially the frequently reverse engineered &lsquo;console&rsquo; APIs) I think displayName (or similar) would make sense there.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6f%3B%26%23x6c%3B%26%23x69%3B%26%23x76%3B%26%23x65%3B%26%23x72%3B%26%23x40%3B%26%23x61%3B%26%23x70%3B%26%23x70%3B%26%23x6c%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6f;&#x6c;&#x69;&#x76;&#x65;&#x72;&#x40;&#x61;&#x70;&#x70;&#x6c;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Oliver Hunt</a> 2011/05/01 23:33</em>
</p>

<p>
 Proposal update from Brandon Benvie: <a href="https://mail.mozilla.org/pipermail/es-discuss/2012-November/026403.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2012-November/026403.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">https://mail.mozilla.org/pipermail/es-discuss/2012-November/026403.html</a>
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x77%3B%26%23x61%3B%26%23x6c%3B%26%23x64%3B%26%23x72%3B%26%23x6f%3B%26%23x6e%3B%26%23x2e%3B%26%23x72%3B%26%23x69%3B%26%23x63%3B%26%23x6b%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x77;&#x61;&#x6c;&#x64;&#x72;&#x6f;&#x6e;&#x2e;&#x72;&#x69;&#x63;&#x6b;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Rick Waldron</a> 2013/01/29 09:58</em> 
</p>

</div>
<!-- SECTION [3271-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/f/f11ebda4f4b455c48aa24a56fd519a88.xhtml used -->
</body>
</html>
