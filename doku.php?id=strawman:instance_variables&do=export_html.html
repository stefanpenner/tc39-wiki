<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:instance_variables&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:instance_variables&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:instance_variables&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>

<a name="instance_variables"></a><h1>Instance Variables</h1>
<div class="level1">

<p>
 In some situations it is desirable to strictly limit access to per object state such that they are totally unaccessable to unknown or untrusted code.  <em>Instance Variables</em> provide this capability.  An instance variable is a similar to a property in that it associates a name with a ECMAScript language value. Like properties, instance variables are associated with objects.  However, they differ from properties in how they are created and accessed and also in that they are not automatically inherited via the [[Prototype]] chain. Any object may have an arbitrary  number of instance variables.
</p>

<p>
Instance variable names may be either string or private name values. Instance variables are always referenced using identifiers prefix by <strong><code>@</code></strong>.  The identifier may (and typically will be) a private name identifier: 
</p>
<pre class="code javascript">   @secret = <span class="nu0">42</span>;
   <span class="kw1">this</span>.<span class="me1">notSecret</span> = @secret;</pre>
<p>
<strong><code>@</code></strong> references always access the object that is the current <code><strong>this</strong></code> value. This object association is always implicit.  A instance variable reference can not be used with dot or backet property access syntax 
</p>
<pre class="code javascript">   <span class="kw1">this</span>.@secret = another.@secret;  <span class="co1">//both references produce syntax errors</span></pre>
<p>
 Using a @ in a property name string does not access the corresponding instance variable: 
</p>
<pre class="code javascript">   <span class="kw1">this</span><span class="br0">&#91;</span><span class="st0">"@secret"</span><span class="br0">&#93;</span> = another<span class="br0">&#91;</span><span class="st0">"@secret"</span><span class="br0">&#93;</span>  <span class="co1">//regular property accesses</span></pre>
<p>
 Of course, the value returned from an instance variable access may be used as a regular property name: 
</p>
<pre class="code javascript">   <span class="kw1">this</span><span class="br0">&#91;</span>@secret<span class="br0">&#93;</span> = another<span class="br0">&#91;</span>@secret<span class="br0">&#93;</span>  <span class="co1">//evaluates as this[42] = another[42]</span></pre>
</div>
<!-- SECTION [1-1644] -->
<a name="creating_instance_variables"></a><h2>Creating Instance Variables</h2>
<div class="level2">

<p>
Instance variables can be accessed or modified by any method invoked on an object assuming it the method knows the name of the instance variable. However, an instance variable can only be created during the initial construction of an object.  This construction may be via a Object or Class Initialiser or a constructor function: 
</p>
<pre class="code javascript"><span class="kw2">var</span> obj = <span class="br0">&#123;</span>
   @secret: <span class="nu0">42</span>,   <span class="co1">//created during object construction</span>
   get secret<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="kw1">return</span> @secret<span class="br0">&#125;</span>,
   set latter<span class="br0">&#40;</span>value<span class="br0">&#41;</span> <span class="br0">&#123;</span>@anotherSecret = value<span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw3">print</span><span class="br0">&#40;</span>obj.<span class="me1">secret</span><span class="br0">&#41;</span>;  <span class="co1">//prints 42 because accessor function can access instance variable</span>
obj.<span class="me1">latter</span> = -<span class="nu0">42</span>;   <span class="co1">//TypeError because instance variable @anotherSecret doesn't exist</span>
&nbsp;
<span class="kw2">function</span> Con<span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="br0">&#123;</span>
   @hidden = x;  <span class="co1">//assignment in constructor creates instance variable</span>
<span class="br0">&#125;</span>
<span class="kw2">var</span> c = <span class="kw2">new</span> Con<span class="br0">&#40;</span><span class="nu0">42</span><span class="br0">&#41;</span>;
<span class="kw3">print</span><span class="br0">&#40;</span><span class="br0">&#40;</span><span class="kw2">function</span> <span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="kw1">return</span> @hidden<span class="br0">&#125;</span><span class="br0">&#41;</span>.<span class="me1">call</span><span class="br0">&#40;</span>c<span class="br0">&#41;</span><span class="br0">&#41;</span>;  <span class="co1">//prints 42</span>
<span class="br0">&#40;</span><span class="kw2">function</span> <span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="br0">&#123;</span>@hidden2 = x<span class="br0">&#125;</span><span class="br0">&#41;</span>.<span class="me1">call</span><span class="br0">&#40;</span>c, -<span class="nu0">42</span><span class="br0">&#41;</span>;   <span class="co1">//TypeError, @hidden2 doesn't exist</span></pre>
<p>
Note that normally a private name would be used as an instance variable name to in order to prevent adversaries from using method application such as the above to gain access to instance variables. Disallowing instance variable creation after completion of the constructor prevents adversaries from using instance variables to attach parasite payload to objects.
</p>

</div>
<!-- SECTION [1645-2983] -->
<a name="implementation_requirements"></a><h2>Implementation Requirements</h2>
<div class="level2">

<p>
Instance variables must not be implemented as property accesses and must not trigger traps if the this object is a Proxy object.  Instance variables are not enumerated by for-in and are not visible to any of the built-in reflection functions.
</p>

</div>
<!-- SECTION [2984-3267] -->
<a name="implementation_considerations"></a><h2>Implementation Considerations</h2>
<div class="level2">

<p>
It is, of course, up to any implementation how it actually goes about implementing instance variables.  Some alternatives include:
</p>
<ul>
<li class="level1"><div class="li"> Store as regular properties but add internal per property attribute that tags instance variables and trigger enforcement of requirements.</div>
</li>
<li class="level1"><div class="li"> Add a single internal object reference slot to every object that has instance variables. That slot can reference a regular object whose own properties are the instance variable store making sure that this object is never leaked.</div>
</li>
<li class="level1"><div class="li"> Allocated dedicated slots for each instances variable in an object (fairly easy to identify in either object literals or constructor functions).  Access them via direct slot offsets.</div>
</li>
</ul>

</div>
<!-- SECTION [3268-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/2/23c44dcbe2296adbc05ce4ae66dc033d.xhtml used -->
</body>
</html>
