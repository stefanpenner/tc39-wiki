<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=clarification:code_mixing&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=clarification" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=clarification:code_mixing&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#code_mixing" class="toc">Code mixing</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#calling" class="toc">Calling</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_caller" class="toc">Old code as caller</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_callee" class="toc">Old code as callee</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#prototypes" class="toc">Prototypes</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_prototype-ancestor" class="toc">Old code as prototype-ancestor</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_prototype-child" class="toc">Old code as prototype-child</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#slot_setting" class="toc">Slot setting</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_slot_container" class="toc">Old code as slot container</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_slot_contents" class="toc">Old code as slot contents</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_code_performing_slot-setting" class="toc">Old code code performing slot-setting</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#slot_getting" class="toc">Slot getting</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_slot_container" class="toc">Old code as slot container</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_slot_contents" class="toc">Old code as slot contents</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_performing_slot-getting" class="toc">Old code performing slot-getting</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#operands" class="toc">Operands</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#exceptions" class="toc">Exceptions</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_thrower" class="toc">Old code as thrower</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#old_code_as_catcher" class="toc">Old code as catcher</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#mixed_method_extraction_and_this_-binding" class="toc">Mixed method extraction and ''this''-binding</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#extracting_method_from_old_object" class="toc">Extracting method from old object</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=clarification:code_mixing&amp;do=export_html.html#attaching_method_to_old_object" class="toc">Attaching method to old object</a></span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<a name="code_mixing"></a><h1>Code mixing</h1>
<div class="level1">

<p>
 If we are serious about best-effort backward compatibility as a prerequisite for adoption, we ought to be thinking not just about keeping the old language semantics around as a subset, but also about the <em>interactions</em> which will occur when &ldquo;new code&rdquo; (objects constructed in the supersest) encounters old code in the wild. In particular, we should make sure we&rsquo;ve considered and defined each type of code interaction which can take place, involving mixtures of old and new code. 
</p>

</div>
<!-- SECTION [1-511] -->
<a name="calling"></a><h2>Calling</h2>
<div class="level2">

</div>
<!-- SECTION [512-532] -->
<a name="old_code_as_caller"></a><h3>Old code as caller</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Name lookup: </div>
<ul>
<li class="level2"><div class="li"> Old code might expect bare name <code>foo</code> to bind and we might have put <code>foo</code> in a namespace. Maybe open such namespaces by default.</div>
</li>
<li class="level2"><div class="li"> Depending on whether we mess with scope-chain rules (eg. to permit closing over a value rather than the variable object used for dynamic lookup), old code <em>might</em> depend on old scope-chain behavior.  </div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Parameter conversion: old code might expect parameters to convert under rules different from the <code>:T</code> / <code>function to T</code> rule. </div>
</li>
<li class="level1"><div class="li"> Dispatch rules: old code will expect the dispatch rules (no overloading, no type-dispatch).</div>
</li>
<li class="level1"><div class="li"> <code>this</code>-binding: old code might expect dynamic <code>this</code> binding, even when calling objects on which there will be no such binding. Not sure if this is a significant or common case: it&rsquo;s always possible to create old code which simply doesn&rsquo;t <em>use</em> <code>this</code>, which is similar to &ldquo;not doing dynamic binding&rdquo;.</div>
</li>
</ul>

</div>
<!-- SECTION [533-1474] -->
<a name="old_code_as_callee"></a><h3>Old code as callee</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Name lookup:</div>
<ul>
<li class="level3"><div class="li"> I don&rsquo;t think old code can find out what name it was looked up as.</div>
</li>
<li class="level3"><div class="li"> New code will find objects using new-code name rules. No surprise there.</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> Parameter conversion: old code might performs ad-hoc type conversions on its parameters. Or will it? Will we simply outlaw the old behavior? This might break code. The old code will still <em>get</em> the types it demands; it will just might get different values than it was written to expect. </div>
</li>
<li class="level2"><div class="li"> Dispatch rules: code can&rsquo;t tell how it was dispatched-to, and new callers will not be surprised by the rules anyways.</div>
</li>
<li class="level2"><div class="li"> <code>this</code>-binding: old code will bind <code>this</code> dynamically, as new code would if it were non-bound method code.</div>
</li>
</ul>

</div>
<!-- SECTION [1475-2217] -->
<a name="prototypes"></a><h2>Prototypes</h2>
<div class="level2">

</div>
<!-- SECTION [2218-2241] -->
<a name="old_code_as_prototype-ancestor"></a><h3>Old code as prototype-ancestor</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Will not add to the set of type constraints on new children. </div>
</li>
<li class="level1"><div class="li"> May not have a sensible type other than <code>Object</code>.</div>
</li>
<li class="level1"><div class="li"> May be freely shadowed as in ES3.</div>
</li>
</ul>

</div>
<!-- SECTION [2242-2444] -->
<a name="old_code_as_prototype-child"></a><h3>Old code as prototype-child</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> May be confused by slot-binding being prohibited by type-constrained prototype.</div>
</li>
<li class="level1"><div class="li"> May expect to be able to set <code>__proto__</code> slot (implementation-defined anyways).</div>
</li>
</ul>

</div>
<!-- SECTION [2445-2658] -->
<a name="slot_setting"></a><h2>Slot setting</h2>
<div class="level2">

</div>
<!-- SECTION [2659-2684] -->
<a name="old_code_as_slot_container"></a><h3>Old code as slot container</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Old objects can have their slots set unless the slot carries <code>DontDelete</code> and <code>ReadOnly</code>; these are modeled in the new language. No assumptions about the ability to set a slot on such an object are lost.</div>
</li>
</ul>

</div>
<!-- SECTION [2685-2935] -->
<a name="old_code_as_slot_contents"></a><h3>Old code as slot contents</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> All denotabe old values exist in the new language, and can be put in slots of new objects if the slot permits it.</div>
</li>
</ul>

</div>
<!-- SECTION [2936-3091] -->
<a name="old_code_code_performing_slot-setting"></a><h3>Old code code performing slot-setting</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Old code <em>putting a value into a slot</em> may trigger a conversion if the new slot is type constrained. This might come as a surprise to old code.</div>
</li>
<li class="level1"><div class="li"> Might also throw an exception if a constraint is violated. Surprising.</div>
</li>
</ul>

</div>
<!-- SECTION [3092-3366] -->
<a name="slot_getting"></a><h2>Slot getting</h2>
<div class="level2">

</div>
<!-- SECTION [3367-3392] -->
<a name="old_code_as_slot_container"></a><h3>Old code as slot container</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Slots can always be retrieved from old objects, and when modelling such an old (unconstrained) object in the new language, this remains true.</div>
</li>
<li class="level1"><div class="li"> Possibly some ad-hoc conversions which old objects did will differ? Getting-as-some-value?</div>
</li>
<li class="level1"><div class="li"> Possibly the value returned for missing slots will differ?</div>
</li>
</ul>

</div>
<!-- SECTION [3393-3735] -->
<a name="old_code_as_slot_contents"></a><h3>Old code as slot contents</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Old values can be retrieved from slots, and are not subject to any alteration on the way out. If you can represent the value in the new language, as far as I know you can get it from a slot.</div>
</li>
</ul>

</div>
<!-- SECTION [3736-3968] -->
<a name="old_code_performing_slot-getting"></a><h3>Old code performing slot-getting</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> As mentionned in the &ldquo;as slot container&rdquo; section above, perhaps old code expects getting from an empty slot to return something we&rsquo;re not returning anymore?</div>
</li>
<li class="level1"><div class="li"> Old code might be surprised if there was a conversion during the set which preceeded the get.</div>
</li>
<li class="level1"><div class="li"> Old code might be unable to get a value it&rsquo;s expecting if the slot is private?</div>
</li>
</ul>

</div>
<!-- SECTION [3969-4355] -->
<a name="operands"></a><h2>Operands</h2>
<div class="level2">

<p>
 TBD. No discussion of operators yet. See <a href="doku.php%3Fid=proposals:operators.html" class="wikilink1" title="proposals:operators" onclick="return svchk()" onkeypress="return svchk()">operators proposal</a>.
</p>

</div>
<!-- SECTION [4356-4463] -->
<a name="exceptions"></a><h2>Exceptions</h2>
<div class="level2">

</div>
<!-- SECTION [4464-4487] -->
<a name="old_code_as_thrower"></a><h3>Old code as thrower</h3>
<div class="level3">

</div>
<!-- SECTION [4488-4518] -->
<a name="old_code_as_catcher"></a><h3>Old code as catcher</h3>
<div class="level3">

</div>
<!-- SECTION [4519-4549] -->
<a name="mixed_method_extraction_and_this_-binding"></a><h2>Mixed method extraction and ''this''-binding</h2>
<div class="level2">

</div>
<!-- SECTION [4550-4607] -->
<a name="extracting_method_from_old_object"></a><h3>Extracting method from old object</h3>
<div class="level3">

</div>
<!-- SECTION [4608-4652] -->
<a name="attaching_method_to_old_object"></a><h3>Attaching method to old object</h3>
<div class="level3">

<p>
 &ldquo;Old&rdquo; code here means Javascript 1.x, ActionScript 2.x, ECMAScript 3, and JScript.NET (version?). 
</p>

</div>
<!-- SECTION [4653-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/7/77f2fbb24c3df7813aad07b2f4ce14df.xhtml used -->
</body>
</html>
