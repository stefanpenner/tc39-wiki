<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>harmony:modules_rationale [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=harmony:modules_rationale&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=harmony" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=harmony:modules_rationale&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=harmony:modules_rationale&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2014-06-10T16:26:23+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=harmony:modules_rationale&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">harmony:modules_rationale</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="harmony:modules_rationale" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="harmony:modules_rationale" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:classes.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:classes">classes</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:types.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:types">types</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:array_comprehensions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:array_comprehensions">array_comprehensions</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:module_loaders.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:module_loaders">module_loaders</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=harmony:modules_rationale.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:modules_rationale">modules_rationale</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#this_page_is_no_longer_current" class="toc">THIS PAGE IS NO LONGER CURRENT</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#motivations" class="toc">Motivations</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#core_module_system" class="toc">Core module system</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#module_api" class="toc">Module API</a></span></li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#design_points" class="toc">Design Points</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#static_modules" class="toc">Static modules</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#closed_modules" class="toc">Closed modules</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#hierarchical_modules" class="toc">Hierarchical modules</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#scoping_semantics" class="toc">Scoping semantics</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#syntax" class="toc">Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:modules_rationale.html#loading_semantics" class="toc">Loading semantics</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="this_page_is_no_longer_current"></a><h1>THIS PAGE IS NO LONGER CURRENT</h1>
<div class="level1">

<p>
 <a href="lib/exe/detail.php%3Fid=harmony%253Amodules_rationale&amp;cache=cache&amp;media=harmony:warning.png.html" class="media" title="harmony:warning.png" onclick="return svchk()" onkeypress="return svchk()"><img src="lib/exe/fetch.php%3Fw=100&amp;h=&amp;cache=cache&amp;media=harmony:warning.png" class="media" alt="" width="100" /></a> <strong>WARNING:</strong> This page is <strong>out of date</strong>. Please see the ES6 <a href="doku.php%3Fid=harmony:specification_drafts.html" class="wikilink1" title="harmony:specification_drafts" onclick="return svchk()" onkeypress="return svchk()">specification drafts</a> for up-to-date information. This page is here only as an archive.
</p>

</div>

<a name="motivations"></a><h1>Motivations</h1>
<div class="level1">

</div>

<a name="core_module_system"></a><h2>Core module system</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Standardized mechanism for creating libraries.</div>
</li>
<li class="level1"><div class="li"> In-language loading of external modules (non-blocking, direct style).</div>
</li>
<li class="level1"><div class="li"> Portability between different host environments.</div>
</li>
<li class="level1"><div class="li"> Future-proof mechanism for platforms to introduce experimental libraries without collision.</div>
</li>
<li class="level1"><div class="li"> No installation/registration code within modules.</div>
</li>
</ul>

</div>

<a name="module_api"></a><h2>Module API</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Fine-grained isolation/sandboxing of dynamic evaluation.</div>
</li>
<li class="level1"><div class="li"> Formalize the &ldquo;multiple globals&rdquo; semantics of the web.</div>
</li>
<li class="level1"><div class="li"> In-language mechanism for extension of language, loading semantics.</div>
</li>
</ul>

</div>

<a name="design_points"></a><h1>Design Points</h1>
<div class="level1">

</div>

<a name="static_modules"></a><h2>Static modules</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>Modules are not an expression form.</strong></div>
</li>
</ul>

<p>
 Modules are static by default (but can be dynamically reflected), in part because this is their common use case. This also makes them far more compatible with static scoping. The loaders <acronym title="Application Programming Interface">API</acronym> makes it possible to achieve more dynamic uses of modules, but static modules makes it possible to do static loading and linking. For more dynamic component mechanisms, JavaScript objects and functions already provide enough expressiveness and flexibility. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Loading is performed at compile time.</strong></div>
</li>
</ul>

<p>
 This makes it possible to load from the filesystem or network in direct style (instead of with callbacks) without blocking the main thread of execution. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Linking is performed at compile time.</strong></div>
</li>
</ul>

<p>
 Modules are used for scoping, and one of the top goals of Harmony is to preserve and promote static, lexical scoping. This avoids the many problems of dynamic scope: programming pitfalls (accidental or malicious scope injection), performance hazards, lack of modularity. Static scoping is also necessary for the Harmony feature of checking for unbound variables at compile time.
</p>

</div>

<a name="closed_modules"></a><h2>Closed modules</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>Modules are generally less dynamic/modifiable than traditional objects.</strong></div>
</li>
</ul>

<p>
 Modules provide the static definitions of a library, which are linked statically (see the &ldquo;static modules&rdquo; section). 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Import declarations are resolved statically.</strong></div>
</li>
</ul>

<p>
 If import declarations were resolved dynamically, then imported variables would be dynamically scoped. Harmony will not have any dynamic scoping (see the &ldquo;static modules&rdquo; section). 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Module exports cannot be removed.</strong></div>
</li>
</ul>

<p>
 If exports could be removed, then imported variables would be dynamically scoped. Harmony will not have any dynamic scoping (see the &ldquo;static modules&rdquo; section). 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Module exports cannot be mutated by clients.</strong></div>
</li>
</ul>

<p>
 This makes it possible for a library writer to have a minimal amount of local control over what clients can and can&rsquo;t do. Of course, the library can always export objects whose <em>contents</em> can be mutated.
</p>

<p>
Secondarily, this also enables optimizations such as inlining and constant propagation for pre-defined system libraries, and dynamically for user-written const library exports once they&rsquo;ve been initialized. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Modules cannot be extended with additional dynamic exports.</strong></div>
</li>
</ul>

<p>
 This would lead to a subtle difference between static module paths and dynamic module paths:
</p>
<pre class="code javascript"><span class="kw2">import</span> m.<span class="me1">n</span>.<span class="me1">o</span>.<span class="me1">dynamicallyAddedExport</span>;  <span class="co1">// fails</span>
<span class="kw2">var</span> x = m.<span class="me1">n</span>.<span class="me1">o</span>.<span class="me1">dynamicallyAddedExport</span>; <span class="co1">// succeeds</span></pre><ul>
<li class="level1"><div class="li"> <strong>Modules are not closed by default with an optional <code>open</code> annotation allowing extensibility.</strong></div>
</li>
</ul>

<p>
 This would be more complex, and would suffer the same problem: static module paths would reject paths that might succeed at runtime. Modules can achieve extensibility by, for example, exporting a <code>plugins</code> object. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Modules are not open by default with a dynamic &ldquo;sealing&rdquo; operation.</strong></div>
</li>
</ul>

<p>
 This would make it very difficult to know what other code might have run before the module was sealed. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Modules are not open by default with an optional <code>sealed</code> annotation.</strong></div>
</li>
</ul>

<p>
 This would still be complex and suffer from the divergent behavior between static and dynamic module paths. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>Module globals are unexported by default.</strong></div>
</li>
</ul>

<p>
 An alternative would be to have all top-level bindings be exported and require declaring hidden top-level bindings private to avoid exporting them. This is inconvenient and leads to accidental exports when creating local/temporary definitions in a module. CommonJS experience shows that it works well to have explicit exports.
</p>

</div>

<a name="hierarchical_modules"></a><h2>Hierarchical modules</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>Modules can be nested.</strong></div>
</li>
</ul>

<p>
 This makes it convenient to modularize code cheaply, without having to create separate files. It is also consistent with the semantics that file top-level is implicitly a module but can contain sub-modules. Finally, it makes refactoring work well: code separated into modules can itself be separated into a new parent module. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>File top-level is the body of an implicit module.</strong></div>
</li>
</ul>

<p>
 This makes it so that files do not name themselves. Clients get to name the module, which ensures lack of module name conflicts, without the library having to contend with the entire world&rsquo;s library names. It also makes versioning easy: multiple versions of a library can be separately loaded, without the library writer having to provide them with explicitly distinct names. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>A file top-level only has its loader&rsquo;s global namespace in scope.</strong></div>
</li>
</ul>

<p>
 This is the only coherent semantics given the present of module instance caching. If a module can be loaded in multiple separate scopes within the same loader, it can&rsquo;t possibly have all its clients&rsquo; scopes available to it. Moreover, this would create all sorts of accidental variable-capturing hazards.
</p>

</div>

<a name="scoping_semantics"></a><h2>Scoping semantics</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>Import does not import both modules and module exports.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Import does not see exported sub-modules.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Outer modules cannot see inner modules&rsquo; definitions.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>A module cannot export any modules other than those defined in its body.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Modules can be mutually recursive.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>The <code>import *</code> form is included.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Module paths in expressions are not statically resolved.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Module exports can include keywords.</strong></div>
</li>
</ul>

<p>
 This is simply as a minor convenience, since ES5 and Harmony syntax allow the use of keywords in a property reference expression. Exported keywords cannot, of course, be imported as variable bindings using <code>import</code>.
</p>

</div>

<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>Module declarations require a new reserved keyword.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Import/export declarations don&rsquo;t start with <code>from</code>.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Import/export declarations use destructuring syntax.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Module loading uses <code>from</code> instead of <code>=</code> to bind module names.</strong></div>
</li>
</ul>

</div>

<a name="loading_semantics"></a><h2>Loading semantics</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <strong>Loading external scripts can now be done in-language.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>Loading a module <acronym title="Uniform Resource Locator">URL</acronym> multiple times results in a single cached instance.</strong></div>
</li>
<li class="level1"><div class="li"> <strong>External modules are executed at their first reference.</strong></div>
</li>
</ul>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/d/d6c78a71741b1f92c45a852e64fe465f.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        harmony/modules_rationale.txt &middot; Last modified: 2014/06/10 16:26 by dherman      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="harmony:modules_rationale" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="harmony:modules_rationale" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="harmony:modules_rationale" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="harmony:modules_rationale" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=harmony:modules_rationale.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=harmony%253Amodules_rationale&amp;1454275733" width="1" height="1" alt=""  /></body>
</html>
