<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=harmony:rest_parameters&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=harmony" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="clear"><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#background" class="toc">Background</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#goals" class="toc">Goals</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#sketch" class="toc">Sketch</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#syntax" class="toc">Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#semantics" class="toc">Semantics</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#table_9_-_internal_properties_only_defined_for_some_objects" class="toc">Table 9 - Internal Properties Only Defined for Some Objects</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#10.5_declaration_binding_instantiation" class="toc">10.5 Declaration Binding Instantiation</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#13.2_creating_function_objects" class="toc">13.2 Creating Function Objects</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:rest_parameters&amp;do=export_html.html#issues" class="toc">Issues</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<p>
<strong>This proposal has progressed to the Draft ECMAScript 6 Specification, which is available for review here: <a href="doku.php%3Fid=harmony:specification_drafts.html" class="wikilink1" title="harmony:specification_drafts" onclick="return svchk()" onkeypress="return svchk()">specification_drafts</a>. Any new issues relating to them should be filed as bugs at <a href="http://bugs.ecmascript.org" class="urlextern" target="_blank" title="http://bugs.ecmascript.org" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://bugs.ecmascript.org</a>. The content on this page is for historic record only and may no longer reflect the current state of the feature described within.</strong>
</p>

<a name="background"></a><h2>Background</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Waldemar&rsquo;s <a href="http://www.mozilla.org/js/language/js20-2002-04/core/functions.html#rest" class="urlextern" target="_blank" title="http://www.mozilla.org/js/language/js20-2002-04/core/functions.html#rest" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">original JS2 rest parameters</a></div>
</li>
<li class="level1"><div class="li"> ES4 rest parameters, gleaned from the <a href="doku.php%3Fid=proposals:normative_grammar.html" class="wikilink1" title="proposals:normative_grammar" onclick="return svchk()" onkeypress="return svchk()">normative grammar</a> and the <a href="http://hg.ecmascript.org/es4" class="urlextern" target="_blank" title="http://hg.ecmascript.org/es4" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">reference implementation</a></div>
</li>
</ul>

</div>
<!-- SECTION [370-655] -->
<a name="goals"></a><h2>Goals</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Provide a better <code>arguments</code> so we can deprecate, obsolete, and some years hence burn with fire / salt the earth anything to do with <code>arguments</code>, <code>foo.arguments</code>, etc.</div>
</li>
<li class="level1"><div class="li"> Capture trailing arguments after one or more fixed formal parameters</div>
</li>
</ul>

</div>
<!-- SECTION [656-926] -->
<a name="sketch"></a><h2>Sketch</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Allow <code>...</code> as an optional prefix before the last formal parameter in a function declaration</div>
</li>
<li class="level1"><div class="li"> Presence of <code>...</code> in <code>function foo(...rest) {</code><em>...</em><code>}</code> creates a rest parameter, <code>rest</code>, denoting a new <code>Array</code> created when <code>foo</code> is called, whose elements from <code>0</code> to <code>foo.length</code> are supplied by the actual arguments passed to <code>foo</code> (if any)</div>
</li>
<li class="level1"><div class="li"> Similarly for <code>function bar(baz, bletch, ...rest) {</code><em>...</em><code>}</code>, with elements of <code>rest</code> being supplied by the third through last actual parameters</div>
</li>
</ul>
<pre class="code">
// Trivial this-free wrapper around Function.prototype.apply:
function simpleApply(func, ...args) {
    &quot;use strict&quot;;
    return func.apply(undefined, args);
}

// Simple printf-style string formatter, write and convert left as exercises:
function printf(format, ...args) {
    var n = 0;
    var i = 0, j;

    while ((j = format.indexOf('%', i)) &gt;= 0) {
        if (n &gt;= args.length)
            throw &quot;printf: too few args for given format &quot; + format;
        write(format.slice(i, j));

        // convert takes exactly one format-specifier char, to keep things simple.
        write(convert(s[j + 1], args[n++]));
        i = j + 2;
    }
    write(format.slice(i));
}
</pre>

</div>
<!-- SECTION [927-2162] -->
<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">

<p>
 The <em>FormalParameterList</em> clause needs to be updated as follows:
</p>
<pre class="code">
FormalParameterList :
  ... Identifier
  FormalParameterListNoRest
  FormalParameterListNoRest , ... Identifier
     
FormalParameterListNoRest :
  Identifier
  FormalParameterListNoRest , Identifier
</pre>

</div>
<!-- SECTION [2163-2466] -->
<a name="semantics"></a><h2>Semantics</h2>
<div class="level2">

<p>
 We let all Function objects have a boolean internal property indicating if it has rest parameters.
</p>

</div>
<!-- SECTION [2467-2589] -->
<a name="table_9_-_internal_properties_only_defined_for_some_objects"></a><h3>Table 9 - Internal Properties Only Defined for Some Objects</h3>
<div class="level3">
<table class="inline">
	<tr>
		<th class="leftalign"> Internal Property                      </th><th> Value Type Domain </th><th> Description </th>
	</tr>
	<tr>
		<td>[[HasRestParameter]]</td><td class="leftalign"> Boolean           </td><td> Whether the function was declared with a rest parameter. The last parameter in the [[FormalParameters]] List is used for the rest parameter. Of the standard built-in ECMAScript objects, only Function objects implement [[HasRestParameters]]. </td>
	</tr>
</table>
<br />

</div>
<!-- SECTION [2590-3079] -->
<a name="10.5_declaration_binding_instantiation"></a><h3>10.5 Declaration Binding Instantiation</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Let <em>env</em> be the environment record component of the running execution context’s VariableEnvironment.</div>
</li>
<li class="level1"><div class="li"> If <em>code</em> is eval code, then let <em>configurableBindings</em> be <strong>true</strong> else let <em>configurableBindings</em> be <strong>false</strong>.</div>
</li>
<li class="level1"><div class="li"> If <em>code</em> is strict mode code, then let <em>strict</em> be <strong>true</strong> else let <em>strict</em> be <strong>false</strong>.</div>
</li>
<li class="level1"><div class="li"> If <em>code</em> is function code, then</div>
<ol>
<li class="level2"><div class="li"> Let <em>func</em> be the function whose [[Call]] internal method initiated execution of <em>code</em>. Let <em>names</em> be the value of <em>func</em>’s [[FormalParameters]] internal property.</div>
</li>
<li class="level2"><div class="li"> Let <em>hasRest</em> be the value of <em>func</em>’s [[HasRestParameters]] internal property.</div>
</li>
<li class="level2"><div class="li"> Let <em>namesCount</em> be the number of elements in <em>names</em>.</div>
</li>
<li class="level2"><div class="li"> Let <em>argCount</em> be the number of elements in <em>args</em>.</div>
</li>
<li class="level2"><div class="li"> Let <em>n</em> be the number 0.</div>
</li>
<li class="level2"><div class="li"> For each String <em>argName</em> in <em>names</em>, in list order do</div>
<ol>
<li class="level3"><div class="li"> Let <em>n</em> be the current value of <em>n</em> plus 1.</div>
</li>
<li class="level3"><div class="li"> If <em>hasRest</em> is <strong>true</strong> and <em>n</em> is equal to <em>namesCount</em></div>
<ol>
<li class="level4"><div class="li"> Let <em>v</em> be the result of creating a new object as if by the expression <strong>new Array()</strong> where <strong>Array</strong> is the standard built-in constructor with that name.</div>
</li>
<li class="level4"><div class="li"> Let <em>index</em> be 0.</div>
</li>
<li class="level4"><div class="li"> Repeat while <em>n</em> less than or equal to <em>argCount</em></div>
<ol>
<li class="level5"><div class="li"> Let <em>value</em> be the value of the <em>n</em>th element of <em>args</em>.</div>
</li>
<li class="level5"><div class="li"> Let <em>indexName</em> be ToString(<em>index</em>).</div>
</li>
<li class="level5"><div class="li"> Call the [[DefineOwnProperty]] internal method of <em>v</em> with arguments <em>indexName</em>, the Property Descriptor { [[Value]]: <em>value</em>, [[Writable]]: <strong>true</strong>, [[Enumerable]]: <strong>true</strong>, [[Configurable]]: <strong>true</strong>}, and <strong>false</strong>.</div>
</li>
<li class="level5"><div class="li"> Let <em>index</em> be the current value of <em>index</em> plus 1.</div>
</li>
<li class="level5"><div class="li"> Let <em>n</em> be the current value of <em>n</em> plus 1.</div>
</li>
</ol>
</li>
</ol>
</li>
<li class="level3"><div class="li"> Else</div>
<ol>
<li class="level4"><div class="li"> If <em>n</em> is greater than <em>argCount</em>, let <em>v</em> be <strong>undefined</strong> otherwise let <em>v</em> be the value of the <em>n</em>th element of <em>args</em>.</div>
</li>
</ol>
</li>
<li class="level3"><div class="li"> Let <em>argAlreadyDeclared</em> be the result of calling <em>env</em>’s HasBinding concrete method passing <em>argName</em> as the argument.</div>
</li>
<li class="level3"><div class="li"> If <em>argAlreadyDeclared</em> is <strong>false</strong>, call <em>env</em>’s CreateMutableBinding concrete method passing <em>argName</em> as the argument.</div>
</li>
<li class="level3"><div class="li"> Call <em>env</em>’s SetMutableBinding concrete method passing <em>argName</em>, <em>v</em>, and <em>strict</em> as the arguments.</div>
</li>
</ol>
</li>
</ol>
</li>
<li class="level1"><div class="li"> ...</div>
</li>
</ol>

</div>
<!-- SECTION [3080-5590] -->
<a name="13.2_creating_function_objects"></a><h3>13.2 Creating Function Objects</h3>
<div class="level3">

<p>
 The callers of 13.2 should pass in <em>hasRest</em> which indicates that the function has a rest parameter. 
</p>
<ul>
<li class="level1"><div class="li"> Set the [[HasRestParameters]] to <em>hasRest</em>.</div>
</li>
</ul>

</div>
<!-- SECTION [5591-5806] -->
<a name="issues"></a><h2>Issues</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Is there any benefit to allowing <code>...</code> with no formal parameter identifier after it? Not without types or arity checks.</div>
</li>
<li class="level1"><div class="li"> Should rest parameters be frozen? There is no aliasing hazard, so freezing is premature and limits utility, <acronym title="In my humble opinion">IMHO</acronym>.</div>
</li>
</ul>

<p>
  &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2009/05/04 22:52</em>
</p>

<p>
The length property of a function should be updated to not include rest parameters.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x61%3B%26%23x72%3B%26%23x76%3B%26%23x40%3B%26%23x67%3B%26%23x6f%3B%26%23x6f%3B%26%23x67%3B%26%23x6c%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x61;&#x72;&#x76;&#x40;&#x67;&#x6f;&#x6f;&#x67;&#x6c;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Erik Arvidsson</a> 2010/11/05 22:42</em>
</p>

<p>
The semantics is not yet complete. It needs to get whether <em>FormalParameterList</em> contains rest parameters and forward that to 13.2.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x61%3B%26%23x72%3B%26%23x76%3B%26%23x40%3B%26%23x67%3B%26%23x6f%3B%26%23x6f%3B%26%23x67%3B%26%23x6c%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x61;&#x72;&#x76;&#x40;&#x67;&#x6f;&#x6f;&#x67;&#x6c;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Erik Arvidsson</a> 2010/11/09 20:47</em>
</p>

<p>
Functions that define a rest parameter should not also have an arguments object.  In other words, using ... in the parameter lists should prevent the creation of the arguments object and the local binding of &ldquo;arguments&rdquo;.  Should the strict mode restrictions on the use of the identifier &ldquo;arguments&rdquo; be relax in that case?
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x41%3B%26%23x6c%3B%26%23x6c%3B%26%23x65%3B%26%23x6e%3B%26%23x2e%3B%26%23x57%3B%26%23x69%3B%26%23x72%3B%26%23x66%3B%26%23x73%3B%26%23x2d%3B%26%23x42%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x40%3B%26%23x6d%3B%26%23x69%3B%26%23x63%3B%26%23x72%3B%26%23x6f%3B%26%23x73%3B%26%23x6f%3B%26%23x66%3B%26%23x74%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x41;&#x6c;&#x6c;&#x65;&#x6e;&#x2e;&#x57;&#x69;&#x72;&#x66;&#x73;&#x2d;&#x42;&#x72;&#x6f;&#x63;&#x6b;&#x40;&#x6d;&#x69;&#x63;&#x72;&#x6f;&#x73;&#x6f;&#x66;&#x74;&#x2e;&#x63;&#x6f;&#x6d;">Allen Wirfs-Brock</a> 2010/11/10 00:17</em> 
</p>

</div>
<!-- SECTION [5807-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/3/34280354630a1a83d39873b9a7100098.xhtml used -->
</body>
</html>
