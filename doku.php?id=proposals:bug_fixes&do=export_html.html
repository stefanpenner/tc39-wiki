<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=proposals:bug_fixes&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=proposals" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=proposals:bug_fixes&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=proposals:bug_fixes&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>

<a name="bug_fixes_to_ecma-262"></a><h1>Bug fixes to ECMA-262</h1>
<div class="level1">

<p>
 Over the last year, we have discussed and reached informal agreement to fix what seem like bugs in Editions 1-3 of ECMA-262.
</p>

</div>
<!-- SECTION [1-172] -->
<a name="small_fixes"></a><h2>Small fixes</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> [ARGUMENTS.SHOULD.BE.ARRAY] <code>arguments</code> should be an object that delegates to <code>Array.prototype</code>.  See <a href="http://bugs.ecmascript-lang.org/ticket/27" class="urlextern" target="_blank" title="http://bugs.ecmascript-lang.org/ticket/27" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://bugs.ecmascript-lang.org/ticket/27</a> for specific information.</div>
</li>
<li class="level1"><div class="li"> [EVAL.IS.OPERATOR] <code>eval</code> should be a unary operator, like <code>delete</code>.  See <a href="doku.php%3Fid=proposals:with-bound_variables.html" class="wikilink1" title="proposals:with-bound_variables" onclick="return svchk()" onkeypress="return svchk()">with-bound variables</a> for discussion.</div>
<ul>
<li class="level2"><div class="li"> Compatibility with existing web content will require supporting Edition 3 <code>eval</code>, including indirect <code>eval</code> at the implementation&rsquo;s discretion.</div>
</li>
<li class="level2"><div class="li"> Edition 4 should contain an informative specification recasting Edition 3 <code>eval</code> in Edition 4 terms, to facilitate interoperation among backward-compatible implementations.</div>
</li>
<li class="level2"><div class="li"> Does evaluation of the unary operator differ in meaning from direct <code>eval</code> application in Edition 3?  I recall someone wanting to force global scope, but that&rsquo;s incompatible and unnecessary.  If the problem is the ability of <code>eval</code> to add bindings to its dynamic scope, let&rsquo;s fix that by making something like <code>eval(&rdquo;let {...}&rdquo;)</code> instead of <code>eval(&rdquo;...&rdquo;)</code> be sweeter enough that it wins over time.  We could even define <code>eval &ldquo;...&rdquo;</code> (the unary operator expression) as the new <code>let</code>-like way.</div>
</li>
<li class="level2"><div class="li"> Would like a separate proposal on <code>eval &ldquo;...&rdquo;</code>.  &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2007/01/22 11:44</em></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> [THIS.PROPAGATES] <code>this</code> in a nested function called by the function&rsquo;s name from the outer function should bind to the outer <code>this</code>.</div>
</li>
<li class="level1"><div class="li"> [IMMUTABLE.GLOBALS] <code>undefined</code>, <code>NaN</code>, and <code>Infinity</code> in the global object should be DontDelete and ReadOnly.</div>
</li>
<li class="level1"><div class="li"> [FUNCTION.LENGTH] There are various bug in E262-3 having to do with the value of the &ldquo;length&rdquo; property on function objects.  Resolved: &ldquo;f.length should be the number of required and optional formal parameters, not counting this, and not counting rest args. Individual cases are marked with a comment.&rdquo;  Some recorded examples follow, but the stated principle should apply generally.</div>
<ul>
<li class="level2"><div class="li"> [MAX.AND.MIN.LENGTH] From the libraries proposal: &ldquo;In ECMA-262, max.length==min.length==2.  But, the actual behavior is based on arg count even with 0 or 1 args.  Decision: bug in ECMA-262 spec.&rdquo; </div>
</li>
<li class="level2"><div class="li"> [UNSHIFT.LENGTH] From the libraries proposal: &ldquo;Bug in E262 that unshift.length=1</div>
</li>
<li class="level2"><div class="li"> [VARARG.LENGTH] From the libraries proposal: &ldquo;Several vararg functions have length &gt; 0 in E262, but their behavior is tied to the number of args only, as if there were no formal parameters. In other words, calling with no args is not the same as calling with 1 or more args equal to their default values. </div>
</li>
<li class="level2"><div class="li"> [FROMCHARCODE.LENGTH] From <a href="doku.php%3Fid=proposals:builtin_classes.html" class="wikilink1" title="proposals:builtin_classes" onclick="return svchk()" onkeypress="return svchk()">builtin classes</a>, Ed noted that <code>String.fromCharCode.length === 1</code> in Edition 3, but should be 0 to tell the truth.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> [REGEXP.CONSTRUCTION] <code>new RegExp(&rdquo;pattern&rdquo;)</code> and <code>/pattern/</code> mean different things: the latter is not created anew every time it is evaluated.  This is usually surprising and is probably a historical accident?  [Brendan says it was a mistake that optimized the wrong good.]  In the context of E4X it will be more surprising still, since evaluating &lt;tag&gt;content&lt;/tag&gt; yields a new <acronym title="Extensible Markup Language">XML</acronym> object every time.</div>
</li>
<li class="level1"><div class="li"> [OBJECT.TRAILING.COMMA] Allow a trailing comma in an object initialiser.</div>
</li>
<li class="level1"><div class="li"> [MSIE.TRAILING.COMMA] Add prose to the spec to clarify that [a,b,c,].length == 3, not 4.  (Should we have a separate page for spec clarifications?)</div>
<ul>
<li class="level2"><div class="li"> ECMA-262 Edition 3 11.1.4 second paragraph and semantics seem clear enough to me &ndash; did you add this because <acronym title="Internet Explorer">IE</acronym> notoriously gets it wrong?    &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2006/03/22 21:46</em></div>
</li>
<li class="level2"><div class="li"> Yes.  I think 11.1.4 is unambiguous, but I don&rsquo;t agree that it is particularly clear, and it wouldn&rsquo;t hurt us to add a sentence that states that a terminating comma does not add to the array length.   &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/03/23 01:23</em></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> [STRING.CHARAT.BRACKETS] Support indexing strings to get (but not set) single-character substrings: <code>s[i]</code> is equivalent to <code>s.charAt(i)</code>, but it does not depend on <code>charAt</code> (which may be overridden or even deleted).</div>
</li>
<li class="level1"><div class="li"> Support the missing <code>Array.prototype.indexOf</code> and <code>.lastIndexOf</code> methods.  These take a value to find in the array, and an optional starting index.</div>
</li>
<li class="level1"><div class="li"> [BACKSLASH.NEWLINE.IN.STRINGS] Edition 3, 7.8.4 says &ldquo;NOTE  A LineTerminator character cannot appear in a string literal, even if preceded by a backslash. Both JS1 and AS3 remove escaped line terminators before scanning (or at least they behave as though they do). Let&rsquo;s make this required behavior for consistency.</div>
</li>
<li class="level1"><div class="li"> [AUTO.SEMICOLON.IN.DO.WHILE] Automatic semicolon insertion should apply after a do-while loop; see <a href="http://bugzilla.mozilla.org/show_bug.cgi?id=238945" class="urlextern" target="_blank" title="http://bugzilla.mozilla.org/show_bug.cgi?id=238945" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Mozilla bug 238945</a>.</div>
</li>
<li class="level1"><div class="li"> [ITERATE.NULL.AND.UNDEFINED] For MSIE compatibility all browsers allow the target object of &ldquo;for..in&rdquo; to be null or undefined, even though this is expressly forbidden by E262-3.  We should sanction this behavior (the loop becomes a no-op).</div>
</li>
<li class="level1"><div class="li"> [ORDER.OF.CONVERSION.IN.COMPARISON] The ToPrimitive conversion is called on the arguments to the abstract comparison procedure (11.8.5). But the operands are passed in different order depending on the comparison being evaluated. The order should always be left to right. The following test case shows to the correct behavior:</div>
</li>
</ul>
<pre class="code javascript">js&gt; <span class="kw2">var</span> a = <span class="br0">&#123;</span> valueOf:<span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">"a"</span><span class="br0">&#41;</span>;return <span class="nu0">1</span><span class="br0">&#125;</span> <span class="br0">&#125;</span> <span class="kw2">var</span> b = <span class="br0">&#123;</span> valueOf:<span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw3">print</span><span class="br0">&#40;</span><span class="st0">"b"</span><span class="br0">&#41;</span>;return <span class="nu0">1</span><span class="br0">&#125;</span> <span class="br0">&#125;</span> a&lt;b
a
b
<span class="kw2">false</span>
js&gt; a&gt;b
a
b
<span class="kw2">false</span></pre>
<p>
Please feel free to add directly to this list.  Also holler if something looks too big to be a &ldquo;bug fix&rdquo;, and deserves a separate proposal.
</p>
<ul>
<li class="level1"><div class="li"> [FOR.IN.LOOP.CREATION.ORDER] Underspecified in eds. 1,2,3. For-in loop should iterate in creation order. See <a href="http://bugs.ecmascript-lang.org/ticket/110" class="urlextern" target="_blank" title="http://bugs.ecmascript-lang.org/ticket/110" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Trac ticket #110</a>.</div>
</li>
</ul>

</div>
<!-- SECTION [173-5936] -->
<a name="bigger_issues"></a><h2>Bigger issues</h2>
<div class="level2">

<p>
 These issues are split out as separate proposals but the list is preserved here just to have it. 
</p>
<ul>
<li class="level1"><div class="li"> <code>typeof</code> cleanups </div>
<ul>
<li class="level2"><div class="li"> <a href="doku.php%3Fid=proposals:typeof.html" class="wikilink1" title="proposals:typeof" onclick="return svchk()" onkeypress="return svchk()">split out</a>.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Consider supporting operator <code>s[i:j]</code> where <code>s</code> is a sequence-like type (<code>Array</code>, <code>String</code>, etc.).  On the left-hand side of assignment this expresses a slice operation.  The advantages, as with <code>s[i]</code>, are conciseness and optimizability.</div>
<ul>
<li class="level2"><div class="li"> Too big for a bug fix?   &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/03/24 11:01</em></div>
</li>
<li class="level2"><div class="li"> <a href="doku.php%3Fid=proposals:slice_syntax.html" class="wikilink1" title="proposals:slice_syntax" onclick="return svchk()" onkeypress="return svchk()">Ok, separated as slice syntax</a>.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Provide static function entry points for all <code>Array</code> and <code>String</code> generic methods, to relieve users from having to write <code>Array.prototype.slice.apply(arraylike, i, j)</code>, e.g. (see <a href="http://developer.mozilla.org/en/docs/New_in_JavaScript_1.6#Array_and_String_generics" class="urlextern" target="_blank" title="http://developer.mozilla.org/en/docs/New_in_JavaScript_1.6#Array_and_String_generics" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Array and String generics</a> for a short example, and <a href="http://erik.eae.net/archives/2006/02/28/00.39.52/" class="urlextern" target="_blank" title="http://erik.eae.net/archives/2006/02/28/00.39.52/" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">some motivational blogging from a JS guru</a>).</div>
<ul>
<li class="level2"><div class="li"> Split out as <a href="doku.php%3Fid=proposals:static_generics.html" class="wikilink1" title="proposals:static_generics" onclick="return svchk()" onkeypress="return svchk()">static generics</a>.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Consider supporting <code>map</code>, <code>reduce</code>, <code>filter</code>, <code>each</code>, <code>some</code>, and <code>every</code> (see <a href="http://developer.mozilla.org/en/docs/New_in_JavaScript_1.6#Array_extras" class="urlextern" target="_blank" title="http://developer.mozilla.org/en/docs/New_in_JavaScript_1.6#Array_extras" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">SpiderMonkey's array extras</a> for a prototype that lacks <code>reduce</code> and renames <code>each</code> to <code>forEach</code>). </div>
<ul>
<li class="level2"><div class="li"> Split out as part of <a href="doku.php%3Fid=proposals:static_generics.html" class="wikilink1" title="proposals:static_generics" onclick="return svchk()" onkeypress="return svchk()">static generics</a>.</div>
</li>
</ul>
</li>
</ul>

<p>
  &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> / <a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x61%3B%26%23x63%3B%26%23x6d%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x61;&#x63;&#x6d;&#x2e;&#x6f;&#x72;&#x67;">Lars T Hansen</a> / <a href="mailto:%26%23x6a%3B%26%23x6f%3B%26%23x64%3B%26%23x79%3B%26%23x65%3B%26%23x72%3B%26%23x40%3B%26%23x61%3B%26%23x64%3B%26%23x6f%3B%26%23x62%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6a;&#x6f;&#x64;&#x79;&#x65;&#x72;&#x40;&#x61;&#x64;&#x6f;&#x62;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Jeff Dyer</a> various dates</em>
</p>

</div>
<!-- SECTION [5937-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/2/2381cb8f47eed2528cbf63ac83f23cd6.xhtml used -->
</body>
</html>
