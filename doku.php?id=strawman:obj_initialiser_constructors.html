<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:obj_initialiser_constructors [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:obj_initialiser_constructors&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:obj_initialiser_constructors&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:obj_initialiser_constructors&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2011-03-02T18:07:25+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:obj_initialiser_constructors&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:obj_initialiser_constructors</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:obj_initialiser_constructors" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:obj_initialiser_constructors" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:obj_initialiser_methods.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:obj_initialiser_methods">obj_initialiser_methods</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:obj_initialiser_const.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:obj_initialiser_const">obj_initialiser_const</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:object_initialiser_initialization_blocks.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:object_initialiser_initialization_blocks">object_initialiser_initialization_blocks</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:super_in_object_initialisers.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:super_in_object_initialisers">super_in_object_initialisers</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:obj_initialiser_constructors.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:obj_initialiser_constructors">obj_initialiser_constructors</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    
<a name="constructor_declarations"></a><h1>Constructor Declarations</h1>
<div class="level1">

<p>
 <em>This is one of several related <a href="doku.php%3Fid=strawman:object_initialiser_extensions.html" class="wikilink1" title="strawman:object_initialiser_extensions" onclick="return svchk()" onkeypress="return svchk()">Object Initialiser Extensions</a>.</em> 
</p>

<p>
Enhance object initialisers  provide a self contained declarative construct for defining discrete objects. Such declarations define abstractions that usually need to be named. One way to name an object literal based abstraction is to wrap it in a factory function that is used to create instances of the abstraction. However, that pattern has the disadvantage it requires two distinct constructs to represent the named abstraction and the name is most closely associated with the factory function rather than the object abstraction. This problem can be solved by creating a new declaration form that builds upon object literal syntax: 
</p>
<pre class="code javascript">constructor Point<span class="br0">&#40;</span>x,y<span class="br0">&#41;</span> <span class="br0">&#123;</span> 
	&lt;proto: AbstractPoint&gt;
	<span class="kw2">private</span> method isPoint<span class="br0">&#40;</span>p<span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="kw1">return</span> p <span class="kw1">instanceof</span> Point<span class="br0">&#125;</span><span class="br0">&#125;</span>
	<span class="co1">//public properties</span>
	<span class="kw2">const</span> x:x,
	<span class="kw2">const</span> y:y,
	method plus<span class="br0">&#40;</span>delta<span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">isPoint</span><span class="br0">&#40;</span>delta<span class="br0">&#41;</span><span class="br0">&#41;</span>
			<span class="kw1">return</span> <span class="kw2">new</span> Point<span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">x</span>+delta.<span class="me1">x</span>,<span class="kw1">this</span>.<span class="me1">y</span>+delta.<span class="me1">y</span>
		<span class="kw2">var</span> d = Number<span class="br0">&#40;</span>delta<span class="br0">&#41;</span>:
		<span class="kw1">return</span> <span class="kw2">new</span> Point<span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">x</span>+d,<span class="kw1">this</span>.<span class="me1">y</span>+d<span class="br0">&#41;</span>;
		<span class="br0">&#125;</span>
	<span class="br0">&#125;</span></pre>
<p>
Usage example: 
</p>
<pre class="code javascript"><span class="kw2">var</span> p1 = <span class="kw2">new</span> Point<span class="br0">&#40;</span><span class="nu0">0</span>,<span class="nu0">0</span><span class="br0">&#41;</span>;
<span class="kw2">var</span> p2 = <span class="kw2">new</span> Point<span class="br0">&#40;</span>a,b<span class="br0">&#41;</span>; 
<span class="kw2">var</span> p3 = p1.<span class="me1">plus</span><span class="br0">&#40;</span>p2<span class="br0">&#41;</span>.<span class="me1">plus</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span></pre>
<p>
 The “body” of a constructor declaration is an extended object literal rather than a function body. It creates a name binding in the current declaration environment whose value is an object that can be invoked as a constructor in a new expression. The object has a [[Construct]] internal property but it does not have a [[Call]] internal method so it cannot be invoked by a <em>CallExpression</em>. The formal parameters correspond to the arguments to the new expression and are in the lexical scope  of the extended object literal.
</p>

<p>
When the constructor object is invoked by a <em>NewExpression</em> it returns a newly created object as specified by the extended object literal that is the constructor body. In addition to the properties defined by the object literal, the new object has an automatically generated <code>constructor</code> property whose value is the constructor object. (If the object literal explicitly defined a <code>constructor</code> property one is not automatically generated). The constructor object does not have a <code>prototype</code> property but instead also has a special [[HasInstance]] internal method that compares the subject object’s <code>constructor</code> property value to the identity of the actual constructor object.  
</p>

</div>

<a name="syntax"></a><h2>SYNTAX</h2>
<div class="level2">

<p>
<em>ConstructorDeclaration</em> :<br/>
 <strong>constructor</strong> <em>Identifier</em> <strong>(</strong> <em>FormalParameterList<sub>opt</sub></em> <strong>)</strong> <em>ObjectLiteral</em>
</p>

</div>

<a name="desugaring"></a><h2>Desugaring</h2>
<div class="level2">

<p>
The above syntax approximately (additional error check is probably needed) desugars into: 
</p>
<pre class="code javascript"><span class="kw2">var</span> Identifier =
  <span class="br0">&#40;</span><span class="kw2">function</span> <span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
	<span class="kw2">var</span> __ctor__ = <span class="kw2">function</span> <span class="br0">&#40;</span>FormalParameterListopt <span class="br0">&#41;</span> <span class="br0">&#123;</span>
		<span class="kw2">var</span> __obj__ = ObjectLiteral;
   		<span class="kw1">if</span> <span class="br0">&#40;</span>Object.<span class="me1">getOwnPropertyDescriptor</span><span class="br0">&#40;</span>__obj__,<span class="st0">'constructor'</span><span class="br0">&#41;</span>
  			<span class="kw1">return</span> __obj__;
  		Object.<span class="me1">defineProperty</span><span class="br0">&#40;</span>__obj__,<span class="st0">'constructor'</span>,
			<span class="br0">&#123;</span>value: __ctor__, writable: <span class="kw2">true</span>, 
    			enumerable: <span class="kw2">false</span>, configurable: <span class="kw2">true</span><span class="br0">&#125;</span><span class="br0">&#41;</span>;
  		<span class="kw1">return</span> __obj__;
   		<span class="br0">&#125;</span>;
    	<span class="co1">// runtime.setSpecialConstructorHasInstance(__ctor__);</span>
     	<span class="kw1">return</span> __ctor__;
   	<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;</pre>
<p>
 The [[HasInstance]] internally if implemented in ECMAScript would be: 
</p>
<pre class="code javascript"><span class="kw2">function</span> <span class="br0">&#91;</span><span class="br0">&#91;</span>HasInstance<span class="br0">&#93;</span><span class="br0">&#93;</span> <span class="br0">&#40;</span>v<span class="br0">&#41;</span><span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">typeof</span> v !== <span class="st0">'object'</span> || v===<span class="kw2">null</span><span class="br0">&#41;</span> <span class="kw1">return</span> <span class="kw2">false</span>;
	<span class="kw1">if</span> <span class="br0">&#40;</span>v.<span class="me1">constructor</span>===<span class="kw1">this</span><span class="br0">&#41;</span> <span class="kw1">return</span> <span class="kw2">true</span>;
	<span class="kw1">return</span> <span class="kw2">false</span>;
	<span class="br0">&#125;</span></pre>
</div>

<a name="design_alternatives"></a><h2>Design Alternatives</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <code>class</code> could be used as the keyword for the declaration instead of <code>constructor</code>.</div>
</li>
<li class="level1"><div class="li"> The implicitly created constructor object could be more like a function declaration based constructor with a unique prototype property, etc.</div>
</li>
<li class="level1"><div class="li"> Similar to the <em>FunctionDeclarations</em>/<em>FunctionExpressions</em> there could also be a <em>ConstructorExpression</em> syntactic form where the identifier was optional.</div>
</li>
</ul>

<p>
 A revised proposal based upon discussions at the Sept. 2010 TC39 meeting is under development <a href="doku.php%3Fid=strawman:obj_initialiser_class_abstraction.html" class="wikilink1" title="strawman:obj_initialiser_class_abstraction" onclick="return svchk()" onkeypress="return svchk()">obj_initialiser_class_abstraction</a>  
</p>

</div>

<!-- no cachefile used, but created -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/obj_initialiser_constructors.txt &middot; Last modified: 2011/03/02 18:07 by allen      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:obj_initialiser_constructors" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:obj_initialiser_constructors" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:obj_initialiser_constructors" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:obj_initialiser_constructors" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:obj_initialiser_constructors.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Aobj_initialiser_constructors&amp;1454277401" width="1" height="1" alt=""  /></body>
</html>
