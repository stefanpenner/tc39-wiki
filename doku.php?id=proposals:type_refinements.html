<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>proposals:type_refinements [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=proposals:type_refinements&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=proposals" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=proposals:type_refinements&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=proposals:type_refinements&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2006-06-02T06:52:48+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=proposals:type_refinements&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">proposals:type_refinements</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:type_refinements" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:type_refinements" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:argument_this.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:argument_this">argument_this</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:documentation.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:documentation">documentation</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:enumeration_type.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:enumeration_type">enumeration_type</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:bytearray.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:bytearray">bytearray</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=proposals:type_refinements.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:type_refinements">type_refinements</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#motivation" class="toc">Motivation</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#proposal_1object-oriented" class="toc">Proposal 1: Object-oriented</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#bound_predicates" class="toc">Bound predicates</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#unbound_predicates" class="toc">Unbound predicates</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#arguments_to_predicates" class="toc">Arguments to predicates</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#arbitrary_expressions_for_type_refinements" class="toc">Arbitrary expressions for type refinements</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#problems" class="toc">Problems</a></span></li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#proposal_2functional" class="toc">Proposal 2: Functional</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#problems" class="toc">Problems</a></span></li>
</ul>
</li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#subtyping_and_conversion" class="toc">Subtyping and Conversion</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:type_refinements.html#predicate_combinators" class="toc">Predicate combinators</a></span></li>
</ul>
</div>
</div>

<p>
DO NOT EXPORT
</p>

<a name="motivation"></a><h1>Motivation</h1>
<div class="level1">

<p>
 Type refinements complement the <a href="doku.php%3Fid=proposals:structural_types_and_typing_of_initializers.html" class="wikilink1" title="proposals:structural_types_and_typing_of_initializers" onclick="return svchk()" onkeypress="return svchk()">type system</a> by allowing programmers to specify detailed invariants that cannot be checked by the static type system. Although the type system allows programmers to check a fairly expressive range of invariants, the system can only express statically checkable invariants. Type refinements, by contrast, are designed to be checked dynamically, and allow programmers to guard their code with syntactically lightweight assertions about precise program invariants.
</p>

<p>
Type refinements facilitate software engineering styles such as: 
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://java.sun.com/j2se/1.4.2/docs/guide/lang/assert.html" class="urlextern" target="_blank" title="http://java.sun.com/j2se/1.4.2/docs/guide/lang/assert.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">programming with assertions</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://en.wikipedia.org/wiki/Design_by_contract" class="urlextern" target="_blank" title="http://en.wikipedia.org/wiki/Design_by_contract" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">design by contract</a></div>
</li>
</ul>

</div>

<a name="proposal_1object-oriented"></a><h1>Proposal 1: Object-oriented</h1>
<div class="level1">

<p>
 Type refinements are specified as dynamic <em>predicates</em>, i.e., functions with <code>Boolean</code> result type. These predicates take one of two forms, <em>bound predicates</em> and <em>unbound predicates</em>.
</p>

</div>

<a name="bound_predicates"></a><h2>Bound predicates</h2>
<div class="level2">

<p>
 In the case where a predicate is a bound method (with the return type <code>Boolean</code>) defined in the class of the object in question, a predicate can simply be specified with the name of the method. When the value is received at runtime, the system implicitly invokes the method on the object; if the result is <code>false</code>, a runtime error is signalled.
</p>

<p>
For example, imagine that the <code>Int</code> class has a method called <code>isNatural</code> which checks whether the integer is non-negative:
</p>
<pre class="code javascript"><span class="kw2">class</span> Int <span class="br0">&#123;</span>
    ...
    <span class="kw2">function</span> isNatural<span class="br0">&#40;</span><span class="br0">&#41;</span> : Boolean <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="kw1">this</span> &gt;= <span class="nu0">0</span> <span class="br0">&#125;</span>
    ...
<span class="br0">&#125;</span></pre>
<p>
Then an expression typed as <code>Int</code> may refine the type with the bound predicate <code>isNatural</code> via some special operator (<code>&ldquo;@&rdquo;</code>? <code>&ldquo;#&rdquo;</code>? <code>&ldquo;|&rdquo;</code>? <code>&ldquo;.&rdquo;</code> would be nice but I believe introduces ambiguities with package qualifiers):
</p>
<pre class="code javascript"><span class="kw2">function</span> factorial<span class="br0">&#40;</span>n : Int#isNatural<span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span></pre>
</div>

<a name="unbound_predicates"></a><h2>Unbound predicates</h2>
<div class="level2">

<p>
 Unbound functions may be used as type refinements as well. In this case, the type of the function used for the predicate must have as its <code>this</code> type a compatible type with the type being refined.
</p>
<pre class="code javascript"><span class="kw2">function</span> trimmedString<span class="br0">&#40;</span><span class="kw1">this</span>:String<span class="br0">&#41;</span> : Boolean <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">length</span> == <span class="nu0">0</span><span class="br0">&#41;</span> || <span class="br0">&#40;</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span> != <span class="st0">' '</span><span class="br0">&#41;</span> &amp;&amp; <span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#91;</span><span class="kw1">this</span>.<span class="me1">length</span> - <span class="nu0">1</span><span class="br0">&#93;</span> != <span class="st0">' '</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">function</span> trim<span class="br0">&#40;</span>s : String<span class="br0">&#41;</span> : String#trimmedString <span class="br0">&#123;</span> ... <span class="br0">&#125;</span></pre>
</div>

<a name="arguments_to_predicates"></a><h2>Arguments to predicates</h2>
<div class="level2">

<p>
 It should also be possible to pass extra arguments to type refinements. For example:
</p>
<pre class="code javascript"><span class="kw2">function</span> hasLength<span class="br0">&#40;</span><span class="kw1">this</span>:String, n:Int#isNatural<span class="br0">&#41;</span> : Boolean <span class="br0">&#123;</span> <span class="kw1">return</span> s.<span class="me1">length</span> == n <span class="br0">&#125;</span>
&nbsp;
<span class="kw2">function</span> repeat<span class="br0">&#40;</span>n : Int#isNatural, s : String<span class="br0">&#41;</span> : String#hasLength<span class="br0">&#40;</span>n * s.<span class="me1">length</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span></pre>
<p>
Here the unbound method <code>hasLength</code> receives as its argument the value <code>n * s.length</code>. Notice that the arguments to <code>repeat</code> are in scope for the predicate expression.
</p>

</div>

<a name="arbitrary_expressions_for_type_refinements"></a><h2>Arbitrary expressions for type refinements</h2>
<div class="level2">

<p>
 The syntax used above may not be conducive to using complex expressions for predicates. We may also want a syntax that allows any expression to be used (for unbound predicates), such as:
</p>
<pre class="code javascript"><span class="kw2">function</span> foo<span class="br0">&#40;</span><span class="br0">&#41;</span> : &lt;&lt; String | <span class="coMULTI">/* complicated expression */</span><span class="br0">&#40;</span>args, ...<span class="br0">&#41;</span> &gt;&gt; <span class="br0">&#123;</span> ... <span class="br0">&#125;</span></pre>
<p>
This reads something like &ldquo;<code>foo</code> has return type <code>String</code>, where the string must pass the predicate specified by calling the unbound method returned by the <em>complicated expression</em> on arguments <em>args</em>.&rdquo;
</p>

</div>

<a name="problems"></a><h2>Problems</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> the difference between bound and unbound predicates is subtle</div>
</li>
<li class="level1"><div class="li"> the syntax is overwhelming</div>
</li>
<li class="level1"><div class="li"> we need a better syntax for the arbitrary expression form, but we&rsquo;re out of delimiters (<code>[</code>, <code>{</code>, and <code>(</code> are all taken, and <code>&lt;</code> conceptually means type parameterization)</div>
</li>
<li class="level1"><div class="li"> if we tried to combine the two syntactic forms, there&rsquo;d be an ambiguity between a simple predicate that is being given arguments (e.g., the <code>hasLength</code> example) and an ordinary expression that happens to be a function call expression</div>
</li>
</ul>

</div>

<a name="proposal_2functional"></a><h1>Proposal 2: Functional</h1>
<div class="level1">

<p>
 In this proposal, predicates are simply functions that take a single argument and return a <code>Boolean</code>. There is no way to write a predicate that operates on multiple function arguments.
</p>

<p>
<strong>To do:</strong> <em>more detail</em>
</p>

</div>

<a name="problems"></a><h2>Problems</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> less expressive: no way to express invariants between arguments</div>
</li>
<li class="level1"><div class="li"> perhaps less idiomatic (no useful meaning for <code>this</code> in the predicate)</div>
</li>
</ul>

</div>

<a name="subtyping_and_conversion"></a><h1>Subtyping and Conversion</h1>
<div class="level1">

<p>
 <code>Int#isNatural</code> is a subtype of <code>Int</code>. 
</p>

<p>
<code>Int#isNatural</code> and <code>Int#isPositive</code> are not subtypes of each other, but they are convertible.
</p>

<p>
Similarly, <code>Int</code> is convertible to <code>Int#isNatural</code>.
</p>

</div>

<a name="predicate_combinators"></a><h1>Predicate combinators</h1>
<div class="level1">

<p>
 It&rsquo;s useful to have predicate combinators like &ldquo;and&rdquo; and &ldquo;or&rdquo;, e.g.: 
</p>
<pre class="code">C ::= ...
   |  C &quot;&amp;&amp;&quot; C
   |  C &quot;||&quot; C</pre>

<p>
 Is this worth adding to the grammar? It could basically be sugar for a wrapper predicate that performs the conjunction or disjunction, but it&rsquo;s more concise and could be implemented more efficiently. 
</p>

</div>

<!-- no cachefile used, but created -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        proposals/type_refinements.txt &middot; Last modified: 2006/06/02 06:52 by jodyer      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:type_refinements" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:type_refinements" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="proposals:type_refinements" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="proposals:type_refinements" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=proposals:type_refinements.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=proposals%253Atype_refinements&amp;1454276630" width="1" height="1" alt=""  /></body>
</html>
