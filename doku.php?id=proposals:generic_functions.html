<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>proposals:generic_functions [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=proposals:generic_functions&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=proposals" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=proposals:generic_functions&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=proposals:generic_functions&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2007-08-14T18:59:58+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=proposals:generic_functions&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">proposals:generic_functions</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:generic_functions" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:generic_functions" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:remove_the_arguments_object.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:remove_the_arguments_object">remove_the_arguments_object</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:resurrected_eval.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:resurrected_eval">resurrected_eval</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:arrays.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:arrays">arrays</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:program_units.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:program_units">program_units</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=proposals:generic_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:generic_functions">generic_functions</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#generic_functions_for_es4" class="toc">Generic functions for ES4</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#motivation" class="toc">Motivation</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#overview" class="toc">Overview</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#proposal_for_generic_functions" class="toc">Proposal for generic functions</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#defining_functions" class="toc">Defining functions</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#defining_methods" class="toc">Defining methods</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#invocation" class="toc">Invocation</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#computing_the_applicable_methods" class="toc">Computing the applicable methods</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#sorting_the_applicable_methods" class="toc">Sorting the applicable methods</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#nextmethod" class="toc">nextMethod</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#null_values_null_types_and_nullability" class="toc">Null values, null types, and nullability</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#types_and_type_checking" class="toc">Types and type checking</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#error_reporting" class="toc">Error reporting</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#tostring" class="toc">toString</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#implementation_notes" class="toc">Implementation notes</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#open_questions" class="toc">Open questions</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#proposalremove_the_current_operator_overloading_mechanism" class="toc">Proposal: remove the current operator overloading mechanism</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#proposal_for_built-in_generic_functions" class="toc">Proposal for built-in generic functions</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#secondary_proposalsfinal_generic_functionsstatic_generic_functions" class="toc">Secondary proposals: final generic functions; static generic functions</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#final_generic_functions" class="toc">Final generic functions</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#static_generic_functions" class="toc">Static generic functions</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#non-features_future_directions_etc" class="toc">Non-features, future directions, etc</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:generic_functions.html#background_material" class="toc">Background material</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="generic_functions_for_es4"></a><h1>Generic functions for ES4</h1>
<div class="level1">

<p>
 2007-08-13 / lhansen@adobe.com / rev 3
</p>

<p>
Also see <a href="doku.php%3Fid=discussion:generic_functions.html" class="wikilink1" title="discussion:generic_functions" onclick="return svchk()" onkeypress="return svchk()">the discussion page</a> for this proposal.
</p>

</div>

<a name="motivation"></a><h2>Motivation</h2>
<div class="level2">

<p>
 Our current operator overloading proposal is very weak.  We ought to have something with proper type dispatch.  Instead of putting something ad-hoc into classes we should just provide for generic functions (multimethods).
</p>

</div>

<a name="overview"></a><h2>Overview</h2>
<div class="level2">

<p>
 Generic functions are function objects each with a set of attached methods.  A call to a generic function matches the types of the actual arguments to the signatures of the attached methods and dispatches to the most appropriate method following deterministic rules.
</p>

<p>
In this proposal, generic functions are only definable at the top level of programs, packages, and functions.  See the last section for other opportunities.
</p>

<p>
New methods can be attached to a generic function at any time. Methods cannot be redefined or removed.
</p>

<p>
At the time a generic function is called, the applicable methods (determined by the manifest types of the actual arguments) are selected and ordered by specificity.  Methods that cannot be ordered cannot be invoked, and if the set of ordered methods is empty the function cannot be invoked at all and an error is signalled.  The most specific member of the set of ordered methods is invoked; the method can ask that control be passed to the next most specific method, and so on.
</p>

</div>

<a name="proposal_for_generic_functions"></a><h2>Proposal for generic functions</h2>
<div class="level2">

</div>

<a name="defining_functions"></a><h3>Defining functions</h3>
<div class="level3">

<p>
 A generic function is defined by a body-less function definition using the contextual keyword pair &ldquo;generic function&rdquo;:
</p>
<pre class="code">
  generic function f(x, y);
</pre>

<p>
Optional and rest arguments are allowed.  The default values for the optional arguments will become the default values for those arguments for all methods.
</p>

<p>
The non-rest arguments are called the <em>fixed</em> arguments.  The <em>arity</em> of a generic function is number of fixed arguments.
</p>

<p>
Type annotations called <em>constraints</em> are allowed on the fixed arguments and on the function itself, to denote a return type.  Constraints serve two purposes: they constraint the specializers and return types of the methods (see the next section), and they provide a type for the generic function itself:
</p>
<pre class="code">
  generic function f(x: Numeric, y: Object): MyClass;
</pre>

<p>
Generic functions cannot be parameterized by types, eg, <code>generic function f.&lt;T&gt;(...)</code> is not allowed.  (This can change, but some issues must be resolved first; see <a href="doku.php%3Fid=discussion:generic_functions.html" class="wikilink1" title="discussion:generic_functions" onclick="return svchk()" onkeypress="return svchk()">the discussion page</a>.)
</p>

</div>

<a name="defining_methods"></a><h3>Defining methods</h3>
<div class="level3">

<p>
 A <em>method</em> is defined on an already defined generic function by providing <em>specializers</em> for the fixed arguments and a <em>body</em> for the code.  There must be exactly as many specializers as there are fixed arguments.
</p>

<p>
The specializers are types, and are expressed as type annotations on the method parameters.  The body is provided as a regular function body:
</p>
<pre class="code">
  generic function f(x:int, y:boolean): string {
      if (y)
          return string(x);
      else
          return &quot;37&quot;;
  }
</pre>

<p>
The specializers must all be either nominal types (class or interface types) or union types of nominal types, plus <code>null</code>, <code>undefined</code>, and <code>*</code>.  If a specializer is absent it defaults to <code>*</code>.
</p>

<p>
A method definition that uses a union type specializer actually defines a set of methods simultaneously, one method per type in the union.
</p>

<p>
Each specializer must be a subtype [sic] of the corresponding constraint in the generic function definition, if a constraint was provided.
</p>

<p>
The return type must be a subtype of the return type constraint in the generic function definition, if a constraint was provided.
</p>

<p>
If the generic function was defined as taking rest arguments then the method may be defined as taking rest arguments as well.
</p>

<p>
The method may not have any optional arguments; default values are provided for the trailing fixed arguments by the generic function.
</p>

</div>

<a name="invocation"></a><h3>Invocation</h3>
<div class="level3">

<p>
 Generic functions are invoked using the normal function invocation syntax.
</p>

<p>
When the function is invoked, the manifest types of the actual arguments are compared to the specializer signatures of the methods, and a set of applicable methods is computed (see below).
</p>

<p>
The applicable methods are then ordered as described below, this yields a set of totally ordered methods and a set of unordered methods.
</p>

<p>
If the set of totally ordered methods is empty, an error is thrown. Otherwise, the first such method is invoked on the arguments.  If the method returns normally or throws an exception then the generic function terminates in the same way.
</p>

</div>

<a name="computing_the_applicable_methods"></a><h4>Computing the applicable methods</h4>
<div class="level4">

<p>
 A method <em>m</em> is applicable if, for every fixed parameter position <em>i</em>, the manifest type of fixed actual argument <em>i</em> is a subtype of the specializer for formal parameter <em>i</em> of <em>m</em>.
</p>

</div>

<a name="sorting_the_applicable_methods"></a><h4>Sorting the applicable methods</h4>
<div class="level4">

<p>
 The applicable methods can be sorted in order of specificity.  This ordering prefers more specific methods over less specific methods (ie, if a specializer <em>s</em> is a subclass of another specializer <em>t</em> then the method using <em>s</em> is preferred) and breaks ties in a predictable way.  This problem has been studied in the literature in the context of CLOS, Dylan, Cecil, and MultiJava.
</p>

<p>
For the time being, I&rsquo;m proposing we use Dylan&rsquo;s algorithm for Method Specificity computation (DRM pp 96-98).
</p>

<p>
For this algorithm we need to construct the class precedence list for classes and interfaces.  We take the local precedence order of a class to be the list containing the base class followed by the implemented interfaces in the order they are present in the class definition, and the local precedence order of an interface to be the list of base interfaces in the order they are present in the interface definition. We then use Dylan&rsquo;s algorithm for computing the class precedence list (DRM pp 54-56).
</p>

<p>
This yields a set of totally ordered methods and a set of unordered methods as desired.
</p>

<p>
(All of this is subject to revision as we study the problem.)
</p>

</div>

<a name="nextmethod"></a><h4>nextMethod</h4>
<div class="level4">

<p>
 Inside the method body the function <code>nextMethod</code> is defined (it is passed as the first argument to the method).  If <code>nextMethod</code> is called it invokes the next method in the list of ordered applicable methods on the argument values on which the present method was invoked.  This call is a normal call and returns the result of the next method.
</p>

</div>

<a name="null_values_null_types_and_nullability"></a><h3>Null values, null types, and nullability</h3>
<div class="level3">

<p>
 The type <code>null</code> is stripped from any type used as a specializer except when <code>null</code> is the lone specializer or it is mentioned explicitly in a union type that is syntactically visible as a union type in the specializer.
</p>

<p>
Thus if <code>C</code> is a nullable class, the following definitions <em>do not</em> specialize for a null value:
</p>
<pre class="code">
  generic function f(x: C) { ... }

  type t = (C!,null)
  generic function f(x: t) { ... }
</pre>

<p>
But these definitions <em>do</em> specialize for a null value:
</p>
<pre class="code">
  generic function f(x: null) { ... }
  generic function f(x: (C,null)) { ... }
</pre>

<p>
See <a href="doku.php%3Fid=discussion:generic_functions.html" class="wikilink1" title="discussion:generic_functions" onclick="return svchk()" onkeypress="return svchk()">the discussion page</a> for some background and other options.
</p>

</div>

<a name="types_and_type_checking"></a><h3>Types and type checking</h3>
<div class="level3">

<p>
 Generic functions have a structural function type that is given by its declared constraints; for example, in the example above the type is <code>function(Numeric,Boolean):MyClass</code>.  As a result, generic functions participate in compile-time and run-type type checking exactly like other functions.
</p>

<p>
If <code>GF</code> is a generic function, then:
</p>
<ul>
<li class="level1"><div class="li"> <code>typeof GF</code> &rArr; <code>&ldquo;function&rdquo;</code></div>
</li>
<li class="level1"><div class="li"> <code>GF is Function</code> &rArr; <code>true</code></div>
</li>
<li class="level1"><div class="li"> <code>GF instanceof Function</code> &rArr; <code>true</code>.</div>
</li>
</ul>

<p>
 Any particular application of a generic function to a set of values may throw run-time type errors if (a) there are no applicable methods for the given arguments or (b) there is no unique most specific method for the given arguments.
</p>

<p>
Some work has been done on checking statically and modularly that these run-time errors will not occur [Clifton 2006].  These techniques depend on placing constraints on how generic functions are declared and imported and are probably not a good fit for ECMAScript&rsquo;s generic functions in their full generality.
</p>

<p>
However, if we were to accept the (separate) proposal for <code>final</code> generic functions, then it should be possible for strict mode to check that generic functions so declared can&rsquo;t throw these errors.
</p>

</div>

<a name="error_reporting"></a><h3>Error reporting</h3>
<div class="level3">

<p>
 A method definition fails if the number of specializers does not equal the number of fixed arguments in the generic function.  This error may be signalled at compile-time.
</p>

<p>
A generic function invocation fails at run-time if there are no methods in the totally ordered subset of the applicable methods.
</p>

</div>

<a name="tostring"></a><h3>toString</h3>
<div class="level3">

<p>
 The <code>toString</code> method on generic functions returns an implementation-defined string consisting of text for a generic function definition followed by text for each of the methods defined on the function, in some arbitrary order, with all texts separated by a newline character.
</p>

</div>

<a name="implementation_notes"></a><h3>Implementation notes</h3>
<div class="level3">

<p>
 The realization of generic functions is left vague on purpose in this proposal.  There is a proof-of-concept generic function system that is now part of the reference implementation that treats generic function and method definitions as syntactic sugar for constructors and method calls on a class called &ldquo;GenericFunction&rdquo;, which has an invoke() method to handle the call.  This implementation uses some system hooks that will eventually be provided as standard meta-object hooks (according to the already accepted meta-object proposal).
</p>

<p>
In other words, apart from surface syntax, generic functions appear to be implementable in the language.
</p>

<p>
Due to some limitations in the current reference implementation, union types are not yet supported.
</p>

</div>

<a name="open_questions"></a><h3>Open questions</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Are union types still sorted?  (I think not &ndash; that was for user-defined conversions, which are gone.)  If so, does union order influence method ordering?</div>
</li>
<li class="level1"><div class="li"> Consider <code>Set.&lt;int&gt;</code> and <code>Set.&lt;*&gt;</code>: should a method specialized on the latter apply to the former, like a method specialized on <code>*</code> applies to <code>int</code>?  If so, what kinds of complexities are introduced?</div>
</li>
</ul>

</div>

<a name="proposalremove_the_current_operator_overloading_mechanism"></a><h2>Proposal: remove the current operator overloading mechanism</h2>
<div class="level2">

<p>
 The operator overloading mechanism is too weak and hard to control. We should just remove it, whatever else we do.
</p>

</div>

<a name="proposal_for_built-in_generic_functions"></a><h2>Proposal for built-in generic functions</h2>
<div class="level2">

<p>
 One of the strengths of generic functions is their ability to extend built-in facilities in a seamless way by means of adding cases to predefined hooks.
</p>

<p>
For example, in ECMAScript one might think of each of the built-in functions (eg <code>Number</code>) as a generic function because these functions perform conversion based on the input type; it might be useful for user code to extend the meaning of each such conversion by adding methods to the converter functions.
</p>

<p>
The definition of a full, coherent, and useful set of built-in generic functions for ECMAScript does not fit into the ES4 timeframe, but I would like not to take the language in a direction that prevents us from adding such functions in the future.
</p>

<p>
However, global generic functions shall be predefined for all the operator names in the language (full list to be provided), allowing for operator overloading on new types.
</p>

<p>
These built-in generic functions will be defined in such a way that an implementation can use fast paths that do not check if new methods have been defined on built-in generic functions; since fundamental types like int and string are final, and since generic functions do not allow for method replacement, there can be no more specific methods defined than those that are primitive to the system.
</p>

<p>
By way of example, here is a plausible definition for &ldquo;+&rdquo;
</p>
<pre class="code">
  // Since + takes one or two arguments we create a distinguished 
  // type for the one-argument case, letting a value of this type
  // be the default value for the second argument.

  private class Absent {}
  private const AbsentValue = new Absent;

  // Primitive number representations are handled here

  private type Numbers = (int,uint,double,decimal)

  // + takes two arguments but the second is optional
  generic function +(a, b=AbsentValue);

  // Unary +

  generic function +(a:*, b:Absent): Numbers
      ToNumeric(a);

  generic function +(a:Numbers, b:Absent):Numbers
      a;

  // Binary +

  // Anything and a string turns into string-append
  generic function +(a:string, b:*): string
      intrinsic::stringAppend(a,string(b));

  generic function +(a:*, b:string): string
      intrinsic::stringAppend(string(a),b);

  // Numbers are handled by primitive code
  generic function +(a:Numbers, b:Numbers): Numbers
      intrinsic::+(a,b);

  // Otherwise, convert both to primitive, then to number,
  // and add them.
  generic function +(a:*, b:*): Numbers
      intrinsic::+(ToNumeric(ToPrimitive(a)) + ToNumeric(ToPrimitive(b)));
</pre>

</div>

<a name="secondary_proposalsfinal_generic_functionsstatic_generic_functions"></a><h2>Secondary proposals: final generic functions; static generic functions</h2>
<div class="level2">

<p>
 The previous proposals do not depend on the following, but the following may not add much complexity and may have substantial utility.
</p>

</div>

<a name="final_generic_functions"></a><h3>Final generic functions</h3>
<div class="level3">

<p>
 A top-level generic function may be designated <code>final</code>.  The meaning of this is that methods may not be added to the function outside the package fragment in which the function is defined.
</p>

<p>
This is primarily a security measure: unrelated code won&rsquo;t be able to extend a method to its own needs (or for nefarious purposes).
</p>

<p>
Secondarily, it aids strict-mode type checking and optimization.
</p>

</div>

<a name="static_generic_functions"></a><h3>Static generic functions</h3>
<div class="level3">

<p>
 A generic function may be defined inside a class if it is designated <code>static</code>:
</p>
<pre class="code">
  class Cls {
    ...
    static generic function fun(...);
  }
</pre>

<p>
These generic functions have the same semantics as top-level generic functions; only the scope is different.
</p>

<p>
Outside the class <code>Cls</code> containing generic function <code>fun</code>, methods may be added using the following syntax:
</p>
<pre class="code">
  static generic function Cls.fun(...) { ... }
</pre>

<p>
Static generic functions can be designated <code>final</code>.  The meaning is that methods may not be added outside the class in which they&rsquo;re defined.
</p>

<p>
The special class static methods (the constructor; <code>meta static invoke</code>) can be generic functions.
</p>

</div>

<a name="non-features_future_directions_etc"></a><h2>Non-features, future directions, etc</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Generic functions are not implicitly defined when a method is defined on a non-existing function.  This keeps things simple and explicit.</div>
</li>
<li class="level1"><div class="li"> There are no generic class-instance methods.  These would not be hard add &ndash; the dispatch would be two-stage, with normal method lookup in the receiver followed by type dispatch &ndash; but there are various approaches we could take wrt overriding, so it seemed a bit much to handle it now.</div>
</li>
<li class="level1"><div class="li"> Generic functions have only one &ldquo;shape&rdquo;, with a set number of fixed parameter.  It would not be very hard to allow for multiple shapes, so that eg the hack with the &ldquo;Absent&rdquo; value in the case of generic + above would feel less unnatural.</div>
</li>
<li class="level1"><div class="li"> The current proposal does not allow for removing methods or redefining them; but the intent is that it does not preclude these operations being added in the future.  eg, non-removable methods on top-level generic functions could be designated &ldquo;final&rdquo;, every other method could be removable.</div>
</li>
<li class="level1"><div class="li"> Structural object and array types cannot be used as specializers.  These have prior history as &ldquo;eql&rdquo; specializers in CLOS; if we feel they are useful we can probably add them later.</div>
</li>
<li class="level1"><div class="li"> The Function constructor can&rsquo;t be used to create generic functions.</div>
</li>
<li class="level1"><div class="li"> There is no way to add methods at run-time, in particular, &ldquo;eval&rdquo; can&rsquo;t do it.  The example implementation in the reference implementation does have run-time method-addition facilities, but those are not intended to be available to user code.  (I don&rsquo;t know how valuable this restriction is, but it does allow &ldquo;eval&rdquo; to use completely different evaluation strategies compared to an ahead-of-time compiler.)</div>
</li>
<li class="level1"><div class="li"> There are no generic function expressions &ndash; they only make much sense when methods can be added at run-time.</div>
</li>
<li class="level1"><div class="li"> It would be straightforward to allow <code>nextMethod</code> to take arguments so that the next method could be called on different arguments than the current method.</div>
</li>
<li class="level1"><div class="li"> Calls to generic functions do not convert their arguments to primitive values if necessary (unlike normal calls). The point of generic functions is to discriminate among types, so conversions to primitive type does not seem very desirable. It may however desirable to perform conversion if there are no applicable methods for a call to a generic function.  <a href="doku.php%3Fid=discussion:generic_functions.html" class="wikilink1" title="discussion:generic_functions" onclick="return svchk()" onkeypress="return svchk()">The discussion page</a> outlines a plausible algorithm.</div>
</li>
</ul>

</div>

<a name="background_material"></a><h2>Background material</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> [Barrett 1996] Kim Barrett, Bob Cassels, Paul Haahr, David A Moon, Keith Playford, and P Tucker Withington: &ldquo;A Monotonic Superclass Linearization for Dylan&rdquo;, OOPSLA 1996.</div>
</li>
<li class="level1"><div class="li"> [Clifton 2006] Curtis Clifton, Todd Millstein, Gary T Leavens, and Craig Chambers: &ldquo;MultiJava: Design Rationale, Compiler Implementation, and Applications&rdquo;.  ACM TOPLAS 28(3), May 2006.</div>
</li>
<li class="level1"><div class="li"> [DRM 1996] Andrew Shalit, &ldquo;The Dylan Reference Manual&rdquo;, Addison Wesley 1996.</div>
</li>
<li class="level1"><div class="li"> [Dujardin 1998] Eric Dujardin, Eric Amiel, and Eric Simon, &ldquo;Fast Algorithms for Compressed Multimethod Dispatch table generation&rdquo;.  ACM TOPLAS 20(1), January 1998.</div>
</li>
<li class="level1"><div class="li"> [Kiczales 1991] Gregor Kiczales, Jim des Rivieres, and Daniel G Bobrow, &ldquo;The Art of the Meta-Object Protocol&rdquo;, <acronym title="Massachusetts Institute of Technology">MIT</acronym> Press 1991.</div>
</li>
<li class="level1"><div class="li"> [Smith 2003] Julian Smith, &ldquo;Adding multimethods to C++&rdquo;. <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1529.html" class="urlextern" target="_blank" title="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1529.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2003/n1529.html</a></div>
</li>
<li class="level1"><div class="li"> [van Rossum 2005] Guido van Rossum, &ldquo;Five-minute multimethods in Python&rdquo;.  <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=101605" class="urlextern" target="_blank" title="http://www.artima.com/weblogs/viewpost.jsp?thread=101605" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://www.artima.com/weblogs/viewpost.jsp?thread=101605</a></div>
</li>
</ul>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/0/06f3540485478681fd4bd92b5ba29e38.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        proposals/generic_functions.txt &middot; Last modified: 2007/08/14 18:59 by lars      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:generic_functions" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:generic_functions" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="proposals:generic_functions" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="proposals:generic_functions" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=proposals:generic_functions.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=proposals%253Ageneric_functions&amp;1454275570" width="1" height="1" alt=""  /></body>
</html>
