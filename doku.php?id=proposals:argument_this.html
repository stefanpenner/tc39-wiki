<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>proposals:argument_this [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=proposals:argument_this&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=proposals" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=proposals:argument_this&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=proposals:argument_this&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2007-05-18T21:58:08+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=proposals:argument_this&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">proposals:argument_this</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:argument_this" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:argument_this" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:operators.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:operators">operators</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=spec:wikiexportscript.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="spec:wikiexportscript">wikiexportscript</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=spec:type_system.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="spec:type_system">type_system</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:program_configuration.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:program_configuration">program_configuration</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=proposals:argument_this.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:argument_this">argument_this</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    
<p>
(See also the <a href="doku.php%3Fid=discussion:argument_this.html" class="wikilink1" title="discussion:argument_this" onclick="return svchk()" onkeypress="return svchk()">discussion page</a>.)
</p>

<a name="proposal_for_argument_this"></a><h1>Proposal for &quot;Argument This&quot;</h1>
<div class="level1">

<p>
 For class methods, we really have two design options:
</p>
<ul>
<li class="level1"><div class="li"> &ldquo;Bound-this&rdquo;: The class method closes over this, and always ignores its first argument (this is the current design).</div>
</li>
<li class="level1"><div class="li"> &ldquo;Argument-this&rdquo;: The class method does not close over this, and instead uses its first argument.</div>
</li>
</ul>

<p>
 I wonder if its possible at this  stage to re-visit the issue of &ldquo;bound-this&rdquo;.   I&rsquo;ve been trying to formalize the semantics of a mini-ES4, and bound-this methods are turning out a bit awkward to fit in. I understand that &ldquo;bound-this&rdquo; has precedent in Actionscript and it guarantees that &ldquo;this&rdquo; always has the right type (that is, this class or a subclass), which may facilitate optimization.
</p>

<p>
Yet there are some technical benefits for &ldquo;argument-this&rdquo;: it yields a smaller and more coherent language, with only one flavor of method (plain vanilla ES3, now with types). It means that all methods (both from classes and structural objects) take a &ldquo;this&rdquo; argument, which is what ES3 programmers might expect, and is perhaps more &ldquo;Javascripty&rdquo;.
</p>

<p>
The type system, via self types, can ensure (in both strict and standard mode) that &ldquo;this&rdquo; is a subtype of (or compatible with) the underlying class type, which is a somewhat weaker guarantee than &ldquo;bound-this&rdquo;.
</p>

<p>
Bound-this does support the nice coding pattern: 
</p>
<pre class="code">   doTenTimes( outputStream.println )</pre>

<p>
 However, this works only if the object outputStream comes from a class, and breaks if outputStream is a structural object. That is, bound-this methods and object methods are just different kinds of entities. The more robust coding pattern: 
</p>
<pre class="code">   doTenTimes( function() outputStream.println() )</pre>

<p>
 that works for both class methods and object methods will also work under both  bound-this and argument-this. It seems that porting code from &ldquo;bound this&rdquo; to &ldquo;argument this&rdquo; primarily requires introducing these wrappers around method extractions. I think argument-this supports  all the coding patterns that programmers should use, and in weird corner cases it gives a semantics that is perhaps more consistent with ES3 and structural objects.
</p>

<p>
&ldquo;Argument this&rdquo; also yields a smoother interoperation between classes and objects, from the point-of-view of the type system. For example, the class D  
</p>
<pre class="code">  class D { var foo:int = 10; function f():int { return this.foo } };</pre>

<p>
 is a subtype of  
</p>
<pre class="code">  {foo:int; function(this:this):int }</pre>

<p>
 under &ldquo;argument-this&rdquo;; under &ldquo;bound this&rdquo;, D is a subtype of 
</p>
<pre class="code">  {foo:int; function(this:*):int }</pre>

<p>
 where this:* indicates that the &ldquo;this&rdquo; argument is discarded, and looks a little strange.
</p>

<p>
Since classes are new in ES4, this is our only chance to get them right.  It it still possible to revisit this issue at this stage? Would it significantly hurt compatibility with Actionscript?
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x63%3B%26%23x6f%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x63%3B%26%23x40%3B%26%23x73%3B%26%23x6f%3B%26%23x65%3B%26%23x2e%3B%26%23x75%3B%26%23x63%3B%26%23x73%3B%26%23x63%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x63;&#x6f;&#x72;&#x6d;&#x61;&#x63;&#x40;&#x73;&#x6f;&#x65;&#x2e;&#x75;&#x63;&#x73;&#x63;&#x2e;&#x65;&#x64;&#x75;">Cormac Flanagan</a> 2007/05/14 09:10</em>
</p>

<p>
There is a third option: 
</p>
<ul>
<li class="level1"><div class="li"> &ldquo;Rejected-this&rdquo;: The class method closes over this, and any attempt to invoke the extracted method with a non-null this object causes a run-time (or compile-time, if you can track it) error.</div>
</li>
</ul>

<p>
 Under this rule, D is a subtype of  
</p>
<pre class="code">  {foo:int; function(this:()):int }</pre>

<p>
 or perhaps even 
</p>
<pre class="code">  {foo:int; function(this:D):int }</pre>

<p>
 Don&rsquo;t know what this does for your type system, though.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x61%3B%26%23x63%3B%26%23x6d%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x61;&#x63;&#x6d;&#x2e;&#x6f;&#x72;&#x67;">Lars T Hansen</a> 2007/05/15 05:39</em> 
</p>

</div>

<!-- no cachefile used, but created -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        proposals/argument_this.txt &middot; Last modified: 2007/05/18 21:58 by brendan      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:argument_this" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:argument_this" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="proposals:argument_this" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="proposals:argument_this" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=proposals:argument_this.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=proposals%253Aargument_this&amp;1454276577" width="1" height="1" alt=""  /></body>
</html>
