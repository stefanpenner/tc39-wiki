<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:soft_bind [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:soft_bind&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:soft_bind&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:soft_bind&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2011-03-03T18:33:34+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:soft_bind&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:soft_bind</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:soft_bind" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:soft_bind" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:const_functions.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:const_functions">const_functions</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:block_lambda_revival.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:block_lambda_revival">block_lambda_revival</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:arrow_function_syntax.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:arrow_function_syntax">arrow_function_syntax</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:fix_function_name_binding.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:fix_function_name_binding">fix_function_name_binding</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:soft_bind.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:soft_bind">soft_bind</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    
<a name="soft_binding"></a><h1>Soft Binding</h1>
<div class="level1">

<p>
 Some have expressed a desire (<a href="http://infrequently.org/2010/09/javascript-uxo-removal/" class="urlextern" target="_blank" title="http://infrequently.org/2010/09/javascript-uxo-removal/" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://infrequently.org/2010/09/javascript-uxo-removal/</a> TODO more links) for a this-binding strength intermediate between JavaScript&rsquo;s default loose <code>this</code>-binding rule and the tight <code>this</code> binding provided by Function.prototype.bind. There have been several proposals for such intermediate binding operations (TODO provide links) but these proposals ran aground on problematic edge cases demonstrating deeper semantic issues. The following new proposal seems better, but is also less examined.
</p>

<p>
Introduce a new <code>soft bind</code> operation, parallel to the existing <code>bind</code> operation, producing a similarly bound function object that uses its captured <code>this</code>-binding under normal non-reflective invocation &ndash; including being invoked as a function and as a method. However, when invoked reflectively via <code>call</code>, <code>apply</code>, <code>bind</code>, or <code>softBind</code>, the function would use the <code>this</code>-binding provided by the reflective call rather than its captured one.
</p>

<p>
The following is an approximate executable specification. As usual for JavaScript, it is a bit sloppy regarding when it uses, for example, the original or current binding of <code>Array.prototype.concat</code>. Whenever reasonable, <em>original</em> should be assumed.
</p>
<pre class="code javascript">   <span class="kw2">Function</span>.<span class="me1">prototype</span>.<span class="me1">softBind</span> = <span class="kw2">function</span><span class="br0">&#40;</span>thisArg, ...<span class="me1">leftArgs</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
     <span class="kw2">var</span> f = <span class="kw1">this</span>;
     <span class="kw2">var</span> result = f.<span class="me1">bind</span><span class="br0">&#40;</span>thisArg, ...<span class="me1">leftArgs</span><span class="br0">&#41;</span>;
     result.<span class="me1">apply</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, rightArgs<span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw1">return</span> f.<span class="me1">apply</span><span class="br0">&#40;</span>newThis, <span class="br0">&#91;</span>...<span class="me1">leftArgs</span>, ...<span class="me1">rightArgs</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     result.<span class="me1">call</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, ...<span class="me1">rightArgs</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw1">return</span> f.<span class="me1">call</span><span class="br0">&#40;</span>newThis, ...<span class="br0">&#91;</span>...<span class="me1">leftArgs</span>, ...<span class="me1">rightArgs</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     result.<span class="me1">bind</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, ...<span class="me1">rightArgs</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw1">return</span> f.<span class="me1">bind</span><span class="br0">&#40;</span>newThis, ...<span class="br0">&#91;</span>...<span class="me1">leftArgs</span>, ...<span class="me1">rightArgs</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     result.<span class="me1">softBind</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, ...<span class="me1">rightArgs</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw1">return</span> f.<span class="me1">softBind</span><span class="br0">&#40;</span>newThis, ...<span class="br0">&#91;</span>...<span class="me1">leftArgs</span>, ...<span class="me1">rightArgs</span><span class="br0">&#93;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     <span class="kw1">return</span> result;
   <span class="br0">&#125;</span>;</pre>
<p>
The following approximation works today, enabling easy experimentation, by using <code>arguments</code> and <code>apply</code> rather than &ldquo;<code>...</code>&ldquo;. Where the semantics differ from the above (e.g., does <code>call</code> delegate to <code>f.call</code> or <code>f.apply</code>), the above code should be taken as more authoritative.
</p>
<pre class="code javascript"> <span class="br0">&#40;</span><span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
   <span class="st0">"use strict"</span>;
&nbsp;
   <span class="kw2">Function</span>.<span class="me1">prototype</span>.<span class="me1">softBind</span> = <span class="kw2">function</span><span class="br0">&#40;</span>thisArg, var_args<span class="br0">&#41;</span> <span class="br0">&#123;</span>
     <span class="kw2">var</span> f = <span class="kw1">this</span>;
     <span class="kw2">var</span> result = f.<span class="me1">bind</span>.<span class="me1">apply</span><span class="br0">&#40;</span>f, arguments<span class="br0">&#41;</span>;
     <span class="kw2">var</span> leftArgs = <span class="br0">&#91;</span><span class="br0">&#93;</span>.<span class="me1">slice</span>.<span class="me1">call</span><span class="br0">&#40;</span>arguments, <span class="nu0">1</span><span class="br0">&#41;</span>;
     result.<span class="me1">apply</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, rightArgs<span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw1">return</span> f.<span class="me1">apply</span><span class="br0">&#40;</span>newThis, leftArgs.<span class="me1">concat</span><span class="br0">&#40;</span>rightArgs<span class="br0">&#41;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     result.<span class="me1">call</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, var_args<span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw2">var</span> rightArgs = <span class="br0">&#91;</span><span class="br0">&#93;</span>.<span class="me1">slice</span>.<span class="me1">call</span><span class="br0">&#40;</span>arguments, <span class="nu0">1</span><span class="br0">&#41;</span>;
       <span class="kw1">return</span> f.<span class="me1">apply</span><span class="br0">&#40;</span>newThis, leftArgs.<span class="me1">concat</span><span class="br0">&#40;</span>rightArgs<span class="br0">&#41;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     result.<span class="me1">bind</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, var_args<span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw2">var</span> rightArgs = <span class="br0">&#91;</span><span class="br0">&#93;</span>.<span class="me1">slice</span>.<span class="me1">call</span><span class="br0">&#40;</span>arguments<span class="br0">&#41;</span>;
       <span class="kw1">return</span> f.<span class="me1">bind</span>.<span class="me1">apply</span><span class="br0">&#40;</span>f, <span class="br0">&#91;</span>newThis<span class="br0">&#93;</span>.<span class="me1">concat</span><span class="br0">&#40;</span>leftArgs.<span class="me1">concat</span><span class="br0">&#40;</span>rightArgs<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     result.<span class="me1">softBind</span> = <span class="kw2">function</span><span class="br0">&#40;</span>newThis, var_args<span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <span class="kw2">var</span> rightArgs = <span class="br0">&#91;</span><span class="br0">&#93;</span>.<span class="me1">slice</span>.<span class="me1">call</span><span class="br0">&#40;</span>arguments<span class="br0">&#41;</span>;
       <span class="kw1">return</span> f.<span class="me1">softBind</span>.<span class="me1">apply</span><span class="br0">&#40;</span>f, <span class="br0">&#91;</span>newThis<span class="br0">&#93;</span>.<span class="me1">concat</span><span class="br0">&#40;</span>leftArgs.<span class="me1">concat</span><span class="br0">&#40;</span>rightArgs<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
     <span class="br0">&#125;</span>;
     <span class="kw1">return</span> result;
   <span class="br0">&#125;</span>;
 <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#40;</span><span class="br0">&#41;</span>;</pre>
</div>

<a name="open_issues"></a><h2>Open Issues</h2>
<div class="level2">

<p>
 What happens when a soft-bound function is called with <code>new</code>? The code above provides an answer accidentally, in the sense that I did not think about that case when writing this code. Nevertheless, the implied answer seems reasonable &ndash; that the soft-bound-<code>this</code> is ignored and the <code>this</code> binding created by <code>new</code> is used instead. Just like normal <code>bind</code>.
</p>

</div>

<a name="possible_tie-ins_to_other_strawmen"></a><h2>Possible tie-ins to other strawmen</h2>
<div class="level2">

<p>
 This strawman as presented above is concerned only with semantics. Other strawmen may well provide syntactic conveniences to make soft-binding more pleasant to use, or even the default path of least resistance for code using certain new constructs.
</p>

<p>
<a href="doku.php%3Fid=strawman:classes_with_trait_composition.html" class="wikilink1" title="strawman:classes_with_trait_composition" onclick="return svchk()" onkeypress="return svchk()">classes_with_trait_composition</a> may make methods soft bound by default.
</p>

<p>
<a href="doku.php%3Fid=strawman:shorter_function_syntax.html" class="wikilink1" title="strawman:shorter_function_syntax" onclick="return svchk()" onkeypress="return svchk()">shorter_function_syntax</a> may make <code>#</code>-function soft bound by default.
</p>

</div>

<a name="see"></a><h1>See</h1>
<div class="level1">

<p>
 TODO link to earlier intermediate-strength <code>this</code>-binding proposals.
</p>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/e/e02a6a43b2e9bb8a93b008a9425d431c.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/soft_bind.txt &middot; Last modified: 2011/03/03 18:33 by arv      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:soft_bind" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:soft_bind" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:soft_bind" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:soft_bind" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:soft_bind.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Asoft_bind&amp;1454275635" width="1" height="1" alt=""  /></body>
</html>
