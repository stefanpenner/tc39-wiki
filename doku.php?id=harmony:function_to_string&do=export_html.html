<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=harmony:function_to_string&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=harmony" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=harmony:function_to_string&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=harmony:function_to_string&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>

<a name="function_to_string_conversion"></a><h1>Function to String conversion</h1>
<div class="level1">

<p>
 For a function <code>fn</code> written in JavaScript, <code>Function.prototype.toString.call(fn)</code> must return source code for a FunctionDeclaration or FunctionExpression that, if <code>eval()</code>uated in an equivalent-enough lexical context, would result in a function with the same [[Call]] behavior as the present one. Note that the new function would have a fresh identity and none of the original&rsquo;s properties, not even <code>.prototype</code>. (The properties could of course be transferred by other means but the identity will remain distinct.)
</p>

<p>
This returned source code must not mention freely any variables that were not mentioned freely by the original function&rsquo;s source code, even if these &ldquo;extra&rdquo; names were originally in scope. With this restriction, an equivalent-enough lexical context need only provide 
</p>
<ul>
<li class="level1"><div class="li"> Bindings for names used freely in the original source code. For purposes of this scope analysis, a use of the direct <code>eval</code> operator is statically considered a free usage of all variables in scope at that point.</div>
</li>
<li class="level1"><div class="li"> The strictness or non-strictness of the original context if relevant to the function&rsquo;s [[Call]] behavior. Note that, if the function is strict and its body carries its own &ldquo;use strict&rdquo; directive, then it may not be relevant for the context to preserve the original strictness.</div>
</li>
</ul>

<p>
 Allowing FunctionExpression in the spec above acknowledges reality. All major <acronym title="JavaScript">JS</acronym> engines will convert an anonymous function to an anonymous FunctionExpression, even though the ES3 and ES5 specs disallow it. This behavior is useful, so we should make it official. Note that a sufficient condition for meeting this specification is to always return precisely the function&rsquo;s original source code.
</p>

<p>
Functions not written in JavaScript remain <a href="doku.php%3Fid=strawman:function_to_string.html" class="wikilink1" title="strawman:function_to_string" onclick="return svchk()" onkeypress="return svchk()">problematic cases</a> not covered by this proposed spec tightening.
</p>

</div>
<!-- SECTION [1-1882] -->
<a name="acks"></a><h1>Acks</h1>
<div class="level1">

<p>
 Thanks to David Flanagan who <a href="https://mail.mozilla.org/pipermail/es5-discuss/2009-May/002474.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es5-discuss/2009-May/002474.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">first raised this</a> on es-discuss.
</p>

<p>
Thanks to Luke Hoban for expanding the notion of lexical context to include strictness.
</p>

</div>
<!-- SECTION [1883-2126] -->
<a name="see"></a><h1>See</h1>
<div class="level1">

<p>
 Remaining <a href="doku.php%3Fid=strawman:function_to_string.html" class="wikilink1" title="strawman:function_to_string" onclick="return svchk()" onkeypress="return svchk()">function_to_string</a> strawman. 
</p>

</div>
<!-- SECTION [2127-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/c/c05f0102a7dc452c00232c807adc4d9a.xhtml used -->
</body>
</html>
