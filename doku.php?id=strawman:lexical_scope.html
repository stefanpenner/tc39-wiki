<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:lexical_scope [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:lexical_scope&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:lexical_scope&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:lexical_scope&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2008-10-10T03:40:47+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:lexical_scope&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:lexical_scope</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:lexical_scope" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:lexical_scope" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:quasis-substitutions-thunk.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:quasis-substitutions-thunk">quasis-substitutions-thunk</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:quasis-substitutions-slot.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:quasis-substitutions-slot">quasis-substitutions-slot</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:binary_data.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:binary_data">binary_data</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:match_web_reality_spec.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:match_web_reality_spec">match_web_reality_spec</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:lexical_scope.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:lexical_scope">lexical_scope</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:lexical_scope.html#rationale" class="toc">Rationale</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:lexical_scope.html#syntax" class="toc">Syntax</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:lexical_scope.html#semantics" class="toc">Semantics</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:lexical_scope.html#consequences" class="toc">Consequences</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:lexical_scope.html#restrictions" class="toc">Restrictions</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=strawman:lexical_scope.html#issues" class="toc">Issues</a></span></li>
</ul>
</div>
</div>

<a name="rationale"></a><h1>Rationale</h1>
<div class="level1">

<p>
 Lexical scope is an important principle in programming: it provides better abstraction and makes programs less brittle for refactoring. It also enables faster implementations since compilers and interpreters can resolve variable references early, preventing expensive runtime searches through the scope chain.
</p>

<p>
This proposal introduces a pragma enforcing lexical scope in any textual block of code, including the program top level. This enforcement requires preventing certain constructs such as <code>with</code> and <code>eval</code> from dynamically modifying the scope chain. Programmers receive several benefits: 
</p>
<ul>
<li class="level1"><div class="li"> Free variables, caused for example by simple misspellings, are a statically enforceable error.</div>
</li>
<li class="level1"><div class="li"> Programs are less sensitive to subtle and potentially malicious changes in behavior by external code.</div>
</li>
<li class="level1"><div class="li"> Implementations may be able to improve the efficiency of variable lookup.</div>
</li>
</ul>

</div>

<a name="syntax"></a><h1>Syntax</h1>
<div class="level1">
<pre class="code ebnf">    Pragma ::= ... | &quot;lexical&quot; &quot;scope&quot;
</pre>
</div>

<a name="semantics"></a><h1>Semantics</h1>
<div class="level1">

<p>
 The <code>use lexical scope</code> pragma changes the scoping semantics of its block (or the program, if it occurs at top level) to use pure lexical scope. This involves the following semantic changes: 
</p>
<ol>
<li class="level1"><div class="li"> The <code>with</code> construct is disallowed; any occurrence of <code>with</code> &mdash; anywhere, at any level of nesting within the block &mdash; is a static error.</div>
</li>
<li class="level1"><div class="li"> The <code>eval</code> construct may not modify its containing block&rsquo;s scope. Attempts to do so result in a dynamic error.</div>
</li>
<li class="level1"><div class="li"> The scope chain for the block no longer contains the global object. In its place is a lexical frame containing standard (host environment-specific) bindings. These must include at least the <em>initial</em> bindings of the standard library (such as <code>Array</code>, <code>Boolean</code>, <code>String</code>, <code>Object</code>, etc.).</div>
</li>
<li class="level1"><div class="li"> The <code>delete</code> operator may not remove any bindings from any part of the scope chain.</div>
</li>
<li class="level1"><div class="li"> No language construct may dynamically modify a frame in the scope chain (e.g., non-standard conditional binding constructs).</div>
</li>
</ol>

<p>
 It is expected that <code>use lexical scope</code> might be subsumed by another pragma such as <code>use strict</code> (and perhaps even eliminated as a separate pragma).
</p>

</div>

<a name="consequences"></a><h1>Consequences</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> With the <code>use lexical scope</code> pragma, all free variable references become an error. This error may be detected statically, since no construct is able to change the meaning of a variable reference at runtime.</div>
</li>
<li class="level1"><div class="li"> Because <code>use lexical scope</code> does not affect the initial meaning of <code>this</code>, the global object is still accessible to programs, but it no longer affects variable scope.</div>
</li>
<li class="level1"><div class="li"> References to top-level bindings may still occur without prefix since the scope chain binds the initial properties of the global object at its outermost level.</div>
</li>
<li class="level1"><div class="li"> However, dynamic tests must be prefixed by <code>this.</code> in order to detect the presence or absence of global properties. It is expected that this will require a moderate but not unreasonable amount of refactoring for code that wishes to make use of the <code>use lexical scope</code> pragma.</div>
</li>
</ul>

</div>

<a name="restrictions"></a><h1>Restrictions</h1>
<div class="level1">

<p>
 The <code>use lexical scope</code> pragma is disallowed in certain contexts to ensure that dynamic objects never appear in the scope chain: 
</p>
<ol>
<li class="level1"><div class="li"> Use of <code>use lexical scope</code> within the scope of a <code>with</code> block results in a compile-time error:<pre class="code javascript"><span class="kw1">with</span> <span class="br0">&#40;</span>obj<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">use</span> lexical scope; <span class="co1">// compile-time error</span>
    ...
<span class="br0">&#125;</span></pre></div>
</li>
<li class="level1"><div class="li"> Use of <code>use lexical scope</code> within the body of code evaluated by an occurrence of <code>eval</code> that occurs in the scope of a <code>with</code> block results in a runtime error before evaluation of the <code>eval</code>ed code begins:<pre class="code javascript"><span class="kw1">with</span><span class="br0">&#40;</span>obj<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">eval</span><span class="br0">&#40;</span><span class="st0">"use lexical scope; ..."</span><span class="br0">&#41;</span> <span class="co1">// run-time error</span>
    ...
<span class="br0">&#125;</span></pre></div>
</li>
</ol>

</div>

<a name="issues"></a><h1>Issues</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> Should <code>eval</code> be restricted in <code>lexical scope</code> mode to operate in the initial scope?</div>
</li>
<li class="level1"><div class="li"> Nested <code>use lexical scope</code>: what to use for top-level frame? Initial bindings or current bindings? Example:</div>
</li>
</ul>
<pre class="code javascript"><span class="kw3">alert</span> = <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span><span class="br0">&#125;</span>
<span class="br0">&#123;</span>
    <span class="kw2">use</span> lexical scope;
    <span class="kw3">alert</span><span class="br0">&#40;</span><span class="st0">'hello, world'</span><span class="br0">&#41;</span>
<span class="br0">&#125;</span></pre>
</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/3/3485be8bcfac3d4489a19e09dea269fc.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/lexical_scope.txt &middot; Last modified: 2008/10/10 03:40 by dherman      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:lexical_scope" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:lexical_scope" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:lexical_scope" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:lexical_scope" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:lexical_scope.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Alexical_scope&amp;1454275788" width="1" height="1" alt=""  /></body>
</html>
