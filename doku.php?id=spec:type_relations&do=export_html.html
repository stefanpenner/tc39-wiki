<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=spec:type_relations&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=spec" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=spec:type_relations&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=spec:type_relations&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=spec:type_relations&amp;do=export_html.html#type_relationships" class="toc">Type Relationships</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=spec:type_relations&amp;do=export_html.html#equality" class="toc">Equality</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=spec:type_relations&amp;do=export_html.html#subtyping" class="toc">Subtyping</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=spec:type_relations&amp;do=export_html.html#compatibility" class="toc">Compatibility</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=spec:type_relations&amp;do=export_html.html#convertibility" class="toc">Convertibility</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="type_relationships"></a><h1>Type Relationships</h1>
<div class="level1">

<p>
 There are four different relations between types: <em>equality</em> (<code>T = U</code>), <em>subtyping</em> (<code>T &lt;: U</code>), <em>compatibility</em> (<code>T ~: U</code>), and <em>convertibility</em> (<code>T ~~&gt; U</code>). These are defined here.
</p>

<p>
For clarity, these rules are presented more in a declarative style than algorithmic, and this presentation is focused more on being expository than complete, since we always have the reference implementation for completeness.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x63%3B%26%23x6f%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x63%3B%26%23x40%3B%26%23x73%3B%26%23x6f%3B%26%23x65%3B%26%23x2e%3B%26%23x75%3B%26%23x63%3B%26%23x73%3B%26%23x63%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x63;&#x6f;&#x72;&#x6d;&#x61;&#x63;&#x40;&#x73;&#x6f;&#x65;&#x2e;&#x75;&#x63;&#x73;&#x63;&#x2e;&#x65;&#x64;&#x75;">Cormac Flanagan</a> 2007/07/10 09:48</em>
</p>

</div>
<!-- SECTION [3-530] -->
<a name="equality"></a><h2>Equality</h2>
<div class="level2">
<table class="inline">
	<tr>
		<th>Notation</th><th>Meaning</th>
	</tr>
	<tr>
		<td><code>T = U</code></td><td><em>type <code>T</code> is considered identical to type <code>U</code></em></td>
	</tr>
</table>
<br />

<p>
 Some types are considered to be identical to each other, even if they have slightly different syntax. These can be thought of as shorthands for one another.
</p>

<p>
This includes:
</p>
<ul>
<li class="level1"><div class="li"> structural array types are nullable by default, so <code>[...]</code>, <code>[...]?</code>, and <code>([...],null)</code> are equal.</div>
</li>
<li class="level1"><div class="li"> structural object types are nullable by default, so <code>{...}</code>, <code>{...}?</code>, and <code>({...},null)</code> are equal.</div>
</li>
<li class="level1"><div class="li"> reorderings of structural object type fields</div>
</li>
<li class="level1"><div class="li"> flattening of unions, including singleton unions (i.e., <code>T</code> = <code>(T)</code>)</div>
</li>
<li class="level1"><div class="li"> alpha-equivalent parameterized types</div>
</li>
<li class="level1"><div class="li"> no <code>this</code> type in a function as shorthand for <code>this : *</code></div>
</li>
<li class="level1"><div class="li"> <code>T?</code> (i.e., nullable <code>T</code>) as shorthand for <code>(T,null)</code></div>
</li>
<li class="level1"><div class="li"> <code>{}</code> and <code>Object</code>  (<code>{*}</code> is different from both of these)</div>
</li>
<li class="level1"><div class="li"> <code>[]</code> and <code>[*]</code> and <code>Array</code> (a little strange, see  Ticket 96)</div>
</li>
</ul>

<p>
 The following are unclear:
</p>
<ul>
<li class="level1"><div class="li"> <code>this</code> type in a method of <code>T</code> is <code>this : T</code>  (unsound, really need self types here)</div>
</li>
</ul>

</div>
<!-- SECTION [531-1598] -->
<a name="subtyping"></a><h2>Subtyping</h2>
<div class="level2">
<table class="inline">
	<tr>
		<th>Notation</th><th>Meaning</th>
	</tr>
	<tr>
		<td><code>T &lt;: U</code></td><td><em>type <code>T</code> is a subtype of type <code>U</code></em></td>
	</tr>
</table>
<br />

<p>
 Subtyping is a partial order on types that reflects the intuition of <em>subsumption</em>, i.e., when one type supports all the operations of another type (and possibly more). 
</p>
<ul>
<li class="level1"><div class="li"> nominal subtyping according to class and interface declarations. The only subtypes of nominal types are other nominal types, not structural types, with the only exceptions being Object, Function, and Array.</div>
</li>
<li class="level1"><div class="li"> structural subtyping: covariant result types, contravariant args, invariant arrays and object properties (<a href="doku.php%3Fid=meetings:minutes_jan_24_2007.html" class="wikilink1" title="meetings:minutes_jan_24_2007" onclick="return svchk()" onkeypress="return svchk()">minutes_jan_24_2007</a>)</div>
</li>
<li class="level1"><div class="li"> reflexive, transitive</div>
</li>
<li class="level1"><div class="li"> anti-symmetric (if <code>T != U</code>, they can&rsquo;t both be subtypes of each other. Alternatively, if two types are subtypes of each other, they must be defined as equal.)</div>
</li>
<li class="level1"><div class="li"> type <code>*</code> is the top type in the subtyping hierarchy (we previously considered designs where <code>*</code> was <em>not</em> the top type, but those seem semantically equivalent but less efficient, since more casts to <code>*</code> are required). Hence <code>*</code> is a supertype of everything.</div>
</li>
</ul>
<pre class="code">

 --------
  T &lt;: *
</pre>
<ul>
<li class="level1"><div class="li"> invariant object width subtyping:</div>
</li>
</ul>
<pre class="code">

------------------------------------------
{l1:T1,...,ln+m:Tn+m} &lt;: {l1:T1,...,ln:Tn}
</pre>
<ul>
<li class="level1"><div class="li"> <code>{}</code> (aka <code>Object</code>) is a supertype of all structural object types via width subtyping above.</div>
</li>
<li class="level1"><div class="li"> invariant extensible array subtyping (can repeat last element):</div>
</li>
</ul>
<pre class="code">

----------------------------
[T1,..,Tn,Tn] &lt;: [T1,...,Tn]
</pre>
<ul>
<li class="level1"><div class="li"> union subtyping (based on a &ldquo;set&rdquo; interpretation of union types)</div>
</li>
</ul>
<pre class="code">
forall i in 1..m. Si &lt;: T
-------------------------
(S1,...,Sm) &lt;: T

exists j in 1..n. S &lt;: Tj
-------------------------
S &lt;: (T1,...,Tn)
</pre>
<ul>
<li class="level1"><div class="li"> function subtyping (contravariant on argument types, covariant on result type, can drop rest and default arguments, can replicate rest arg):</div>
</li>
</ul>
<pre class="code">
U' &lt;: U
forall i &lt;= n. Si' &lt;: Si
T &lt;: T'
-----------------------------------------------------------------------------------------
function(this:U,S1,..,Sm,Sm+1=,..,Sn=):T &lt;: function(this:U',S1',..,Sm',Sm+1'=,..,Sn=):T'

U' &lt;: U
forall i &lt;= n. Si' &lt;: Si
V' &lt;: V
T &lt;: T'
----------------------------------------------------------------------------------------------------
function(this:U,S1,..,Sm,Sm+1=,..,Sn=,...V):T &lt;: function(this:U',S1',..,Sm',Sm+1'=,..,Sn=,...V'):T'


-----------------------------------------------------------------------------------------
function(this:U,S1,..,Sm,Sm+1=,..,Sn=,...V):T &lt;: function(this:U,S1,..,Sm,Sm+1=,..,Sn=):T

------------------------------------------------------------------------------------------
function(this:U,S1,..,Sm,Sm+1=,..,Sn=,Sn+1=):T &lt;: function(this:U,S1,..,Sm,Sm+1=,..,Sn=):T

--------------------------------------------------------------------------
function(this:U,S1,..,Sm,...[V]):T &lt;: function(this:U,S1,..,Sm,V,...[V]):T

</pre>
<ul>
<li class="level1"><div class="li"> Nominal subtyping, based on the class hierarchy</div>
</li>
</ul>
<pre class="code">
class C.&lt;X1..Xn&gt; extends D.&lt;T1..Tm&gt; ... 
Ti' = Ti[X1:=S1,..,Xn:=Sn]
-------------------------------------------
C.&lt;S1..Sn&gt; &lt;: D.&lt;T1'..Tm'&gt;

class C.&lt;X1..Xn&gt; ... implements ... I.&lt;T1..Tm&gt; ...
Ti' = Ti[X1:=S1,..,Xn:=Sn]
-------------------------------------------
C.&lt;S1..Sn&gt; &lt;: I.&lt;T1'..Tm'&gt;

interface I1.&lt;X1..Xn&gt; extends I1.&lt;T1..Tm&gt; ... 
Ti' = Ti[X1:=S1,..,Xn:=Sn]
-------------------------------------------
I1.&lt;S1..Sn&gt; &lt;: I2.&lt;T1'..Tm'&gt;
</pre>
<ul>
<li class="level1"><div class="li"> Nominal types are subtypes of corresponding structural object types</div>
</li>
</ul>
<pre class="code">
class C&lt;T1..Tn&gt; has public slots l1:S1,..lm:Sm
----------------------------------------------
C.&lt;T1..Tn&gt; &lt;: {l1:S1,..,lm:Sm}
</pre>

</div>
<!-- SECTION [1599-5200] -->
<a name="compatibility"></a><h2>Compatibility</h2>
<div class="level2">
<table class="inline">
	<tr>
		<th>Notation</th><th>Meaning</th>
	</tr>
	<tr>
		<td><code>T ~: U</code></td><td><em>type <code>T</code> is compatible with type <code>U</code></em></td>
	</tr>
</table>
<br />

<p>
 Type compatibility formalizes the relationship between typed and untyped code. If <code>T ~: U</code>, then it maybe the case that <code>T</code> is not a subtype of <code>U</code>, but they represent a legal inter-operation between typed and untyped code.
</p>

<p>
Inter-operation between typed and untyped code never involves conversions (such as <code>to</code>-methods), so object identity is always preserved in these interactions. Using untyped code in typed code requires extra runtime checks (described in the forthcoming section on runtime checks...).
</p>

<p>
Properties of <code>~:</code>: 
</p>
<ul>
<li class="level1"><div class="li"> not transitive (because everything is compatible with <code>*</code> and <code>*</code> is compatible with everything). Instead, we allow subtyping before and after compatibility operations, to allow various re-structuring of types (this is essentially a shorthand that allows us to avoid repeating variants of some subtyping rules as compatibility rules):</div>
</li>
</ul>
<pre class="code">
S &lt;: T    T ~: U    U &lt;: V
--------------------------
        S ~: V
</pre>
<ul>
<li class="level1"><div class="li"> not symmetric (because it includes subtyping)</div>
</li>
<li class="level1"><div class="li"> <code>T ~ U</code> means <code>T ~: U</code> and <code>U ~: T</code></div>
</li>
<li class="level1"><div class="li"> includes subtyping and universal compatibility with <code>*</code>:</div>
</li>
</ul>
<pre class="code">
T &lt;: U
------    ------    ------
T ~: U    T ~: *    * ~: T
</pre>
<ul>
<li class="level1"><div class="li"> includes compatibility of structural objects with the &ldquo;untyped object&rdquo; type <code>{*}</code>:</div>
</li>
</ul>
<pre class="code">

------------------------      ------------------------
{x1:S1 ... xn:Sn} ~: {*}      {*} ~: {x1:S1 ... xn:Sn}
</pre>
<ul>
<li class="level1"><div class="li"> includes compatibility with array types:</div>
</li>
</ul>
<pre class="code">

--------------------    --------------------
Array ~: [T1,...,Tn]    [T1,...,Tn] ~: Array
</pre>
<ul>
<li class="level1"><div class="li"> lifts through function types:</div>
</li>
</ul>
<pre class="code">
U' ~: U
forall i &lt;= n. Si' ~: Si
T ~: T'
-----------------------------------------------------------------------------------------
function(this:U,S1,..,Sm,Sm+1=,..,Sn=):T ~: function(this:U',S1',..,Sm',Sm+1'=,..,Sn=):T'

U' ~: U
forall i &lt;= n. Si' ~: Si
V' ~: V
T ~: T'
----------------------------------------------------------------------------------------------------
function(this:U,S1,..,Sm,Sm+1=,..,Sn=,...V):T ~: function(this:U',S1',..,Sm',Sm+1'=,..,Sn=,...V'):T'
</pre>
<ul>
<li class="level1"><div class="li"> lifts through union types:</div>
</li>
</ul>
<pre class="code">
forall i in 1..n. Si ~: Ti
--------------------------
(S1,..,Sn) ~: (T1,..,Tn)
</pre>
<ul>
<li class="level1"><div class="li"> invariant through object types:</div>
</li>
</ul>
<pre class="code">
forall i in 1..n. Si ~ Ti
--------------------------------------  
{l1:S1 ... ln:Sn} ~: {l1:T1 ... ln:Tn}
</pre>
<ul>
<li class="level1"><div class="li"> invariant through array types:</div>
</li>
</ul>
<pre class="code">
forall i in 1..n. Si ~ Ti
--------------------------
[S1,...,Sn] ~: [T1,...,Tn]

    example: [int,*] ~: [int,bool,string]
    example: [int,bool,string] ~: [int,*]
</pre>
<ul>
<li class="level1"><div class="li"> If <code>Set</code> is a generic nominal type, then <code>Set.&lt;*&gt;</code> and <code>Set.&lt;int&gt;</code> could be compatible, since <code>*</code> and <code>int</code> are both compatible with each other.</div>
</li>
</ul>
<pre class="code">
forall i in 1..n. Si ~ Ti 
---------------------------------------
        C.&lt;S1..Sn&gt; ~: C.&lt;T1..Tn&gt;
</pre>

<p>
 <strong>Note</strong>: There are various ways to extend the compatibility relation that allow more program to pass in strict mode. For now, we are being a little conservative by forbidding some such extensions; they are listed here for later consideration.
</p>

</div>
<!-- SECTION [5201-8414] -->
<a name="convertibility"></a><h2>Convertibility</h2>
<div class="level2">
<table class="inline">
	<tr>
		<th>Notation</th><th>Meaning</th>
	</tr>
	<tr>
		<td><code>T ~~&gt; U</code></td><td><em>type <code>T</code> is convertible to type <code>U</code></em></td>
	</tr>
</table>
<br />

<p>
 Even if <code>T</code> is not compatible with <code>U</code>, it may still be <em>convertible</em> to <code>U</code>, meaning that there is a defined <code>to</code>-method that can perform a conversion from <code>T</code> to <code>U</code>. 
</p>
<ul>
<li class="level1"><div class="li"> such conversions do not preserve object identity</div>
</li>
<li class="level1"><div class="li"> includes compatibility (and therefore subtyping):</div>
</li>
</ul>
<pre class="code">
T ~: U
-------
T ~~&gt; U
</pre>
<ul>
<li class="level1"><div class="li"> includes <code>to</code> methods:</div>
</li>
</ul>
<pre class="code">
T is a class
static T.intrinsic::to : S' -&gt; T
S ~: S'
--------------------------------
S ~~&gt; T
</pre>

<p>
Note that class <code>boolean</code> has a <code>meta::convert</code> static method with argument type <code>*</code>, so effectively any type is convertible to <code>boolean</code>.
</p>

</div>
<!-- SECTION [8415-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/0/0beac1e32a2fe834f8edfea6b252b1fe.xhtml used -->
</body>
</html>
