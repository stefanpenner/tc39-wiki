<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=discussion:string_formatting&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=discussion" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=discussion:string_formatting&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=discussion:string_formatting&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>
<div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="clear"><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:string_formatting&amp;do=export_html.html#minimal_proposal" class="toc">Minimal Proposal</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=discussion:string_formatting&amp;do=export_html.html#sprintf_suggestion" class="toc">sprintf suggestion</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=discussion:string_formatting&amp;do=export_html.html#syntax" class="toc">Syntax</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=discussion:string_formatting&amp;do=export_html.html#semantics" class="toc">Semantics</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=discussion:string_formatting&amp;do=export_html.html#examples" class="toc">Examples</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=discussion:string_formatting&amp;do=export_html.html#discussion" class="toc">Discussion</a></span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<a name="minimal_proposal"></a><h2>Minimal Proposal</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Add some kind of type-safe <code>sprintf</code> analogue.  I don&rsquo;t know what this means yet, but if we punt this to the &ldquo;ecosystem&rdquo;, type safety will have to be added after Edition 4 is done.  It might not be possible to bolt on type safety without more foundational work.  Or if possible using <a href="doku.php%3Fid=proposals:meta_objects.html" class="wikilink1" title="proposals:meta_objects" onclick="return svchk()" onkeypress="return svchk()">reflection</a>, it might be unsightly or otherwise costly (just requiring reflection is costly; it might mean no formatting in the <a href="doku.php%3Fid=clarification:compact_profile.html" class="wikilink1" title="clarification:compact_profile" onclick="return svchk()" onkeypress="return svchk()">compact profile</a>).  I&rsquo;d like to put a &ldquo;foot in the door&rdquo; here, to ensure that Edition 4 can support type-safe formatting somehow.</div>
</li>
</ul>

<p>
  &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2006/03/01 00:03</em>
</p>

</div>
<!-- SECTION [2-687] -->
<a name="sprintf_suggestion"></a><h2>sprintf suggestion</h2>
<div class="level2">

<p>
 For the type-safe formatter, perhaps the following works.
</p>

<p>
Currently missing from this proposal: the exact formatting specifiers and their meanings.
</p>

</div>
<!-- SECTION [688-869] -->
<a name="syntax"></a><h3>Syntax</h3>
<div class="level3">
<pre class="code javascript">   format<span class="br0">&#40;</span> literal-string, expression <span class="br0">&#41;</span></pre>
</div>
<!-- SECTION [870-954] -->
<a name="semantics"></a><h3>Semantics</h3>
<div class="level3">

<p>
 <code>format</code> is a built-in operator that takes a literal string and any object and returns a string.  
</p>

<p>
The string encodes formatting specifications (like in C) and raw text.  Each formatting specification is followed by a colon and the name of the field to be extracted from the object.  Only primitive values can be formatted, and it is an error when the type of the value does not match the type of the formatting specification.  However, the <code>!</code> conversion modifier allows the conversion of value of one type to a value of the correct type (thus &ldquo;%!s&rdquo; applies the String function to the argument before printing).
</p>

<p>
Non-identifier field names are substrings of the format string bracketed by quotes.
</p>

</div>
<!-- SECTION [955-1679] -->
<a name="examples"></a><h3>Examples</h3>
<div class="level3">
<pre class="code javascript">   format<span class="br0">&#40;</span> <span class="st0">"Person: %s:name %d:age %.2g:salary<span class="es0">\n</span>"</span>, <span class="br0">&#123;</span> <span class="kw3">name</span>: <span class="st0">"Bill"</span>, age: <span class="nu0">52</span>, salary: <span class="nu0">25000</span> <span class="br0">&#125;</span> <span class="br0">&#41;</span>;
&nbsp;
   format<span class="br0">&#40;</span> <span class="st0">"My data: [%d:'0', %d:'1']<span class="es0">\n</span>"</span>, <span class="br0">&#91;</span><span class="nu0">37</span>, <span class="nu0">42</span><span class="br0">&#93;</span> <span class="br0">&#41;</span>;
&nbsp;
   format<span class="br0">&#40;</span> <span class="st0">"%!5.2g:value"</span>, getValue<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span>;</pre>
</div>
<!-- SECTION [1680-1918] -->
<a name="discussion"></a><h3>Discussion</h3>
<div class="level3">

<p>
 In Edition 3 this is (dynamically) type-safe, and besides implementable in user code.  
</p>

<p>
In Edition 4 this is statically type-safe since <code>format</code> is a built-in operator and (presumably?) there are some guarantees in the language that e.g. <code>String</code> returns a string.  In an untyped setting or for functions returning Object, it&rsquo;s still possible to type-check dynamically.
</p>

<p>
It&rsquo;s nice that we don&rsquo;t have to worry about positional arguments.
</p>

<p>
No introspection is needed beyond that already present in Edition 3.
</p>

<p>
Various extensions are possible, by tacking on an extra argument.  Consider a third argument that is an object that contains custom converters:
</p>
<pre class="code javascript">   format<span class="br0">&#40;</span> <span class="st0">"Person: %s:name %d:age %.2g:salary<span class="es0">\n</span>"</span>, 
           myPerson,
           <span class="br0">&#123;</span> <span class="kw3">name</span> : <span class="kw2">function</span> <span class="br0">&#40;</span>s : String<span class="br0">&#41;</span> : String <span class="br0">&#123;</span> <span class="kw1">return</span> s.<span class="me1">toTitleCase</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#125;</span> <span class="br0">&#125;</span> <span class="br0">&#41;</span>;</pre>
<p>
The main problem with the proposal is that it&rsquo;s a bit of a closed world, it does not encourage the ecosystem to extend it.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/03/13 08:21</em>
</p>

<p>
Brendan proposed that we could use the <code>%</code> operator, like Python: 
</p>
<pre class="code">  &quot;Person: %s:name %d:age %.2g:salary\n&quot; % { name: &quot;Bill&quot;, age: 52, salary: 25000 }</pre>

<p>
 Seems nice enough to me.
</p>

<p>
Observe that static typing of fragments like this requires a type system that does not give the object literal the type <code>Object</code> but something more useful, as outlined in the body of <a href="doku.php%3Fid=discussion:destructuring_assignment.html" class="wikilink1" title="discussion:destructuring_assignment" onclick="return svchk()" onkeypress="return svchk()">destructuring assignment</a>; you&rsquo;d end up writing (with currently proposed syntax)  
</p>
<pre class="code">  &quot;Person: %s:name %d:age %.2g:salary\n&quot; % #{ name: &quot;Bill&quot;, age: 52, salary: 25000 }</pre>

<p>
  &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/04/18 03:52</em>
</p>

<p>
There are probably real limits to what the ecosystem can be expected to do if we want static typing and convenient syntax.
</p>

<p>
One can probably hack around with pragmas: 
</p>
<pre class="code">  use formatting &quot;%s:name&quot; = toTitlecase</pre>

<p>
 but this is just shorthand for passing in an object that defines formatting functions.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x6f%3B%26%23x70%3B%26%23x65%3B%26%23x72%3B%26%23x61%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x6f;&#x70;&#x65;&#x72;&#x61;&#x2e;&#x63;&#x6f;&#x6d;">Lars T Hansen</a> 2006/04/18 04:06</em>
</p>

<p>
I moved this out of the proposal:json_encoding_and_decoding wiki here
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x69%3B%26%23x61%3B%26%23x69%3B%26%23x6e%3B%26%23x2e%3B%26%23x6c%3B%26%23x61%3B%26%23x6d%3B%26%23x62%3B%26%23x40%3B%26%23x79%3B%26%23x61%3B%26%23x68%3B%26%23x6f%3B%26%23x6f%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x69;&#x61;&#x69;&#x6e;&#x2e;&#x6c;&#x61;&#x6d;&#x62;&#x40;&#x79;&#x61;&#x68;&#x6f;&#x6f;&#x2e;&#x63;&#x6f;&#x6d;">Iain Lamb</a> 2006/09/22 15:02</em>  
</p>

</div>
<!-- SECTION [1919-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/6/66dd0cd6d2b61a3dc3e75656ba17bb94.xhtml used -->
</body>
</html>
