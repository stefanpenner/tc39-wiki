<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>harmony:proxy_defaulthandler [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=harmony:proxy_defaulthandler&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=harmony" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=harmony:proxy_defaulthandler&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=harmony:proxy_defaulthandler&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2013-10-18T15:09:04+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=harmony:proxy_defaulthandler&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">harmony:proxy_defaulthandler</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="harmony:proxy_defaulthandler" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="harmony:proxy_defaulthandler" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:virtual_object_api.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:virtual_object_api">virtual_object_api</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:proxies_spec.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:proxies_spec">proxies_spec</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:extended_object_api.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:extended_object_api">extended_object_api</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:proxies.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:proxies">proxies</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:proxy_defaulthandler">proxy_defaulthandler</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#the_content_on_this_page_is_obsolete" class="toc">The content on this page is OBSOLETE</a></span></li>
<li class="level1"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#default_proxy_forwarding_handler" class="toc">Default Proxy forwarding handler</a></span><ul class="toc">
<li class="clear"><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#forwarding_handler_constructor" class="toc">Forwarding Handler constructor</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#open_issues" class="toc">Open Issues</a></span><ul class="toc">
<li class="clear"><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#alternative_names" class="toc">Alternative names</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#alternative_implementation_for_default_set_trap" class="toc">Alternative implementation for default set trap</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#default_implementation_of_fix" class="toc">Default implementation of fix()</a></span></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#feedback_and_history" class="toc">Feedback and History</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#references" class="toc">References</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="the_content_on_this_page_is_obsolete"></a><h1>The content on this page is OBSOLETE</h1>
<div class="level1">

</div>

<a name="default_proxy_forwarding_handler"></a><h1>Default Proxy forwarding handler</h1>
<div class="level1">
<table class="inline">
	<tr>
		<td><strong>This <acronym title="Application Programming Interface">API</acronym> is superseded by <a href="doku.php%3Fid=harmony:direct_proxies.html" class="wikilink1" title="harmony:direct_proxies" onclick="return svchk()" onkeypress="return svchk()">direct proxies</a> and the <a href="doku.php%3Fid=harmony:reflect_api.html" class="wikilink1" title="harmony:reflect_api" onclick="return svchk()" onkeypress="return svchk()">reflect api</a></strong></td>
	</tr>
</table>
<br />

<p>
 Goal: to standardize a default forwarding handler that delegates all meta-level operations applied to a proxy to a given target object, as exemplified <a href="doku.php%3Fid=harmony:proxies.html#examplea_no-op_forwarding_proxy" class="wikilink1" title="harmony:proxies" onclick="return svchk()" onkeypress="return svchk()">here</a>.
</p>

<p>
Rationale: this is a common handler, required as a starting point by most abstractions that wrap existing <acronym title="JavaScript">JS</acronym> objects. The default forwarding handler is also required in the <a href="doku.php%3Fid=harmony:proxies.html#transparent_chains_of_no-op_proxies" class="wikilink1" title="harmony:proxies" onclick="return svchk()" onkeypress="return svchk()">double lifting</a> pattern.
</p>

<p>
Advantages of standardizing a default forwarding handler:
</p>
<ul>
<li class="level1"><div class="li"> Wrapper proxies don&rsquo;t need to define this handler over and over again,</div>
</li>
<li class="level1"><div class="li"> The code for the default handler doesn&rsquo;t need to be downloaded over and over again,</div>
</li>
<li class="level1"><div class="li"> The default handler evolves in sync with potential changes to the Proxy <acronym title="Application Programming Interface">API</acronym>,</div>
</li>
<li class="level1"><div class="li"> A built-in implementation is likely to be faster than a no-op forwarding handler defined in <acronym title="JavaScript">JS</acronym> itself</div>
</li>
</ul>

</div>

<a name="forwarding_handler_constructor"></a><h3>Forwarding Handler constructor</h3>
<div class="level3">

<p>
 The following is a revised <acronym title="Application Programming Interface">API</acronym> based on the standard Javascript constructor pattern.
</p>
<pre class="code javascript">Proxy.<span class="me1">Handler</span> = <span class="kw2">function</span><span class="br0">&#40;</span>target<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">this</span>.<span class="me1">target</span> = target;
<span class="br0">&#125;</span>;
&nbsp;
Proxy.<span class="me1">Handler</span>.<span class="me1">prototype</span> = <span class="br0">&#123;</span>
&nbsp;
  <span class="co1">// == fundamental traps ==</span>
&nbsp;
  <span class="co1">// Object.getOwnPropertyDescriptor(proxy, name) -&gt; pd | undefined</span>
  getOwnPropertyDescriptor: <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">var</span> desc = Object.<span class="me1">getOwnPropertyDescriptor</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span>, <span class="kw3">name</span><span class="br0">&#41;</span>;
    <span class="kw1">if</span> <span class="br0">&#40;</span>desc !== undefined<span class="br0">&#41;</span> <span class="br0">&#123;</span> desc.<span class="me1">configurable</span> = <span class="kw2">true</span>; <span class="br0">&#125;</span>
    <span class="kw1">return</span> desc;
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// Object.getPropertyDescriptor(proxy, name) -&gt; pd | undefined</span>
  getPropertyDescriptor: <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">var</span> desc = Object.<span class="me1">getPropertyDescriptor</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span>, <span class="kw3">name</span><span class="br0">&#41;</span>;
    <span class="kw1">if</span> <span class="br0">&#40;</span>desc !== undefined<span class="br0">&#41;</span> <span class="br0">&#123;</span> desc.<span class="me1">configurable</span> = <span class="kw2">true</span>; <span class="br0">&#125;</span>
    <span class="kw1">return</span> desc;
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// Object.getOwnPropertyNames(proxy) -&gt; [ string ]</span>
  getOwnPropertyNames: <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> Object.<span class="me1">getOwnPropertyNames</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// Object.getPropertyNames(proxy) -&gt; [ string ]</span>
  getPropertyNames: <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> Object.<span class="me1">getPropertyNames</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// Object.defineProperty(proxy, name, pd) -&gt; undefined</span>
  defineProperty: <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span>, desc<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> Object.<span class="me1">defineProperty</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span>, <span class="kw3">name</span>, desc<span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// delete proxy[name] -&gt; boolean</span>
  <span class="kw1">delete</span>: <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="kw1">delete</span> <span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#91;</span><span class="kw3">name</span><span class="br0">&#93;</span>; <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// Object.{freeze|seal|preventExtensions}(proxy) -&gt; proxy</span>
  fix: <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="co1">// As long as target is not frozen, the proxy won't allow itself to be fixed</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>!Object.<span class="me1">isFrozen</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">return</span> undefined;
    <span class="br0">&#125;</span>
    <span class="kw2">var</span> props = <span class="br0">&#123;</span><span class="br0">&#125;</span>;
    Object.<span class="me1">getOwnPropertyNames</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#41;</span>.<span class="me1">forEach</span><span class="br0">&#40;</span><span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      props<span class="br0">&#91;</span><span class="kw3">name</span><span class="br0">&#93;</span> = Object.<span class="me1">getOwnPropertyDescriptor</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span>, <span class="kw3">name</span><span class="br0">&#41;</span>;
    <span class="br0">&#125;</span>.<span class="me1">bind</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
    <span class="kw1">return</span> props;
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// == derived traps ==</span>
&nbsp;
  <span class="co1">// name in proxy -&gt; boolean</span>
  has: <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="kw3">name</span> <span class="kw1">in</span> <span class="kw1">this</span>.<span class="me1">target</span>; <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// ({}).hasOwnProperty.call(proxy, name) -&gt; boolean</span>
  hasOwn: <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="br0">&#40;</span><span class="br0">&#123;</span><span class="br0">&#125;</span><span class="br0">&#41;</span>.<span class="me1">hasOwnProperty</span>.<span class="me1">call</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span>, <span class="kw3">name</span><span class="br0">&#41;</span>; <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// proxy[name] -&gt; any</span>
  get: <span class="kw2">function</span><span class="br0">&#40;</span>receiver, <span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#91;</span><span class="kw3">name</span><span class="br0">&#93;</span>; <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// proxy[name] = value</span>
  set: <span class="kw2">function</span><span class="br0">&#40;</span>receiver, <span class="kw3">name</span>, value<span class="br0">&#41;</span> <span class="br0">&#123;</span>
   <span class="kw1">if</span> <span class="br0">&#40;</span>canPut<span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span>, <span class="kw3">name</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// canPut as defined in ES5 8.12.4 [[CanPut]]</span>
     <span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#91;</span><span class="kw3">name</span><span class="br0">&#93;</span> = value;
     <span class="kw1">return</span> <span class="kw2">true</span>;
   <span class="br0">&#125;</span>
   <span class="kw1">return</span> <span class="kw2">false</span>; <span class="co1">// causes proxy to throw in strict mode, ignore otherwise</span>
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="co1">// for (var name in proxy) { ... }</span>
  enumerate: <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw2">var</span> result = <span class="br0">&#91;</span><span class="br0">&#93;</span>;
    <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw2">var</span> <span class="kw3">name</span> <span class="kw1">in</span> <span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> result.<span class="me1">push</span><span class="br0">&#40;</span><span class="kw3">name</span><span class="br0">&#41;</span>; <span class="br0">&#125;</span>;
    <span class="kw1">return</span> result;
  <span class="br0">&#125;</span>,
&nbsp;
  <span class="coMULTI">/*
  // if iterators would be supported:
  // for (var name in proxy) { ... }
  iterate: function() {
    var props = this.enumerate();
    var i = 0;
    return {
      next: function() {
        if (i === props.length) throw StopIteration;
        return props[i++];
      }
    };
  },*/</span>
&nbsp;
  <span class="co1">// Object.keys(proxy) -&gt; [ string ]</span>
  keys: <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> Object.<span class="me1">keys</span><span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#41;</span>; <span class="br0">&#125;</span>
<span class="br0">&#125;</span>;</pre>
<p>
To create a default forwarding proxy to an object <code>obj</code>, one would write:
</p>
<pre class="code javascript"><span class="kw2">var</span> h = <span class="kw2">new</span> Proxy.<span class="me1">Handler</span><span class="br0">&#40;</span>obj<span class="br0">&#41;</span>;
<span class="kw2">var</span> p = Proxy.<span class="me1">create</span><span class="br0">&#40;</span>h<span class="br0">&#41;</span>;</pre>
<p>
To modify one of the default traps, one can either override traps on a default handler or use prototype inheritance. For example:
</p>
<pre class="code javascript"><span class="co1">// using assignment</span>
<span class="kw2">var</span> h = <span class="kw2">new</span> Proxy.<span class="me1">Handler</span><span class="br0">&#40;</span>obj<span class="br0">&#41;</span>;
h.<span class="me1">get</span> = <span class="kw2">function</span><span class="br0">&#40;</span>rcvr, <span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>;
<span class="kw2">var</span> p = Proxy.<span class="me1">create</span><span class="br0">&#40;</span>h<span class="br0">&#41;</span>;
&nbsp;
<span class="co1">// using inheritance</span>
<span class="kw2">function</span> MyHandler<span class="br0">&#40;</span>target<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  Proxy.<span class="me1">Handler</span>.<span class="me1">call</span><span class="br0">&#40;</span><span class="kw1">this</span>, target<span class="br0">&#41;</span>; <span class="co1">// constructor chaining</span>
<span class="br0">&#125;</span>
MyHandler.<span class="me1">prototype</span> = Object.<span class="me1">create</span><span class="br0">&#40;</span>Proxy.<span class="me1">Handler</span>.<span class="me1">prototype</span><span class="br0">&#41;</span>;
MyHandler.<span class="me1">prototype</span>.<span class="me1">get</span> = <span class="kw2">function</span><span class="br0">&#40;</span>rcvr, <span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>;
&nbsp;
<span class="kw2">var</span> h2 = <span class="kw2">new</span> MyHandler<span class="br0">&#40;</span>obj<span class="br0">&#41;</span>;
<span class="kw2">var</span> p2 = Proxy.<span class="me1">create</span><span class="br0">&#40;</span>h2<span class="br0">&#41;</span>;</pre>
<p>
Pros of this <acronym title="Application Programming Interface">API</acronym>:
</p>
<ul>
<li class="level1"><div class="li"> Familiarity to Javascript developers.</div>
</li>
<li class="level1"><div class="li"> Handler inheritance is straightforward.</div>
</li>
<li class="level1"><div class="li"> All default traps are shared among all default handler instances.</div>
</li>
</ul>

<p>
 Cons of this <acronym title="Application Programming Interface">API</acronym>:
</p>
<ul>
<li class="level1"><div class="li"> The constructor pattern is subject to the bug of forgetting <code>new</code>, in which case <code>Proxy.Handler(obj)</code> will set a <code>target</code> property on <code>Proxy</code>.</div>
</li>
<li class="level1"><div class="li"> It&rsquo;s awkward that handlers are created using constructor functions (requiring <code>new</code>) whereas proxies are created using a factory method (not requiring <code>new</code>). This makes the <acronym title="Application Programming Interface">API</acronym> feel a little inconsistent.</div>
</li>
</ul>

<p>
  &mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2010/12/14 3:10</em>
</p>

</div>

<a name="open_issues"></a><h2>Open Issues</h2>
<div class="level2">

</div>

<a name="alternative_names"></a><h4>Alternative names</h4>
<div class="level4">

<p>
 We can debate about alternative names for <code>Handler</code> and <code>target</code>.
</p>

<p>
If the Proxy <acronym title="Application Programming Interface">API</acronym> would be contained in a Harmony module, it may make sense to introduce <code>Handler</code> as an exported variable, next to <code>Proxy</code>, instead of making it a property on <code>Proxy</code>.
</p>

<p>
It was <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-April/013854.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2011-April/013854.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">noted</a> that calling the default forwarding handler <code>Handler</code> is potentially confusing (not all handlers are forwarding handlers). Possible alternative: <code>Forwarder</code>.
</p>

<p>
<em>&mdash; <a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2011/05/04 12:15</em>
</p>

</div>

<a name="alternative_implementation_for_default_set_trap"></a><h4>Alternative implementation for default set trap</h4>
<div class="level4">

<p>
 As currently defined, the default <code>set</code> trap&rsquo;s behavior is counter-intuitive in the case of a &ldquo;chain&rdquo; of proxies (a proxy forwarding to another proxy):
</p>
<pre class="code javascript">  set: <span class="kw2">function</span><span class="br0">&#40;</span>receiver, <span class="kw3">name</span>, value<span class="br0">&#41;</span> <span class="br0">&#123;</span>
   <span class="kw1">if</span> <span class="br0">&#40;</span>canPut<span class="br0">&#40;</span><span class="kw1">this</span>.<span class="me1">target</span>, <span class="kw3">name</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="co1">// canPut as defined in ES5 8.12.4 [[CanPut]]</span>
     <span class="kw1">this</span>.<span class="me1">target</span><span class="br0">&#91;</span><span class="kw3">name</span><span class="br0">&#93;</span> = value;
     <span class="kw1">return</span> <span class="kw2">true</span>;
   <span class="br0">&#125;</span>
   <span class="kw1">return</span> <span class="kw2">false</span>; <span class="co1">// causes proxy to throw in strict mode, ignore otherwise</span>
  <span class="br0">&#125;</span>,</pre>
<p>
If <code>this.target</code> is a proxy, the <code>canPut</code> auxiliary function will trigger that proxy&rsquo;s <code>getOwnPropertyDescriptor</code> and <code>getPropertyDescriptor</code> traps to determine whether the property can be set. Only then is the assignment performed on <code>this.target</code> and is that proxy&rsquo;s <code>set</code> trap invoked.
</p>

<p>
Part of the awkwardness lies in the fact that the &ldquo;inner&rdquo; <code>set</code> returns its own boolean to indicate success, but that boolean isn&rsquo;t accessible to the &ldquo;outer&rdquo; <code>set</code>. Instead each proxy in the chain tests the boolean and either throws or ignores it. MarkM suggests the following refactoring of the internal spec methods which would make this chaining of <code>set</code> calls more intuitive:
</p>

<p>
Since the system itself will provide the default traps, the default <code>set</code> trap could call a new internal  [[Set]](P,V) method which returns a boolean, such that [[Put]] would be redefined as:
</p>
<pre class="code">
8.12.5 [[Put]](P,V,Throw)

  If the result of calling [[Set]](P,V) is true, return.
  Else if Throw is true, throw a TypeError exception.
  else return.
</pre>

<p>
The [[Set]] method on regular objects would be defined as is the current [[Put]] but returning a boolean rather than conditionally throwing. The [[Set]] method on proxies would call the <code>set</code> trap. The default <code>set</code> trap would call [[Set]] on <code>this.target</code>. So this default <code>set</code> trap is the primitive by which the ability to call [[Set]] is exposed.
</p>

<p>
The one problem with this plan is [[Set]] on an object that inherits from a proxy. This plan would still go through the [[CanPut]] logic on the derived object which would still trigger the [[GetProperty]] and [[GetOwnProperty]] traps on the proxy. So there&rsquo;s not much difference in the inherited case. But the direct chaining case is more direct and intuitive.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2011/01/12 3:10</em>
</p>

</div>

<a name="default_implementation_of_fix"></a><h4>Default implementation of fix()</h4>
<div class="level4">

<p>
 The above implementation of <code>fix()</code> was written without giving much thought to the consequences. On second thought, the above default implementation is potentially unsafe: if a proxy handler inherits from the default forwarding handler, but does not override <code>fix()</code>, and it forwards to a frozen object, then freezing the proxy will fix it by fully bypassing the handler. This would mean that any intercepting behavior (e.g. for access control, logging, ...) that the handler specified would no longer be called, which can be surprising. A  more conservative and safer default implementation of the <code>fix</code> trap would just be to always return <code>undefined</code>. This implies that default forwarding proxies can&rsquo;t be fixed unless <code>fix</code> is explicitly overridden.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2011/05/04 12:20</em>
</p>

</div>

<a name="feedback_and_history"></a><h2>Feedback and History</h2>
<div class="level2">

<p>
 TC39 January 2011 meeting:
</p>

<p>
From Waldemar&rsquo;s notes:
</p>

<p>
Proxy default handler: Some trivial bugs in the code:  Calling getOwnPropertyDescriptor etc. with only one argument.  desc in &ldquo;desc.configurable = true&rdquo; can be undefined.
</p>

<p>
set/put/canPut problem discussion. Allen:  Clean up the list of primitive methods and handlers. MarkM:  All existing uses of put can be written in terms of [[Set]]. Waldemar:  Would want a more generic way of invoking [[Set]] rather than having to instantiate a new default proxy. Brendan:  Issue remains with prototype chain.
</p>

<p>
Agreed to move this to proposal stage, with some open issues.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2011/01/24 10:39</em>
</p>

<p>
TC39 November 2010 meeting: agreement that a default forwarding handler should become part of the spec.
</p>

<p>
A first iteration of this <acronym title="Application Programming Interface">API</acronym> required handlers to be created using a factory method:
</p>
<pre class="code javascript"><span class="kw2">var</span> handler = Proxy.<span class="me1">handlerFor</span><span class="br0">&#40;</span>target<span class="br0">&#41;</span>;</pre>
<p>
Drawback of this <acronym title="Application Programming Interface">API</acronym>: one cannot inherit from a shared handler prototype. Waldemar: why not define an <acronym title="Application Programming Interface">API</acronym> based on prototypes and constructor functions? The revised <acronym title="Application Programming Interface">API</acronym> was formulated in response to this.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2010/12/15 2:53</em>
</p>

</div>

<a name="references"></a><h2>References</h2>
<div class="level2">

<p>
 An implementation of this <acronym title="Application Programming Interface">API</acronym> that works using proxies in Firefox 4 is available <a href="http://code.google.com/p/es-lab/source/browse/trunk/src/proxies/forwardingHandler.js" class="urlextern" target="_blank" title="http://code.google.com/p/es-lab/source/browse/trunk/src/proxies/forwardingHandler.js" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">here</a>. 
</p>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/2/2015d3842b372938b8682b22e4679436.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        harmony/proxy_defaulthandler.txt &middot; Last modified: 2013/10/18 15:09 by rwaldron      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="harmony:proxy_defaulthandler" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="harmony:proxy_defaulthandler" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="harmony:proxy_defaulthandler" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="harmony:proxy_defaulthandler" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=harmony:proxy_defaulthandler.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=harmony%253Aproxy_defaulthandler&amp;1454275460" width="1" height="1" alt=""  /></body>
</html>
