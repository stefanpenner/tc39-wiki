<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>proposals:numbers [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=proposals:numbers&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=proposals" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=proposals:numbers&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=proposals:numbers&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2008-07-14T18:23:18+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=proposals:numbers&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">proposals:numbers</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:numbers" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:numbers" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:builtin_classes.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:builtin_classes">builtin_classes</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:structural_types_and_typing_of_initializers.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:structural_types_and_typing_of_initializers">structural_types_and_typing_of_initializers</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:is_as_to.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:is_as_to">is_as_to</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=proposals:nullability.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:nullability">nullability</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=proposals:numbers.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="proposals:numbers">numbers</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="level1"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#numbers" class="toc">Numbers</a></span><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#motivation" class="toc">Motivation</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#representations" class="toc">Representations</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#syntax" class="toc">Syntax</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#standard_interpretation" class="toc">Standard interpretation</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#representation-selection_suffix" class="toc">Representation-selection suffix</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#effect_of_the_use_numbertype_pragma_on_syntactic_interpretation" class="toc">Effect of the &quot;use &lt;numbertype&gt;&quot; pragma on syntactic interpretation</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#conversions" class="toc">Conversions</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#operations" class="toc">Operations</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#binary_aritmetic_operators" class="toc">Binary aritmetic operators</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#the_selected_type_is_number" class="toc">The selected type is &quot;Number&quot;</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#the_selected_type_is_not_number" class="toc">The selected type is not &quot;Number&quot;</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#relational_operators" class="toc">Relational operators</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#bitwise_and_shift_operators" class="toc">Bitwise and shift operators</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#unary_operators" class="toc">Unary operators</a></span></li>
</ul>
</li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#use_numbertype" class="toc">''use &lt;numbertype&gt;''</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#classification" class="toc">Classification</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#string-to-number_conversion" class="toc">String-to-number conversion</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#number-to-string_conversion" class="toc">Number-to-string conversion</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#open_issues" class="toc">Open issues</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#an_opposing_view" class="toc">An opposing view</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=proposals:numbers.html#the_overview_seems_to_have_something_different_again" class="toc">The Overview seems to have something different, again?</a></span></li>
</ul>
</li>
</ul>
</div>
</div>

<a name="numbers"></a><h1>Numbers</h1>
<div class="level1">

<p>
 (Also see the <a href="doku.php%3Fid=discussion:numbers.html" class="wikilink1" title="discussion:numbers" onclick="return svchk()" onkeypress="return svchk()">discussion page</a> for this proposal)
</p>

</div>

<a name="motivation"></a><h2>Motivation</h2>
<div class="level2">

<p>
 ECMAScript 3rd Edition had only numeric type, called <code>Number</code>, with a concrete representation as IEEE double precision binary floating point.  The 4th Edition draft adds types <code>int</code>, <code>uint</code>.  The <a href="doku.php%3Fid=proposals:decimal.html" class="wikilink1" title="proposals:decimal" onclick="return svchk()" onkeypress="return svchk()">decimal</a> proposal has added a type <code>decimal</code>; the <a href="doku.php%3Fid=proposals:type_parameters.html" class="wikilink1" title="proposals:type_parameters" onclick="return svchk()" onkeypress="return svchk()">type parameters</a> proposal makes it possible for user programs to provide their own numeric types.
</p>

<p>
The present proposal attempts to pull all these strands together and define the relationships of the various representations, mixed-representation arithmetic, and so on.  It also tries to do something interesting with the <code>Number</code> type, which does not have to be seen as a primitive type in its own right but instead as an alias that maps to more primitive types depending on context.
</p>

</div>

<a name="representations"></a><h2>Representations</h2>
<div class="level2">

<p>
 There shall be four built-in representations for numbers: <code>double</code>, <code>decimal</code>, <code>int</code>, and <code>uint</code>.  There is a built-in type corresponding to each of these representations.
</p>

<p>
The representations hold the following values: 
</p>
<ul>
<li class="level1"><div class="li"> <code>double</code> values are 64-bit IEEE binary floating point values</div>
</li>
<li class="level1"><div class="li"> <code>decimal</code> values are 128-bit IEEE decimal floating point values</div>
</li>
<li class="level1"><div class="li"> <code>int</code> values are integers in the range -(2^31) .. (2^31)-1</div>
</li>
<li class="level1"><div class="li"> <code>uint</code> values are integers in the range 0 .. (2^32)-1</div>
</li>
</ul>

<p>
 All representation types are <code>final</code> classes that are direct subtypes of <code>Object</code>.  (See the <a href="doku.php%3Fid=discussion:numbers.html" class="wikilink1" title="discussion:numbers" onclick="return svchk()" onkeypress="return svchk()">discussion page</a> for a discussion of why there is not a subtype relationship between the numeric types.)
</p>

<p>
There shall also be a non-nullable non-final dynamic class <code>Number</code> that holds a double value and which is generally compatible with the <code>Number</code> type in Edition 3.  <code>Number</code> is a direct subtype of <code>Object</code>.
</p>

</div>

<a name="syntax"></a><h2>Syntax</h2>
<div class="level2">

<p>
 In general, number literals can map to multiple representation (eg, <code>1</code> can be represented without loss of precision in any of the four representations).  
</p>

</div>

<a name="standard_interpretation"></a><h3>Standard interpretation</h3>
<div class="level3">

<p>
 In the absence of a representation-selection suffix or a <code>use &lt;numbertype&gt;</code> pragma, the representation is selected as follows, selecting the first rule that matches: 
</p>
<ul>
<li class="level1"><div class="li"> Any integer value prefixed by <code>0x</code> in the range of a <code>uint</code> is represented as a <code>uint</code></div>
</li>
<li class="level1"><div class="li"> Any integer value in the range of an <code>int</code> is represented as an <code>int</code></div>
</li>
<li class="level1"><div class="li"> Any integer value in the range of a <code>uint</code> but outside the range of an <code>int</code> is represented as a <code>uint</code></div>
</li>
<li class="level1"><div class="li"> Everything else is represented as a <code>double</code>.</div>
</li>
</ul>

</div>

<a name="representation-selection_suffix"></a><h3>Representation-selection suffix</h3>
<div class="level3">

<p>
 The program can force the representation of a number literal by suffixing the literal with a character denoting the type, one of <code>m</code>, <code>d</code>, <code>i</code>, and <code>u</code> (case-insensitively): 
</p>
<ul>
<li class="level1"><div class="li"> <code>10.5m</code> is a decimal literal</div>
</li>
<li class="level1"><div class="li"> <code>10.5d</code> is a double literal</div>
</li>
<li class="level1"><div class="li"> <code>37i</code> is an int literal</div>
</li>
<li class="level1"><div class="li"> <code>42u</code> is a uint literal</div>
</li>
</ul>

<p>
 (The suffix <code>m</code> was taken from C# and is the initial letter of the word &ldquo;money&rdquo;.  Monetary computations tend to benefit the most from decimal floating point.)
</p>

<p>
These suffixes are handy in situations where a <code>use &lt;numbertype&gt;</code> pragma is in effect but where we still want to control the numeric types and not have to worry about run-time conversions, for example.
</p>

<p>
The suffixes are part of the syntax for the various number literals.  Thus 0x10i is an int literal.  The rules are roughly: 
</p>
<ul>
<li class="level1"><div class="li"> [0-9]+[iumd]?</div>
</li>
<li class="level1"><div class="li"> 0x[0-9a-fA-F]+[iu]?</div>
</li>
<li class="level1"><div class="li"> [0-9]+.[0-9]+[Ee][+-]?[0-9]+[md]?</div>
</li>
</ul>

</div>

<a name="effect_of_the_use_numbertype_pragma_on_syntactic_interpretation"></a><h3>Effect of the &quot;use &lt;numbertype&gt;&quot; pragma on syntactic interpretation</h3>
<div class="level3">

<p>
 The program can also force the representation of an un-suffixed number literal by placing the literal in the scope of a <code>use &lt;numbertype&gt;</code> pragma.  
</p>

<p>
When the pragma selects a floating-point type &ndash; <code>use decimal</code> and <code>use double</code> &ndash; then every literal is interpreted as being of that type.
</p>

<p>
When the pragma selects an integer type &ndash; <code>use int</code> and <code>use uint</code> &ndash; then every integer literal is interpreted as being of that type.  Integer values that do not fit the target type are read as <code>double</code> and then converted to <code>int</code> or <code>uint</code> using the standard conversion.
</p>

<p>
A special meaning is given to the phrase <code>use Number</code>.  The phrase means that the implementation should revert to the standard (initial) behavior.
</p>

</div>

<a name="conversions"></a><h2>Conversions</h2>
<div class="level2">

<p>
 All built-in numeric types are interconvertible in the sense that  
</p>
<ul>
<li class="level1"><div class="li"> mixed-representation arithmetic converts operands to a common representation (normally without loss of precision) </div>
</li>
<li class="level1"><div class="li"> assignment silently converts a numeric type to the target type (even if that entails loss of precision)</div>
</li>
</ul>

<p>
 In effect it is as if each type defines a <code>to</code> operator that can handle any of the built-in numeric types, and there is no strict-mode restriction on that <code>to</code> operator.
</p>

<p>
For mixed-representation arithmetic operators like <code>+</code> and <code>-</code>, <code>int</code> is converted to <code>uint</code> if possible, otherwise to <code>double</code> or <code>decimal</code> depending on the other operand.  <code>uint</code> is converted to <code>double</code> or <code>decimal</code> depending on the other operand.  <code>double</code> is converted to <code>decimal</code>.  A <code>Number</code> value is converted to <code>double</code> before it participates in any arithmetic.  The next section contains more details.
</p>

</div>

<a name="operations"></a><h2>Operations</h2>
<div class="level2">

<p>
 Observe that when no pragma is in effect, the most that can be said about the type of the result of an arithmetic operation is that it is <code>Numeric</code> (see section &ldquo;Classification&rdquo; below).  When a pragma is in effect, the type of the result is known precisely.
</p>

</div>

<a name="binary_aritmetic_operators"></a><h3>Binary aritmetic operators</h3>
<div class="level3">

<p>
 The binary aritmetic operators <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, and <code>%</code> operate on numeric arguments in one of two ways, depending on whether a <code>use &lt;numbertype&gt;</code> pragma is in effect.  
</p>

</div>

<a name="the_selected_type_is_number"></a><h4>The selected type is &quot;Number&quot;</h4>
<div class="level4">

<p>
 If no pragma is in effect then the operands are converted to a common representation if necessary before the operation is performed.  No argument conversion takes place if the operands are of the same representation.
</p>

<p>
Operands are converted to a common representation by the following algorithm:
</p>
<ul>
<li class="level1"><div class="li"> if one operand is decimal, the other is converted to decimal</div>
</li>
<li class="level1"><div class="li"> else if one operand is double, the other is converted to double</div>
</li>
<li class="level1"><div class="li"> else (one operand is uint and the other is int) </div>
<ul>
<li class="level2"><div class="li"> if the int is nonnegative then it is converted to uint  </div>
</li>
<li class="level2"><div class="li"> else both operands are converted to double.</div>
</li>
</ul>
</li>
</ul>

<p>
 The type of the result of the operation is selected by the following algorithm:
</p>
<ul>
<li class="level1"><div class="li"> if the operands are double, the result is double</div>
</li>
<li class="level1"><div class="li"> if the operands are decimal, the result is decimal</div>
</li>
<li class="level1"><div class="li"> if the operands are int and the result is representable as an int without loss of precision, the result is an int.</div>
</li>
<li class="level1"><div class="li"> if the operands are uint and the result is representable as an uint without loss of precision, the result is an uint.</div>
</li>
<li class="level1"><div class="li"> else the result is a double</div>
</li>
</ul>

</div>

<a name="the_selected_type_is_not_number"></a><h4>The selected type is not &quot;Number&quot;</h4>
<div class="level4">

<p>
 If a pragma is in effect then the operands are converted independently to the representation selected by the pragma before the operation is performed.  The result of the operation is always in the selected representation, even if that entails loss of precision.  (For example, if <code>use uint</code> is in effect then <code>/</code> is unsigned integer division.)
</p>

</div>

<a name="relational_operators"></a><h3>Relational operators</h3>
<div class="level3">

<p>
 The relational operators <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>,<code>&gt;=</code>, <code>==</code>, <code>===</code>, <code>!=</code>, and <code>!==</code> convert their operands in the same ways as the binary arithmetic operators, and always produce a boolean result.
</p>

</div>

<a name="bitwise_and_shift_operators"></a><h3>Bitwise and shift operators</h3>
<div class="level3">

<p>
 The bitwise and shift operators &lt;&lt;, &gt;&gt;, &gt;&gt;&gt;, &amp;, |, and ^ work as in Edition 3: arguments are converted to <code>int</code> or <code>uint</code> as required by the operator, and the result is <code>int</code> or <code>uint</code> as per the Edition 3 spec.  The <code>use &lt;numbertype&gt;</code> pragmas have no effect. 
</p>

</div>

<a name="unary_operators"></a><h3>Unary operators</h3>
<div class="level3">

<p>
 The unary arithmetic operators <code>+</code> and <code>-</code> operate on their single numeric operand in one of two ways, depending on whether a <code>use &lt;numbertype&gt;</code> pragma is in effect.
</p>

<p>
If no pragma is in effect, then the result of the operation is in the representation of the operand if (a) that representation is <code>decimal</code> or <code>double</code> or (b) the result can be represented without loss of precision.  Otherwise, the result is represented as <code>double</code>.
</p>

<p>
If a pragma is in effect then the operand is converted to the representation selected by the pragma before the operation is performed.  The result of the operation is always in the selected representation, even if that entails loss of precision.  For example, if <code>use uint</code> is in effect then -0xFFFFFFFF = ~0xFFFFFFFF + 1 = 1, not the <code>double</code> value -4294967296.
</p>

<p>
The operation of the unary arithmetic operators <code>++</code> and <code>&ndash;</code> depends on whether a <code>use &lt;numbertype&gt;</code> pragma is in effect.
</p>

<p>
If a pragma is not in effect, then the value is extracted from the location, converted to a number, incremented or decremented, and stored back into the location (with possible truncation).  (This behavior is entirely compatible with Edition 3 except in that it takes type annotations into account.)
</p>

<p>
If a pragma is in effect, then the value is extracted and converted to a number of the selected representation, incremented or decremented, then converted to the selected representation again, and finally stored back into the location (with possible conversion yet again to match the annotation on the location). 
</p>

</div>

<a name="use_numbertype"></a><h2>''use &lt;numbertype&gt;''</h2>
<div class="level2">

<p>
 As outlined in the preceding sections, the pragma <code>use &lt;numbertype&gt;</code> has several effects in its scope (which is lexical block scope like for other pragmas):
</p>
<ul>
<li class="level1"><div class="li"> it affects the behavior of arithmetic and relational operators; and</div>
</li>
<li class="level1"><div class="li"> it affects the interpretation of numeric literals.</div>
</li>
</ul>

<p>
 The effect of this pragma can also be explained in large part in terms of namespaces.  See the <a href="doku.php%3Fid=discussion:numbers.html" class="wikilink1" title="discussion:numbers" onclick="return svchk()" onkeypress="return svchk()">the discussion page</a> for more.
</p>

<p>
The phrase <code>use Number</code> means &ldquo;revert to standard behavior&rdquo;, ie, in its scope the implementation behaves as if no number-type pragma is in effect.
</p>

</div>

<a name="classification"></a><h2>Classification</h2>
<div class="level2">

<p>
 User programs will wish to test if a value has a numeric type.  Since there is no common base type for numbers, one can&rsquo;t use eg <code>x is Number</code> (or even <code>x instanceof Number</code>).  
</p>

<p>
There shall be a predefined union type <code>Numeric</code>: 
</p>
<pre class="code">  type Numeric = (int, uint, double, decimal, Number)</pre>

<p>
 User code would now use <code>x is Numeric</code> to test for a number.  User code that defines new number types could extend the union, 
</p>
<pre class="code">  type CNumeric = (Numeric, Complex)</pre>

<p>
 which does the right thing.
</p>

</div>

<a name="string-to-number_conversion"></a><h2>String-to-number conversion</h2>
<div class="level2">

<p>
 3rd Edition has the following facilities: 
</p>
<ul>
<li class="level1"><div class="li"> <code>Number</code> converts its argument to a double through the <code>ToNumber</code> mechanism</div>
</li>
<li class="level1"><div class="li"> <code>parseInt</code> parses an integer-syntaxed prefix of a string as a double</div>
</li>
<li class="level1"><div class="li"> <code>parseFloat</code> parses a prefix of a string as a double</div>
</li>
</ul>

<p>
 In 4th Edition, we should make the following changes: 
</p>
<ul>
<li class="level1"><div class="li"> <code>Number</code> should convert its argument to the currently selected floating-point representation</div>
</li>
<li class="level1"><div class="li"> <code>parseInt</code> should return an int</div>
</li>
<li class="level1"><div class="li"> <code>parseUint</code> should return a uint</div>
</li>
<li class="level1"><div class="li"> <code>parseDecimal</code> should return a decimal</div>
</li>
<li class="level1"><div class="li"> <code>parseDouble</code> should be introduced as an alias for <code>parseFloat</code></div>
</li>
</ul>

</div>

<a name="number-to-string_conversion"></a><h2>Number-to-string conversion</h2>
<div class="level2">

<p>
 At a minimum, <code>toFixed</code>, <code>toPrecision</code>, and <code>toExponential</code> must have their domains extended to <code>Numeric</code> (rather than <code>double</code> as in 3rd Edition) and have proper behavior defined on <code>decimal</code> (the behavior for <code>int</code> and <code>uint</code> being defined by conversion to <code>double</code>).
</p>

<p>
<code>ToString</code> must also be defined on <code>decimal</code>.
</p>

<p>
[I would suggest the details (though not necessarily the words) to be found at <a href="http://www2.hursley.ibm.com/decimal/daconvs.html" class="urlextern" target="_blank" title="http://www2.hursley.ibm.com/decimal/daconvs.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">http://www2.hursley.ibm.com/decimal/daconvs.html</a> &ndash; this has now been in use for 25+ years, and has been adopted by Java, C#, etc.  &mdash; <em><a href="mailto:%26%23x4d%3B%26%23x46%3B%26%23x43%3B%26%23x40%3B%26%23x75%3B%26%23x6b%3B%26%23x2e%3B%26%23x69%3B%26%23x62%3B%26%23x6d%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x4d;&#x46;&#x43;&#x40;&#x75;&#x6b;&#x2e;&#x69;&#x62;&#x6d;&#x2e;&#x63;&#x6f;&#x6d;">Mike Cowlishaw</a> 2006/11/27 23:39</em>]
</p>

</div>

<a name="open_issues"></a><h2>Open issues</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> It is possible that <code>use &lt;numbertype&gt;</code> is overdesigned in various ways</div>
</li>
<li class="level1"><div class="li"> The syntax <code>use Number</code> is in any case pretty obscure, to say the least</div>
</li>
<li class="level1"><div class="li"> The name <code>Numeric</code> is not very pretty</div>
</li>
<li class="level1"><div class="li"> It is possible there should be other predefined unions, like <code>RealNumber</code>, <code>AnyNumber</code>, <code>FloatNumber</code> that can be used for forward-compatible signatures (I know this smells of the Scheme numeric tower, but I do believe they have utility &ndash; some are used in the Math object in the reference implementation but are private to that object).  Most would leave out <code>Number</code> because it&rsquo;s mostly obsolete.  Fx:</div>
</li>
</ul>
<pre class="code">
    AnyNumber = (int,uint,double,decimal,Number)  // might have complex, float, bignum in the future
    RealNumber = (int,uint,double,decimal)        // might have bignum, float in the future
    FloatNumber = (double,decimal)                // might have float in the future
    IntegralNumber = (int,uint)                   // might have bignum in the future
</pre>

</div>

<a name="an_opposing_view"></a><h2>An opposing view</h2>
<div class="level2">

<p>
 Another trial balloon.
</p>

<p>
I&rsquo;ve been pondering numbers today.  One issue is the &ldquo;use &lt;numbertype&gt;&rdquo; pragma.  I fear it does not pull its weight in the form we have it now.
</p>

<p>
Recall:
</p>

<p>
We started out with &ldquo;use precision ...&rdquo; and &ldquo;use rounding ...&rdquo; for decimal.
</p>

<p>
Then we figured that &ldquo;use decimal&rdquo; was a neat way of letting people have the semantics they presumably wanted.  The main use case for &ldquo;use decimal&rdquo; is that you slap it on at the top of your program and then forget about it, it just works.  In its current form it affects the interpretation of literals and the conversion behavior of many operators, but not assignment.  There are some problems, eg parseFloat() still returns a double, but mostly this works OK.
</p>

<p>
Then we figured that &ldquo;use uint&rdquo; is maybe good for bit crunchers: mod32 arithmetic, no overflow checks, basically fast machine arithmetic, and if your variables are typed right and your literals are suffixed right you can get the performance you need.  But it&rsquo;s hard to control, and not what you normally want, so it had to be block-scoped.
</p>

<p>
At that point it seemed silly not to generalize it to &ldquo;use int&rdquo; and &ldquo;use double&rdquo;, and to allow all these pragmas to be in effect lexically.
</p>

<p>
Then we (or I) added various escape hatches, like &ldquo;use uint&rdquo; would not affect the meaning of literals that looked like floating point (because in reality you might want programs that use uint here and double there, and sometimes those regions overlap).
</p>

<p>
Since the syntax of the pragma is still clumsy &ndash; block scoped only &ndash; there&rsquo;s another proposal from me in the Trac to allow pragmas to be scoped in expressions using &ldquo;let&rdquo; syntax; we all but agreed about this at the last f2f.
</p>

<p>
In retrospect this strikes me as nuttily complicated in order to satisfy two simple and very distinct actual use cases: 
</p>
<ol>
<li class="level1"><div class="li"> convenient decimal arithmetic for the masses</div>
</li>
<li class="level1"><div class="li"> wrapping uint aritmetic for the crypto heads</div>
</li>
</ol>

<p>
 In particular, the wrapping uint arithmetic effectively only affects the operators +, -, *, /, and % (and unary +, -, ++, and &ndash;)  because the shift / bitwise ops are already behaving the way we want them to; it&rsquo;s true the relational operators are affected too but that strikes me as a bug (if you happen to compare a double and a uint, do you really want the double to be converted to uint for the comparison?).
</p>

<p>
Here&rsquo;s another approach (strawman proposal).
</p>

<p>
(1) &ldquo;use decimal&rdquo; is allowed at the top level only and only affects the interpretation of literals.  All literals are interpreted as decimals.  After that, normal operator behavior takes over and in practice almost all computations will be performed as decimal.  Explicit casts can be used to convert numbers extracted from <acronym title="Document Object Model">DOM</acronym>, parseInt, etc.
</p>

<p>
(1a) If the above is too bare-bones, let it also affect arithmetic so that it always converts the operands to decimal, like the current numbers proposal.
</p>

<p>
(2) New &ldquo;wrapping&rdquo; operators are introduced for the list of operators outlined above.  These convert their operands to uint and perform uint arithmetic, returning uint results.  As such they are like the bitwise operators we already have.  These operators are spelled like the ones we have, prefixed by a backtick: 
</p>
<pre class="code">x `+ y
`++x
x`--</pre>

<p>
 (The O&rsquo;Caml way +. (<acronym title="If I remember correctly">IIRC</acronym>) is alas(?) syntactically ambiguous.  It&rsquo;s possible &ldquo;.+&rdquo; would work.  Suggest away.)
</p>

<p>
A side benefit of this is that wrapping behavior, which is new to the language and has some dangers as Mike C has pointed out (though not all he has pointed out), becomes explicitly visible.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x6c%3B%26%23x74%3B%26%23x68%3B%26%23x40%3B%26%23x61%3B%26%23x63%3B%26%23x6d%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x6c;&#x74;&#x68;&#x40;&#x61;&#x63;&#x6d;&#x2e;&#x6f;&#x72;&#x67;">Lars T Hansen</a> 2007/09/26 22:47</em>
</p>

</div>

<a name="the_overview_seems_to_have_something_different_again"></a><h2>The Overview seems to have something different, again?</h2>
<div class="level2">

<p>
 As far as I can see, the decimal support proposed in the Overview is even less functional than the various discussions above.  If one were to write: 
</p>
<pre class="code">use decimal default
total = 0.70 * 1.05 </pre>

<p>
 then total will not have the value 0.735 but something a little less (it, and the calculation will be binary floating-point); when rounded to cents the wrong result would be returned.  This would seem to have a high &lsquo;astonishment factor&rsquo;.  (The &lsquo;default&rsquo; above is just for illustration, but something seems to be required.)  &mdash; <em><a href="mailto:%26%23x4d%3B%26%23x46%3B%26%23x43%3B%26%23x40%3B%26%23x75%3B%26%23x6b%3B%26%23x2e%3B%26%23x69%3B%26%23x62%3B%26%23x6d%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x4d;&#x46;&#x43;&#x40;&#x75;&#x6b;&#x2e;&#x69;&#x62;&#x6d;&#x2e;&#x63;&#x6f;&#x6d;">Mike Cowlishaw</a> 2007/10/31 09:29</em> 
</p>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/b/b3f82a2e5abe0086eb63bf6ca2d42606.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        proposals/numbers.txt &middot; Last modified: 2008/07/14 18:23 by jodyer      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="proposals:numbers" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="proposals:numbers" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="proposals:numbers" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="proposals:numbers" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=proposals:numbers.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=proposals%253Anumbers&amp;1454275565" width="1" height="1" alt=""  /></body>
</html>
