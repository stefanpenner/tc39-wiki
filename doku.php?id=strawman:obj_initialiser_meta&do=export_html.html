<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:obj_initialiser_meta&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:obj_initialiser_meta&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:obj_initialiser_meta&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>

<a name="object_literal_meta_properties"></a><h1>Object Literal Meta Properties</h1>
<div class="level1">

<p>
 <em>This is one of several related <a href="doku.php%3Fid=strawman:object_initialiser_extensions.html" class="wikilink1" title="strawman:object_initialiser_extensions" onclick="return svchk()" onkeypress="return svchk()">Object Initialiser Extensions</a>.</em>
</p>

<p>
<em>Updated to use  angle brackets, add array form, replaced parent meta property with proto, elimianted extensible meta property</em>  &mdash; <em><a href="mailto:%26%23x41%3B%26%23x6c%3B%26%23x6c%3B%26%23x65%3B%26%23x6e%3B%26%23x2e%3B%26%23x57%3B%26%23x69%3B%26%23x72%3B%26%23x66%3B%26%23x73%3B%26%23x2d%3B%26%23x42%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x40%3B%26%23x6d%3B%26%23x69%3B%26%23x63%3B%26%23x72%3B%26%23x6f%3B%26%23x73%3B%26%23x6f%3B%26%23x66%3B%26%23x74%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x41;&#x6c;&#x6c;&#x65;&#x6e;&#x2e;&#x57;&#x69;&#x72;&#x66;&#x73;&#x2d;&#x42;&#x72;&#x6f;&#x63;&#x6b;&#x40;&#x6d;&#x69;&#x63;&#x72;&#x6f;&#x73;&#x6f;&#x66;&#x74;&#x2e;&#x63;&#x6f;&#x6d;">Allen Wirfs-Brock</a> 2010/09/08 04:20</em> <br/>
 <em>Updated to use <strong>closed</strong> as meta property, allow <strong>null</strong> proto,  and Array literals with explicit proto meta properties have [[Class]] Array internal properties.</em>  &mdash; <em><a href="mailto:%26%23x41%3B%26%23x6c%3B%26%23x6c%3B%26%23x65%3B%26%23x6e%3B%26%23x40%3B%26%23x57%3B%26%23x69%3B%26%23x72%3B%26%23x66%3B%26%23x73%3B%26%23x2d%3B%26%23x42%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x41;&#x6c;&#x6c;&#x65;&#x6e;&#x40;&#x57;&#x69;&#x72;&#x66;&#x73;&#x2d;&#x42;&#x72;&#x6f;&#x63;&#x6b;&#x2e;&#x63;&#x6f;&#x6d;">Allen Wirfs-Brock</a> 2011/03/09 20:28</em>
</p>

<p>
As  currently specified in ECMAScript 5 all objects created using object literal syntax always have the built-in Object.prototype as their parent. This precludes the use of object initialisers  to define objects that require some other parent. Furthermore, there is no declarative mechanism to specify other internal properties of objects such as their [[extensible]] internal property.  Such internal properties can only be set by applying Object reflection methods.
</p>

<p>
This extension proposes enhancing object initialisers and array initialisers to support the specification of such internal meta properties. Meta properties are specified using an angle bracketed list as the first item within the object literal.  This syntax is upwards compatible with ES5 object and array literal syntax which does not currently permit a opening angle bracket to appear as the first token inside an object literal.
</p>

<p>
Example: 
</p>
<pre class="code javascript"><span class="kw2">var</span> obj = <span class="br0">&#123;</span>
    &lt;proto: someObject, sealed&gt;, <span class="co1">//meta properties</span>
    <span class="co1">// ES5-style property definitions</span>
    prop1: expr,
    get prop2 <span class="br0">&#40;</span><span class="br0">&#41;</span>  <span class="br0">&#123;</span><span class="kw1">return</span> computeSomeValue<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#125;</span>
<span class="br0">&#125;</span>;
&nbsp;
<span class="kw2">var</span> arrayLike = <span class="br0">&#91;</span>
    &lt;proto: EnhancedArray.<span class="me1">prototype</span>&gt;, <span class="co1">//meta properties</span>
    <span class="co1">// ES5-style array indexed property values</span>
    <span class="nu0">0</span>,
    <span class="nu0">1</span>
<span class="br0">&#93;</span>;</pre>
<p>
In the above examples, the “proto” meta property is used set the [[prototype]] internal property, and the “sealed” meta property indicates that the object is a sealed object (the value of the configurable attribute for all properties is false and the value of object’s [[extensible]] internal property is false. Other meta properties names include “frozen” and “closed”. Specifying the <code>closed</code> meta property sets the object’s [[extensible]] internal property to false.
</p>

<p>
When the “proto” meta property is used with an array initializer, the array that is created  is an object whose [[Class]] internal property is <del>&ldquo;Object&rdquo; rather than</del> &ldquo;Array&rdquo; and which uses Array&rsquo;s special versions of the [[DefineOwnProperty]] internal method. In this case, a non-configurable property named “length” is also created whose initial value is array index + 1 of the last array indexed property defined by the literal.
</p>

<p>
Assuming default built-in name bindings, the above examples are semantically equivalent to: 
</p>
<pre class="code javascript"><span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">typeof</span> someObject!==<span class="st0">"object"</span><span class="br0">&#41;</span>
    <span class="kw1">throw</span> <span class="kw2">new</span> TypeError; <span class="co1">//null is allowed</span>
<span class="kw2">var</span> obj = Object.<span class="me1">preventExtensions</span><span class="br0">&#40;</span>Object.<span class="me1">create</span><span class="br0">&#40;</span> someObject, <span class="br0">&#123;</span>
    prop1: <span class="br0">&#123;</span>value: expr, writable: <span class="kw2">true</span>, 
            enumerable: <span class="kw2">true</span>, configurable: <span class="kw2">false</span><span class="br0">&#125;</span>,
    prop2: <span class="br0">&#123;</span>get: <span class="kw2">function</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#123;</span><span class="kw1">return</span> computeSomeValue<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#125;</span>,set: undefined,
            enumerable: <span class="kw2">true</span>, configurable: <span class="kw2">false</span><span class="br0">&#125;</span>,
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>;
&nbsp;
<span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw1">typeof</span> Array.<span class="me1">prototype</span>!==<span class="st0">"object"</span><span class="br0">&#41;</span>
    <span class="kw1">throw</span> <span class="kw2">new</span> TypeError;
<span class="kw2">var</span> arrayLike = Array.<span class="me1">create</span><span class="br0">&#40;</span> Array.<span class="me1">prototype</span>, <span class="br0">&#123;</span>
    <span class="nu0">0</span>: <span class="br0">&#123;</span>value: <span class="nu0">0</span>, writable: <span class="kw2">true</span>, 
        enumerable: <span class="kw2">true</span>, configurable: <span class="kw2">true</span><span class="br0">&#125;</span>,
    <span class="nu0">1</span>: <span class="br0">&#123;</span>value: <span class="nu0">1</span>, writable: <span class="kw2">true</span>,
        enumerable: <span class="kw2">true</span>, configurable: <span class="kw2">true</span><span class="br0">&#125;</span>,
    length: <span class="br0">&#123;</span>value: <span class="nu0">2</span>, writable: <span class="kw2">true</span>,
             enumerable: <span class="kw2">false</span>, configurable: <span class="kw2">true</span><span class="br0">&#125;</span>,
<span class="br0">&#125;</span><span class="br0">&#41;</span>;</pre>
<p>
In the Array case above, <code>Array.create</code> is assumed to be a variant of <code>Object.create</code> that creates an object with in internal methods of Array instances.
</p>

<p>
<del>While ECMAScript permits using Object.create to create objects whose [[Prototype]] internal property is null, this is an unusual usage that is typically only needed in special circumstances.  In typical usage,  an expression evaluating to null in this context is more likely to be  indicative of a program error than an actual programmer intent. For this reason, a null [[Prototype]] value may not be specified using object literal syntax.</del> 
</p>

<p>
<strong>null</strong> may used as the value of <strong>proto:</strong> but <strong>undefined</strong> and other non-object values may not and their occurrence will throw an error.
</p>

<p>
<del>Overall this is a pure syntactic extension to ES5 object and array initialisers.  It provides no new semantic that are not already available to the ES5 programmer. However, </del> It allows a broader range of objects to defined using the straight object literal syntax.  This means that fewer programmer will need to learn the more complex Object reflection <acronym title="Application Programming Interface">API</acronym> and allows such object to be defined in contexts where access to the Object reflection functions have been restricted. In addition, the declarative nature of object initialisers  make it easier (hence more likely) for implementations to recognize and optimize objects defined in this manner.
</p>

</div>
<!-- SECTION [1-5107] -->
<a name="syntax"></a><h2>SYNTAX</h2>
<div class="level2">

<p>
 <em>ObjectLiteral</em> :<br/>
        <strong>{ }</strong><br/>
 <strong>{</strong> <em>MetaProperties</em> <strong>}</strong><br/>
 <strong>{</strong> <em>MetaProperties</em> <strong>, }</strong><br/>
 <strong>{</strong> <em>MetaProperties</em> <strong>,</strong>    <em>PropertyNameAndValueList</em> <strong>}</strong><br/>
 <strong>{</strong> <em>MetaProperties</em> <strong>,</strong>    <em>PropertyNameAndValueList</em> <strong>, }</strong><br/>
 <strong>{</strong> <em>PropertyNameAndValueList</em> <strong>}</strong><br/>
 <strong>{</strong> <em>PropertyNameAndValueList</em> <strong>, }</strong><br/>

</p>

<p>
<em>ArrayLiteral</em> :<br/>
 <strong>[</strong> <em>Ellision<sub>opt</sub></em> <strong>]</strong><br/>
 <strong>[</strong> <em>MetaProperties</em> <em>Ellision<sub>opt</sub></em> <strong>]</strong><br/>
 <strong>[</strong> <em>MetaProperties</em> <strong>,</strong> <em>ElementList</em>  <strong>]</strong><br/>
 <strong>[</strong> <em>MetaProperties</em> <strong>,</strong> <em>ElementList</em> <strong>,</strong>  <em>Ellision<sub>opt</sub></em> <strong>]</strong><br/>
 <strong>[</strong> <em>ElementList</em>  <strong>]</strong><br/>
 <strong>[</strong> <em>ElementList</em> <strong>,</strong>  <em>Ellision<sub>opt</sub></em> <strong>]</strong><br/>

</p>

<p>
<em>MetaProperties</em> :<br/>
 <strong>&lt;</strong> MetaPropertyList <strong>&gt;</strong><br/>
 <br/>
 <em>MetaPropertyList</em> :<br/>
 <em>MetaProperty</em><br/>
 <em>MetaPropertyList</em> <strong>,</strong> <em>MetaProperty</em><br/>
 <br/>
 <em>MetaProperty</em> :<br/>
 <strong>proto</strong> <strong>:</strong> <em>MemberExpression</em><br/>
 <strong>sealed</strong><br/>
 <strong>frozen</strong><br/>
 <strong>closed</strong>
</p>

</div>
<!-- SECTION [5108-6120] -->
<a name="discussion"></a><h2>Discussion</h2>
<div class="level2">

<p>
 This is pure bikeshedding but I would prefer if these looked more like properties.
</p>
<pre class="code javascript"><span class="kw2">var</span> obj = <span class="br0">&#123;</span>
  @proto: someObject,
  @sealed: <span class="kw2">true</span>,  <span class="co1">// or just @sealed?</span>
&nbsp;
  <span class="co1">// ES5-style property definitions</span>
  prop1: expr,
  get prop2 <span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> computeSomeValue<span class="br0">&#40;</span><span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>;</pre>
<p>
Other options include naming even closer to the internal properties:
</p>
<pre class="code javascript"><span class="kw2">var</span> obj = <span class="br0">&#123;</span>
  <span class="br0">&#91;</span><span class="br0">&#91;</span>Prototype<span class="br0">&#93;</span><span class="br0">&#93;</span>: someObject,
  <span class="br0">&#91;</span><span class="br0">&#91;</span>Extensible<span class="br0">&#93;</span><span class="br0">&#93;</span>: <span class="kw2">false</span>,
&nbsp;
  <span class="co1">// ES5-style property definitions</span>
  prop1: expr,
  get prop2 <span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">return</span> computeSomeValue<span class="br0">&#40;</span><span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>;</pre>
<p>
 &mdash; <em><a href="mailto:%26%23x61%3B%26%23x72%3B%26%23x76%3B%26%23x40%3B%26%23x67%3B%26%23x6f%3B%26%23x6f%3B%26%23x67%3B%26%23x6c%3B%26%23x65%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x61;&#x72;&#x76;&#x40;&#x67;&#x6f;&#x6f;&#x67;&#x6c;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">Erik Arvidsson</a> 2011/03/11 22:50</em>
</p>

<p>
I actually try to maintain significant separation between surface features of the language and the internal properties that happen to be used in any particular edition of the specification to define the semantics of those surface features. 
</p>

<p>
That aside, either of the above would be possible alternatives but you also would need to consider how they would be applied for array initializes.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x41%3B%26%23x6c%3B%26%23x6c%3B%26%23x65%3B%26%23x6e%3B%26%23x40%3B%26%23x57%3B%26%23x69%3B%26%23x72%3B%26%23x66%3B%26%23x73%3B%26%23x2d%3B%26%23x42%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x41;&#x6c;&#x6c;&#x65;&#x6e;&#x40;&#x57;&#x69;&#x72;&#x66;&#x73;&#x2d;&#x42;&#x72;&#x6f;&#x63;&#x6b;&#x2e;&#x63;&#x6f;&#x6d;">Allen Wirfs-Brock</a> 2011/03/12 16:35</em>
</p>

<p>
I don&rsquo;t think the double-bracket syntax works because of array literals, and it&rsquo;s also awfully heavyweight. But I share Arv&rsquo;s reservation about the angle-bracket syntax (though I can&rsquo;t quite articulate it... something about it rubs me wrong). The @ syntax is appealing. FWIW, since the head of an array literal is an array position, it&rsquo;s competing with E4X, sadly.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x64%3B%26%23x68%3B%26%23x65%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x63%3B%26%23x63%3B%26%23x73%3B%26%23x2e%3B%26%23x6e%3B%26%23x65%3B%26%23x75%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x64;&#x68;&#x65;&#x72;&#x6d;&#x61;&#x6e;&#x40;&#x63;&#x63;&#x73;&#x2e;&#x6e;&#x65;&#x75;&#x2e;&#x65;&#x64;&#x75;">Dave Herman</a> 2011/03/15 22:27</em> 
</p>

</div>
<!-- SECTION [6121-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/c/cc68f75b839fc36495ae756349b363bd.xhtml used -->
</body>
</html>
