<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>strawman:proxy_derived_traps [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:proxy_derived_traps&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:proxy_derived_traps&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:proxy_derived_traps&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2011-04-05T10:25:29+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=strawman:proxy_derived_traps&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">strawman:proxy_derived_traps</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:proxy_derived_traps" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:proxy_derived_traps" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:object_initialiser_shorthand.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:object_initialiser_shorthand">object_initialiser_shorthand</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:direct_proxies.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:direct_proxies">direct_proxies</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:proxy_instanceof.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:proxy_instanceof">proxy_instanceof</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:proxy_set_trap.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:proxy_set_trap">proxy_set_trap</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=strawman:proxy_derived_traps.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:proxy_derived_traps">proxy_derived_traps</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    
<a name="more_derived_traps"></a><h2>More derived traps</h2>
<div class="level2">

<p>
 David Bruant noted that the <code>getPropertyDescriptor</code> and <code>getPropertyNames</code> <a href="doku.php%3Fid=harmony:proxies.html#api" class="wikilink1" title="harmony:proxies" onclick="return svchk()" onkeypress="return svchk()">traps</a> can become derived. They are currently specced as fundamental traps.
</p>

<p>
Since fundamental traps are required and derived traps are optional, and since derived traps add no new complexity beyond the fundamental traps, there is an incentive to keep the number of fundamental traps as small as possible.
</p>

<p>
The <code>getPropertyDescriptor</code> and <code>getPropertyNames</code> traps can be defined in terms of <code>getOwnPropertyDescriptor</code> and <code>getOwnPropertyNames</code> respectively, and by walking the proxy&rsquo;s prototype chain:
</p>
<pre class="code javascript">getPropertyDescriptor: <span class="kw2">function</span><span class="br0">&#40;</span>proxy, <span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw2">var</span> pd = Object.<span class="me1">getOwnPropertyDescriptor</span><span class="br0">&#40;</span>proxy, <span class="kw3">name</span><span class="br0">&#41;</span>; <span class="co1">// calls getOwnPropertyDescriptor trap</span>
  <span class="kw2">var</span> proto = Object.<span class="me1">getPrototypeOf</span><span class="br0">&#40;</span>proxy<span class="br0">&#41;</span>;
  <span class="kw1">while</span> <span class="br0">&#40;</span>pd === undefined &amp;&amp; proto !== <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    pd = Object.<span class="me1">getOwnPropertyDescriptor</span><span class="br0">&#40;</span>proto, <span class="kw3">name</span><span class="br0">&#41;</span>;
    proto = Object.<span class="me1">getPrototypeOf</span><span class="br0">&#40;</span>proto<span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>
  <span class="kw1">return</span> pd;
<span class="br0">&#125;</span>
&nbsp;
getPropertyNames: <span class="kw2">function</span><span class="br0">&#40;</span>proxy, <span class="kw3">name</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw2">var</span> props = Object.<span class="me1">getOwnPropertyNames</span><span class="br0">&#40;</span>proxy<span class="br0">&#41;</span>; <span class="co1">// calls getOwnPropertyNames trap</span>
  <span class="kw2">var</span> proto = Object.<span class="me1">getPrototypeOf</span><span class="br0">&#40;</span>proxy<span class="br0">&#41;</span>;
  <span class="kw1">while</span> <span class="br0">&#40;</span>proto !== <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    props = props.<span class="me1">concat</span><span class="br0">&#40;</span>Object.<span class="me1">getOwnPropertyNames</span><span class="br0">&#40;</span>proto<span class="br0">&#41;</span><span class="br0">&#41;</span>;
    proto = Object.<span class="me1">getPrototypeOf</span><span class="br0">&#40;</span>proto<span class="br0">&#41;</span>;
  <span class="br0">&#125;</span>
  <span class="co1">// remove duplicate property names from props (not shown)</span>
  <span class="kw1">return</span> props;
<span class="br0">&#125;</span></pre>
<p>
Note that the above definitions assume that <code>getPropertyDescriptor</code> and <code>getPropertyNames</code> get passed the <code>proxy</code> for which they are intercepting, which is proposed in a separate <a href="doku.php%3Fid=strawman:handler_access_to_proxy.html" class="wikilink1" title="strawman:handler_access_to_proxy" onclick="return svchk()" onkeypress="return svchk()">strawman</a>.
</p>

<p>
Currently, handlers don&rsquo;t have a way of accessing the proxy they&rsquo;re currently intercepting, so they cannot get at a proxy&rsquo;s prototype. The Proxy implementation does have access to these parts and can perform the correct default behavior, it&rsquo;s just that this default behavior cannot be expressed fully in Javascript code, which is a big difference compared to all existing derived traps.
</p>

<p>
MarkM suggests refining our notion of derived traps by distinguishing (&rdquo;optional&rdquo; vs &ldquo;mandatory&rdquo;) versus (&rdquo;fundamental&rdquo; vs &ldquo;derived&rdquo;) traps. Optional vs. mandatory indicates whether or not the trap must be present for the proxy to work, while fundamental vs. derived indicates whether or not the default behavior for a missing trap can be defined in Javascript itself in terms of other traps. 
</p>
<table class="inline">
	<tr>
		<th class="rightalign">             </th><th class="leftalign"> Optional       </th><th class="leftalign"> Mandatory   </th>
	</tr>
	<tr>
		<td><strong>Fundamental</strong></td><td><code>getPropertyDescriptor</code> and <code>getPropertyNames</code></td><td> all existing &ldquo;fundamental&rdquo; traps </td>
	</tr>
	<tr>
		<td class="leftalign"><strong>Derived</strong>     </td><td class="leftalign"> all other existing &ldquo;derived&rdquo; traps   </td><td> none </td>
	</tr>
</table>
<br />

<p>
 For developers, really the only distinction that matters is optional vs. mandatory. The fundamental vs. derived distinction is there primarily to help us, spec. writers, distinguish the traps. Again, if <code>proxy</code> would become a parameter to the above two derived traps, this discussion is moot and the table again collapses into our current simple distinction of fundamental vs derived traps, without the need to special-case <code>getPropertyDescriptor</code> and <code>getPropertyNames</code>.
</p>

<p>
&mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2011/02/28 06:09</em>
</p>

</div>

<a name="references"></a><h2>References</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-January/012603.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2011-January/012603.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Discussion thread</a> on es-discuss.</div>
</li>
</ul>

</div>

<a name="feedback"></a><h2>Feedback</h2>
<div class="level2">

<p>
 Discussed at the March 2011 TC39 meeting. General consensus that less fundamental traps is better. &mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2011/03/30 13:00</em>
</p>

<p>
As <a href="https://mail.mozilla.org/pipermail/es-discuss/2011-March/013522.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es-discuss/2011-March/013522.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">noted by David Bruant</a>, a recursive default implementation would follow the ES5 spec semantics more closely:
</p>
<pre class="code javascript">getPropertyDescriptor: <span class="kw2">function</span><span class="br0">&#40;</span><span class="kw3">name</span>, proxy<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw2">var</span> pd = Object.<span class="me1">getOwnPropertyDescriptor</span><span class="br0">&#40;</span>proxy, <span class="kw3">name</span><span class="br0">&#41;</span>;
  <span class="kw2">var</span> proto = Object.<span class="me1">getPrototypeOf</span><span class="br0">&#40;</span>proxy<span class="br0">&#41;</span>;
  <span class="kw1">if</span> <span class="br0">&#40;</span>proto === <span class="kw2">null</span> || pd !== undefined<span class="br0">&#41;</span>
    <span class="kw1">return</span> pd;
  <span class="kw1">return</span> Object.<span class="me1">getPropertyDescriptor</span><span class="br0">&#40;</span>proto, <span class="kw3">name</span><span class="br0">&#41;</span>;
<span class="br0">&#125;</span></pre>
<p>
The difference is significant in that in the iterative version, lookup is forced to proceed up to the root (for missing properties), while in the recursive version, a proxy on the prototype-chain can stop the prototype-walk early.
</p>

<p>
&mdash; <em><a href="mailto:%26%23x74%3B%26%23x6f%3B%26%23x6d%3B%26%23x76%3B%26%23x63%3B%26%23x2e%3B%26%23x62%3B%26%23x65%3B%26%23x40%3B%26%23x67%3B%26%23x6d%3B%26%23x61%3B%26%23x69%3B%26%23x6c%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x74;&#x6f;&#x6d;&#x76;&#x63;&#x2e;&#x62;&#x65;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Tom Van Cutsem</a> 2011/04/05 03:20</em> 
</p>

</div>

<!-- no cachefile used, but created -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        strawman/proxy_derived_traps.txt &middot; Last modified: 2011/04/05 10:25 by tomvc      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="strawman:proxy_derived_traps" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="strawman:proxy_derived_traps" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="strawman:proxy_derived_traps" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="strawman:proxy_derived_traps" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=strawman:proxy_derived_traps.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=strawman%253Aproxy_derived_traps&amp;1454275708" width="1" height="1" alt=""  /></body>
</html>
