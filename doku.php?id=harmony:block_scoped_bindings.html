<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <title>harmony:block_scoped_bindings [ES Wiki]</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=harmony:block_scoped_bindings&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="http://wiki.ecmascript.org/feed.php?mode=list&amp;ns=harmony" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=harmony:block_scoped_bindings&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=harmony:block_scoped_bindings&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="date" content="2010-08-20T16:52:40+0000" />
  <meta name="robots" content="index,follow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />

  <link rel="shortcut icon" href="lib/images/favicon.ico" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/layout.css" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/tpl/default/design.css" />

  
  <link rel="stylesheet" media="print" type="text/css" href="lib/tpl/default/print.css" />

  <!--[if gte IE 5]>
  <style type="text/css">
    /* that IE 5+ conditional comment makes this only visible in IE 5+ */
    /* IE bugfix for transparent PNGs */
    //DISABLED   img { behavior: url("/lib/scripts/pngbehavior.htc"); }
  </style>
  <![endif]-->

  </head>

<body>
<div class="dokuwiki">
  
  <div class="stylehead">

    <div class="header">
      <div class="pagename">
        [[<a href="doku.php%3Fid=harmony:block_scoped_bindings&amp;do=backlink.html" onclick="return svchk()" onkeypress="return svchk()">harmony:block_scoped_bindings</a>]]
      </div>
      <div class="logo">
        <a href="doku.php%3Fid=.html" onclick="return svchk()" onkeypress="return svchk()" name="top" accesskey="h" title="[ALT+H]">ES Wiki</a>      </div>
    </div>
  
    
    <div class="bar" id="bar_top">
      <div class="bar-left" id="bar_topleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="harmony:block_scoped_bindings" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="harmony:block_scoped_bindings" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
  
      <div class="bar-right" id="bar_topright">
        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="recent" /><input type="hidden" name="id" value="" /><input type="submit" value="Recent changes" class="button" title="ALT+R" accesskey="r" /></form>        <form action="doku.php%3Fid=.html" accept-charset="utf-8" class="search" name="search" onsubmit="return svchk()"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch_in" accesskey="f" name="id" class="edit" onkeyup="ajax_qsearch.call('qsearch_in','qsearch_out')" /><input type="submit" value="Search" class="button" /><div id="qsearch_out" class="ajax_qsearch" onclick="this.style.display='none'"></div></form>&nbsp;
      </div>
    </div>

        <div class="breadcrumbs">
      Trace: <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=strawman:weakreferences.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="strawman:weakreferences">weakreferences</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:arrow_function_syntax.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:arrow_function_syntax">arrow_function_syntax</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:function_to_string.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:function_to_string">function_to_string</a> <span class="bcsep">&raquo;</span> <a href="doku.php%3Fid=harmony:function_name_property.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:function_name_property">function_name_property</a> <span class="bcsep">&raquo;</span> <span class="curid"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html" onclick="return svchk()" onkeypress="return svchk()" class="breadcrumbs" title="harmony:block_scoped_bindings">block_scoped_bindings</a></span>          </div>
    
  </div>
  
  
  <div class="page">
    <!-- wikipage start -->
    <div class="toc">
<div class="tocheader"> <script type="text/javascript">showTocToggle("+","-")</script>Table of Contents</div>
<div id="tocinside">
<ul class="toc">
<li class="clear"><ul class="toc">
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#common_syntax" class="toc">Common Syntax</a></span></li>
<li class="level2"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#common_semantics" class="toc">Common Semantics</a></span><ul class="toc">
<li class="level3"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#12.1-delta_block" class="toc">12.1-delta Block</a></span></li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1-delta_environment_record" class="toc">10.2.1-delta Environment Record</a></span><ul class="toc">
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#table_17-delta_--_abstract_methods_of_environment_records" class="toc">Table 17-delta -- Abstract Methods of Environment Records</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#table_18_becomes_unnecessary" class="toc">Table 18 becomes unnecessary</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.1.2_declarative_createmutablebinding_n_d" class="toc">10.2.1.1.2 (Declarative) CreateMutableBinding(N,D)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.1.3_declarative_setmutablebinding_n_v_s" class="toc">10.2.1.1.3 (Declarative) SetMutableBinding(N,V,S)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.1.7_declarative_createimmutablebinding_n" class="toc">10.2.1.1.7 (Declarative) CreateImmutableBinding(N)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.1.8_declarative_initializebinding_n_v" class="toc">10.2.1.1.8 (Declarative) InitializeBinding(N,V)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.2.2_object_createmutablebinding_n_d" class="toc">10.2.1.2.2 (Object) CreateMutableBinding(N,D)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.2.3_object_setmutablebinding_n_v_s" class="toc">10.2.1.2.3 (Object) SetMutableBinding(N,V,S)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.2.4_object_getbindingvalue_n_s" class="toc">10.2.1.2.4 (Object) GetBindingValue(N,S)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.2.1.2.5_object_deletebinding_n" class="toc">10.2.1.2.5 (Object) DeleteBinding(N)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#new_10.2.1.2.7_object_createimmutablebinding_n" class="toc">New 10.2.1.2.7 (Object) CreateImmutableBinding(N)</a></span></li>
<li class="level4"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#new_10.2.1.2.8_object_initializebinding_n_v" class="toc">New 10.2.1.2.8 (Object) InitializeBinding(N,V)</a></span></li>
</ul>
</li>
<li class="level3"><span class="li"><a href="doku.php%3Fid=harmony:block_scoped_bindings.html#10.5-delta_declaration_binding_instantiation" class="toc">10.5-delta Declaration Binding Instantiation</a></span></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<p>
The new blocked scoped binding are <a href="doku.php%3Fid=harmony:let.html" class="wikilink1" title="harmony:let" onclick="return svchk()" onkeypress="return svchk()">let</a>, <a href="doku.php%3Fid=harmony:const.html" class="wikilink1" title="harmony:const" onclick="return svchk()" onkeypress="return svchk()">const</a>, and <a href="doku.php%3Fid=harmony:block_functions.html" class="wikilink1" title="harmony:block_functions" onclick="return svchk()" onkeypress="return svchk()">block functions</a>. 
</p>

<a name="common_syntax"></a><h2>Common Syntax</h2>
<div class="level2">

<p>
 <a href="doku.php%3Fid=harmony:let.html" class="wikilink1" title="harmony:let" onclick="return svchk()" onkeypress="return svchk()">let</a>, <a href="doku.php%3Fid=harmony:const.html" class="wikilink1" title="harmony:const" onclick="return svchk()" onkeypress="return svchk()">const</a>, and <a href="doku.php%3Fid=harmony:block_functions.html" class="wikilink1" title="harmony:block_functions" onclick="return svchk()" onkeypress="return svchk()">block functions</a> declarations should all be allowed in a <code>Program</code>, a <code>FunctionBody</code>, or a <code>Block</code>. However, none should be considered statements by themselves, and so cannot appear in unprotected statement context. For example:
</p>
<pre class="code javascript">  <span class="kw1">if</span> <span class="br0">&#40;</span>b<span class="br0">&#41;</span> <span class="kw2">var</span> x = <span class="nu0">9</span>; <span class="co1">// legal</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>b<span class="br0">&#41;</span> let x = <span class="nu0">9</span>; <span class="co1">// illegal -- must be rejected</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>b<span class="br0">&#41;</span> <span class="br0">&#123;</span> let x = <span class="nu0">9</span>; <span class="br0">&#125;</span> <span class="co1">// legal</span></pre>
<p>
To accommodate this, we adjust the following productions from the ES5 grammar:
</p>
<pre class="code">
  Block:
         { StatementList? }
  SourceElement:
         Statement
         FunctionDeclaration
</pre>

<p>
to instead be
</p>
<pre class="code">
  Block:
         { SourceElements? }
  SourceElement:
         Statement
         Declaration
  Declaration:
         LetDeclaration
         ConstDeclaration
         FunctionDeclaration
</pre>

<p>
Note that a <code>VariableStatement</code> remains a kind of statement, and so can appear in unprotected statement context, as in our first <code>if</code> example above. Since the scope of a <code>VariableStatement</code> is hoisted into the containing <code>Program</code> or <code>FunctionBody</code>, the appearance of a <code>VariableStatement</code> in statement context does not cause confusion about its semantics.
</p>

<p>
Confusingly, what the ES5 grammar refers to as a <code>VariableDeclaration</code> is neither a statement nor a declaration, but rather the name-initializer bindings that occur to the right of the <code>var</code> keyword. The grammar should use <code>VariableDeclarator</code> or something better to distinguish this non-terminal from <code>FunctionDeclaration</code>, etc.
</p>

</div>

<a name="common_semantics"></a><h2>Common Semantics</h2>
<div class="level2">

<p>
 ES5/strict and ES-Harmony are lexically scoped. However, because ES5/strict does not allow a <code>Declaration</code> in a <code>Block</code>, it need only create an Environment Record on each entry to a Program, Function, or catch-clause. (Full ES5 also creates an Environment Record on each entry to a with-statement, but that need not concern us here.) For ES-Harmony, we need to create a Declarative Environment Record on each entry to a <code>Block</code> as well. The new semantics of block entry resembles the ES5 semantics for catch-clause entry (12.14).
</p>

</div>

<a name="12.1-delta_block"></a><h3>12.1-delta Block</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Let <em>oldEnv</em> be the running execution context&rsquo;s LexicalEnvironment.</div>
</li>
<li class="level1"><div class="li"> Let <em>blockEnv</em> be the result of calling NewDeclarativeEnvironmentRecord passing <em>oldEnv</em> as the argument.</div>
</li>
<li class="level1"><div class="li"> Set the running execution context&rsquo;s LexicalEnvironment to <em>blockEnv</em>.</div>
</li>
<li class="level1"><div class="li"> Perform Declaration Binding Instantiation using the block code as described by our modified 10.5 below.</div>
</li>
<li class="level1"><div class="li"> Let <em>B</em> be the result of evaluating <em>SourceElements_opt</em>.</div>
</li>
<li class="level1"><div class="li"> Set the running execution context&rsquo;s LexicalEnvironment to <em>oldEnv</em>.</div>
</li>
<li class="level1"><div class="li"> Return <em>B</em></div>
</li>
</ol>

<p>
  NOTE: No matter how control leaves the <em>Block</em> the LexicalEnvironment is always restored to its former state.
</p>

</div>

<a name="10.2.1-delta_environment_record"></a><h3>10.2.1-delta Environment Record</h3>
<div class="level3">

<p>
 Since <code>ConstDeclaration</code>s may appear at in global code, we need to promote <code>CreateImmutableBinding(N)</code> and <code>InitializeImmutableBinding(N,V)</code> to the internal supertype, Environment Record, and provide an implementation of these methods for Object Environment Records as well. Since <code>let</code>, like <code>const</code>, has a temporal dead zone, we need the same separation between creating a binding vs. initializing for mutable bindings that we have for immutable bindings. 
</p>
<ul>
<li class="level1"><div class="li"> We redefine the meaning of <code>CreateMutableBinding(N,D)</code> to create an uninitialized mutable binding. </div>
</li>
<li class="level1"><div class="li"> We generalize the <code>InitializeImmutableBinding(N,V)</code> method to simply <code>InitializeBinding(N,V)</code>. </div>
</li>
<li class="level1"><div class="li"> Within <code>SetMutableBinding(N,V,S)</code> we assert that the mutable binding must already have been initialized. </div>
</li>
<li class="level1"><div class="li"> We refactor all <em>existing</em> callers of <code>CreateMutableBinding</code> to ensure that the binding is initialized before it can be observed; to maintain compatibility.</div>
</li>
<li class="level1"><div class="li"> We change Object Environment Record so that uninitialized bindings are in scope without touching the bindings object, and only become backed by the bindings object upon initialization.</div>
</li>
</ul>

</div>

<a name="table_17-delta_--_abstract_methods_of_environment_records"></a><h4>Table 17-delta -- Abstract Methods of Environment Records</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <code>CreateMutableBinding(N,D)</code>: Create a new but uninitialized mutable binding ...</div>
</li>
<li class="level1"><div class="li"> <code>InitializeBinding(N,V)</code>: Initialize the value of an already existing but uninitialized binding ...</div>
</li>
<li class="level1"><div class="li"> <code>SetMutableBinding(N,V,S)</code>: Set the value of an already initialized binding ...</div>
</li>
</ul>

</div>

<a name="table_18_becomes_unnecessary"></a><h4>Table 18 becomes unnecessary</h4>
<div class="level4">

</div>

<a name="10.2.1.1.2_declarative_createmutablebinding_n_d"></a><h4>10.2.1.1.2 (Declarative) CreateMutableBinding(N,D)</h4>
<div class="level4">

<p>
 The concrete Environment Record method CreateMutableBinding for declarative environment records creates a new uninitialized mutable binding for the name N. ...
</p>

<p>
3. Create an uninitialized mutable binding in <em>envRec</em> for <em>N</em>.
</p>

</div>

<a name="10.2.1.1.3_declarative_setmutablebinding_n_v_s"></a><h4>10.2.1.1.3 (Declarative) SetMutableBinding(N,V,S)</h4>
<div class="level4">

<p>
 ... If the binding is an immutable binding and S is true, then a TypeError is thrown. ...
</p>

<p>
4. Else this must be an attempt to change the value of an immutable binding, so if S is true, throw a TypeError exception.
</p>

</div>

<a name="10.2.1.1.7_declarative_createimmutablebinding_n"></a><h4>10.2.1.1.7 (Declarative) CreateImmutableBinding(N)</h4>
<div class="level4">

<p>
 The concrete Environment Record method CreateImmutableBinding for declarative environment records creates a new uninitialized immutable binding for the name <em>N</em>. A binding must not already exist in this environment record for N. 
</p>

</div>

<a name="10.2.1.1.8_declarative_initializebinding_n_v"></a><h4>10.2.1.1.8 (Declarative) InitializeBinding(N,V)</h4>
<div class="level4">

<p>
 ... An uninitialized binding for <em>N</em> must already exist. ...
</p>

<p>
2. Assert: <em>envRec</em> must have an uninitialized binding for <em>N</em>.
</p>

<p>
...
</p>

<p>
4. Record that the binding for <em>N</em> in <em>envRec</em> has been initialized.
</p>

</div>

<a name="10.2.1.2.2_object_createmutablebinding_n_d"></a><h4>10.2.1.2.2 (Object) CreateMutableBinding(N,D)</h4>
<div class="level4">

<p>
 The concrete Environment Record method CreateMutableBinding for object environment records creates a new uninitialized mutable binding for the name <em>N</em>. If Boolean argument <em>D</em> is provided and has the value true the new binding is marked as being subject to configuration. 
</p>
<ol>
<li class="level1"><div class="li"> Let <em>envRec</em> be the object environment record for which the method was invoked. </div>
</li>
<li class="level1"><div class="li"> Assert: <em>envRec</em> does not already have a binding for <em>N</em>. </div>
</li>
<li class="level1"><div class="li"> Create an uninitialized mutable binding in <em>envRec</em> for <em>N</em>.</div>
</li>
<li class="level1"><div class="li"> Record that the newly created binding is to be writable.</div>
</li>
<li class="level1"><div class="li"> If <em>D</em> is true record that the newly created binding is to be configurable; else non-configurable.</div>
</li>
</ol>

</div>

<a name="10.2.1.2.3_object_setmutablebinding_n_v_s"></a><h4>10.2.1.2.3 (Object) SetMutableBinding(N,V,S)</h4>
<div class="level4">

<p>
 Between 1 and 2. If <em>envRec</em> has an uninitialized binding for <em>N</em> and <em>S</em> is true, throw a ReferenceError exception.
</p>

</div>

<a name="10.2.1.2.4_object_getbindingvalue_n_s"></a><h4>10.2.1.2.4 (Object) GetBindingValue(N,S)</h4>
<div class="level4">

<p>
 Between 1 and 2. If <em>envRec</em> has an uninitialized binding for <em>N</em> and <em>S</em> is true, throw a ReferenceError exception.
</p>

</div>

<a name="10.2.1.2.5_object_deletebinding_n"></a><h4>10.2.1.2.5 (Object) DeleteBinding(N)</h4>
<div class="level4">

<p>
 Between 1 and 2. If <em>envRec</em> has an uninitialized binding for <em>N</em> and <em>S</em> is true, throw a ReferenceError exception.
</p>

</div>

<a name="new_10.2.1.2.7_object_createimmutablebinding_n"></a><h4>New 10.2.1.2.7 (Object) CreateImmutableBinding(N)</h4>
<div class="level4">

<p>
 The concrete Environment Record method CreateImmutableBinding for object environment records creates a new uninitialized immutable binding for the name <em>N</em>. 
</p>
<ol>
<li class="level1"><div class="li"> Let <em>envRec</em> be the object environment record for which the method was invoked. </div>
</li>
<li class="level1"><div class="li"> Assert: <em>envRec</em> does not already have a binding for <em>N</em>. </div>
</li>
<li class="level1"><div class="li"> Create an uninitialized immutable binding in <em>envRec</em> for <em>N</em>. </div>
</li>
<li class="level1"><div class="li"> Record that the newly created binding is to be non-writable and non-configurable.</div>
</li>
</ol>

</div>

<a name="new_10.2.1.2.8_object_initializebinding_n_v"></a><h4>New 10.2.1.2.8 (Object) InitializeBinding(N,V)</h4>
<div class="level4">

<p>
 The concrete Environment Record method InitializeBinding for object environment records creates in an environment record’s associated binding object a property whose name is <em>N</em> and initializes it to <em>V</em>. A property named <em>N</em> must not already exist in the binding object. On success, it drops its own separate record that <em>N</em> is uninitialized. 
</p>
<ol>
<li class="level1"><div class="li"> Let <em>envRec</em> be the object environment record for which the method was invoked.</div>
</li>
<li class="level1"><div class="li"> Assert: <em>envRec</em> currently records <em>N</em> as uninitialized.</div>
</li>
<li class="level1"><div class="li"> Let <em>bindings</em> be the binding object for <em>envRec</em>. </div>
</li>
<li class="level1"><div class="li"> Assert: The result of calling the [[HasProperty]] internal method of bindings, passing <em>N</em> as the property name, is false. </div>
</li>
<li class="level1"><div class="li"> Call the [[DefineOwnProperty]] internal method of <em>bindings</em>, passing </div>
<ul>
<li class="level2"><div class="li"> <em>N</em>, </div>
</li>
<li class="level2"><div class="li"> Property Descriptor { [[Value]]: <em>V</em>, [[Writable]]: the recorded writability of <em>N</em>, [[Enumerable]]: true, [[Configurable]]: the recorded configurability of <em>N</em> }, </div>
</li>
<li class="level2"><div class="li"> and true </div>
</li>
</ul>
</li>
</ol>

<p>
    as arguments. 
</p>

<p>
Open question: <a href="https://mail.mozilla.org/pipermail/es5-discuss/2010-June/003559.html" class="urlextern" target="_blank" title="https://mail.mozilla.org/pipermail/es5-discuss/2010-June/003559.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Parity error</a> applies to the last <code>true</code> argument above. If we adopt my proposed #2, then it should instead be <code>S</code>. 
</p>
<hr noshade="noshade" size="1" />

<p>
More questions: 
</p>
<ul>
<li class="level1"><div class="li"> The global object may have arbitrary properties, so how can step 4 above assert that [[HasProperty]] returns false?</div>
</li>
<li class="level1"><div class="li"> How do <code>let</code> not in a block statement and <code>var</code> interact in global code? Are both allowed to declare the same name? If so, does the <code>let</code> binding shadow the <code>var</code> one?</div>
</li>
<li class="level1"><div class="li"> How do <code>let</code> not in a block statement and <code>var</code> interact in function code? Currently (ES5 and older), <code>var a;</code> in <code>function f(a) {...}</code> restates the argument binding.</div>
</li>
</ul>

<p>
 We should forbid <code>let</code> and <code>var</code> binding the same name in the same scope. Sorry if I missed that in this strawman.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2010/06/09 14:54</em> 
</p>
<hr noshade="noshade" size="1" />

<p>
We should also forbid <code>var</code>-declarations that have already been &ldquo;shadowed&rdquo; by <code>let</code>-declarations, such as:
</p>
<pre class="code javascript"><span class="kw2">var</span> x = <span class="st0">"outer"</span>;
<span class="kw2">function</span> f<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="br0">&#123;</span>
        let x = <span class="st0">"inner"</span>;
        <span class="br0">&#123;</span>
            <span class="co1">// after hoisting, the initializer mutates the let-binding!</span>
            <span class="kw2">var</span> x = <span class="st0">"sneaky"</span>; <span class="co1">// this should be illegal</span>
        <span class="br0">&#125;</span>
        <span class="kw3">print</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span>; <span class="co1">// prints sneaky!</span>
    <span class="br0">&#125;</span>
    <span class="kw1">return</span> x; <span class="co1">// prints undefined!</span>
<span class="br0">&#125;</span></pre>
<p>
This might be implied by Brendan&rsquo;s last statement, but I&rsquo;m just clarifying that it&rsquo;s more than just forbidding <code>let x; var x;</code>.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x64%3B%26%23x68%3B%26%23x65%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x63%3B%26%23x63%3B%26%23x73%3B%26%23x2e%3B%26%23x6e%3B%26%23x65%3B%26%23x75%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x64;&#x68;&#x65;&#x72;&#x6d;&#x61;&#x6e;&#x40;&#x63;&#x63;&#x73;&#x2e;&#x6e;&#x65;&#x75;&#x2e;&#x65;&#x64;&#x75;">Dave Herman</a> 2010/08/20 16:33</em>   
</p>

</div>

<a name="10.5-delta_declaration_binding_instantiation"></a><h3>10.5-delta Declaration Binding Instantiation</h3>
<div class="level3">

<p>
 After step 1. Let <em>lexEnv</em> be the environment record component of the running execution context&rsquo;s LexicalEnvironment.
</p>

<p>
Step 5-delta. Change all uses of <em>env</em> to <em>lexEnv</em>. Generalize this to apply to each <em><code>Declaration</code></em> in code, rather than just each <em><code>FunctionDeclaration</code></em>. Rephrase to avoid <code>Declaration</code>s in nested blocks and catch-clauses. Refactor so that the particulars for each kind of <code>Declaration</code> are defined by that <code>Declaration</code>. 
</p>

<p>
Step 8-delta. Rephrase to make clear that this step is skipped on entry to blocks and catch-clauses, and that the enumeration of <code>VariableDeclaration</code>s in the remaining cases must traverse into nested blocks and catch-clauses. 
</p>

</div>

<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/e/e8f7f49b93cd1b18f0f9c828a02360ff.xhtml used -->
    <!-- wikipage stop -->
  </div>

  <div class="clearer">&nbsp;</div>

  
  <div class="stylefoot">

    <div class="meta">
      <div class="user">
              </div>
      <div class="doc">
        harmony/block_scoped_bindings.txt &middot; Last modified: 2010/08/20 16:52 by dherman      </div>
    </div>

   
    <div class="bar" id="bar_bottom">
      <div class="bar-left" id="bar_bottomleft">
        <form class="button" method="post" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="edit" /><input type="hidden" name="rev" value="" /><input type="hidden" name="id" value="harmony:block_scoped_bindings" /><input type="submit" value="Show pagesource" class="button" title="ALT+V" accesskey="v" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="revisions" /><input type="hidden" name="id" value="harmony:block_scoped_bindings" /><input type="submit" value="Old revisions" class="button" title="ALT+O" accesskey="o" /></form>      </div>
      <div class="bar-right" id="bar_bottomright">
                        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="login" /><input type="hidden" name="id" value="harmony:block_scoped_bindings" /><input type="submit" value="Login" class="button" /></form>        <form class="button" method="get" action="index.html" onsubmit="return svchk()"><input type="hidden" name="do" value="index" /><input type="hidden" name="id" value="harmony:block_scoped_bindings" /><input type="submit" value="Index" class="button" title="ALT+X" accesskey="x" /></form>        <a href="doku.php%3Fid=harmony:block_scoped_bindings.html#top"><input type="button" class="button" value="Back to top" onclick="window.scrollTo(0, 0)" /></a>&nbsp;
      </div>
    </div>

  </div>

</div>

<div align="center" class="footerinc">
  <a target="_blank" href="feed.php" title="Recent changes RSS feed"><img src="lib/tpl/default/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/2.0/" rel="license" title="Creative Commons License"><img src="lib/tpl/default/images/button-cc.gif" width="80" height="15" alt="Creative Commons License" border="0" /></a>

  <a target="_blank" href="https://www.paypal.com/xclick/business=andi%40splitbrain.org&amp;item_name=DokuWiki+Donation&amp;no_shipping=1&amp;no_note=1&amp;tax=0&amp;currency_code=EUR&amp;lc=US" title="Donate"><img src="lib/tpl/default/images/button-donate.gif" alt="Donate" border="0" /></a>

  <a target="_blank" href="http://www.php.net" title="Powered by PHP"><img src="lib/tpl/default/images/button-php.gif" width="80" height="15" alt="Powered by PHP" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="lib/tpl/default/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="lib/tpl/default/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="lib/tpl/default/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>



<!--

<rdf:RDF xmlns="http://web.resource.org/cc/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="">
   <dc:type rdf:resource="http://purl.org/dc/dcmitype/Text" />
   <license rdf:resource="http://creativecommons.org/licenses/by-nc-sa/2.0/" />
</Work>

<License rdf:about="http://creativecommons.org/licenses/by-nc-sa/2.0/">
   <permits rdf:resource="http://web.resource.org/cc/Reproduction" />
   <permits rdf:resource="http://web.resource.org/cc/Distribution" />
   <requires rdf:resource="http://web.resource.org/cc/Notice" />
   <requires rdf:resource="http://web.resource.org/cc/Attribution" />
   <prohibits rdf:resource="http://web.resource.org/cc/CommercialUse" />
   <permits rdf:resource="http://web.resource.org/cc/DerivativeWorks" />
   <requires rdf:resource="http://web.resource.org/cc/ShareAlike" />
</License>

</rdf:RDF>

-->
</div>

<img src="lib/exe/indexer.php%3Fid=harmony%253Ablock_scoped_bindings&amp;1454275455" width="1" height="1" alt=""  /></body>
</html>
