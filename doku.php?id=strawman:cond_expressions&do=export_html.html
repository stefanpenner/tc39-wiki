<html>
<head>
  <meta name="generator" content="DokuWiki Release 2005-09-22e" />
  <link rel="start" href="index.html" />
  <link rel="contents" href="doku.php%3Fid=strawman:cond_expressions&amp;do=index.html" title="" />
  <link rel="alternate" type="application/rss+xml" title="Recent Changes" href="feed.php" />
  <link rel="alternate" type="application/rss+xml" title="Current Namespace" href="feed.php%3Fmode=list&amp;ns=strawman" />
  <link rel="alternate" type="text/html" title="Plain HTML" href="doku.php%3Fid=strawman:cond_expressions&amp;do=export_html.html" />
  <link rel="alternate" type="text/plain" title="Wiki Markup" href="doku.php%3Fid=strawman:cond_expressions&amp;do=export_raw" />
  <link rel="stylesheet" media="screen" type="text/css" href="lib/styles/style.css" />
  <meta name="robots" content="noindex,nofollow" />
  <script language="javascript" type="text/javascript" charset="utf-8">
    var alertText   = 'Please enter the text you want to format.\nIt will be appended to the end of the document.'
    var notSavedYet = 'Unsaved changes will be lost.\nReally continue?'
    var DOKU_BASE   = '/'
  </script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/script.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/tw-sack.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/ajax.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domLib.js"></script>
  <script language="javascript" type="text/javascript" charset="utf-8" src="lib/scripts/domTT.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/plugins/plugin/style.css" />
</head>
<body>

<a name="conditional_expressions"></a><h1>Conditional expressions</h1>
<div class="level1">

<p>
 Similar to Scheme and Lisp&rsquo;s <code>cond</code>. You can see people simulate this with nested ternary conditional expressions.
</p>

</div>
<!-- SECTION [1-157] -->
<a name="syntax"></a><h1>Syntax</h1>
<div class="level1">
<pre class="code">
CondExpression ::= &quot;cond&quot; &quot;{&quot; CaseBlockClause+ DefaultBlockClause? &quot;}&quot;

CaseBlockClause ::= &quot;case&quot; Expression Block

DefaultBlockClause ::= &quot;default&quot; Block
</pre>

</div>
<!-- SECTION [158-351] -->
<a name="examples"></a><h1>Examples</h1>
<div class="level1">
<pre class="code javascript"><span class="kw2">var</span> x = cond <span class="br0">&#123;</span>
            <span class="kw1">case</span> y &gt; <span class="nu0">100</span> <span class="br0">&#123;</span> <span class="st0">"huge"</span> <span class="br0">&#125;</span>
            <span class="kw1">case</span> y &gt; <span class="nu0">50</span>  <span class="br0">&#123;</span> <span class="st0">"big"</span> <span class="br0">&#125;</span>
            <span class="kw2">default</span>      <span class="br0">&#123;</span> <span class="st0">"small"</span> <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>;</pre>
</div>
<!-- SECTION [352-536] -->
<a name="semantics"></a><h1>Semantics</h1>
<div class="level1">

<p>
 The expression is equivalent to a nested conditional, where each block is transformed to an expression that produces the completion of the block. (Such as a let-expression that completes similarly to pound-expressions.)
</p>
<hr noshade="noshade" size="1" />

<p>
 It is not simulated with nested ternary operators, it is realized with serial ternary operators. This new form is less compact, and is potentially confusing, since it sort of looks like the switch statement, but behaves very differently. Why do we also need this new form? 
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x63%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x40%3B%26%23x79%3B%26%23x61%3B%26%23x68%3B%26%23x6f%3B%26%23x6f%3B%26%23x2d%3B%26%23x69%3B%26%23x6e%3B%26%23x63%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x63;&#x72;&#x6f;&#x63;&#x6b;&#x40;&#x79;&#x61;&#x68;&#x6f;&#x6f;&#x2d;&#x69;&#x6e;&#x63;&#x2e;&#x63;&#x6f;&#x6d;">Douglas Crockford</a> 2011/02/28 17:52</em>
</p>

<p>
They are in fact nested. Just look at the resulting AST.
</p>

<p>
To answer your question, the benefit is to improve readability for compound conditionals. Take a simple example like:
</p>
<pre class="code javascript"><span class="kw2">var</span> x = <span class="kw1">switch</span> <span class="br0">&#123;</span>
            <span class="kw1">case</span> y &gt; <span class="nu0">100</span> <span class="br0">&#123;</span> <span class="st0">"huge"</span> <span class="br0">&#125;</span>
            <span class="kw1">case</span> y &gt; <span class="nu0">50</span>  <span class="br0">&#123;</span> <span class="st0">"big"</span> <span class="br0">&#125;</span>
            <span class="kw2">default</span>      <span class="br0">&#123;</span> <span class="st0">"small"</span> <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>;</pre>
<p>
Doing this with nested ternaries, you can format the code in several different ways:
</p>
<pre class="code javascript"><span class="kw2">var</span> x = y &gt; <span class="nu0">100</span>
      ? <span class="st0">"huge"</span>
      : y &gt; <span class="nu0">50</span>
      ? <span class="st0">"big"</span>
      : <span class="st0">"small"</span>;
<span class="co1">// or</span>
<span class="kw2">var</span> x = y &gt; <span class="nu0">100</span> ? <span class="st0">"huge"</span>
      : y &gt; <span class="nu0">50</span>  ? <span class="st0">"big"</span>
                : <span class="st0">"small"</span>;
<span class="co1">// or</span>
<span class="kw2">var</span> x = y &gt; <span class="nu0">100</span> ? <span class="st0">"huge"</span>
      : y &gt; <span class="nu0">50</span>  ? <span class="st0">"big"</span>
      : <span class="st0">"small"</span>;</pre>
<p>
These are all a little awkward and none of them really does a good job of representing the general structure of a sequence of pairs of question and answer.
</p>

<p>
As for calling it <code>switch</code>, well, this was just a pragmatic decision to avoid reserving another keyword. And it shares a lot in common with the semantics of <code>switch</code>; it just avoids all the <code>break</code> nonsense.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x64%3B%26%23x68%3B%26%23x65%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x63%3B%26%23x63%3B%26%23x73%3B%26%23x2e%3B%26%23x6e%3B%26%23x65%3B%26%23x75%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x64;&#x68;&#x65;&#x72;&#x6d;&#x61;&#x6e;&#x40;&#x63;&#x63;&#x73;&#x2e;&#x6e;&#x65;&#x75;&#x2e;&#x65;&#x64;&#x75;">Dave Herman</a> 2011/02/28 19:55</em>
</p>

<p>
I&rsquo;ve changed the name to <code>cond</code> to make it clearer what I&rsquo;m proposing. We could always discuss the tradeoffs between different keywords later. Here&rsquo;s the same comparison redone using <code>cond</code>:
</p>
<pre class="code javascript"><span class="kw2">var</span> x = cond <span class="br0">&#123;</span>
            <span class="kw1">case</span> y &gt; <span class="nu0">100</span> <span class="br0">&#123;</span> <span class="st0">"huge"</span> <span class="br0">&#125;</span>
            <span class="kw1">case</span> y &gt; <span class="nu0">50</span>  <span class="br0">&#123;</span> <span class="st0">"big"</span> <span class="br0">&#125;</span>
            <span class="kw2">default</span>      <span class="br0">&#123;</span> <span class="st0">"small"</span> <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>;</pre>
<p>
vs:
</p>
<pre class="code javascript"><span class="kw2">var</span> x = y &gt; <span class="nu0">100</span>
      ? <span class="st0">"huge"</span>
      : y &gt; <span class="nu0">50</span>
      ? <span class="st0">"big"</span>
      : <span class="st0">"small"</span>;
<span class="co1">// or</span>
<span class="kw2">var</span> x = y &gt; <span class="nu0">100</span> ? <span class="st0">"huge"</span>
      : y &gt; <span class="nu0">50</span>  ? <span class="st0">"big"</span>
                : <span class="st0">"small"</span>;
<span class="co1">// or</span>
<span class="kw2">var</span> x = y &gt; <span class="nu0">100</span> ? <span class="st0">"huge"</span>
      : y &gt; <span class="nu0">50</span>  ? <span class="st0">"big"</span>
      : <span class="st0">"small"</span>;</pre>
<p>
 &mdash; <em><a href="mailto:%26%23x64%3B%26%23x68%3B%26%23x65%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x63%3B%26%23x63%3B%26%23x73%3B%26%23x2e%3B%26%23x6e%3B%26%23x65%3B%26%23x75%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x64;&#x68;&#x65;&#x72;&#x6d;&#x61;&#x6e;&#x40;&#x63;&#x63;&#x73;&#x2e;&#x6e;&#x65;&#x75;&#x2e;&#x65;&#x64;&#x75;">Dave Herman</a> 2011/03/01 01:08</em>
</p>

<p>
Of those 4 suggestions, I prefer that last two. I still don&rsquo;t see the need for the first one.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x63%3B%26%23x72%3B%26%23x6f%3B%26%23x63%3B%26%23x6b%3B%26%23x40%3B%26%23x79%3B%26%23x61%3B%26%23x68%3B%26%23x6f%3B%26%23x6f%3B%26%23x2d%3B%26%23x69%3B%26%23x6e%3B%26%23x63%3B%26%23x2e%3B%26%23x63%3B%26%23x6f%3B%26%23x6d%3B" class="mail" title="&#x63;&#x72;&#x6f;&#x63;&#x6b;&#x40;&#x79;&#x61;&#x68;&#x6f;&#x6f;&#x2d;&#x69;&#x6e;&#x63;&#x2e;&#x63;&#x6f;&#x6d;">Douglas Crockford</a> 2011/03/01 01:26</em>
</p>

<p>
It seems to me <code>?:</code> has already grown into too much of the same niche that <code>cond</code> wants to inhabit.
</p>

<p>
Suggestive data from Go: <a href="http://golang.org/doc/go_spec.html#Expression_switches" class="urlextern" target="_blank" title="http://golang.org/doc/go_spec.html#Expression_switches" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Go generalizes switch</a> so that it subsumes <code>cond</code> and drops C&rsquo;s ?: ternary conditional operator. You find one or the other, but not both. Is there a language derived from C that has both <code>?:</code> and <code>cond</code>?
</p>

<p>
Once again (see also the comma operator), the heavy hand of C is on <acronym title="JavaScript">JS</acronym>&lsquo;s shoulder.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x62%3B%26%23x72%3B%26%23x65%3B%26%23x6e%3B%26%23x64%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x6d%3B%26%23x6f%3B%26%23x7a%3B%26%23x69%3B%26%23x6c%3B%26%23x6c%3B%26%23x61%3B%26%23x2e%3B%26%23x6f%3B%26%23x72%3B%26%23x67%3B" class="mail" title="&#x62;&#x72;&#x65;&#x6e;&#x64;&#x61;&#x6e;&#x40;&#x6d;&#x6f;&#x7a;&#x69;&#x6c;&#x6c;&#x61;&#x2e;&#x6f;&#x72;&#x67;">Brendan Eich</a> 2011/03/02 08:24</em>
</p>

<p>
What&rsquo;s great about Lisp&rsquo;s <code>cond</code> is that it explicitly delineates a case analysis. A key element of good programming is getting case analysis right. (<a href="http://www.cs.yale.edu/quotes.html" class="urlextern" target="_blank" title="http://www.cs.yale.edu/quotes.html" onclick="return svchk()" onkeypress="return svchk()" rel="nofollow">Alan Perlis</a>: &ldquo;Programmers are not to be measured by their ingenuity and their logic but by the completeness of their case analysis.&rdquo;) Both ?: and if-else are structured around one-off checks, which you can chain together to form a bunch of checks. But <code>cond</code> explicitly delineates a case analysis. It&rsquo;s a visual marker that suggests &ldquo;within these braces is a complete enumeration of the space&rdquo; &mdash; does not guarantee, but suggests.
</p>

<p>
When I was in grad school, we taught our undergrads to structure their functions with a <code>cond</code> as the main body, as a way of getting them always to think about their case analysis. Now that we&rsquo;re talking about treating statements more like expressions with <a href="doku.php%3Fid=strawman:shorter_function_syntax.html" class="wikilink1" title="strawman:shorter_function_syntax" onclick="return svchk()" onkeypress="return svchk()">sharp functions</a> and the like, this style becomes more possible:
</p>
<pre class="code javascript">#<span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    cond <span class="br0">&#123;</span>
        <span class="kw1">case</span> p<span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>
        <span class="kw1">case</span> q<span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>
        ...
        <span class="kw2">default</span>  <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
<p>
Now, I could always use if-else:
</p>
<pre class="code javascript">#<span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>...<span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>
    <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>...<span class="br0">&#41;</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>
    <span class="kw1">else</span> <span class="br0">&#123;</span> ... <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
<p>
But these aren&rsquo;t bracketed in a way that delineates the case analysis. It&rsquo;s easy to start mixing imperative code into the middle, and you end up with programming by patching-till-it-does-something. Alternatively, I could use ?:
</p>
<pre class="code javascript">#<span class="br0">&#40;</span>x<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    p<span class="br0">&#40;</span>x<span class="br0">&#41;</span> ? ... :
    q<span class="br0">&#40;</span>x<span class="br0">&#41;</span> ? ... :
           ...
<span class="br0">&#125;</span></pre>
<p>
but this code just doesn&rsquo;t read as clearly to me. The <code>cond</code>-<code>case</code>-<code>default</code> or <code>switch</code>-<code>case</code>-<code>default</code> style reads as a case analysis. The above just reads as abstruse hieroglyphics. Yes, <acronym title="JavaScript">JS</acronym> is in the C tradition, but <acronym title="JavaScript">JS</acronym> is also many people&rsquo;s first programming language. We don&rsquo;t have to remain loyal to the C tradition just because it&rsquo;s familiar to some.
</p>

<p>
Personally, I would probably use <code>cond</code> most of the time, and maybe ?: when there are only two cases. Now that&rsquo;s just my style, and I&rsquo;m not trying to be in the business of forcing people to write <acronym title="JavaScript">JS</acronym> in my style. (Although I would certainly advocate using <code>cond</code> if I were teaching people <acronym title="JavaScript">JS</acronym>, assuming it existed.) But if we don&rsquo;t include it, we are of course forcing people not to use it.
</p>

<p>
I see this as being in a similar space to the ?? operator, which I like a lot. It&rsquo;s not necessary, but it encourages and rewards people for using good style.
</p>

<p>
 &mdash; <em><a href="mailto:%26%23x64%3B%26%23x68%3B%26%23x65%3B%26%23x72%3B%26%23x6d%3B%26%23x61%3B%26%23x6e%3B%26%23x40%3B%26%23x63%3B%26%23x63%3B%26%23x73%3B%26%23x2e%3B%26%23x6e%3B%26%23x65%3B%26%23x75%3B%26%23x2e%3B%26%23x65%3B%26%23x64%3B%26%23x75%3B" class="mail" title="&#x64;&#x68;&#x65;&#x72;&#x6d;&#x61;&#x6e;&#x40;&#x63;&#x63;&#x73;&#x2e;&#x6e;&#x65;&#x75;&#x2e;&#x65;&#x64;&#x75;">Dave Herman</a> 2011/03/02 22:40</em> 
</p>

</div>
<!-- SECTION [537-] -->
<!-- cachefile /usr/local/www/es-lang.org/wiki/data/cache/9/9c138eb15eca13a4b2e5c09a45b89730.xhtml used -->
</body>
</html>
